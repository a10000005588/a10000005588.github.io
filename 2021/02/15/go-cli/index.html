<!DOCTYPE HTML>
<html lang="">

<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="William&#39;s éš¨æ‰‹æœ­è¨˜">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://a10000005588.github.io">
    <!--SEO-->

<meta name="keywords" content="Golang">


<meta name="description" content="ä»¥ä¸‹ç‚ºå­¸ç¿’æœ¬èª²ç¨‹ Pluralshight: The Go CLI Playbook æ‰€è¨˜éŒ„çš„ç­†è¨˜ï¼Œäº†è§£Golangæœ¬èº«æ‰€æä¾›çš„æŒ‡ä»¤é›†å·¥å…·è¦å¦‚ä½•ä½¿ç”¨
https://app.pluralsigh...">


<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->

<title>
    
    Go CLI Playbook å­¸ç¿’ç­†è¨˜ |
    
    William&#39;s éš¨æ‰‹æœ­è¨˜
</title>

<link rel="alternate" href="/atom.xml" title="William&#39;s éš¨æ‰‹æœ­è¨˜" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    

</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">ä½ ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œä¸ºäº†ä½ æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œè¯·æ›´æ–°æµè§ˆå™¨çš„ç‰ˆæœ¬æˆ–è€…ä½¿ç”¨å…¶ä»–ç°ä»£æµè§ˆå™¨ï¼Œæ¯”å¦‚Chromeã€Firefoxã€Safariç­‰ã€‚</div>
<![endif]-->
<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="William L.K.">
            <img src="/img/avatar.jpg" alt="logoå¤´åƒ" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippetä¸»é¢˜,ä»æœªå¦‚æ­¤ç®€å•æœ‰è¶£</h2>-->
            
            <h2>
                Just Code It.
            </h2>
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://a10000005588.github.io">
                        William&#39;s éš¨æ‰‹æœ­è¨˜</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                æœ€æ–°è²¼æ–‡ä¸²</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/programming"><i class="fa "></i>
                                ç¨‹å¼èªè¨€ç­†è¨˜</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/backend/"><i class="fa "></i>
                                Webå¾Œç«¯å·¥ç¨‹</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/tools/"><i class="fa "></i>
                                å·¥å…·ä½¿ç”¨</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/blockchain/"><i class="fa "></i>
                                å€å¡Šéˆ</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa clock"></i>
                                è²¼æ–‡è»Œè·¡</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/about/"><i class="fa "></i>
                                é—œæ–¼æˆ‘(=Â´á´¥`)</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Go CLI Playbook å­¸ç¿’ç­†è¨˜">
            
            Go CLI Playbook å­¸ç¿’ç­†è¨˜
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/Golang/">Golang</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2021/02/15</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>ä»¥ä¸‹ç‚ºå­¸ç¿’æœ¬èª²ç¨‹ <a href="https://app.pluralsight.com/library/courses/go-cli-playbook/table-of-contents" target="_blank" rel="noopener">Pluralshight: The Go CLI Playbook</a> æ‰€è¨˜éŒ„çš„ç­†è¨˜ï¼Œäº†è§£Golangæœ¬èº«æ‰€æä¾›çš„æŒ‡ä»¤é›†å·¥å…·è¦å¦‚ä½•ä½¿ç”¨</p>
<p><a href="https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48" target="_blank" rel="noopener">https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48</a></p>
<h2 id="Go-Command-åŠŸèƒ½"><a href="#Go-Command-åŠŸèƒ½" class="headerlink" title="Go Command åŠŸèƒ½"></a>Go Command åŠŸèƒ½</h2><p>Go çš„åŸºæœ¬Commandå¯ä»¥æä¾›ä»¥ä¸‹åŠŸèƒ½</p>
<ul>
<li>Building Application: æŠŠ<code>.go</code>æª”æ¡ˆç·¨è­¯æˆåŸ·è¡Œæª”</li>
<li>Testing Application: æ¸¬è©¦<code>.go</code>ç¨‹å¼</li>
<li>Profiling Application: æ•ˆèƒ½æ¸¬è©¦</li>
<li>Managing Workspaces: ç®¡ç†é–‹ç™¼ç’°å¢ƒ</li>
<li>Interacting with Environment: èˆ‡ç’°å¢ƒäº’å‹•</li>
</ul>
<h3 id="Go-Commandçš„åˆ—è¡¨"><a href="#Go-Commandçš„åˆ—è¡¨" class="headerlink" title="Go Commandçš„åˆ—è¡¨"></a>Go Commandçš„åˆ—è¡¨</h3><p>åœ¨çµ‚ç«¯æ©Ÿä¸‹ <code>go</code> æŒ‡ä»¤ï¼Œå°±æœƒé¡¯ç¤ºgo commandçš„è©³ç´°è³‡è¨Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">âœ go</span><br><span class="line">Go is a tool for managing Go source code.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"></span><br><span class="line">        go command [arguments]</span><br><span class="line"></span><br><span class="line">The commands are:</span><br><span class="line"></span><br><span class="line">        build       compile packages and dependencies</span><br><span class="line">        clean       remove object files and cached files</span><br><span class="line">        doc         show documentation for package or symbol</span><br><span class="line">        env         print Go environment information</span><br><span class="line">        bug         start a bug report</span><br><span class="line">        fix         update packages to use new APIs</span><br><span class="line">        fmt         gofmt (reformat) package sources</span><br><span class="line">        generate    generate Go files by processing source</span><br><span class="line">        get         download and install packages and dependencies</span><br><span class="line">        install     compile and install packages and dependencies</span><br><span class="line">        list        list packages</span><br><span class="line">        run         compile and run Go program</span><br><span class="line">        test        test packages</span><br><span class="line">        tool        run specified go tool</span><br><span class="line">        version     print Go version</span><br><span class="line">        vet         report likely mistakes in packages</span><br><span class="line"></span><br><span class="line">Use &quot;go help [command]&quot; for more information about a command.</span><br><span class="line"></span><br><span class="line">Additional help topics:</span><br><span class="line"></span><br><span class="line">        c           calling between Go and C</span><br><span class="line">        buildmode   build modes</span><br><span class="line">        cache       build and test caching</span><br><span class="line">        filetype    file types</span><br><span class="line">        gopath      GOPATH environment variable</span><br><span class="line">        environment environment variables</span><br><span class="line">        importpath  import path syntax</span><br><span class="line">        packages    package lists</span><br><span class="line">        testflag    testing flags</span><br><span class="line">        testfunc    testing functions</span><br><span class="line"></span><br><span class="line">Use &quot;go help [topic]&quot; for more information about that topic.</span><br></pre></td></tr></table></figure></p>
<h3 id="å¯é€é-go-help-å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤"><a href="#å¯é€é-go-help-å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤" class="headerlink" title="å¯é€é go help å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤"></a>å¯é€é <code>go help</code> å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤</h3><p>å‡å¦‚è¦çœ‹go testçš„ä»‹ç´¹ï¼Œé‚£å°±ä¸‹é€™è¡ŒæŒ‡ä»¤ <code>go help test</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">âœ go help test</span><br><span class="line">usage: go test [build/test flags] [packages] [build/test flags &amp; test binary flags]</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; automates testing the packages named by the import paths.</span><br><span class="line">It prints a summary of the test results in the format:</span><br><span class="line"></span><br><span class="line">        ok   archive/tar   0.011s</span><br><span class="line">        FAIL archive/zip   0.022s</span><br><span class="line">        ok   compress/gzip 0.033s</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">followed by detailed output for each failed package.</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; recompiles each package along with any files with names matching</span><br><span class="line">the file pattern &quot;*_test.go&quot;.</span><br><span class="line">These additional files can contain test functions, benchmark functions, and</span><br><span class="line">example functions. See &apos;go help testfunc&apos; for more.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The test binary also accepts flags that control execution of the test; these</span><br><span class="line">flags are also accessible by &apos;go test&apos;. See &apos;go help testflag&apos; for details.</span><br><span class="line"></span><br><span class="line">For more about build flags, see &apos;go help build&apos;.</span><br><span class="line">For more about specifying packages, see &apos;go help packages&apos;.</span><br></pre></td></tr></table></figure>
<h2 id="go-env-æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸"><a href="#go-env-æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸" class="headerlink" title="go env æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸"></a><code>go env</code> æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; go env</span><br><span class="line"></span><br><span class="line">GOARCH=&quot;amd64&quot;</span><br><span class="line">GOBIN=&quot;/Users/username/go/bin&quot;</span><br><span class="line">GOCACHE=&quot;/Users/username/Library/Caches/go-build&quot;</span><br><span class="line">GOEXE=&quot;&quot;</span><br><span class="line">GOHOSTARCH=&quot;amd64&quot;</span><br><span class="line">GOHOSTOS=&quot;darwin&quot;</span><br><span class="line">GOOS=&quot;darwin&quot;</span><br><span class="line">GOPATH=&quot;/Users/username/go&quot;</span><br><span class="line">GORACE=&quot;&quot;</span><br><span class="line">GOROOT=&quot;/usr/local/Cellar/go/1.10.2/libexec&quot;</span><br><span class="line">GOTMPDIR=&quot;&quot;</span><br><span class="line">GOTOOLDIR=&quot;/usr/local/Cellar/go/1.10.2/libexec/pkg/tool/darwin_amd64&quot;</span><br><span class="line">GCCGO=&quot;gccgo&quot;</span><br><span class="line">CC=&quot;clang&quot;</span><br><span class="line">CXX=&quot;clang++&quot;</span><br><span class="line">CGO_ENABLED=&quot;1&quot;</span><br><span class="line">CGO_CFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_CPPFLAGS=&quot;&quot;</span><br><span class="line">CGO_CXXFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_FFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_LDFLAGS=&quot;-g -O2&quot;</span><br><span class="line">PKG_CONFIG=&quot;pkg-config&quot;</span><br><span class="line">GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build760606218=/tmp/go-build -gno-record-gcc-switches -fno-common&quot;</span><br></pre></td></tr></table></figure>
<h2 id="go-run-åŸ·è¡Œç¨‹å¼"><a href="#go-run-åŸ·è¡Œç¨‹å¼" class="headerlink" title="go run åŸ·è¡Œç¨‹å¼"></a><code>go run</code> åŸ·è¡Œç¨‹å¼</h2><blockquote>
<p>æ³¨æ„ï¼Œè‹¥è¦é‹ç¨‹<code>go run</code>ï¼Œéœ€è¦åœ¨<code>$GOPATH</code>åº•ä¸‹çš„<code>src</code>ç›®éŒ„é€²è¡Œ</p>
</blockquote>
<p>é‹è¡Œä¸€å€‹åŒ…å«main()æ–¹æ³•çš„ç¨‹å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; go run main.go</span><br></pre></td></tr></table></figure>
<h3 id="é€é-go-run-raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race-conditionçš„ç‹€æ³ç™¼ç”Ÿ"><a href="#é€é-go-run-raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race-conditionçš„ç‹€æ³ç™¼ç”Ÿ" class="headerlink" title="é€é go run --raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿ"></a>é€é <code>go run --race</code>ä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿ</h3><p>è‹¥ç›®å‰æœ‰å€‹ä½¿ç”¨<code>gorouting</code>çš„ç¨‹å¼ï¼Œè‹¥è¦åµæ¸¬æ˜¯å¦æœƒç™¼ç”Ÿrace conditionç‹€æ³ï¼Œå¯ä»¥åŠ ä¸Š<code>-race</code>é€™å€‹flag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			fmt.Println(i)</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‹¥æœ‰race conditionï¼Œgo toolæœƒç”¢å‡ºå ±å‘Šä¾†è§£é‡‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">âœ go run -race race_condition/main.go </span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 8:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 8 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 7:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 7 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line">Found 2 data race(s)</span><br><span class="line">exit status 66</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬ä¾†èªªåœ¨devæ¨¡å¼æ™‚ï¼Œæœƒå»ºè­°æ¯æ¬¡é‹è¡Œå°ˆæ¡ˆæ™‚ï¼Œéƒ½åŠ ä¸Š-race</span><br></pre></td></tr></table></figure>
<h2 id="go-build-ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´"><a href="#go-build-ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´" class="headerlink" title="go build ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´"></a><code>go build</code> ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´</h2><p><code>go build</code>æœƒæŠŠå°ˆæ¡ˆç·¨è­¯æˆåŸ·è¡Œæª”</p>
<p>è‹¥ç›®å‰æœ‰å€‹åœ¨cmdsè³‡æ–™å¤¾å…§çš„å°ˆæ¡ˆå«åš <code>hello</code> ä¸¦å¼•ç”¨äº†<code>helloService</code>é€™å€‹ä¾è³´å…§çš„æ–¹æ³•</p>
<p>cmds/hello.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"helloService"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	helloService.SayHello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>helloService/msg.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHello represents a greeting to developer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£åœ¨ <code>/cmds/hello</code>å°ˆæ¡ˆä¸­åŸ·è¡Œ <code>go build</code>ï¼Œæœƒåœ¨ç•¶å‰ç›®éŒ„ç”¢ç”Ÿ<code>hello</code>åŸ·è¡Œæª”</p>
<p><img src="./pics/01.png" alt=""></p>
<p>å¯ç›´æ¥åŸ·è¡Œè©²åŸ·è¡Œæª”</p>
<p><img src="./pics/02.png" alt=""></p>
<h3 id="ä½¿ç”¨-go-build-oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±"><a href="#ä½¿ç”¨-go-build-oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±" class="headerlink" title="ä½¿ç”¨ go build -oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±"></a>ä½¿ç”¨ <code>go build -o</code>å®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±</h3><p>å‡å¦‚è¦æŠŠç·¨è­¯æª”æ¡ˆå«åš<code>hello_exe.a</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ <span class="keyword">go</span> build -o hello_exe.a</span><br></pre></td></tr></table></figure>
<p><img src="./pics/03.png" alt=""></p>
<h3 id="ä½¿ç”¨-go-build-i-ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´"><a href="#ä½¿ç”¨-go-build-i-ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´" class="headerlink" title="ä½¿ç”¨ go build -i ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´"></a>ä½¿ç”¨ <code>go build -i</code> ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´</h3><p>è‹¥å°å°ˆæ¡ˆé€²è¡Œç·¨è­¯æ™‚ï¼ŒåŠ ä¸Š<code>-i</code>åƒæ•¸ï¼ŒæœƒåŒæ™‚å°‡importçš„ä¾è³´ (ex:<code>helloService</code>)ä¹Ÿæœƒç·¨è­¯è©²ä¾è³´å€‘ä¸¦å®‰è£åœ¨ <code>$GOPATH/pkg</code>åº•ä¸‹</p>
<p><img src="./pics/04.png" alt=""></p>
<h3 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h3><p>Go Official Docs: Command go<br><a href="https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies" target="_blank" rel="noopener">https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies</a></p>
<h2 id="go-install-ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage"><a href="#go-install-ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage" class="headerlink" title="go install ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage"></a><code>go install</code> ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage</h2><p>æœƒå°‡å°ˆæ¡ˆ (main) é€²è¡Œç·¨è­¯æˆbinæª”æ¡ˆä¸¦æ”¾ç½®åœ¨<code>$GOPATH/bin</code>åº•ä¸‹</p>
<p>æœƒå°‡ä¾è³´ (package) é€²è¡Œç·¨è­¯ä¸¦å®‰è£åœ¨<code>$GOPATH/pkg</code>åº•ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœå·²ç¶“æœ‰å­˜åœ¨çš„ä¾è³´æˆ–æ˜¯binaryæª”æ¡ˆã€é‚£go installå°±ä¸æœƒæœ‰ä½œç”¨</span><br></pre></td></tr></table></figure>
<h3 id="go-install-nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ"><a href="#go-install-nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ" class="headerlink" title="go install -nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ"></a><code>go install -n</code>ï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ</h3><p>å‡å¦‚æˆ‘å€‘åœ¨å°å‰›å‰›çš„helloServiceé€™å€‹ä¾è³´ï¼Œé€²è¡Œ<code>go install -n</code></p>
<p>æœƒçœ‹åˆ°ä¸æœƒåšä»€éº¼å‹•ä½œï¼Œå› ç‚ºå·²ç¶“æœ‰å®‰è£è©²ä¾è³´åœ¨<code>pkg</code>åº•ä¸‹</p>
<p><img src="./pics/05.png" alt=""></p>
<p>å°‡è©²ä¾è³´ç§»é™¤ï¼Œå†æ¬¡åŸ·è¡Œä¸€éï¼Œæœƒçœ‹åˆ°go toolåŸ·è¡Œäº†ä»€éº¼å‹•ä½œ</p>
<p><img src="./pics/06.png" alt=""></p>
<h3 id="go-install-xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ"><a href="#go-install-xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ" class="headerlink" title="go install -xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ"></a><code>go install -x</code>ï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ</h3><h4 id="å…¶ä»–flag"><a href="#å…¶ä»–flag" class="headerlink" title="å…¶ä»–flag"></a>å…¶ä»–flag</h4><ul>
<li>-p n: æŒ‡å®šç”¨å¤šå°‘å€‹cpuä¾†é€²è¡Œinstall, é è¨­æ˜¯å¯å–å¾—çš„æ•¸é‡</li>
</ul>
<h3 id="ç”¢ç”ŸShared-Librariesï¼Œä½¿ç”¨-buildmode-flag"><a href="#ç”¢ç”ŸShared-Librariesï¼Œä½¿ç”¨-buildmode-flag" class="headerlink" title="ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨-buildmode flag"></a>ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨<code>-buildmode</code> flag</h3><p>é€é <code>go build -buildmode</code> æˆ–æ˜¯ <code>go install -buildmode</code><br>å¯ä»¥åƒCæˆ–C++é‚£æ¨£ç”¢ç”ŸShared Librariesï¼Œä¾›å‹•æ…‹è¼‰å…¥</p>
<p>é€é<code>go help buildmode</code>å¯æŸ¥çœ‹æœ‰æä¾›å“ªäº›æ¨¡å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é è¨­-buildmodeæœƒä½¿ç”¨ archiveï¼šå°‡æª”æ¡ˆç·¨è­¯æˆ .a</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ -buildmode=sharedï¼šå°‡æª”æ¡ˆç·¨è­¯æˆå¯å‹•æ…‹è¼‰å…¥çš„shared libï¼Œæˆ–æ˜¯åœ¨runtimeæ™‚å¯é€£çµ</span><br></pre></td></tr></table></figure>
<p>å‡å¦‚å†ç”¨å‰›å‰›çš„ç¯„ä¾‹ï¼Œä¸€å€‹<code>cmds/hello.go</code>ä¸­å¼•ç”¨äº† helloServiceé€™å€‹package</p>
<p><img src="./pics/07.png" alt=""></p>
<h4 id="ä½¿ç”¨-buildmode-shared-ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-shared-ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=shared ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=shared</code> ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Libraries</h4><p>è‹¥è¦å°‡æŸå€‹packageç·¨è­¯æˆshared libraryï¼Œ</p>
<p>èˆ‰å€‹ä¾‹å­ï¼ŒæŠŠ<code>helloService</code> ç·¨è­¯æˆshared libraryä¸¦å®‰è£åœ¨<code>pkg</code>è³‡æ–™å¤¾ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go install -buildmode=shared helloService</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„: Macosä¸æ”¯æ´ -buildmode=shared<br>-buildmode=shared not supported on darwin/amd64</p>
</blockquote>
<p>æ¥è‘—ç·¨è­¯ä¸»ç¨‹å¼ï¼Œä¸¦æŒ‡å®šå…¶åŸ·è¡Œæª”å¯ä»¥å‹•æ…‹è¼‰å…¥(-linkshared) shared library</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go build -linkshared cmds/hello</span><br></pre></td></tr></table></figure>
<p>åŸ·è¡Œç·¨è­¯å¾Œçš„åŸ·è¡Œæª” <code>./hello</code> ï¼Œå¯çœ‹åˆ°å…¶çµæœ</p>
<p>ä¸éè‹¥å°‡<code>pkg</code>ä¸­ï¼Œå‰›å‰›go installçš„<code>helloService</code>çš„shared libraryçµ¦åˆªé™¤çš„è©±ï¼Œå†æ¬¡åŸ·è¡Œ <code>/.hello</code> é‚£å°±æœƒç™¼ç”Ÿç„¡æ³•åŸ·è¡Œç‹€æ³ã€‚</p>
<h4 id="ä½¿ç”¨-buildmode-c-archive-ç”¢ç”Ÿä¾›C-language-â€œéœæ…‹â€é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-c-archive-ç”¢ç”Ÿä¾›C-language-â€œéœæ…‹â€é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=c-archive ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=c-archive</code> ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Libraries</h4><p>å¦‚æœæƒ³è¦å°‡pakcageç·¨è­¯æˆCå¯ä»¥è¼‰å…¥çš„shared libraryçš„è©±ï¼Œéœ€è¦å°pakcageçš„methodï¼ŒåŠ ä¸Š <code>//export functionName</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> helloService</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//export SayHello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‹¥ä½¿ç”¨ <code>-buildmode=c-archive</code>çš„è©±ï¼Œå‰‡æœƒç”¢ç”Ÿå‡º <code>.h</code>èˆ‡<code>.a</code>çš„shared library</p>
<blockquote>
<p>æ³¨æ„: Macosé‹è¡Œ<code>-buildmode=c-archive</code> æœƒç„¡æ³•ç”¢ç”Ÿ <code>.h</code>æª”æ¡ˆ goç‰ˆæœ¬: go1.15 darwin/amd64</p>
</blockquote>
<p>æ¥è‘—å°±å¯ä»¥åœ¨Cèªè¨€å…§å¼•å…¥ç”¨Go buildå¥½çš„share library</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello.a"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  SayHello();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸ·è¡Œä¹‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc hello.c ./hello</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-buildmode-c-shared-ç”¢ç”Ÿä¾›C-language-â€œå‹•æ…‹â€é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-c-shared-ç”¢ç”Ÿä¾›C-language-â€œå‹•æ…‹â€é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=c-shared ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=c-shared</code> ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared Libraries</h4><p>åŒç”¨goç”¢ç”Ÿå‡ºshared library</p>
<h4 id="ä½¿ç”¨-buildmode-plugin-å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo-plugin"><a href="#ä½¿ç”¨-buildmode-plugin-å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo-plugin" class="headerlink" title="ä½¿ç”¨ -buildmode=plugin å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo plugin"></a>ä½¿ç”¨ <code>-buildmode=plugin</code> å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo plugin</h4><p>å¯ä»¥æŠŠå°ˆæ¡ˆéœ€è¦importçš„packageï¼Œæ‰“åŒ…æˆplugin</p>
<p>èˆ‰å€‹ä¾‹å­ï¼Œè‹¥ç¾åœ¨æˆ‘å€‘è¦å°‡pluginé€™ä¸€å€‹pakcageæ‰“åŒ…æˆplugin</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ThingToDo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Executing action"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€éä»¥ä¸‹æŒ‡ä»¤ï¼Œåšå‡ºä¸€å€‹pluginï¼Œæª”åå«åš plugin å‰¯æª”åç‚º<code>.so</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go build -buildmode=plugin -o=plugin.so plugin/plugin.go</span><br></pre></td></tr></table></figure></p>
<p>æ¥è‘—æˆ‘å€‘å®šç¾©äº†ä¸€å€‹å°å°ˆæ¡ˆï¼Œä¾†ä½¿ç”¨plugin</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"flag"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"plugin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	path := flag.String(<span class="string">"plugin"</span>, <span class="string">""</span>, <span class="string">"Plugin to execute"</span>)</span><br><span class="line"></span><br><span class="line">	flag.Parse()</span><br><span class="line">    <span class="comment">// å¦‚æœåŸ·è¡Œgoæ™‚æ²’æœ‰å¸¶ -pluginæŒ‡ä»¤</span></span><br><span class="line">	<span class="keyword">if</span> *path == <span class="string">""</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">"Path to plugin must be provided"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®€å–plugin</span></span><br><span class="line">	p, err := plugin.Open(*path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°‹æ‰¾pluginæ˜¯å¦æœ‰ThingToDoé€™å€‹æ–¹æ³•</span></span><br><span class="line">	f, err := p.Lookup(<span class="string">"ThingToDo"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	thingToDo, ok := f.(<span class="function"><span class="keyword">func</span><span class="params">()</span>)</span></span><br><span class="line"><span class="function">	<span class="title">if</span> !<span class="title">ok</span></span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">"Could not find function 'ThingToDo' in plugin"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	thingToDo()</span><br><span class="line">	log.Println(<span class="string">"Did the thing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥è‘—é‹è¡Œä¸‹é¢æŒ‡ä»¤ä½¿ç”¨plugin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go run action/action.go -plugin=./plugin.so</span><br></pre></td></tr></table></figure>
<p>å¦‚æœpluginå­˜åœ¨çš„è©±ï¼Œå°±å¯ä»¥åŸ·è¡Œ <code>plugin.so</code>å…§çš„<code>ThingToDo</code>æ–¹æ³•</p>
<p>åŸ·è¡Œçµæœ<br><img src="./pics/08.png" alt=""></p>
<h4 id="åƒè€ƒ-1"><a href="#åƒè€ƒ-1" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h4><p>Golangçš„æ„å»ºæ¨¡å¼ - Chen Jiehua<br><a href="https://chenjiehua.me/golang/golang-buildmode.html" target="_blank" rel="noopener">https://chenjiehua.me/golang/golang-buildmode.html</a></p>
<h2 id="go-test-æ’°å¯«å–®å…ƒæ¸¬è©¦Unit-Testing-Programs"><a href="#go-test-æ’°å¯«å–®å…ƒæ¸¬è©¦Unit-Testing-Programs" class="headerlink" title="go test æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programs"></a><code>go test</code> æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programs</h2><p>é€é <code>go test</code> å¯æ¸¬è©¦golangæ’°å¯«çš„ç¨‹å¼çš„Inputèˆ‡Outputæ˜¯å¦æ­£ç¢º</p>
<h3 id="æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡"><a href="#æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡" class="headerlink" title="æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡"></a>æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡</h3><p>ç”±æ–¼goæœ¬èº«å°æ¸¬è©¦æœ‰è‘—åš´è¬¹çš„è¦å‰‡ï¼Œæ•…å¯ä»¥é¿å…åƒå…¶ä»–èªè¨€é‚£æ¨£æœ‰å„ç¨®ä¸åŒæ¸¬è©¦çš„æ¡†æ¶ï¼Œä»¥çµ±ä¸€æ¸¬è©¦çš„æ¨£å¼</p>
<p>å…¶è¦å‰‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>è‹¥æœ‰å®šç¾©æ¸¬è©¦çš„æª”æ¡ˆåç¨±ï¼Œéœ€è¦ä»¥ <code>_test.go</code>æœ€çµå°¾å‘½å</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mylib_test.go</span><br></pre></td></tr></table></figure>
<ul>
<li>è‹¥éœ€è¦è¢«æ¸¬è©¦çš„æ–¹æ³•ï¼Œè«‹ä»¥ <code>Test_</code> ç‚ºé–‹é ­</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func Test_MyFunction() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åŸ·è¡Œæ¸¬è©¦"><a href="#åŸ·è¡Œæ¸¬è©¦" class="headerlink" title="åŸ·è¡Œæ¸¬è©¦"></a>åŸ·è¡Œæ¸¬è©¦</h3><p>è‹¥æœ‰å€‹å°ˆæ¡ˆå«åš <code>testing_example</code>ï¼Œå…¶ç›®éŒ„æ¶æ§‹å¦‚ä¸‹</p>
<p><img src="./pics/09.png" alt=""></p>
<p><code>testing_example/mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">			t.Fail()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	t.Run(<span class="string">"Go can concatenate strings"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"Hello, "</span>+<span class="string">"Go"</span> != <span class="string">"Hello, Go"</span> &#123;</span><br><span class="line">			t.Fail()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶å­packageä¹Ÿæœ‰å®šç¾©testing file <code></code>testing_example/childlib/childlib_test.go`<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> childlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_MoreBasics</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="number">10</span><span class="number">-5</span> != <span class="number">5</span> &#123;</span><br><span class="line">		t.Error(<span class="string">"Failed to subtract correctly"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡"><a href="#åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡" class="headerlink" title="åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡"></a>åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡</h3><p>è‹¥è¦å°å°ˆæ¡ˆåŸ·è¡ŒUnit Testï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test testing_example </span><br><span class="line">ok      testing_example 0.014s</span><br></pre></td></tr></table></figure>
<p>ä½†æœƒç™¼ç¾child packageçš„æ¸¬è©¦æ²’æœ‰åŸ·è¡Œåˆ°ï¼Œæ‰€ä»¥è‹¥è¦å°packageå…§æ‰€æœ‰å­<br>packageéƒ½é€²è¡Œæ¸¬è©¦ï¼Œé‚£éœ€è¦åŠ ä¸Š <code>/...</code> åšéè¿´å°‹æ‰¾çš„å‹•ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via ğŸ¹ v1.15 </span><br><span class="line">âœ go test testing_example/...</span><br><span class="line">ok      testing_example (cached)</span><br><span class="line">ok      testing_example/childlib        0.015s</span><br></pre></td></tr></table></figure>
<h3 id="æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸-flags"><a href="#æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸-flags" class="headerlink" title="æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flags"></a>æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flags</h3><p>é€é <code>go help testflag</code> å¯ä»¥æŸ¥çœ‹åŸ·è¡Œæ¸¬è©¦æ™‚å¯ä»¥å®¢è£½åŒ–çš„é¸æ“‡</p>
<p>åˆ—èˆ‰ä¸€äº›å¸¸ä½¿ç”¨çš„ï¼š</p>
<ul>
<li><code>-cpu</code>: æŒ‡å®šæ¸¬è©¦æ™‚ä½¿ç”¨çš„CPUæ•¸é‡ï¼Œé è¨­æ˜¯æœƒä½¿ç”¨ <code>GOMAXPROCS</code>åƒæ•¸çš„å€¼</li>
<li><code>-parallel</code>: æ¸¬è©¦æ™‚å¯ä»¥ä¸¦è¡Œè™•ç†ï¼Œä½†åªæœ‰æŒ‡å®šFunctionæ‰æœƒè¢«ä¸¦è¡Œè™•ç†</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	t.Parallel()  <span class="comment">// é€²è¡Œä¸¦è¡Œæ¸¬è©¦</span></span><br><span class="line">	t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">			t.Fail()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-list</code>: å¯é€éæ­£å‰‡è¡¨é”å¼éæ¿¾å‡ºæ¸¬è©¦æ–¹æ³•åç¨±ï¼Œå†æ¸¬è©¦æ™‚æœƒåˆ—å‡ºç¬¦åˆçš„æ¸¬è©¦æ–¹æ³•çµ¦</li>
</ul>
<p>å‡å¦‚è¦åˆ—å‡ºæœ‰åŒ…å« <code>Basics</code>çš„æ¸¬è©¦æ–¹æ³•åç¨±ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -list Basics testing_example/...</span><br><span class="line">ok      testing_example 0.022s</span><br><span class="line">Test_MoreBasics   // åˆ—å‡º</span><br><span class="line">ok      testing_example/childlib        0.023s</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>-run</code>: è·ŸListå¾ˆåƒï¼Œä½†åªæœƒåŸ·è¡Œç¬¦åˆæ­£å‰‡è¡¨é”å¼çš„æ¸¬è©¦æ–¹æ³•<ul>
<li>ä½¿ç”¨æ™‚æ©Ÿï¼šè‹¥é–‹ç™¼å‡ºå­å°ˆæ¡ˆçš„æ¸¬è©¦æ–¹æ³•ï¼Œé€é<code>-run</code>æŒ‡å®šè©²å­å°ˆæ¡ˆçš„scopeåŸ·è¡Œæ¸¬è©¦å°±å¥½ï¼Œå°±å¯ä»¥çœå»ä¸å°‘æ™‚é–“</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -run Basics testing_example/...</span><br><span class="line">ok      testing_example 0.024s [no tests to run]</span><br><span class="line">ok      testing_example/childlib        0.022s</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-timeout d</code>: è¶…éå¤šä¹…å°±åœæ­¢æ¸¬è©¦ï¼Œé è¨­ç‚º10åˆ†é˜</li>
<li><code>-v</code>: æ¸¬è©¦æ™‚å°‡è©³ç´°çµæœåˆ—å‡ºä¾†</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -v testing_example/...</span><br><span class="line">=== RUN   Test_BasicChecks</span><br><span class="line">=== PAUSE Test_BasicChecks</span><br><span class="line">=== CONT  Test_BasicChecks</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_add</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_concatenate_strings</span><br><span class="line">--- PASS: Test_BasicChecks (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_add (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_concatenate_strings (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example 0.017s</span><br><span class="line">=== RUN   Test_MoreBasics</span><br><span class="line">=== PAUSE Test_MoreBasics</span><br><span class="line">=== CONT  Test_MoreBasics</span><br><span class="line">--- PASS: Test_MoreBasics (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example/childlib        0.025s</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-count</code>: æŒ‡å®šåŸ·è¡Œæ¸¬è©¦çš„æ¬¡æ•¸</li>
<li><code>-cover</code>: é¡¯ç¤ºæ¸¬è©¦çš„æ¶µè“‹ç¯„åœè³‡è¨Š</li>
</ul>
<h3 id="æ¸¬è©¦çš„æ¶µè“‹-Code-Coverage"><a href="#æ¸¬è©¦çš„æ¶µè“‹-Code-Coverage" class="headerlink" title="æ¸¬è©¦çš„æ¶µè“‹ Code Coverage"></a>æ¸¬è©¦çš„æ¶µè“‹ Code Coverage</h3><p>å¯ä»¥é€é <code>go test -cover</code> ä¾†æŸ¥çœ‹ç›®å‰æ¸¬è©¦é …ç›®æ¶µè“‹äº†å¤šå°‘é–‹ç™¼çš„å…§å®¹</p>
<p>ä»¥ä¸‹ç‚ºæ¸¬è©¦çš„é …ç›®å…§å®¹ï¼š</p>
<p><img src="./pics/10.png" alt=""></p>
<p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subractor</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l - r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨é€™é‚Šåªæœ‰æ¸¬è©¦adderæ–¹æ³•ï¼Œæ²’æœ‰subractoræ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">		t.Fail()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„ç¯„ä¾‹åªæ¸¬è©¦ä¸€å€‹æ–¹æ³•<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span> </span><br><span class="line">âœ <span class="keyword">go</span> test -cover testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.013s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure></p>
<h4 id="é€égo-test-coverpkg-æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package"><a href="#é€égo-test-coverpkg-æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package" class="headerlink" title="é€égo test -coverpkg æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package"></a>é€é<code>go test -coverpkg</code> æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package</h4><p>å†ç”¨ä¸Šè¿°çš„ç¯„ä¾‹ï¼Œæˆ‘å€‘æ‰“ç®—æ¸¬è©¦å°ˆæ¡ˆ <code>testing_example_1</code>ä¸­çš„ <code>fmt</code> èˆ‡ <code>testing_example_1</code>æœ¬èº«è‡ªå·±é€™å…©å€‹pacakgeï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -coverpkg testing_example_1, fmt testing_example_1 </span><br><span class="line">warning: no packages being tested depend on matches for pattern </span><br><span class="line">ok      fmt     0.089s  coverage: 0.0% of statements in testing_example_1, </span><br><span class="line">ok      testing_example_1       0.019s  coverage: 50.0% of statements in testing_example_1,</span><br></pre></td></tr></table></figure>
<h4 id="é€égo-test-coverprofile-ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š"><a href="#é€égo-test-coverprofile-ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š" class="headerlink" title="é€égo test -coverprofile ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š"></a>é€é<code>go test -coverprofile</code> ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       0.012s  coverage: 50.0% of statements</span><br></pre></td></tr></table></figure>
<p>åŒæ™‚æœƒç”¢ç”Ÿ <code>cover.out</code>é€™å€‹æ¸¬è©¦å ±å‘Šæª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mode: set</span><br><span class="line">testing_example_1/mylib.go:3.26,5.2 1 1</span><br><span class="line">testing_example_1/mylib.go:7.30,9.2 1 0</span><br></pre></td></tr></table></figure></p>
<h4 id="é€é-go-tool-æŸ¥çœ‹æ¸¬è©¦å ±å‘Š"><a href="#é€é-go-tool-æŸ¥çœ‹æ¸¬è©¦å ±å‘Š" class="headerlink" title="é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Š"></a>é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Š</h4><p>å¯ä»¥é€é <code>go tool cover -html= æ¸¬è©¦å ±å‘Šæª”æ¡ˆåç¨±</code> ä¾†ç”¢ç”Ÿå‡ºä»¥ç¶²é æ–¹å¼ç€è¦½çš„å ±å‘Š</p>
<p>è‹¥è¦è§£æç”¢ç”Ÿå‡ºä¾†çš„å ±å‘Š <code>cover.out</code></p>
<p><code>go tool cover -html=cover.out</code></p>
<p>å¯ä»¥ç”¢å‡ºWebå‘ˆç¾ï¼Œæ¸¬è©¦çš„å ±å‘Š</p>
<p><img src="pics/11.png" alt=""><br><img src="https://i.imgur.com/SgATMg2.png" alt=""></p>
<p>å¦‚æœè¦çœ‹å‡ºæ›´è©³ç´°çš„æ¸¬è©¦å ±å‘Šçš„è©±ï¼Œä¾‹å¦‚æƒ³çœ‹åˆ°æ¸¬è©¦æ–¹æ³•è¢«åŸ·è¡Œå¹¾æ¬¡</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span></span><br><span class="line">âœ <span class="keyword">go</span> test -covermode count -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.018s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure>
<p>ä¸€æ¨£æœƒç”¢ç”Ÿå‡º <code>cover.out</code>æª”æ¡ˆï¼Œé€™æ™‚å†é€é <code>go tool cover -html</code></p>
<p><img src="pics/12.png" alt=""><br><img src="https://i.imgur.com/mncGfk7.png" alt=""></p>
<h3 id="é€²è¡Œå£“åŠ›æ¸¬è©¦-Benchmark-Testing"><a href="#é€²è¡Œå£“åŠ›æ¸¬è©¦-Benchmark-Testing" class="headerlink" title="é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testing"></a>é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testing</h3><p>golangçš„testå·¥å…·äº¦æä¾›benchmarkçš„æ¸¬è©¦ï¼Œå¯ä»¥çœ‹å‡ºè©²æ–¹æ³•éœ€è¦è€—è²»å¤šå°‘CPUè³‡æº</p>
<h4 id="è¦å‰‡"><a href="#è¦å‰‡" class="headerlink" title="è¦å‰‡"></a>è¦å‰‡</h4><p>éœ€è¦å®šç¾©æ–¹æ³•åç¨±å‰ç¶´ç‚º <code>Benchmark</code> ä¾‹å¦‚:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æŒ‡ä»¤-go-test-bench"><a href="#æŒ‡ä»¤-go-test-bench" class="headerlink" title="æŒ‡ä»¤: go test -bench"></a>æŒ‡ä»¤: <code>go test -bench</code></h4><p>è‹¥è¦å°testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆï¼š<br><img src="pics/13.png" alt=""><br><img src="https://i.imgur.com/FPmr2HU.png" alt=""></p>
<p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">		t.Fail()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€™æ™‚é€é <code>go test -bench Adder testing_example_2</code>ï¼Œå°<code>testing_example_2</code>é€™å°ˆæ¡ˆå…§æœ‰åŒ…å« <code>Adder</code>çš„å£“æ¸¬æ–¹æ³•é€²è¡Œå£“åŠ›æ¸¬è©¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15</span><br><span class="line">âœ go test -bench Adder testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4        1000000000               0.374 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.433s</span><br></pre></td></tr></table></figure>
<p>BenchmarkAdder é€™éš»æ–¹æ³•åŸ·è¡Œäº†1000000000æ¬¡, æ¯æ¬¡èŠ±äº† 0.374 ns</p>
<p>æˆ–æ˜¯ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ–¹æ³•Benchmarkåç¨± <code>go test -bench . testing_example_2</code></p>
<h4 id="æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š-go-test-benchtime"><a href="#æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š-go-test-benchtime" class="headerlink" title="æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š go test -benchtime"></a>æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š <code>go test -benchtime</code></h4><p>å¯æŒ‡å®šå£“æ¸¬æ¸¬å¤šå°‘æ™‚é–“ï¼Œå¯ä»¥æ“´å±•å£“æ¸¬çš„æ¬¡æ•¸</p>
<p>èˆ‰ä¾‹ï¼Œåªå£“æ¸¬0.001ç§’ï¼Œé‚£å¯çœ‹åˆ°åªæœƒæ¸¬å‡º 2864049æ¬¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -benchtime 0.001s -bench . testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4         2864049                 0.485 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.024s</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### æª¢è¦–å£“åŠ›æ¸¬è©¦èŠ±å¤šå°‘è¨˜æ†¶é«”ï¼š `go test -bench . -benchmem`</span><br><span class="line"></span><br><span class="line">é€é `-bemchmem`é€™å€‹flagï¼Œå£“æ¸¬è³‡è¨Šæœƒå¤šäº† `B/op` èˆ‡ `allocs/op` ä¾†æª¢è¦–è©²æ–¹æ³•å£“æ¸¬æ™‚èŠ±äº†å¤šå°‘è¨˜æ†¶é«”è³‡æº</span><br></pre></td></tr></table></figure>
<p>~/go/src via v1.15<br>âœ go test -bench . -benchmem testing_example_2<br>goos: darwin<br>goarch: amd64<br>pkg: testing_example_2<br>BenchmarkAdder-4        1000000000               0.501 ns/op           0 B/op          0 allocs/op<br>PASS<br>ok      testing_example_2       0.586s<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### ä½¿ç”¨go tool pprof  (performance profiling tool) ç”¢ç”Ÿæ¸¬è©¦å ±å‘Š</span><br><span class="line"></span><br><span class="line">ç”¢å‡ºå ±å‘Šä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£ `graphviz`é€™å€‹å¥—ä»¶ï¼Œé€™æ¨£go toolæ‰èƒ½å¤ ç¹ªè£½æµç¨‹åœ–ä¾›æˆ‘å€‘æŸ¥çœ‹</span><br><span class="line"></span><br><span class="line">Linux/Macos</span><br></pre></td></tr></table></figure></p>
<p>sudo apt-get install graphyiz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; æ›´å¤šæœ‰é—œgraphyizè³‡è¨Šè«‹åˆ°ï¼š http://graphviz.org</span><br><span class="line">&gt; </span><br><span class="line"></span><br><span class="line">#### ç”¢ç”Ÿç¨‹å¼è¨˜æ†¶é«”èŠ±è²»å ±å‘Š `go test -memprofile`</span><br><span class="line"></span><br><span class="line">ä¸€æ¨£ç”¨testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆåšæ¸¬è©¦</span><br><span class="line"></span><br><span class="line">![](pics/14.png)</span><br><span class="line">![](https://i.imgur.com/FPmr2HU.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`mylib.go`</span><br><span class="line">```go=</span><br><span class="line">package mylib</span><br><span class="line"></span><br><span class="line">func adder(l, r int) int &#123;</span><br><span class="line">	return l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">		t.Fail()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€é <code>go test -memprofile mem.out testing_example_2</code> ä¾†ç”¢å‡ºå«åš <code>mem.out</code>çš„æ¸¬è©¦å ±å‘Š</p>
<p>æ¸¬è©¦çµæœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -memprofile mem.out testing_example_2</span><br><span class="line">ok      testing_example_2       0.018s</span><br></pre></td></tr></table></figure></p>
<p>ä»¥åŠæœƒç”¢ç”Ÿå…©å€‹æª”æ¡ˆ <code>mem.out</code> èˆ‡ <code>testing_example_2.test</code>ï¼Œå¾Œè€…ä¸»è¦æä¾›çµ¦ go tool pprofæª¢è¦–</p>
<p><img src="pics/15.png" alt=""><br><img src="https://i.imgur.com/KsJqL24.png" alt=""></p>
<p>æ¥è‘—é€é <code>go tool pprof</code>æª¢è¦–å…¶å ±å‘Š <code>testing_example_2.test</code>ï¼Œä¸¦æŒ‡å®šç”¨<code>-web</code> ç¶²é çš„æ–¹å¼ç€è¦½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure>
<p>ä¸éç”±æ–¼ç¯„ä¾‹æª”æ¡ˆè¦æ¨¡å¤ªå°ï¼Œgo toolç„¡æ³•æ•æ‰åˆ°æœ‰ç”¨çš„è³‡è¨Šï¼Œæ‰€ä»¥æŠ“ä¸åˆ°</p>
<p><img src="pics/16.png" alt=""></p>
<p>é€™æ™‚å¯ä»¥é€é <code>go test -mmprofilerate n</code>ä¾†æ”¹è®Šè®€å–å ±å‘Šçš„é »ç‡ï¼Œç•¶åŸ·è¡Œnå€‹æŒ‡ä»¤æ™‚ï¼Œå°±ç”¢å‡ºå ±å‘Š</p>
<p>æ¥è‘—å†æŸ¥çœ‹ä¸€æ¬¡ç”¢å‡ºçš„å ±å‘Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æ¯å€‹æ–¹æ³•è©³ç´°çš„è¨˜æ†¶é«”æ¶ˆè€—è³‡è¨Šåœ–</p>
<p><img src="pics/17.png" alt=""></p>
<h4 id="ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š-go-test-cpuprofile"><a href="#ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š-go-test-cpuprofile" class="headerlink" title="ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š go test -cpuprofile"></a>ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š <code>go test -cpuprofile</code></h4><p>ä¸€æ¨£å¯ä»¥ç”¢ç”Ÿæ¯å€‹æ–¹æ³•æˆ–packageä½¿ç”¨å¤šå°‘çš„CPUé—œè¯åœ–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -cpuprofile cpu.out testing_example_2 </span><br><span class="line">ok      testing_example_2       0.224s</span><br></pre></td></tr></table></figure></p>
<p>ç”¢ç”Ÿå‡º<code>cpu.out</code>èˆ‡<code>testing_example_2.test</code>ï¼Œç„¶å¾Œå¾Œè€…ä¹Ÿæ˜¯é€é <code>pprof</code>æª¢è¦–</p>
<p><img src="pics/18.png" alt=""></p>
<p>ä¸éä¹Ÿæ˜¯ä¸€æ¨£æ²’çœ‹åˆ°è±å¯Œçš„æ¸¬è©¦è³‡è¨Šï¼Œå› ç‚ºæ•´å€‹æ¸¬è©¦åªæœ‰åŸ·è¡Œä¸€éï¼Œå°è‡´pprofç„¡æ³•æŠ“åˆ°æœ‰ç”¨çš„è³‡è¨Š</p>
<p><img src="pics/19.png" alt=""></p>
<p>é€™æ™‚å¯ä»¥é€é <code>-count</code> å¯ä»¥æ¸¬è©¦å¤šæ¬¡ä»¥å–å¾—è¶³å¤ çš„CPUä½¿ç”¨é‡å ±å‘Š</p>
<p><code>go test -cpuprofile cpu.out -count 1000000 testing_example_2</code></p>
<p>åœ¨æŸ¥çœ‹ä¸€éå°±æœƒæœ‰æ–¹æ³•å‘¼å«çš„CPUæ¶ˆè€—æµç¨‹åœ–å¯ä»¥æª¢è¦–äº†</p>
<p><img src="pics/20.png" alt=""></p>
<h4 id="ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š-go-test-trace"><a href="#ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š-go-test-trace" class="headerlink" title="ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š go test -trace"></a>ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š <code>go test -trace</code></h4><p>é€é<code>-trace</code>é€™å€‹flag, å¯ä»¥ç”¢å‡ºè¨±å¤šæª¢è¦–ç¨‹å¼çš„åŸ·è¡Œå ±å‘Š</p>
<p>ä¸€æ¨£é€é <code>go test -trace trace.out testing_example_2</code>ä¾†ç”¢ç”Ÿå«åš <code>trace.out</code>çš„å ±å‘Š</p>
<p>ä»¥ <code>go tool trace trace.out</code> æª¢è¦–å…§å®¹</p>
<p><img src="pics/21.png" alt=""></p>
<p>é»é–‹View traceå¯çœ‹åˆ°å¦‚ä¸‹</p>
<p><img src="pics/22.png" alt=""></p>
<h2 id="åƒè€ƒè³‡æº"><a href="#åƒè€ƒè³‡æº" class="headerlink" title="åƒè€ƒè³‡æº"></a>åƒè€ƒè³‡æº</h2><ul>
<li><p><a href="https://golang.org/cmd/trace/" target="_blank" rel="noopener">Go-Command trace</a></p>
</li>
<li><p><a href="https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d" target="_blank" rel="noopener">Using Go 1.10 new trace features to debug an integration test</a></p>
</li>
</ul>

    </div>
    
    <div class="post-footer">
        <div>
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2021/02/16/go-array-slice-map/" class="pre-post btn btn-default" title="Goä½¿ç”¨Arrayã€Sliceèˆ‡Mapçš„ä»‹ç´¹">
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">ä¸Šä¸€ç¯‡</span>
        <span class="hidden-xs">
            Goä½¿ç”¨Arrayã€Sliceèˆ‡Mapçš„ä»‹ç´¹</span>
    </a>
    
    
    <a href="/2021/02/15/go-package-best-practice/" class="next-post btn btn-default" title="ç”¨Golangæ’°å¯«Packageçš„Best Practice">
        <span class="hidden-lg">ä¸‹ä¸€ç¯‡</span>
        <span class="hidden-xs">
            ç”¨Golangæ’°å¯«Packageçš„Best Practice</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    <div id="disqus_thread"></div>
    

<script type="text/javascript">
var disqus_config = function() {
    this.page.url = 'http://a10000005588.github.io/2021/02/15/go-cli/';
    this.page.identifier = '2021/02/15/go-cli/';
    this.page.title = 'Go CLI Playbook å­¸ç¿’ç­†è¨˜';
};

// Only if disqus_thread id is defined load the embed script
if (document.getElementById('disqus_thread')) {
    var dsq = document.createElement('script');
    var head = document.getElementsByTagName('head')[0];
    var body = document.getElementsByTagName('body')[0];

    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.setAttribute('data-timestamp', '' + +new Date());
    dsq.src = 'https://williamblog-1.disqus.com/embed.js';

    console.log('head', head);
    console.log('body', body);
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}
  
</script>

</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            Table of Contents
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-Command-åŠŸèƒ½"><span class="toc-text">Go Command åŠŸèƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Go-Commandçš„åˆ—è¡¨"><span class="toc-text">Go Commandçš„åˆ—è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¯é€é-go-help-å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤"><span class="toc-text">å¯é€é go help å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-env-æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸"><span class="toc-text">go env æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-run-åŸ·è¡Œç¨‹å¼"><span class="toc-text">go run åŸ·è¡Œç¨‹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#é€é-go-run-raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race-conditionçš„ç‹€æ³ç™¼ç”Ÿ"><span class="toc-text">é€é go run --raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-build-ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´"><span class="toc-text">go build ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-go-build-oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±"><span class="toc-text">ä½¿ç”¨ go build -oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-go-build-i-ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´"><span class="toc-text">ä½¿ç”¨ go build -i ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åƒè€ƒ"><span class="toc-text">åƒè€ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-install-ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage"><span class="toc-text">go install ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#go-install-nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ"><span class="toc-text">go install -nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go-install-xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ"><span class="toc-text">go install -xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å…¶ä»–flag"><span class="toc-text">å…¶ä»–flag</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç”¢ç”ŸShared-Librariesï¼Œä½¿ç”¨-buildmode-flag"><span class="toc-text">ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨-buildmode flag</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä½¿ç”¨-buildmode-shared-ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared-Libraries"><span class="toc-text">ä½¿ç”¨ -buildmode=shared ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Libraries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä½¿ç”¨-buildmode-c-archive-ç”¢ç”Ÿä¾›C-language-â€œéœæ…‹â€é€£çµçš„Shared-Libraries"><span class="toc-text">ä½¿ç”¨ -buildmode=c-archive ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Libraries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä½¿ç”¨-buildmode-c-shared-ç”¢ç”Ÿä¾›C-language-â€œå‹•æ…‹â€é€£çµçš„Shared-Libraries"><span class="toc-text">ä½¿ç”¨ -buildmode=c-shared ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared Libraries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä½¿ç”¨-buildmode-plugin-å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo-plugin"><span class="toc-text">ä½¿ç”¨ -buildmode=plugin å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo plugin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åƒè€ƒ-1"><span class="toc-text">åƒè€ƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-test-æ’°å¯«å–®å…ƒæ¸¬è©¦Unit-Testing-Programs"><span class="toc-text">go test æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡"><span class="toc-text">æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸ·è¡Œæ¸¬è©¦"><span class="toc-text">åŸ·è¡Œæ¸¬è©¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡"><span class="toc-text">åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸-flags"><span class="toc-text">æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¸¬è©¦çš„æ¶µè“‹-Code-Coverage"><span class="toc-text">æ¸¬è©¦çš„æ¶µè“‹ Code Coverage</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#é€égo-test-coverpkg-æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package"><span class="toc-text">é€égo test -coverpkg æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é€égo-test-coverprofile-ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š"><span class="toc-text">é€égo test -coverprofile ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é€é-go-tool-æŸ¥çœ‹æ¸¬è©¦å ±å‘Š"><span class="toc-text">é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é€²è¡Œå£“åŠ›æ¸¬è©¦-Benchmark-Testing"><span class="toc-text">é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#è¦å‰‡"><span class="toc-text">è¦å‰‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æŒ‡ä»¤-go-test-bench"><span class="toc-text">æŒ‡ä»¤: go test -bench</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š-go-test-benchtime"><span class="toc-text">æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š go test -benchtime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š-go-test-cpuprofile"><span class="toc-text">ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š go test -cpuprofile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š-go-test-trace"><span class="toc-text">ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š go test -trace</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åƒè€ƒè³‡æº"><span class="toc-text">åƒè€ƒè³‡æº</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2017
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>