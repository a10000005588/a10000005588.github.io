<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>William&#39;s 隨手札記</title>
  
  <subtitle>Blog of William</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://a10000005588.github.io/"/>
  <updated>2021-02-16T03:12:44.014Z</updated>
  <id>http://a10000005588.github.io/</id>
  
  <author>
    <name>William L.K.</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Go使用Array、Slice與Map的介紹</title>
    <link href="http://a10000005588.github.io/2021/02/16/go-array-slice-map/"/>
    <id>http://a10000005588.github.io/2021/02/16/go-array-slice-map/</id>
    <published>2021-02-16T02:41:51.000Z</published>
    <updated>2021-02-16T03:12:44.014Z</updated>
    
    <content type="html"><![CDATA[<p>這篇主要介紹如何在Golang底下使用Array, Slice, Map等操作技巧</p><a id="more"></a><h2 id="array用法"><a href="#array用法" class="headerlink" title="array用法"></a>array用法</h2><h3 id="新增array方式"><a href="#新增array方式" class="headerlink" title="新增array方式"></a>新增array方式</h3><h4 id="1-透過"><a href="#1-透過" class="headerlink" title="1. 透過 []"></a>1. 透過 <code>[]</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line">fmt.Println(<span class="string">"array arr:"</span>, a)</span><br></pre></td></tr></table></figure><h4 id="2-透過-make"><a href="#2-透過-make" class="headerlink" title="2. 透過 make"></a>2. 透過 <code>make</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr := <span class="built_in">make</span>([]<span class="keyword">int64</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h4 id="3-動態分配array"><a href="#3-動態分配array" class="headerlink" title="3. 動態分配array"></a>3. 動態分配array</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr=<span class="built_in">make</span>([][]<span class="keyword">int64</span>,<span class="number">10</span>) <span class="comment">//外層有10格</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">    arr[i]=<span class="built_in">make</span>([]<span class="keyword">int64</span>,i) <span class="comment">//動態分裡面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="array遍歷方法"><a href="#array遍歷方法" class="headerlink" title="array遍歷方法"></a>array遍歷方法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt;<span class="built_in">len</span>(a); i++ &#123; </span><br><span class="line">    fmt.Println(<span class="string">"arr["</span>, i, <span class="string">"] ="</span>, a[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用range, 第一個值 key為索引，value為索引的值</span></span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> arr &#123; </span><br><span class="line">    fmt.Println(<span class="string">"arr["</span>, i, <span class="string">"] ="</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="slice用法"><a href="#slice用法" class="headerlink" title="slice用法"></a>slice用法</h2><h3 id="新增slice方式"><a href="#新增slice方式" class="headerlink" title="新增slice方式"></a>新增slice方式</h3><h4 id="1-使用array"><a href="#1-使用array" class="headerlink" title="1. 使用array"></a>1. 使用array</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray [<span class="number">10</span>]<span class="keyword">int</span> = [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="keyword">var</span> mySlice []<span class="keyword">int</span> = myArray[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure><h4 id="2-使用-make"><a href="#2-使用-make" class="headerlink" title="2. 使用 make"></a>2. 使用 <code>make</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make([]T, length, capacity)</span></span><br><span class="line"><span class="comment">// 創建長度為5，容量為10的切片</span></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 創建長度為5，並初始化該切片</span></span><br><span class="line">slice2 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>註： make的capacity若沒有設置會預設跟length一樣，為slice最大長度之上限。</p></blockquote><h3 id="動態新增slice長度-使用append"><a href="#動態新增slice長度-使用append" class="headerlink" title="動態新增slice長度: 使用append"></a>動態新增slice長度: 使用append</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在slice2 增加6</span></span><br><span class="line">slice2 = <span class="built_in">append</span>(slice2, <span class="number">6</span>)</span><br><span class="line">fmt.Println(<span class="string">"slice:"</span>, slice2)</span><br><span class="line"><span class="comment">// slice: 1 2 3 4 5 6</span></span><br></pre></td></tr></table></figure><h3 id="動態減少slice長度-slice"><a href="#動態減少slice長度-slice" class="headerlink" title="動態減少slice長度: slice[:]"></a>動態減少slice長度: slice[:]</h3><p>例如：去除最前面一個元素</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">queue := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">queue = queue[<span class="number">1</span>:]  <span class="comment">// queue = &#123;2,3&#125;</span></span><br></pre></td></tr></table></figure><h3 id="使用slcie實作一個簡單的queue結構"><a href="#使用slcie實作一個簡單的queue結構" class="headerlink" title="使用slcie實作一個簡單的queue結構"></a>使用slcie實作一個簡單的queue結構</h3><ul><li><p>宣告一個queue結構</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queue := []int&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>新增一個元素到queue</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queue = append(queue, 6)</span><br></pre></td></tr></table></figure></li><li><p>從queue的開頭pop一個元素</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element := queue[0]</span><br><span class="line">queue = queue[1:]</span><br></pre></td></tr></table></figure></li></ul><h3 id="檢查slice是否為空-len"><a href="#檢查slice是否為空-len" class="headerlink" title="檢查slice是否為空 len()"></a>檢查slice是否為空 <code>len()</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">slice := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">len</span>(slice) == <span class="number">0</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="slice-搭配-struct的傳值與回傳"><a href="#slice-搭配-struct的傳值與回傳" class="headerlink" title="slice 搭配 struct的傳值與回傳"></a>slice 搭配 struct的傳值與回傳</h3><p>以我做 <a href="https://leetcode.com/problems/minimum-depth-of-binary-tree/" target="_blank" rel="noopener">Leetcode 111. Minimum Depth of Binary Tree</a> 的範例來看，怎麼使用slice搭配struct進行傳值與回傳</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> pair <span class="keyword">struct</span> &#123;</span><br><span class="line">    node *TreeNode</span><br><span class="line">    height <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minDepth</span><span class="params">(root *TreeNode)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// 若目前root為nil 高度為0</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用queue存放當前的root, 透過golang的slice來實作</span></span><br><span class="line">    queue := []pair&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// make a new pair for root</span></span><br><span class="line">    rootPair := pair&#123;node: root, height: <span class="number">1</span>&#125;</span><br><span class="line">    queue = <span class="built_in">append</span>(queue, rootPair)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(queue) != <span class="number">0</span> &#123;</span><br><span class="line">        element := queue[<span class="number">0</span>]</span><br><span class="line">        elementNode := element.node</span><br><span class="line">        <span class="comment">// 將取出來的elemenet去掉</span></span><br><span class="line">        queue = queue[<span class="number">1</span>:]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果左右子樹都還有值，那就繼續找，將left, right塞進queue</span></span><br><span class="line">        <span class="keyword">if</span> elementNode.Left == <span class="literal">nil</span> &amp;&amp; elementNode.Right == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> element.height</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> elementNode.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">            queue = push(queue, elementNode.Left, element.height)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> elementNode.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">            queue = push(queue, elementNode.Right, element.height)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(queue []pair, root *TreeNode, currHeight <span class="keyword">int</span>)</span> []<span class="title">pair</span></span> &#123;</span><br><span class="line">    newElement := pair&#123;node: root, height: currHeight + <span class="number">1</span>&#125;</span><br><span class="line">    newQueue := <span class="built_in">append</span>(queue, newElement)</span><br><span class="line">    <span class="keyword">return</span> newQueue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>line 14: 宣告一個型態為pair的struct slice</p><p>line 42: 將struct slice傳入<code>push()</code>，並回傳之</p><h2 id="Array-和-Slice差異"><a href="#Array-和-Slice差異" class="headerlink" title="Array 和 Slice差異"></a>Array 和 Slice差異</h2><table><thead><tr><th>array</th><th>slice</th></tr></thead><tbody><tr><td>長度宣告後不可以變動</td><td>長度可以透過append()或slice[:]做變動</td></tr><tr><td>X</td><td>slice為array的指標，若更動slice，也會更動到原本array的內容</td></tr></tbody></table><h3 id="如何避免Slice更動到原本Array"><a href="#如何避免Slice更動到原本Array" class="headerlink" title="如何避免Slice更動到原本Array?"></a>如何避免Slice更動到原本Array?</h3><h4 id="方法-1-make-and-Copy"><a href="#方法-1-make-and-Copy" class="headerlink" title="方法 1 : make and Copy"></a>方法 1 : <code>make</code> and <code>Copy</code></h4><p>先開一個新的空間，用make開好，用copy拷貝過去<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr:=[]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">newSlice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(arr))</span><br><span class="line"><span class="built_in">copy</span>(newSlice, arr)</span><br></pre></td></tr></table></figure></p><h4 id="方法-2-append"><a href="#方法-2-append" class="headerlink" title="方法 2 : append"></a>方法 2 : <code>append</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr:=[]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">newSlice = <span class="built_in">append</span>([]<span class="keyword">int64</span>(<span class="literal">nil</span>), arr[<span class="number">1</span>:<span class="number">3</span>]...) <span class="comment">//一定要「…」</span></span><br></pre></td></tr></table></figure><h2 id="Map用法"><a href="#Map用法" class="headerlink" title="Map用法"></a>Map用法</h2><p>建立一個 map 兩種方式</p><h3 id="使用make"><a href="#使用make" class="headerlink" title="使用make"></a>使用make</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="comment">// m["age"] = 16</span></span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>回傳值, 和 map 是否存在<br>如果是不存在的 key , value = 0 , ok = false<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value , ok := m[<span class="string">"age"</span>]</span><br></pre></td></tr></table></figure></p><p>利用 range 取得 map 中所有的 key 和 value, 並列印<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> m &#123;</span><br><span class="line">            fmt.Println(<span class="string">"Key:"</span>, key, <span class="string">"Value:"</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>一次宣告多值<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">       <span class="string">"age"</span> : <span class="number">16</span>,</span><br><span class="line">       <span class="string">"height"</span> : <span class="number">180</span>,</span><br><span class="line">       <span class="string">"weight"</span> : <span class="number">6</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>Golang 兩三事<ul><li><a href="http://daniel0076.logdown.com/posts/280719-golang-slice-notes" target="_blank" rel="noopener">http://daniel0076.logdown.com/posts/280719-golang-slice-notes</a></li></ul></li><li>Golang slice trick<ul><li><a href="https://github.com/golang/go/wiki/SliceTricks" target="_blank" rel="noopener">https://github.com/golang/go/wiki/SliceTricks</a></li></ul></li><li>How to implement a queue in Go?<ul><li><a href="https://stackoverflow.com/questions/3042329/how-to-implement-a-queue-in-go" target="_blank" rel="noopener">https://stackoverflow.com/questions/3042329/how-to-implement-a-queue-in-go</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;這篇主要介紹如何在Golang底下使用Array, Slice, Map等操作技巧&lt;/p&gt;
    
    </summary>
    
      <category term="Golang" scheme="http://a10000005588.github.io/categories/Golang/"/>
    
    
      <category term="Golang" scheme="http://a10000005588.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Go CLI Playbook 學習筆記</title>
    <link href="http://a10000005588.github.io/2021/02/15/go-cli/"/>
    <id>http://a10000005588.github.io/2021/02/15/go-cli/</id>
    <published>2021-02-15T10:38:03.000Z</published>
    <updated>2021-02-15T10:40:21.313Z</updated>
    
    <content type="html"><![CDATA[<p>以下為學習本課程 <a href="https://app.pluralsight.com/library/courses/go-cli-playbook/table-of-contents" target="_blank" rel="noopener">Pluralshight: The Go CLI Playbook</a> 所記錄的筆記，了解Golang本身所提供的指令集工具要如何使用</p><p><a href="https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48" target="_blank" rel="noopener">https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48</a></p><h2 id="Go-Command-功能"><a href="#Go-Command-功能" class="headerlink" title="Go Command 功能"></a>Go Command 功能</h2><p>Go 的基本Command可以提供以下功能</p><ul><li>Building Application: 把<code>.go</code>檔案編譯成執行檔</li><li>Testing Application: 測試<code>.go</code>程式</li><li>Profiling Application: 效能測試</li><li>Managing Workspaces: 管理開發環境</li><li>Interacting with Environment: 與環境互動</li></ul><h3 id="Go-Command的列表"><a href="#Go-Command的列表" class="headerlink" title="Go Command的列表"></a>Go Command的列表</h3><p>在終端機下 <code>go</code> 指令，就會顯示go command的詳細資訊<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">➜ go</span><br><span class="line">Go is a tool for managing Go source code.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"></span><br><span class="line">        go command [arguments]</span><br><span class="line"></span><br><span class="line">The commands are:</span><br><span class="line"></span><br><span class="line">        build       compile packages and dependencies</span><br><span class="line">        clean       remove object files and cached files</span><br><span class="line">        doc         show documentation for package or symbol</span><br><span class="line">        env         print Go environment information</span><br><span class="line">        bug         start a bug report</span><br><span class="line">        fix         update packages to use new APIs</span><br><span class="line">        fmt         gofmt (reformat) package sources</span><br><span class="line">        generate    generate Go files by processing source</span><br><span class="line">        get         download and install packages and dependencies</span><br><span class="line">        install     compile and install packages and dependencies</span><br><span class="line">        list        list packages</span><br><span class="line">        run         compile and run Go program</span><br><span class="line">        test        test packages</span><br><span class="line">        tool        run specified go tool</span><br><span class="line">        version     print Go version</span><br><span class="line">        vet         report likely mistakes in packages</span><br><span class="line"></span><br><span class="line">Use &quot;go help [command]&quot; for more information about a command.</span><br><span class="line"></span><br><span class="line">Additional help topics:</span><br><span class="line"></span><br><span class="line">        c           calling between Go and C</span><br><span class="line">        buildmode   build modes</span><br><span class="line">        cache       build and test caching</span><br><span class="line">        filetype    file types</span><br><span class="line">        gopath      GOPATH environment variable</span><br><span class="line">        environment environment variables</span><br><span class="line">        importpath  import path syntax</span><br><span class="line">        packages    package lists</span><br><span class="line">        testflag    testing flags</span><br><span class="line">        testfunc    testing functions</span><br><span class="line"></span><br><span class="line">Use &quot;go help [topic]&quot; for more information about that topic.</span><br></pre></td></tr></table></figure></p><h3 id="可透過-go-help-可看到特定command的指令"><a href="#可透過-go-help-可看到特定command的指令" class="headerlink" title="可透過 go help 可看到特定command的指令"></a>可透過 <code>go help</code> 可看到特定command的指令</h3><p>假如要看go test的介紹，那就下這行指令 <code>go help test</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜ go help test</span><br><span class="line">usage: go test [build/test flags] [packages] [build/test flags &amp; test binary flags]</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; automates testing the packages named by the import paths.</span><br><span class="line">It prints a summary of the test results in the format:</span><br><span class="line"></span><br><span class="line">        ok   archive/tar   0.011s</span><br><span class="line">        FAIL archive/zip   0.022s</span><br><span class="line">        ok   compress/gzip 0.033s</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">followed by detailed output for each failed package.</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; recompiles each package along with any files with names matching</span><br><span class="line">the file pattern &quot;*_test.go&quot;.</span><br><span class="line">These additional files can contain test functions, benchmark functions, and</span><br><span class="line">example functions. See &apos;go help testfunc&apos; for more.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The test binary also accepts flags that control execution of the test; these</span><br><span class="line">flags are also accessible by &apos;go test&apos;. See &apos;go help testflag&apos; for details.</span><br><span class="line"></span><br><span class="line">For more about build flags, see &apos;go help build&apos;.</span><br><span class="line">For more about specifying packages, see &apos;go help packages&apos;.</span><br></pre></td></tr></table></figure><h2 id="go-env-查看環境變數"><a href="#go-env-查看環境變數" class="headerlink" title="go env 查看環境變數"></a><code>go env</code> 查看環境變數</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; go env</span><br><span class="line"></span><br><span class="line">GOARCH=&quot;amd64&quot;</span><br><span class="line">GOBIN=&quot;/Users/username/go/bin&quot;</span><br><span class="line">GOCACHE=&quot;/Users/username/Library/Caches/go-build&quot;</span><br><span class="line">GOEXE=&quot;&quot;</span><br><span class="line">GOHOSTARCH=&quot;amd64&quot;</span><br><span class="line">GOHOSTOS=&quot;darwin&quot;</span><br><span class="line">GOOS=&quot;darwin&quot;</span><br><span class="line">GOPATH=&quot;/Users/username/go&quot;</span><br><span class="line">GORACE=&quot;&quot;</span><br><span class="line">GOROOT=&quot;/usr/local/Cellar/go/1.10.2/libexec&quot;</span><br><span class="line">GOTMPDIR=&quot;&quot;</span><br><span class="line">GOTOOLDIR=&quot;/usr/local/Cellar/go/1.10.2/libexec/pkg/tool/darwin_amd64&quot;</span><br><span class="line">GCCGO=&quot;gccgo&quot;</span><br><span class="line">CC=&quot;clang&quot;</span><br><span class="line">CXX=&quot;clang++&quot;</span><br><span class="line">CGO_ENABLED=&quot;1&quot;</span><br><span class="line">CGO_CFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_CPPFLAGS=&quot;&quot;</span><br><span class="line">CGO_CXXFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_FFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_LDFLAGS=&quot;-g -O2&quot;</span><br><span class="line">PKG_CONFIG=&quot;pkg-config&quot;</span><br><span class="line">GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build760606218=/tmp/go-build -gno-record-gcc-switches -fno-common&quot;</span><br></pre></td></tr></table></figure><h2 id="go-run-執行程式"><a href="#go-run-執行程式" class="headerlink" title="go run 執行程式"></a><code>go run</code> 執行程式</h2><blockquote><p>注意，若要運程<code>go run</code>，需要在<code>$GOPATH</code>底下的<code>src</code>目錄進行</p></blockquote><p>運行一個包含main()方法的程式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; go run main.go</span><br></pre></td></tr></table></figure><h3 id="透過-go-run-race來偵測是否會有race-condition的狀況發生"><a href="#透過-go-run-race來偵測是否會有race-condition的狀況發生" class="headerlink" title="透過 go run --race來偵測是否會有race condition的狀況發生"></a>透過 <code>go run --race</code>來偵測是否會有race condition的狀況發生</h3><p>若目前有個使用<code>gorouting</code>的程式，若要偵測是否會發生race condition狀況，可以加上<code>-race</code>這個flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若有race condition，go tool會產出報告來解釋<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">➜ go run -race race_condition/main.go </span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 8:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 8 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 7:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 7 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line">Found 2 data race(s)</span><br><span class="line">exit status 66</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一般來說在dev模式時，會建議每次運行專案時，都加上-race</span><br></pre></td></tr></table></figure><h2 id="go-build-編譯程式與其依賴"><a href="#go-build-編譯程式與其依賴" class="headerlink" title="go build 編譯程式與其依賴"></a><code>go build</code> 編譯程式與其依賴</h2><p><code>go build</code>會把專案編譯成執行檔</p><p>若目前有個在cmds資料夾內的專案叫做 <code>hello</code> 並引用了<code>helloService</code>這個依賴內的方法</p><p>cmds/hello.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"helloService"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">helloService.SayHello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>helloService/msg.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHello represents a greeting to developer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>那在 <code>/cmds/hello</code>專案中執行 <code>go build</code>，會在當前目錄產生<code>hello</code>執行檔</p><p><img src="./pics/01.png" alt=""></p><p>可直接執行該執行檔</p><p><img src="./pics/02.png" alt=""></p><h3 id="使用-go-build-o定義編譯後檔案名稱"><a href="#使用-go-build-o定義編譯後檔案名稱" class="headerlink" title="使用 go build -o定義編譯後檔案名稱"></a>使用 <code>go build -o</code>定義編譯後檔案名稱</h3><p>假如要把編譯檔案叫做<code>hello_exe.a</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ <span class="keyword">go</span> build -o hello_exe.a</span><br></pre></td></tr></table></figure><p><img src="./pics/03.png" alt=""></p><h3 id="使用-go-build-i-編譯專案的依賴"><a href="#使用-go-build-i-編譯專案的依賴" class="headerlink" title="使用 go build -i 編譯專案的依賴"></a>使用 <code>go build -i</code> 編譯專案的依賴</h3><p>若對專案進行編譯時，加上<code>-i</code>參數，會同時將import的依賴 (ex:<code>helloService</code>)也會編譯該依賴們並安裝在 <code>$GOPATH/pkg</code>底下</p><p><img src="./pics/04.png" alt=""></p><h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><p>Go Official Docs: Command go<br><a href="https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies" target="_blank" rel="noopener">https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies</a></p><h2 id="go-install-編譯專案成為package"><a href="#go-install-編譯專案成為package" class="headerlink" title="go install 編譯專案成為package"></a><code>go install</code> 編譯專案成為package</h2><p>會將專案 (main) 進行編譯成bin檔案並放置在<code>$GOPATH/bin</code>底下</p><p>會將依賴 (package) 進行編譯並安裝在<code>$GOPATH/pkg</code>底下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果已經有存在的依賴或是binary檔案、那go install就不會有作用</span><br></pre></td></tr></table></figure><h3 id="go-install-n：顯示會進行的動作，但不會真正執行"><a href="#go-install-n：顯示會進行的動作，但不會真正執行" class="headerlink" title="go install -n：顯示會進行的動作，但不會真正執行"></a><code>go install -n</code>：顯示會進行的動作，但不會真正執行</h3><p>假如我們在對剛剛的helloService這個依賴，進行<code>go install -n</code></p><p>會看到不會做什麼動作，因為已經有安裝該依賴在<code>pkg</code>底下</p><p><img src="./pics/05.png" alt=""></p><p>將該依賴移除，再次執行一遍，會看到go tool執行了什麼動作</p><p><img src="./pics/06.png" alt=""></p><h3 id="go-install-x：顯示會進行的動作，但會真正執行"><a href="#go-install-x：顯示會進行的動作，但會真正執行" class="headerlink" title="go install -x：顯示會進行的動作，但會真正執行"></a><code>go install -x</code>：顯示會進行的動作，但會真正執行</h3><h4 id="其他flag"><a href="#其他flag" class="headerlink" title="其他flag"></a>其他flag</h4><ul><li>-p n: 指定用多少個cpu來進行install, 預設是可取得的數量</li></ul><h3 id="產生Shared-Libraries，使用-buildmode-flag"><a href="#產生Shared-Libraries，使用-buildmode-flag" class="headerlink" title="產生Shared Libraries，使用-buildmode flag"></a>產生Shared Libraries，使用<code>-buildmode</code> flag</h3><p>透過 <code>go build -buildmode</code> 或是 <code>go install -buildmode</code><br>可以像C或C++那樣產生Shared Libraries，供動態載入</p><p>透過<code>go help buildmode</code>可查看有提供哪些模式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">預設-buildmode會使用 archive：將檔案編譯成 .a</span><br><span class="line"></span><br><span class="line">使用 -buildmode=shared：將檔案編譯成可動態載入的shared lib，或是在runtime時可連結</span><br></pre></td></tr></table></figure><p>假如再用剛剛的範例，一個<code>cmds/hello.go</code>中引用了 helloService這個package</p><p><img src="./pics/07.png" alt=""></p><h4 id="使用-buildmode-shared-產生供go動態連結的Shared-Libraries"><a href="#使用-buildmode-shared-產生供go動態連結的Shared-Libraries" class="headerlink" title="使用 -buildmode=shared 產生供go動態連結的Shared Libraries"></a>使用 <code>-buildmode=shared</code> 產生供go動態連結的Shared Libraries</h4><p>若要將某個package編譯成shared library，</p><p>舉個例子，把<code>helloService</code> 編譯成shared library並安裝在<code>pkg</code>資料夾中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ go install -buildmode=shared helloService</span><br></pre></td></tr></table></figure><blockquote><p>注意: Macos不支援 -buildmode=shared<br>-buildmode=shared not supported on darwin/amd64</p></blockquote><p>接著編譯主程式，並指定其執行檔可以動態載入(-linkshared) shared library</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ go build -linkshared cmds/hello</span><br></pre></td></tr></table></figure><p>執行編譯後的執行檔 <code>./hello</code> ，可看到其結果</p><p>不過若將<code>pkg</code>中，剛剛go install的<code>helloService</code>的shared library給刪除的話，再次執行 <code>/.hello</code> 那就會發生無法執行狀況。</p><h4 id="使用-buildmode-c-archive-產生供C-language-“靜態”連結的Shared-Libraries"><a href="#使用-buildmode-c-archive-產生供C-language-“靜態”連結的Shared-Libraries" class="headerlink" title="使用 -buildmode=c-archive 產生供C language “靜態”連結的Shared Libraries"></a>使用 <code>-buildmode=c-archive</code> 產生供C language “靜態”連結的Shared Libraries</h4><p>如果想要將pakcage編譯成C可以載入的shared library的話，需要對pakcage的method，加上 <code>//export functionName</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> helloService</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//export SayHello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若使用 <code>-buildmode=c-archive</code>的話，則會產生出 <code>.h</code>與<code>.a</code>的shared library</p><blockquote><p>注意: Macos運行<code>-buildmode=c-archive</code> 會無法產生 <code>.h</code>檔案 go版本: go1.15 darwin/amd64</p></blockquote><p>接著就可以在C語言內引入用Go build好的share library</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello.a"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  SayHello();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行之</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc hello.c ./hello</span><br></pre></td></tr></table></figure><h4 id="使用-buildmode-c-shared-產生供C-language-“動態”連結的Shared-Libraries"><a href="#使用-buildmode-c-shared-產生供C-language-“動態”連結的Shared-Libraries" class="headerlink" title="使用 -buildmode=c-shared 產生供C language “動態”連結的Shared Libraries"></a>使用 <code>-buildmode=c-shared</code> 產生供C language “動態”連結的Shared Libraries</h4><p>同用go產生出shared library</p><h4 id="使用-buildmode-plugin-將所有import的packages，打包成go-plugin"><a href="#使用-buildmode-plugin-將所有import的packages，打包成go-plugin" class="headerlink" title="使用 -buildmode=plugin 將所有import的packages，打包成go plugin"></a>使用 <code>-buildmode=plugin</code> 將所有import的packages，打包成go plugin</h4><p>可以把專案需要import的package，打包成plugin</p><p>舉個例子，若現在我們要將plugin這一個pakcage打包成plugin</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ThingToDo</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Executing action"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>透過以下指令，做出一個plugin，檔名叫做 plugin 副檔名為<code>.so</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ go build -buildmode=plugin -o=plugin.so plugin/plugin.go</span><br></pre></td></tr></table></figure></p><p>接著我們定義了一個小專案，來使用plugin</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"flag"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"plugin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">path := flag.String(<span class="string">"plugin"</span>, <span class="string">""</span>, <span class="string">"Plugin to execute"</span>)</span><br><span class="line"></span><br><span class="line">flag.Parse()</span><br><span class="line">    <span class="comment">// 如果執行go時沒有帶 -plugin指令</span></span><br><span class="line"><span class="keyword">if</span> *path == <span class="string">""</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">"Path to plugin must be provided"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 讀取plugin</span></span><br><span class="line">p, err := plugin.Open(*path)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尋找plugin是否有ThingToDo這個方法</span></span><br><span class="line">f, err := p.Lookup(<span class="string">"ThingToDo"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">thingToDo, ok := f.(<span class="function"><span class="keyword">func</span><span class="params">()</span>)</span></span><br><span class="line"><span class="function"><span class="title">if</span> !<span class="title">ok</span></span> &#123;</span><br><span class="line">log.Fatal(<span class="string">"Could not find function 'ThingToDo' in plugin"</span>)</span><br><span class="line">&#125;</span><br><span class="line">thingToDo()</span><br><span class="line">log.Println(<span class="string">"Did the thing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著運行下面指令使用plugin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ go run action/action.go -plugin=./plugin.so</span><br></pre></td></tr></table></figure><p>如果plugin存在的話，就可以執行 <code>plugin.so</code>內的<code>ThingToDo</code>方法</p><p>執行結果<br><img src="./pics/08.png" alt=""></p><h4 id="參考-1"><a href="#參考-1" class="headerlink" title="參考"></a>參考</h4><p>Golang的构建模式 - Chen Jiehua<br><a href="https://chenjiehua.me/golang/golang-buildmode.html" target="_blank" rel="noopener">https://chenjiehua.me/golang/golang-buildmode.html</a></p><h2 id="go-test-撰寫單元測試Unit-Testing-Programs"><a href="#go-test-撰寫單元測試Unit-Testing-Programs" class="headerlink" title="go test 撰寫單元測試Unit Testing Programs"></a><code>go test</code> 撰寫單元測試Unit Testing Programs</h2><p>透過 <code>go test</code> 可測試golang撰寫的程式的Input與Output是否正確</p><h3 id="測試需注意的規則"><a href="#測試需注意的規則" class="headerlink" title="測試需注意的規則"></a>測試需注意的規則</h3><p>由於go本身對測試有著嚴謹的規則，故可以避免像其他語言那樣有各種不同測試的框架，以統一測試的樣式</p><p>其規則如下：</p><ul><li>若有定義測試的檔案名稱，需要以 <code>_test.go</code>最結尾命名</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mylib_test.go</span><br></pre></td></tr></table></figure><ul><li>若需要被測試的方法，請以 <code>Test_</code> 為開頭</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func Test_MyFunction() &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="執行測試"><a href="#執行測試" class="headerlink" title="執行測試"></a>執行測試</h3><p>若有個專案叫做 <code>testing_example</code>，其目錄架構如下</p><p><img src="./pics/09.png" alt=""></p><p><code>testing_example/mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">t.Run(<span class="string">"Go can concatenate strings"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="string">"Hello, "</span>+<span class="string">"Go"</span> != <span class="string">"Hello, Go"</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>其子package也有定義testing file <code></code>testing_example/childlib/childlib_test.go`<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> childlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_MoreBasics</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">10</span><span class="number">-5</span> != <span class="number">5</span> &#123;</span><br><span class="line">t.Error(<span class="string">"Failed to subtract correctly"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="執行測試的範疇"><a href="#執行測試的範疇" class="headerlink" title="執行測試的範疇"></a>執行測試的範疇</h3><p>若要對專案執行Unit Test：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test testing_example </span><br><span class="line">ok      testing_example 0.014s</span><br></pre></td></tr></table></figure><p>但會發現child package的測試沒有執行到，所以若要對package內所有子<br>package都進行測試，那需要加上 <code>/...</code> 做遞迴尋找的動作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via 🐹 v1.15 </span><br><span class="line">➜ go test testing_example/...</span><br><span class="line">ok      testing_example (cached)</span><br><span class="line">ok      testing_example/childlib        0.015s</span><br></pre></td></tr></table></figure><h3 id="測試可以夾帶的參數-flags"><a href="#測試可以夾帶的參數-flags" class="headerlink" title="測試可以夾帶的參數 flags"></a>測試可以夾帶的參數 flags</h3><p>透過 <code>go help testflag</code> 可以查看執行測試時可以客製化的選擇</p><p>列舉一些常使用的：</p><ul><li><code>-cpu</code>: 指定測試時使用的CPU數量，預設是會使用 <code>GOMAXPROCS</code>參數的值</li><li><code>-parallel</code>: 測試時可以並行處理，但只有指定Function才會被並行處理</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">t.Parallel()  <span class="comment">// 進行並行測試</span></span><br><span class="line">t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>-list</code>: 可透過正則表達式過濾出測試方法名稱，再測試時會列出符合的測試方法給</li></ul><p>假如要列出有包含 <code>Basics</code>的測試方法名稱：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -list Basics testing_example/...</span><br><span class="line">ok      testing_example 0.022s</span><br><span class="line">Test_MoreBasics   // 列出</span><br><span class="line">ok      testing_example/childlib        0.023s</span><br></pre></td></tr></table></figure></p><ul><li><code>-run</code>: 跟List很像，但只會執行符合正則表達式的測試方法<ul><li>使用時機：若開發出子專案的測試方法，透過<code>-run</code>指定該子專案的scope執行測試就好，就可以省去不少時間</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -run Basics testing_example/...</span><br><span class="line">ok      testing_example 0.024s [no tests to run]</span><br><span class="line">ok      testing_example/childlib        0.022s</span><br></pre></td></tr></table></figure><ul><li><code>-timeout d</code>: 超過多久就停止測試，預設為10分鐘</li><li><code>-v</code>: 測試時將詳細結果列出來</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -v testing_example/...</span><br><span class="line">=== RUN   Test_BasicChecks</span><br><span class="line">=== PAUSE Test_BasicChecks</span><br><span class="line">=== CONT  Test_BasicChecks</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_add</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_concatenate_strings</span><br><span class="line">--- PASS: Test_BasicChecks (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_add (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_concatenate_strings (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example 0.017s</span><br><span class="line">=== RUN   Test_MoreBasics</span><br><span class="line">=== PAUSE Test_MoreBasics</span><br><span class="line">=== CONT  Test_MoreBasics</span><br><span class="line">--- PASS: Test_MoreBasics (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example/childlib        0.025s</span><br></pre></td></tr></table></figure><ul><li><code>-count</code>: 指定執行測試的次數</li><li><code>-cover</code>: 顯示測試的涵蓋範圍資訊</li></ul><h3 id="測試的涵蓋-Code-Coverage"><a href="#測試的涵蓋-Code-Coverage" class="headerlink" title="測試的涵蓋 Code Coverage"></a>測試的涵蓋 Code Coverage</h3><p>可以透過 <code>go test -cover</code> 來查看目前測試項目涵蓋了多少開發的內容</p><p>以下為測試的項目內容：</p><p><img src="./pics/10.png" alt=""></p><p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subractor</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l - r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在這邊只有測試adder方法，沒有subractor方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到上述的範例只測試一個方法<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span> </span><br><span class="line">➜ <span class="keyword">go</span> test -cover testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.013s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure></p><h4 id="透過go-test-coverpkg-指定測試程式引用的package"><a href="#透過go-test-coverpkg-指定測試程式引用的package" class="headerlink" title="透過go test -coverpkg 指定測試程式引用的package"></a>透過<code>go test -coverpkg</code> 指定測試程式引用的package</h4><p>再用上述的範例，我們打算測試專案 <code>testing_example_1</code>中的 <code>fmt</code> 與 <code>testing_example_1</code>本身自己這兩個pacakge：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -coverpkg testing_example_1, fmt testing_example_1 </span><br><span class="line">warning: no packages being tested depend on matches for pattern </span><br><span class="line">ok      fmt     0.089s  coverage: 0.0% of statements in testing_example_1, </span><br><span class="line">ok      testing_example_1       0.019s  coverage: 50.0% of statements in testing_example_1,</span><br></pre></td></tr></table></figure><h4 id="透過go-test-coverprofile-產出測試的報告"><a href="#透過go-test-coverprofile-產出測試的報告" class="headerlink" title="透過go test -coverprofile 產出測試的報告"></a>透過<code>go test -coverprofile</code> 產出測試的報告</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       0.012s  coverage: 50.0% of statements</span><br></pre></td></tr></table></figure><p>同時會產生 <code>cover.out</code>這個測試報告檔案，內容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mode: set</span><br><span class="line">testing_example_1/mylib.go:3.26,5.2 1 1</span><br><span class="line">testing_example_1/mylib.go:7.30,9.2 1 0</span><br></pre></td></tr></table></figure></p><h4 id="透過-go-tool-查看測試報告"><a href="#透過-go-tool-查看測試報告" class="headerlink" title="透過 go tool 查看測試報告"></a>透過 go tool 查看測試報告</h4><p>可以透過 <code>go tool cover -html= 測試報告檔案名稱</code> 來產生出以網頁方式瀏覽的報告</p><p>若要解析產生出來的報告 <code>cover.out</code></p><p><code>go tool cover -html=cover.out</code></p><p>可以產出Web呈現，測試的報告</p><p><img src="pics/11.png" alt=""><br><img src="https://i.imgur.com/SgATMg2.png" alt=""></p><p>如果要看出更詳細的測試報告的話，例如想看到測試方法被執行幾次</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span></span><br><span class="line">➜ <span class="keyword">go</span> test -covermode count -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.018s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure><p>一樣會產生出 <code>cover.out</code>檔案，這時再透過 <code>go tool cover -html</code></p><p><img src="pics/12.png" alt=""><br><img src="https://i.imgur.com/mncGfk7.png" alt=""></p><h3 id="進行壓力測試-Benchmark-Testing"><a href="#進行壓力測試-Benchmark-Testing" class="headerlink" title="進行壓力測試 Benchmark Testing"></a>進行壓力測試 Benchmark Testing</h3><p>golang的test工具亦提供benchmark的測試，可以看出該方法需要耗費多少CPU資源</p><h4 id="規則"><a href="#規則" class="headerlink" title="規則"></a>規則</h4><p>需要定義方法名稱前綴為 <code>Benchmark</code> 例如:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指令-go-test-bench"><a href="#指令-go-test-bench" class="headerlink" title="指令: go test -bench"></a>指令: <code>go test -bench</code></h4><p>若要對testing_example_2這個專案下的檔案：<br><img src="pics/13.png" alt=""><br><img src="https://i.imgur.com/FPmr2HU.png" alt=""></p><p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>這時透過 <code>go test -bench Adder testing_example_2</code>，對<code>testing_example_2</code>這專案內有包含 <code>Adder</code>的壓測方法進行壓力測試</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15</span><br><span class="line">➜ go test -bench Adder testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4        1000000000               0.374 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.433s</span><br></pre></td></tr></table></figure><p>BenchmarkAdder 這隻方法執行了1000000000次, 每次花了 0.374 ns</p><p>或是也可以不指定方法Benchmark名稱 <code>go test -bench . testing_example_2</code></p><h4 id="指定要花多少時間做benchmark測試：-go-test-benchtime"><a href="#指定要花多少時間做benchmark測試：-go-test-benchtime" class="headerlink" title="指定要花多少時間做benchmark測試： go test -benchtime"></a>指定要花多少時間做benchmark測試： <code>go test -benchtime</code></h4><p>可指定壓測測多少時間，可以擴展壓測的次數</p><p>舉例，只壓測0.001秒，那可看到只會測出 2864049次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -benchtime 0.001s -bench . testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4         2864049                 0.485 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.024s</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 檢視壓力測試花多少記憶體： `go test -bench . -benchmem`</span><br><span class="line"></span><br><span class="line">透過 `-bemchmem`這個flag，壓測資訊會多了 `B/op` 與 `allocs/op` 來檢視該方法壓測時花了多少記憶體資源</span><br></pre></td></tr></table></figure><p>~/go/src via v1.15<br>➜ go test -bench . -benchmem testing_example_2<br>goos: darwin<br>goarch: amd64<br>pkg: testing_example_2<br>BenchmarkAdder-4        1000000000               0.501 ns/op           0 B/op          0 allocs/op<br>PASS<br>ok      testing_example_2       0.586s<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### 使用go tool pprof  (performance profiling tool) 產生測試報告</span><br><span class="line"></span><br><span class="line">產出報告之前，需要先安裝 `graphviz`這個套件，這樣go tool才能夠繪製流程圖供我們查看</span><br><span class="line"></span><br><span class="line">Linux/Macos</span><br></pre></td></tr></table></figure></p><p>sudo apt-get install graphyiz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 更多有關graphyiz資訊請到： http://graphviz.org</span><br><span class="line">&gt; </span><br><span class="line"></span><br><span class="line">#### 產生程式記憶體花費報告 `go test -memprofile`</span><br><span class="line"></span><br><span class="line">一樣用testing_example_2這個專案下的檔案做測試</span><br><span class="line"></span><br><span class="line">![](pics/14.png)</span><br><span class="line">![](https://i.imgur.com/FPmr2HU.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`mylib.go`</span><br><span class="line">```go=</span><br><span class="line">package mylib</span><br><span class="line"></span><br><span class="line">func adder(l, r int) int &#123;</span><br><span class="line">return l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>透過 <code>go test -memprofile mem.out testing_example_2</code> 來產出叫做 <code>mem.out</code>的測試報告</p><p>測試結果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -memprofile mem.out testing_example_2</span><br><span class="line">ok      testing_example_2       0.018s</span><br></pre></td></tr></table></figure></p><p>以及會產生兩個檔案 <code>mem.out</code> 與 <code>testing_example_2.test</code>，後者主要提供給 go tool pprof檢視</p><p><img src="pics/15.png" alt=""><br><img src="https://i.imgur.com/KsJqL24.png" alt=""></p><p>接著透過 <code>go tool pprof</code>檢視其報告 <code>testing_example_2.test</code>，並指定用<code>-web</code> 網頁的方式瀏覽</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure><p>不過由於範例檔案規模太小，go tool無法捕捉到有用的資訊，所以抓不到</p><p><img src="pics/16.png" alt=""></p><p>這時可以透過 <code>go test -mmprofilerate n</code>來改變讀取報告的頻率，當執行n個指令時，就產出報告</p><p>接著再查看一次產出的報告<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure></p><p>可以看到每個方法詳細的記憶體消耗資訊圖</p><p><img src="pics/17.png" alt=""></p><h4 id="產生CPU消費報告-go-test-cpuprofile"><a href="#產生CPU消費報告-go-test-cpuprofile" class="headerlink" title="產生CPU消費報告 go test -cpuprofile"></a>產生CPU消費報告 <code>go test -cpuprofile</code></h4><p>一樣可以產生每個方法或package使用多少的CPU關聯圖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">➜ go test -cpuprofile cpu.out testing_example_2 </span><br><span class="line">ok      testing_example_2       0.224s</span><br></pre></td></tr></table></figure></p><p>產生出<code>cpu.out</code>與<code>testing_example_2.test</code>，然後後者也是透過 <code>pprof</code>檢視</p><p><img src="pics/18.png" alt=""></p><p>不過也是一樣沒看到豐富的測試資訊，因為整個測試只有執行一遍，導致pprof無法抓到有用的資訊</p><p><img src="pics/19.png" alt=""></p><p>這時可以透過 <code>-count</code> 可以測試多次以取得足夠的CPU使用量報告</p><p><code>go test -cpuprofile cpu.out -count 1000000 testing_example_2</code></p><p>在查看一遍就會有方法呼叫的CPU消耗流程圖可以檢視了</p><p><img src="pics/20.png" alt=""></p><h4 id="產生程式足跡報告-go-test-trace"><a href="#產生程式足跡報告-go-test-trace" class="headerlink" title="產生程式足跡報告 go test -trace"></a>產生程式足跡報告 <code>go test -trace</code></h4><p>透過<code>-trace</code>這個flag, 可以產出許多檢視程式的執行報告</p><p>一樣透過 <code>go test -trace trace.out testing_example_2</code>來產生叫做 <code>trace.out</code>的報告</p><p>以 <code>go tool trace trace.out</code> 檢視內容</p><p><img src="pics/21.png" alt=""></p><p>點開View trace可看到如下</p><p><img src="pics/22.png" alt=""></p><h2 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h2><ul><li><p><a href="https://golang.org/cmd/trace/" target="_blank" rel="noopener">Go-Command trace</a></p></li><li><p><a href="https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d" target="_blank" rel="noopener">Using Go 1.10 new trace features to debug an integration test</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;以下為學習本課程 &lt;a href=&quot;https://app.pluralsight.com/library/courses/go-cli-playbook/table-of-contents&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Pluralshi
      
    
    </summary>
    
    
      <category term="Golang" scheme="http://a10000005588.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>用Golang撰寫Package的Best Practice</title>
    <link href="http://a10000005588.github.io/2021/02/15/go-package-best-practice/"/>
    <id>http://a10000005588.github.io/2021/02/15/go-package-best-practice/</id>
    <published>2021-02-15T08:33:51.000Z</published>
    <updated>2021-02-15T08:51:31.740Z</updated>
    
    <content type="html"><![CDATA[<p>以下收錄撰寫golang package可以遵循的內容</p><h2 id="Package-概覽"><a href="#Package-概覽" class="headerlink" title="Package 概覽"></a>Package 概覽</h2><p>一個Go Pakcage的基本元素包含了如下：</p><ul><li>Package declaration: 基本定義，告訴developer package的功能是什麼</li><li>Documentation: 提供Package內所包含的function是什麼，要如何使用</li><li>Imports: 如何引入pakcage內的function</li><li>var &amp; const blocks: 使用的變數宣告</li><li>Types &amp; interfaces: 定義package內會使用的型態以及介面</li><li>Functions: functions的實作<h3 id="Package的範圍：一個資料夾內的所有-go檔案，其他除外"><a href="#Package的範圍：一個資料夾內的所有-go檔案，其他除外" class="headerlink" title="Package的範圍：一個資料夾內的所有.go檔案，其他除外"></a>Package的範圍：一個資料夾內的所有<code>.go</code>檔案，其他除外</h3>基本上一個Go Package只會包含單一目錄內所有的Go Source.</li></ul><p>舉個例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---services</span><br><span class="line"> |--- events (Package)</span><br><span class="line">   |-- data (資料夾)</span><br><span class="line">   |-- handlers.go</span><br><span class="line">   |-- serve.go</span><br></pre></td></tr></table></figure><p>上面<code>events</code>這個package，只會包含 <code>handlers.go</code> 以及 <code>serve.go</code> 這兩隻檔案的內容，<code>data</code>資料夾會被排除</p><h2 id="Package種類"><a href="#Package種類" class="headerlink" title="Package種類"></a>Package種類</h2><h3 id="Library-Packages"><a href="#Library-Packages" class="headerlink" title="Library Packages"></a>Library Packages</h3><p>定義Golang Package的內容，提供相同功能性的function。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .../services</span></span><br><span class="line"><span class="keyword">package</span> services</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>Library Pakcage通常被其他的package所引入進來</li><li>Library Package的名稱必須要跟自己的資料夾名稱一樣</li><li>pakcage內的最好是提供相似的功能<h3 id="Main-Package"><a href="#Main-Package" class="headerlink" title="Main Package"></a>Main Package</h3></li></ul><p>定義了Application的進入點，程式要啟動就會是從main package開始，注重在app的設置以及初始化的邏輯。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>包含 main() function</li><li>可以在任何的資料夾</li></ul><h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p><code>http</code> package: <a href="https://golang.org/pkg/net/http/" target="_blank" rel="noopener">https://golang.org/pkg/net/http/</a></p><ul><li>Constants: 定義常數內容</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    StatusContinue           = <span class="number">100</span> <span class="comment">// RFC 7231, 6.2.1</span></span><br><span class="line">    StatusSwitchingProtocols = <span class="number">101</span> <span class="comment">// RFC 7231, 6.2.2</span></span><br><span class="line">    StatusProcessing         = <span class="number">102</span> <span class="comment">// RFC 2518, 10.1</span></span><br><span class="line">    StatusEarlyHints         = <span class="number">103</span> <span class="comment">// RFC 8297</span></span><br><span class="line"></span><br><span class="line">    StatusOK                   = <span class="number">200</span> <span class="comment">// RFC 7231, 6.3.1</span></span><br><span class="line">    StatusCreated              = <span class="number">201</span> <span class="comment">// RFC 7231, 6.3.2</span></span><br><span class="line">    StatusAccepted             = <span class="number">202</span> <span class="comment">// RFC 7231, 6.3.3</span></span><br><span class="line">    StatusNonAuthoritativeInfo = <span class="number">203</span> <span class="comment">// RFC 7231, 6.3.4</span></span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li><p>Variables: 定義變數內容，且給予說明</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    <span class="comment">// ErrNotSupported is returned by the Push method of Pusher</span></span><br><span class="line">    <span class="comment">// implementations to indicate that HTTP/2 Push support is not</span></span><br><span class="line">    <span class="comment">// available.</span></span><br><span class="line">    ErrNotSupported = &amp;ProtocolError&#123;<span class="string">"feature not supported"</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Deprecated: ErrUnexpectedTrailer is no longer returned by</span></span><br><span class="line">    <span class="comment">// anything in the net/http package. Callers should not</span></span><br><span class="line">    <span class="comment">// compare errors against this variable.</span></span><br><span class="line">    ErrUnexpectedTrailer = &amp;ProtocolError&#123;<span class="string">"trailer header without chunked transfer encoding"</span>&#125;</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>Types: 定義客製化型態，並給予說明</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Client is an HTTP client. Its zero value (DefaultClient) is a usable client that uses DefaultTransport. ...</span></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// Transport specifies the mechanism by which individual</span></span><br><span class="line">    <span class="comment">// HTTP requests are made.</span></span><br><span class="line">    <span class="comment">// If nil, DefaultTransport is used.</span></span><br><span class="line">    Transport RoundTripper</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>也提供了Clinet形態的初始化變數設置，不用一直自行初始化<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultClient is the default Client and is used by Get, Head, and Post.</span></span><br><span class="line"><span class="keyword">var</span> DefaultClient = &amp;Client&#123;&#125;</span><br></pre></td></tr></table></figure></p><ul><li>Function: 定義function內容，並添加說明</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CanonicalHeaderKey returns the canonical format of the header key s. The canonicalization converts the first letter and any letter following a hyphen to upper case; the rest are converted to lowercase. For example, the canonical key for "accept-encoding" is "Accept-Encoding". If s contains a space or invalid header field bytes, it is returned without modifications.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CanonicalHeaderKey</span></span> &#123;...&#125;</span><br></pre></td></tr></table></figure><h2 id="Pakcage-的生命週期"><a href="#Pakcage-的生命週期" class="headerlink" title="Pakcage 的生命週期"></a>Pakcage 的生命週期</h2><ol><li>Import 所需要的package</li><li>將initial value設置在variables</li><li>呼叫 <code>init()</code> 方法，執行初始化該package的動作</li></ol><blockquote><p>注意，無法直接呼叫 <code>init()</code> ，該方法只能在golang的compiler時期被golang呼叫執行。</p></blockquote><h3 id="範例-1"><a href="#範例-1" class="headerlink" title="範例"></a>範例</h3><p>假如有個目錄如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- cmd</span><br><span class="line"> |--- startAll</span><br><span class="line"> |   |- main.go</span><br><span class="line"> |--- services</span><br><span class="line">     |- handlers.go</span><br><span class="line">     |- serve.go</span><br><span class="line"> |--- internal</span><br><span class="line">     |--- ports</span><br><span class="line">        |--- ports.go</span><br></pre></td></tr></table></figure></p><p>若 <code>main.go</code> import <code>services</code> 這個package</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Package events provides a webservice that manages the libary's special events.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> events</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/pluralsight/libmanager/services/internal/ports"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StartServer registers the handlers and initiates the web service.</span></span><br><span class="line"><span class="comment">// The service is started on the local machine with the port specified by</span></span><br><span class="line"><span class="comment">// .../lm/services/internal/ports#EventService</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartServer</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">sm := http.NewServeMux()</span><br><span class="line">sm.Handle(<span class="string">"/"</span>, <span class="built_in">new</span>(eventHandler))</span><br><span class="line"><span class="keyword">return</span> http.ListenAndServe(<span class="string">":"</span>+strconv.Itoa(port), sm)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"serve.go 1"</span>, port)</span><br><span class="line">port = ports.EventService</span><br><span class="line">fmt.Println(<span class="string">"serve.go 2"</span>, port)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"second init in serve.go"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到init() 可以多次宣告</p></blockquote><p>此時<code>main.go</code>呼叫<code>services</code> pakcage內的<code>startServer</code> function</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package main is typically used to define a single, executable command and its associated logic.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Functions in the main package should normally avoid containing business logic; they</span></span><br><span class="line"><span class="comment">// should focus on initializing the application and handling any errors that are returned by</span></span><br><span class="line"><span class="comment">// any library calls.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/pluralsight/libmanager/services/events"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"init in main.go"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The main function, when defined in a main package, defines</span></span><br><span class="line"><span class="comment">// the entry and exit point for an executable command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Println(<span class="string">"Starting all services"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// start the services</span></span><br><span class="line">wg := <span class="built_in">new</span>(sync.WaitGroup)</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">// 執行 events package內的StartServer方法</span></span><br><span class="line"><span class="keyword">go</span> startServer(wg, events.StartServer)</span><br><span class="line">wg.Wait()</span><br><span class="line">log.Println(<span class="string">"All services stopped"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// startServer is a function in the main package that supports the command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startServer</span><span class="params">(wg *sync.WaitGroup, startFunc <span class="keyword">func</span>()</span> <span class="title">error</span>)</span> &#123;</span><br><span class="line">err := startFunc()</span><br><span class="line">wg.Done()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要注意，services import了internal內<code>ports</code> package的變數，故若呼叫了<code>main.go</code> 中的startServer，會先印出初始化的<code>port = 42</code>, 再來是透過<code>init()</code>接收到ports package的 <code>port = 3000</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">fmt.Println(&quot;serve.go 1&quot;, port)</span><br><span class="line">port = ports.EventService</span><br><span class="line">fmt.Println(&quot;serve.go 2&quot;, port)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>印出如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">serve.go 1 42</span><br><span class="line">serve.go 2 3000</span><br><span class="line">second init in serve.go</span><br></pre></td></tr></table></figure></p><h2 id="Pakcage-存取範疇"><a href="#Pakcage-存取範疇" class="headerlink" title="Pakcage 存取範疇"></a>Pakcage 存取範疇</h2><ul><li>Public Scope<ul><li>以大寫宣告</li><li>可被專案內所有成員存取</li></ul></li><li>Package Scope<ul><li>以小寫宣告</li><li>只能被同一個package內存取</li></ul></li><li>Internal Package<ul><li>可同時使用public-level, package-level 的成員</li><li>只限於父層與子層的成員存取</li></ul></li></ul><h2 id="Pakcage設計的Best-Practice"><a href="#Pakcage設計的Best-Practice" class="headerlink" title="Pakcage設計的Best Practice"></a>Pakcage設計的Best Practice</h2><h3 id="Pakcage-名稱"><a href="#Pakcage-名稱" class="headerlink" title="Pakcage 名稱"></a>Pakcage 名稱</h3><ul><li>儘量簡短，使用名詞</li><li>小寫開頭，不使用 <code>_</code>, <code></code>等特殊字元</li><li>別使用一般使用者會用到的變數名稱 <code>event</code>, <code>temp</code> 等名詞來命名.</li></ul><h3 id="Package-說明"><a href="#Package-說明" class="headerlink" title="Package 說明"></a>Package 說明</h3><p>一個公開的pakcage通常會包含兩個主要說明內容</p><ul><li>licensing: 使用的開放協議</li><li>package comment: package的功能說明</li><li>說明開頭應包含 package名稱，方法的話開頭會function的名稱</li></ul><p><code>helloworld/doc.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2009 The Go Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by sa BSD-style</span></span><br><span class="line"><span class="comment">// license that can be found in the LICENSE file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package helloworld implements ....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld</span><br></pre></td></tr></table></figure></p><p>這時使用 <code>go doc helloworld</code>，就會顯示 <code>helloworld</code> package內<code>doc.go</code>的說明</p><h4 id="使用-doc-go-做更複雜的說明"><a href="#使用-doc-go-做更複雜的說明" class="headerlink" title="使用 doc.go 做更複雜的說明"></a>使用 <code>doc.go</code> 做更複雜的說明</h4><p>若有太多的package敘述要呈現，通常會在<code>doc.go</code> 說明</p><p><img src="./pics/pic01.png" alt="pic01"></p><h3 id="Pakcage內容的描述撰寫指引"><a href="#Pakcage內容的描述撰寫指引" class="headerlink" title="Pakcage內容的描述撰寫指引"></a>Pakcage內容的描述撰寫指引</h3><ul><li>避免冗余</li></ul><p>例如，下面的package名稱與function名稱都重複了，所以可以將function名稱與package重複的部分給去掉<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.HTTPServer -&gt; http.server</span><br><span class="line">json.JSONEncoder -&gt; json.encoder</span><br></pre></td></tr></table></figure></p><ul><li>盡量簡化</li></ul><p>例如，下面可以簡化成如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time.NewTime -&gt; time.Time</span><br><span class="line">db.ConnectToDatabase -&gt; db.Connect</span><br></pre></td></tr></table></figure></p><h3 id="Package內容準則"><a href="#Package內容準則" class="headerlink" title="Package內容準則"></a>Package內容準則</h3><ul><li>提供直覺的功能<ul><li>single reponsibility: 單一功能</li><li>cohesive API: 功能相依的Application Programming Interface</li></ul></li><li>提供友善的使用方法<ul><li>simple to use</li><li>minimize API: 將功能重點化</li><li>encapsulate changes: 將變動封裝起來，不影響原本使用者的input, output的使用方式</li></ul></li><li>最大化可重複利用性<ul><li>reduce dependencies: 減少依賴其他dependencies的狀況</li><li>minimize scope: 縮小範疇，避免到處都是public，造成package內部的變數被其他地方所影響。</li></ul></li></ul><h3 id="結構設計"><a href="#結構設計" class="headerlink" title="結構設計"></a>結構設計</h3><table><thead><tr><th>Package Input</th><th>Package Output</th></tr></thead><tbody><tr><td>對於configuration使用 concrete types</td><td>對於configuration &amp; behavior 都使用concrete types</td></tr><tr><td>對於behavior 使用 interface</td><td>對於errors 請避免不發生 panics: 因為錯誤即使發生了，使用者也無法對其做處理</td></tr></tbody></table><p>透過 <code>http</code> package來看看其結構設計</p><table><thead><tr><th>Package Input</th><th>Package Output</th></tr></thead><tbody><tr><td><code>net/http.Request</code> 對於http.Reqeust所要使用的configuration，例如http body要用的參數格式是什麼，使用 concrete types，明確規範使用者要放置什麼給package</td><td><code>net/http.Response</code> 對於其回傳結果，將configuration &amp; behavior 都使用concrete types定義好，避免使用者混淆</td></tr><tr><td><code>net/http.Handler</code> 對於http.Handler, 這個處理http的behavior 使用 interface，方便使用者可以針對他們自己的http Request進來的行為定義自己的型態</td><td><code>net/http.Get</code> 正常狀況下 (用戶正確使用下)，用戶使用其方法是不會發生panic的</td></tr></tbody></table><h2 id="Import-Package方法"><a href="#Import-Package方法" class="headerlink" title="Import Package方法"></a>Import Package方法</h2><h3 id="1-Typical-Imports"><a href="#1-Typical-Imports" class="headerlink" title="1. Typical Imports"></a>1. Typical Imports</h3><p>使用<code>fmt</code> pakcage的 <code>Println</code> function<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"hello, gophers!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-Alternative-Imports"><a href="#2-Alternative-Imports" class="headerlink" title="2. Alternative Imports"></a>2. Alternative Imports</h3><ul><li>Aliases 將pakcege 別名</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// 這時會引入了兩個叫做json的pakcage, compiler會出現混淆</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"pluralsight.com/libmanager/json"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  data, err := json.Marshal(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可透過 alias ，將其中一個package名稱進行別名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"encode/json"</span></span><br><span class="line">  lmjson <span class="string">"pluralsight.com/libmanager/json"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="3-Import-for-side-effect-為引入的package，在引入其他的package使其作用"><a href="#3-Import-for-side-effect-為引入的package，在引入其他的package使其作用" class="headerlink" title="3. Import for side effect: 為引入的package，在引入其他的package使其作用"></a>3. Import for side effect: 為引入的package，在引入其他的package使其作用</h3><p>這有點難理解，直接看範例</p><p>例如以下有引入兩個packages, 一個是<code>sql</code> package, 另外一個是 <code>pq</code> postgres這個資料庫的package.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"database/sql"</span></span><br><span class="line">  _ <span class="string">"github.com/lib/pq"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>可以看到 <code>pq</code> 是用 <code>_</code> 代表他是一個write only的package, 本身使用者不會去使用到它，而是提供給 <code>sql</code> 做初始化sql內要採用哪個database做使用</p><p>可以看到 <a href="https://github.com/lib/pq/blob/master/conn.go" target="_blank" rel="noopener">pg</a> package內 有這一段程式碼，提供<code>init()</code>給sql做注入使用其postgres dirver做使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">sql.Register(<span class="string">"postgres"</span>, &amp;Driver&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Internal-packages"><a href="#4-Internal-packages" class="headerlink" title="4. Internal packages"></a>4. Internal packages</h3><p>主要提供父層與子層的pakcage做存取，目的是要提供跳脫自己之外的存取限制，又不會洩漏自己內部訊息給外部使用者。</p><p>只要是宣告為 <code>internal</code> 的package，就可以被父層或子層存取</p><p>以下範例為，<code>services</code> 下有宣告 <code>internal</code> package, 可提供其他package <code>services/events/serve.go</code> 做存取使用</p><p><img src="pics/pic04.png" alt="pic04"></p><p>若在超出internal定義的範疇 (上一個層級與下一個層級)，則會compiler編譯時會發生錯誤訊息</p><p><img src="pics/pic02.png" alt="pic02"></p><p><img src="pics/pic03.png" alt="pic03"></p><h3 id="4-Relative-Import"><a href="#4-Relative-Import" class="headerlink" title="4. Relative Import"></a>4. Relative Import</h3><p>透過 <code>../../package</code> 的方式import，不過在Production環境下不建議使用; 或者得透過golang最新的 <code>go mod</code> 管理方式。</p><h2 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h2><ul><li><p><a href="https://app.pluralsight.com/library/courses/go-packages-deep-dive/description" target="_blank" rel="noopener">Pluralsight: Deep Dive into Go Packages by Mike Van Sickle </a></p></li><li><p><a href="https://github.com/lib/pq/blob/master/conn.go" target="_blank" rel="noopener">lib/pq/conn.go</a></p></li><li><p><a href="https://stackoverflow.com/questions/38517593/relative-imports-in-go" target="_blank" rel="noopener">Stackoverflow: Relative imports in Go</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;以下收錄撰寫golang package可以遵循的內容&lt;/p&gt;
&lt;h2 id=&quot;Package-概覽&quot;&gt;&lt;a href=&quot;#Package-概覽&quot; class=&quot;headerlink&quot; title=&quot;Package 概覽&quot;&gt;&lt;/a&gt;Package 概覽&lt;/h2&gt;&lt;p&gt;一個G
      
    
    </summary>
    
    
      <category term="Golang" scheme="http://a10000005588.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Go new與make的介紹與差異 [Golang]</title>
    <link href="http://a10000005588.github.io/2020/11/08/Go-new%E8%88%87make%E7%9A%84%E4%BB%8B%E7%B4%B9%E8%88%87%E5%B7%AE%E7%95%B0/"/>
    <id>http://a10000005588.github.io/2020/11/08/Go-new與make的介紹與差異/</id>
    <published>2020-11-08T03:19:59.000Z</published>
    <updated>2020-11-08T05:01:19.326Z</updated>
    
    <content type="html"><![CDATA[<p>Golang中，<code>make</code>與<code>new</code>都是建構變數來使用</p><a id="more"></a><h2 id="new的介紹"><a href="#new的介紹" class="headerlink" title="new的介紹"></a>new的介紹</h2><p>new(T)會建構一個T型別的 “沒有名字” 的變數，以T的zeroed value來初始化T，且new(T) 回傳 “指向T的指標”</p><ul><li>若T是 string，那zeroed值為 <code>&quot;&quot;</code></li><li>若T是 int，那zeroed值為 <code>0</code></li><li>若T是 channel, func, map, slice，那zeroed值為 <code>nil</code></li></ul><h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p := <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// 宣告一個指向int不具名變數的`指標p`，`指標p`指向一個初始化的zeroed value為0</span></span><br><span class="line"></span><br><span class="line">fmt.Print(*p) <span class="comment">// 印出 0</span></span><br><span class="line"></span><br><span class="line">*p = <span class="number">2</span> <span class="comment">// 將不具名變數的值設置為2</span></span><br><span class="line"></span><br><span class="line">fmt.Print(*p) <span class="comment">// 印出 2</span></span><br></pre></td></tr></table></figure><p>其中new算是golang語法的簡寫，其中<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newInt</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>就等於下列寫法<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newInt</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> dummy <span class="keyword">int</span></span><br><span class="line">  <span class="keyword">return</span> &amp;dummy   <span class="comment">// 回傳dummy的指標</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="注意-謹慎操作new出來的map"><a href="#注意-謹慎操作new出來的map" class="headerlink" title="注意: 謹慎操作new出來的map"></a>注意: 謹慎操作new出來的map</h3><p>因為用<code>new</code>初始化的map會是 nil map，故以下操作會出現panic</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  book := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) </span><br><span class="line">  <span class="comment">// 宣告一個指標叫做book, 指向一個map為index是string</span></span><br><span class="line">  <span class="comment">// 映射到string型態的book名稱</span></span><br><span class="line"></span><br><span class="line">  b := *book  <span class="comment">// 取得book指標所指向的map</span></span><br><span class="line">  b[<span class="string">"ISBN-001"</span>] = <span class="string">"go programming language"</span> <span class="comment">// panic: assignment to entry in nil map</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述範例會出錯的原因是因為， b是一個nil map，沒有指向任何的記憶體位置，所以對一個nil值操作當然會冒出error</p><p>解法就得透過 <code>make</code> 方法為nil map分配確定的內存地址了</p><h3 id="new-不是-Keyword"><a href="#new-不是-Keyword" class="headerlink" title="new 不是 Keyword"></a><code>new</code> 不是 Keyword</h3><p>要注意一點是 <code>new</code> 並非是golang的關鍵字，故可以在func內重新宣告<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">delta</span><span class="params">(old, <span class="built_in">new</span> <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">new</span> - old</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="make的介紹"><a href="#make的介紹" class="headerlink" title="make的介紹"></a>make的介紹</h2><ul><li><code>make(T, args)</code>用來為 <code>slices</code>, <code>maps</code>, 以及 <code>channel</code>分配其記憶體位址的空間與初始化值，並回傳一個型態<code>T</code>的參考！</li><li>make不會回傳指標！</li></ul><h3 id="範例-1"><a href="#範例-1" class="headerlink" title="範例"></a>範例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  books := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">100</span>) <span class="comment">// 初始化長度為100的book字串陣列，每個array內的值都是 ""</span></span><br><span class="line">  </span><br><span class="line">  receiver := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>) <span class="comment">// 初始化channel，但不會回傳指標</span></span><br><span class="line">  booksMapper := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由於<code>make</code>回傳的是參考，所以若將make宣告的<code>s2</code> 傳給func <code>modifySlice</code>對<code>s2</code>做修改時，也會影響<code>s2</code>的內容</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifySlice</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    s[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s2 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">fmt.Printf(<span class="string">"%#v"</span>, s2) <span class="comment">// s2為 []int&#123;0, 0, 0&#125;</span></span><br><span class="line">modifySlice(s2)</span><br><span class="line">fmt.Printf(<span class="string">"%#v"</span>, s2) <span class="comment">// s2被modifySlice()方法給變成 []int&#123;1, 0, 0&#125;</span></span><br></pre></td></tr></table></figure><h2 id="new與make的差異"><a href="#new與make的差異" class="headerlink" title="new與make的差異"></a>new與make的差異</h2><ul><li>new會回傳指標，但是初始化的值為zeroed value，特別是在對map做初始化時，其zeroed valued為 <code>nil</code>，意思就是不會分配其記憶體位置</li><li>make只能用來對特別型態(如map, slice, func, channle)分配其記憶體內存地址，以及為這些特殊型態設定該初始值 (string就是””, int為0)</li></ul><p>所以若要傳指標時，就需要考慮用<code>new</code>，而非是<code>make</code>了</p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul><li>golang 筆記：make 與 new 的差別 by 愷開<ul><li><a href="https://medium.com/d-d-mag/golang-%E7%AD%86%E8%A8%98-make-%E8%88%87-new-%E7%9A%84%E5%B7%AE%E5%88%A5-68b05c7ce016" target="_blank" rel="noopener">https://medium.com/d-d-mag/golang-%E7%AD%86%E8%A8%98-make-%E8%88%87-new-%E7%9A%84%E5%B7%AE%E5%88%A5-68b05c7ce016</a></li></ul></li><li>Allocation with make<ul><li><a href="https://golang.org/doc/effective_go.html#allocation_make" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#allocation_make</a></li></ul></li><li>Allocation with new<ul><li><a href="https://golang.org/doc/effective_go.html#allocation_new" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#allocation_new</a></li></ul></li><li>The Go Programming Language, Author: Alan A. A. Donovan, Brian W. Kernighan</li><li>不要向nil map写入(panic: assignment to entry in nil map) #7<ul><li><a href="https://github.com/kevinyan815/gocookbook/issues/7" target="_blank" rel="noopener">https://github.com/kevinyan815/gocookbook/issues/7</a></li></ul></li><li>理解 Go make 和 new 的区别 by 三月沙<ul><li><a href="https://sanyuesha.com/2017/07/26/go-make-and-new/" target="_blank" rel="noopener">https://sanyuesha.com/2017/07/26/go-make-and-new/</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Golang中，&lt;code&gt;make&lt;/code&gt;與&lt;code&gt;new&lt;/code&gt;都是建構變數來使用&lt;/p&gt;
    
    </summary>
    
    
      <category term="Golang" scheme="http://a10000005588.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Go Module 入門與使用介紹</title>
    <link href="http://a10000005588.github.io/2020/11/07/Go-Module-%E5%85%A5%E9%96%80%E8%88%87%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%B4%B9%E4%BB%8B%E7%B4%B9/"/>
    <id>http://a10000005588.github.io/2020/11/07/Go-Module-入門與使用介紹介紹/</id>
    <published>2020-11-07T14:46:02.000Z</published>
    <updated>2021-01-28T12:18:22.322Z</updated>
    
    <content type="html"><![CDATA[<p>Go Module 為目前最主流的依賴解決的方案</p><p>發佈於 Go 11.1版，於Go 1.14推薦在Production環境上使用</p><a id="more"></a><p>Go Modules的出現解決了以下幾點爭議：</p><ul><li>依賴問題</li><li>淘汰GOPATH的機制</li><li>統一社群中其他依賴管理工具</li></ul><h2 id="為何-GOPATH-不在被推薦使用"><a href="#為何-GOPATH-不在被推薦使用" class="headerlink" title="為何 GOPATH 不在被推薦使用"></a>為何 GOPATH 不在被推薦使用</h2><h3 id="簡單介紹"><a href="#簡單介紹" class="headerlink" title="簡單介紹"></a>簡單介紹</h3><p>GOPATH原先是透過定義好的目錄結構如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">go</span><br><span class="line">|--bin</span><br><span class="line">|--pkg</span><br><span class="line">|--src</span><br><span class="line">    |--github.com</span><br><span class="line">    |--golang.org</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>各目錄分別為：</p><ul><li>bin: 儲存所編譯產生的二進位檔案</li><li>pkg: 儲存預先編譯的目的檔案，以加快程式的後續編譯速度</li><li>src: 儲存所有 .go 檔案或原始程式碼<ul><li>一般會以 <code>$GOPATH/src/github.com/</code> 儲存 Go的應用程式和函式庫</li></ul></li></ul><h3 id="棄用原因-無法明確定義與參照依賴-Dependency-的版本"><a href="#棄用原因-無法明確定義與參照依賴-Dependency-的版本" class="headerlink" title="棄用原因: 無法明確定義與參照依賴(Dependency)的版本"></a>棄用原因: 無法明確定義與參照依賴(Dependency)的版本</h3><p>因為<code>.go</code> 專案都必須要儲存在 <code>$GOPATH/src</code> 底下，但該依賴管理方式並沒有提供版本控制的概念，會造成以下問題：</p><ol><li>執行<code>go get</code> 取得遠端的依賴包時，會無法得知目前所載的版本</li><li>無法處理 v1,v2,v3等不同版本的參考問題，假設有的Library叫做 <code>/foo/bar</code> 但不管幾版，都會在GOPATH底下，其路徑都會是一樣的 (都在github.com/foo/bar)</li></ol><h2 id="Go-modules的基本使用方式"><a href="#Go-modules的基本使用方式" class="headerlink" title="Go modules的基本使用方式"></a>Go modules的基本使用方式</h2><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><ul><li><code>go mod init</code>: 產生 go.mod 檔案</li><li><code>go mod download</code>: 下載go.mod檔案中指明的所有依賴</li><li><code>go mod tidy</code>: 整理所有依賴</li><li><code>go mod graph</code>: 檢視現有的依賴結構</li><li><code>go mod edit</code>: 編輯 go.mod 檔案</li><li><code>go mod vendor</code>: 會出專案所有的依賴到vendor目錄</li><li><code>go mod verify</code>: 驗證一個模組是否被竄改過</li><li><code>go mod why</code>: 檢視為何需要依賴該模組</li></ul><h3 id="環境變數"><a href="#環境變數" class="headerlink" title="環境變數"></a>環境變數</h3><p>可透過 <code>go env</code> 來檢視常用的環境變數，以下為與Go Module相關的環境變數</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> GOMODULES新增的環境變數</span><br><span class="line">GO111MODULE="on"</span><br><span class="line">GOPROXY="https://proxy.golang.org,direct"</span><br><span class="line">GONOPROXY=""</span><br><span class="line">GOSUMDB="sum.golang.org"</span><br><span class="line">GONOSUMDB=""</span><br><span class="line">GOPRIVATE=""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 以下為原本GOPATH就有的環境變數</span><br><span class="line">GOARCH="amd64"</span><br><span class="line">GOBIN="/Users/user/go/bin"</span><br><span class="line">GOCACHE="/Users/user/Library/Caches/go-build"</span><br><span class="line">GOENV="/Users/user/Library/Application Support/go/env"</span><br><span class="line">GOEXE=""</span><br><span class="line">GOFLAGS=""</span><br><span class="line">GOHOSTARCH="amd64"</span><br><span class="line">GOHOSTOS="darwin"</span><br><span class="line">GOINSECURE=""</span><br><span class="line">GOMODCACHE="/Users/user/go/pkg/mod"</span><br><span class="line">GOOS="darwin"</span><br><span class="line">GOPATH="/Users/user/go"</span><br><span class="line">GOROOT="/usr/local/Cellar/go/1.15/libexec"</span><br><span class="line">GOTMPDIR=""</span><br><span class="line">GOTOOLDIR="/usr/local/Cellar/go/1.15/libexec/pkg/tool/darwin_amd64"</span><br><span class="line">GCCGO="gccgo"</span><br><span class="line">AR="ar"</span><br><span class="line">CC="clang"</span><br><span class="line">CXX="clang++"</span><br><span class="line">CGO_ENABLED="1"</span><br><span class="line">GOMOD="/dev/null"</span><br><span class="line">CGO_CFLAGS="-g -O2"</span><br><span class="line">CGO_CPPFLAGS=""</span><br><span class="line">CGO_CXXFLAGS="-g -O2"</span><br><span class="line">CGO_FFLAGS="-g -O2"</span><br><span class="line">CGO_LDFLAGS="-g -O2"</span><br><span class="line">PKG_CONFIG="pkg-config"</span><br><span class="line">GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build233814295=/tmp/go-build -gno-record-gcc-switches -fno-common"</span><br></pre></td></tr></table></figure><h4 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a>GO111MODULE</h4><p>透過GO111MODULE作為該專案是否使用 Go modules的開關，可設定以下內容</p><ul><li>auto: 只要專案包含 <code>go.mod</code> 檔案，就使用Go modules (在Go 1.11~1.14，為預設)</li><li>on: 啟用Go modules (推薦使用)</li><li>off: 禁用Go modules</li></ul><div style="border-radius: 10px;padding: 20px;background-color: #C8FAFF;color: black;margin-bottom: 15px;"><br>為何叫做 GO111MODULE?<br><br>因為go modules是在 go1.11版本所提出的<br></div><h4 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a>GOPROXY</h4><p>設定GO模組的proxy, 使Go在後續拉取模組的版本時，直接透過映像檔網站快速拉取，而非到Github這種Version control service平台</p><p>GOPROXY預設值為 <code>https://proxy.golang.org,direct</code>，透過逗號將代理的地方給隔開</p><p>若不想使用GOPROXY, 可設置為 GOPROXY=”off”</p><p>其中最後有 <code>direct</code> 一詞的用意是，若前面的proxy值都沒辦法載到<br>模組，例如在 <code>https://proxy.golang.org</code>抓不到，那麼就會回到原位置(例如Github)去下載</p><h4 id="GOSUMDB"><a href="#GOSUMDB" class="headerlink" title="GOSUMDB"></a>GOSUMDB</h4><p>GOSUMDB為Go checksum database，驗證拉取的模組版本資料未經過竄改</p><p>預設值為 <code>sum.golang.org</code>，也可設置成 <code>off</code>，禁止Go在後續操作中做驗證版本的動作</p><h4 id="GONOPROXY-GONOSUMDB-GOPRIVATE"><a href="#GONOPROXY-GONOSUMDB-GOPRIVATE" class="headerlink" title="GONOPROXY/GONOSUMDB/GOPRIVATE"></a>GONOPROXY/GONOSUMDB/GOPRIVATE</h4><p>設定私有模組的環境變數，一般來說建議直接設定 GONOPROXY，會作為 GONOPROXY與GONOSUMDB的預設值</p><p>值可設定多組，例如<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GOPRIVATE="git.xxx.com,github.com/eddycjy/mquote"</span><br></pre></td></tr></table></figure></p><p>設定之後字首為 <code>git.xxx.com</code> 以及 <code>github.com/eddycjy/mquote</code> 的模組會被認為是私有模組</p><p>也可以直接用設定 <code>*</code>，以下表示來自<code>.example.com</code> 的子域名的都表示來自私有倉庫</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GOPRIVATE="*.example.com"</span><br></pre></td></tr></table></figure><h3 id="啟用方式"><a href="#啟用方式" class="headerlink" title="啟用方式"></a>啟用方式</h3><p>Go modules預設不是開啟的，透過<code>GO111MODULE</code>來做設定，可用<code>auto</code>, <code>on</code>, <code>off</code>做設定</p><p>透過env進行設定 <code>go env -w</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GO111MODULE=on</span><br></pre></td></tr></table></figure></p><h3 id="初始化一個專案"><a href="#初始化一個專案" class="headerlink" title="初始化一個專案"></a>初始化一個專案</h3><p>在一個資料夾內，透過 <code>go mod init</code> 初始化一個專案</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go mod init github.com/jellyhola/module-repo</span><br><span class="line">go: creating new go.mod: module github.com/jellyhola/module-repo</span><br></pre></td></tr></table></figure><p>這時會產生一個 <code>go.mod</code> 檔案，會紀錄目前專案模組為 <code>github.com/jellyhola/module-repo</code>，go版本為<code>1.15</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line">go 1.15</span><br></pre></td></tr></table></figure></p><p>這時定義一份 <code>main.go</code> 檔案，import <code>github.com/example/hello</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"rsc.io/quote"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">Hello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Hello :print quote.Hello()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> quote.Hello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>這時專案目錄會自動產生 <code>go.sum</code>檔案, 以及<code>go.mod</code>會多紀錄使用了 <code>rsc.io/quote</code>模組以及使用的版本為 <code>1.5.2</code></p><p>go.sum<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=</span><br><span class="line">rsc.io/quote v1.5.2 h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">rsc.io/quote v1.5.2/go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPXsUe+TKr0=</span><br><span class="line">rsc.io/sampler v1.3.0 h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">rsc.io/sampler v1.3.0/go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9JXDnKaTXpA=</span><br></pre></td></tr></table></figure></p><p>go.mod<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line">go 1.15</span><br><span class="line"></span><br><span class="line">require rsc.io/quote v1.5.2</span><br></pre></td></tr></table></figure></p><div style="border-radius: 10px;padding: 20px;background-color: #C8FAFF;color: black;margin-bottom: 15px;"><br><br>建議將 go.sum與go.mod這兩個檔案提交到版本控制<br><br></div><p>由於本身<code>rsc.io/quote</code>這個模組，下載go時就已經安裝完畢，故不用透過 <code>go get</code>來額外下載</p><p>接著可用<code>go list -m all</code> 檢視目前專案所使用的依賴</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go list -m all</span><br><span class="line">github.com/jellyhola/module-repo</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br></pre></td></tr></table></figure><p>可看到目前 <code>golang.org/x/text</code>這項模組，為untagged的狀況，接著可以透過 <code>go get</code>來更新此模組到最新的tag</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go get golang.org/x/text</span><br><span class="line">go: golang.org/x/text upgrade =&gt; v0.3.4</span><br><span class="line">go: downloading golang.org/x/text v0.3.4</span><br></pre></td></tr></table></figure><p>可看到 go.mod內容改變了<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.15</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">golang.org/x/text v0<span class="number">.3</span><span class="number">.4</span> <span class="comment">// indirect</span></span><br><span class="line">rsc.io/quote v1<span class="number">.5</span><span class="number">.2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>其中 <code>// indirect</code> 表示該模組為間接依賴，表示目前應用程式的import敘述中，並沒有發現這模組的明確參考，有可能是</p><ul><li>事先手動go get拉取下來的模組</li><li>該專案所依賴模組之所依賴的</li></ul><p>試著跑一下專案，驗證模組是否能正常運作</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go run main.go</span><br><span class="line">你好，世界。%</span><br></pre></td></tr></table></figure><h3 id="拉取的模組會存在哪？"><a href="#拉取的模組會存在哪？" class="headerlink" title="拉取的模組會存在哪？"></a>拉取的模組會存在哪？</h3><p>go mod會將拉取的模組放置在 <code>$GOPATH/pkg/mod</code> 與 <code>$GOPATH/pkg/sumdb</code> 目錄下！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ls $GOPATH/pkg</span><br><span class="line">cache      github.com golang.org  rsc.io</span><br></pre></td></tr></table></figure><p>若想要清除已經快取的模組版本，使用 <code>go clean -modcache</code> 指令</p><h2 id="Go-module-進階探討"><a href="#Go-module-進階探討" class="headerlink" title="Go module 進階探討"></a>Go module 進階探討</h2><h3 id="Go-modules的go-get探討"><a href="#Go-modules的go-get探討" class="headerlink" title="Go modules的go get探討"></a>Go modules的go get探討</h3><p>使用go get取得模組時，會分別進行3個步驟</p><ol><li>finding: 查找模組是否存在</li><li>downloading: 進行下載</li><li>extracting: 分析下載的模組的雜湊值是否正確</li></ol><p>像上一節所拉取的模組 <code>golang.org/x/text</code> 其拉取的資訊如下</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">版本資訊-commit的時間-雜湊值</span><br><span class="line">v0.0.0-20170915032832-14c0d48ead0c</span><br></pre></td></tr></table></figure><ul><li>commit的時間會是以UTC時區為準</li><li>go get拉取的指令若沒有指定版本，會直接拉取到 v0.0.0版</li></ul><h3 id="go-get行為"><a href="#go-get行為" class="headerlink" title="go get行為"></a>go get行為</h3><ul><li>go get: 直接拉取dependency，只會更新指定的他自己</li><li>go get -u: 更新現有的dependency，會強制更新該denpendency所依賴的其他模組</li><li>go get -u -t: 更新所有denpendency，以及包含單元測試使用到的</li></ul><h3 id="go-get版本指定"><a href="#go-get版本指定" class="headerlink" title="go get版本指定"></a>go get版本指定</h3><ul><li>go get golang.org/x/text@latest : 拉取最新的版本，若存在tag，優先使用之</li><li>go get golang.org/x/text@master : 拉取master分支的最新commit</li><li>go get <a href="mailto:golang.org/x/text@v0.3.2" target="_blank" rel="noopener">golang.org/x/text@v0.3.2</a> : 拉取tag為v0.3.2的commit</li><li>go get golang.org/x/text@342b2e : 拉取hash為342b2e的commit，最後轉為 v0.3.2</li></ul><h2 id="Go-modules的go-run與go-build"><a href="#Go-modules的go-run與go-build" class="headerlink" title="Go modules的go run與go build"></a>Go modules的go run與go build</h2><p>執行go build時，會根據go.mod自動下載該專案所需的模組，才進行編譯</p><div style="border-radius: 10px;padding: 20px;background-color: #FFF6C8;color: black;margin-bottom: 15px;"><br><br>若是要使用 vendor目錄作為denpendency, 在執行 go mod vendor產生vendor目錄後，需要執行 go build -mod=vendor<br>才可使用 go build -mod=vendor 使用vendor目錄作為denpendency來編譯<br><br></div><h2 id="Go-modules匯入路徑說明"><a href="#Go-modules匯入路徑說明" class="headerlink" title="Go modules匯入路徑說明"></a>Go modules匯入路徑說明</h2><p>Go modules在主版本編號為 v0與v1的情況會省略其編號，在v2以上則需要明確指定！</p><p>假如要匯入 v2以上的<a href="mailto:golang.org/example@v2.0.0" target="_blank" rel="noopener">golang.org/example@v2.0.0</a>，則必須要在import底下明確指定v2</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/example/v2"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="為何省略v0與v1"><a href="#為何省略v0與v1" class="headerlink" title="為何省略v0與v1??"></a>為何省略v0與v1??</h3><p>因為官方鼓勵開發人員將模組建立到v1版本就不在變動。</p><p>所以若開發人員在發佈v2版本時，會被擁有明確的v1版本尾綴，近一步導致v1版本變成雜訊且沒有什麼意義</p><p>在匯入路徑忽略v0版本，因為根據語意化版本標準，v0的這些版本大多沒有相容性保證</p><h2 id="Go-modules-語意化版本控制"><a href="#Go-modules-語意化版本控制" class="headerlink" title="Go modules 語意化版本控制"></a>Go modules 語意化版本控制</h2><p>一個go modules的版本資訊如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//主版本號.次版本號.修訂號</span><br><span class="line">v1.2.3</span><br></pre></td></tr></table></figure></p><ul><li>主版本編號：做了不相容的API修改之類的</li><li>次版本編號: 做了向下相容的功能性新增</li><li>修訂好: 向下相容的功能除錯</li></ul><p>若是先行版本的話，那加上 <code>pre</code> 後綴<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1.2.3-pre</span><br></pre></td></tr></table></figure></p><div style="border-radius: 10px;padding: 20px;background-color: #FFF6C8;color: black;margin-bottom: 15px;"><br><br>發佈新版本時應遵循語意化版本規則，否則無法被go get所拉取<br><br></div><h2 id="go-list的功能"><a href="#go-list的功能" class="headerlink" title="go list的功能"></a>go list的功能</h2><p>提供該專案所有denpendency的資訊</p><p>透過 <code>go list -m -u all</code> 可以檢視所有的dependency資訊</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ go list -m -u all</span><br><span class="line">github.com/jellyhola/module-repo</span><br><span class="line">golang.org/x/text v0.3.4</span><br><span class="line">golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br></pre></td></tr></table></figure><ul><li>-m: 顯示所有依賴的模組</li><li>-u: 顯示能夠升級的版本</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Go Module 為目前最主流的依賴解決的方案&lt;/p&gt;
&lt;p&gt;發佈於 Go 11.1版，於Go 1.14推薦在Production環境上使用&lt;/p&gt;
    
    </summary>
    
      <category term="Golang" scheme="http://a10000005588.github.io/categories/Golang/"/>
    
    
      <category term="Golang" scheme="http://a10000005588.github.io/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Gitbook的使用紀錄</title>
    <link href="http://a10000005588.github.io/2020/10/04/gitbook-tutorial/"/>
    <id>http://a10000005588.github.io/2020/10/04/gitbook-tutorial/</id>
    <published>2020-10-03T22:47:21.000Z</published>
    <updated>2021-01-28T12:12:54.817Z</updated>
    
    <content type="html"><![CDATA[<p>Gitbook提供了能夠將markdown格式轉寫成一本電子書的樣子</p><a id="more"></a><h2 id="本地端執行"><a href="#本地端執行" class="headerlink" title="本地端執行"></a>本地端執行</h2><p>安裝方式，用 <a href="https://www.npmjs.com/package/gitbook" target="_blank" rel="noopener">npm</a> 安裝</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g gitbook-cli</span><br></pre></td></tr></table></figure><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>找一個資料夾，執行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook init</span><br></pre></td></tr></table></figure></p><p>會產生 </p><ul><li>reamdme.md<ul><li>介紹本書內容</li></ul></li><li>summary.md<ul><li>用來定義gitbook目錄</li></ul></li></ul><h4 id="summary-md-結構"><a href="#summary-md-結構" class="headerlink" title="summary.md 結構"></a>summary.md 結構</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* ch1</span><br><span class="line">  * ch1-1</span><br><span class="line">  * ch1-2</span><br></pre></td></tr></table></figure><p>檔案結構的話就長這樣<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- ch1</span><br><span class="line">|- ch1-1</span><br><span class="line">|- ch1-2</span><br><span class="line">-readme.md</span><br><span class="line">-summary.md</span><br></pre></td></tr></table></figure></p><h2 id="運行gitbook"><a href="#運行gitbook" class="headerlink" title="運行gitbook"></a>運行gitbook</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook serve</span><br></pre></td></tr></table></figure><p>預設會運行在 <a href="http://localhost:4000" target="_blank" rel="noopener">localhost:4000</a></p><h3 id="安裝Plugin"><a href="#安裝Plugin" class="headerlink" title="安裝Plugin"></a>安裝Plugin</h3><p>事先安裝gitbook-plugin套件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gitbook-plugin</span><br></pre></td></tr></table></figure></p><p>若要安裝留言板等套件，需要先定義 book.json ，可以定義使用的plugin</p><p>book.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [&quot;disqus&quot;],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;disqus&quot;: &#123;</span><br><span class="line">      &quot;shortName&quot;: &quot;你的留言板名稱&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>例如可使用 Google Analytics ( Google 分析 )、Disqus ( 社群&amp;留言板 ) 和 youtube …等外掛，也可以在Gitbook npm網站中找到自己要的plugin</p><p>定義玩使用的plungin外掛，請執行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook install</span><br></pre></td></tr></table></figure></p><h3 id="Disqus留言板"><a href="#Disqus留言板" class="headerlink" title="Disqus留言板"></a>Disqus留言板</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gitbook-plugin-disqus</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [&quot;disqus&quot;],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;disqus&quot;: &#123;</span><br><span class="line">      &quot;shortName&quot;: &quot;你的留言板名稱&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="內容綱要-InTopic-TOC"><a href="#內容綱要-InTopic-TOC" class="headerlink" title="內容綱要 InTopic TOC"></a>內容綱要 InTopic TOC</h3><p>如果要實現右邊側邊欄本頁md檔案的階層式，可安裝 InTopic TOC</p><p><a href="https://github.com/fzankl/gitbook-plugin-intopic-toc" target="_blank" rel="noopener">GitBook plugin: InTopic TOC</a></p><p>於book.json中定義<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;intopic-toc&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;intopic-toc&quot;: &#123;</span><br><span class="line">      &quot;label&quot;: &quot;In this article&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>接著執行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook install</span><br></pre></td></tr></table></figure></p><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><p><a href="https://github.com/GitbookIO/gitbook" target="_blank" rel="noopener">Gitbook Github Docs</a></p><p><a href="https://docs.gitbook.com/getting-started/quick-start" target="_blank" rel="noopener">Gitbook Online Platform Docs</a></p><p><a href="https://www.oxxostudio.tw/articles/201502/gitbook.html" target="_blank" rel="noopener">用 GitBook 來寫本書吧</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Gitbook提供了能夠將markdown格式轉寫成一本電子書的樣子&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://a10000005588.github.io/categories/Tools/"/>
    
    
      <category term="Note" scheme="http://a10000005588.github.io/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>靜態與動態函式庫的介紹與差異(Static 與 Shared Libraries)</title>
    <link href="http://a10000005588.github.io/2020/08/17/Static_vs_Shared_Lib/"/>
    <id>http://a10000005588.github.io/2020/08/17/Static_vs_Shared_Lib/</id>
    <published>2020-08-17T13:38:37.000Z</published>
    <updated>2021-01-28T12:10:16.323Z</updated>
    
    <content type="html"><![CDATA[<p>剛好在複習Golang的時候看到Go有支援載入C Language的Static Library與Shared Libraries，於是來複習一下他們之間的差異</p><a id="more"></a><h2 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h2><p>首先要先了解，Library的意義，就單純為一個檔案<br>將會共用的程式碼打包再一起的檔案就稱為Library</p><p>假設現在若要使用print這個方法來印出東西在螢幕，<br>故可以將print編譯成Library，供各個開發者直接使用，不用讓開發者自己定義print方法，要煩惱如何與OS溝通並印出畫面的邏輯程式碼</p><h3 id="Static-Library"><a href="#Static-Library" class="headerlink" title="Static Library"></a>Static Library</h3><p>Static Libarary通常為我們自己寫好的程式碼，經過Compile之後，所得到的就是 Static Library</p><p>Shared則是我們也是將程式碼經過Compile，也是得到 Shared Library</p><p>聽起來過程都很像，那到底差異在哪？</p><p>其實從字面上曉得，從使用其意義來解釋</p><p>在專案程式使用其Static Library時，該專案進行Compile，Compiler會在Compile Time時將Static Library的程式碼給”複製”到專案程式碼中。</p><p>假如我們Static Lib中有個<code>print()</code>方法，那專案Compile時就會把<code>print()</code>方法copy到APP中，APP啟動時就會有<code>print()</code>方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE (import static lib) -&gt; Compiled STATIC Lib</span><br><span class="line">APP 啟動 -&gt; PRINT()</span><br></pre></td></tr></table></figure><h3 id="Shared-Library"><a href="#Shared-Library" class="headerlink" title="Shared Library"></a>Shared Library</h3><p>顧名思義就是直接共享Library內的程式碼</p><p>當專案使用的是Shared Library，那專案進行Compile時，Compiler會去<code>Link</code> Shared Libaray的方法，而不是用複製的。</p><p>假如Shared Library Lib中同樣有個<code>print()</code>方法，那專案Compile就會連結該Shared Lib中的<code>print()</code>方法，於是APP啟動也同樣會有<code>print()</code>方法可使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE (import shared lib) -&gt; Compiled</span><br><span class="line">APP 啟動 -&gt; 連結使用 Shared Lib內的 print()</span><br></pre></td></tr></table></figure><blockquote><p>Shared Library支援動態連結載入</p></blockquote><h2 id="使用情境"><a href="#使用情境" class="headerlink" title="使用情境"></a>使用情境</h2><p>若要給客戶提供一個有100個功能的APP</p><p>交付給客戶的若是 Static Library建築出的APP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客戶聽著，你只要有這一個檔案，就包含了你需要的100個功能</span><br></pre></td></tr></table></figure><p>若交付給客戶的功能，每一隻功能都用Shared Library實作，那麼。。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客戶聽著，我這個檔案很小，但同時要連結100的檔案 (Shared Library)，一個都不能少，才能啟動</span><br></pre></td></tr></table></figure><h2 id="優缺點"><a href="#優缺點" class="headerlink" title="優缺點"></a>優缺點</h2><table><thead><tr><th></th><th>Static</th><th>Shared</th></tr></thead><tbody><tr><td>專案大小</td><td>專案size比較肥大</td><td>專案的size較小</td></tr><tr><td>啟動狀況</td><td>程式碼在Compile時都放在一起了，直接運行該專案就好</td><td>若某個Shared Lib不見，專案會無法啟動</td></tr><tr><td>是否支援動態連結</td><td>無，專案運作時較耗費記憶體</td><td>有支援，當執行到有使用Shared Library的class時，才會載入之到記憶體，避免記憶體空間浪費</td></tr></tbody></table><h2 id="Library編譯的檔案格式"><a href="#Library編譯的檔案格式" class="headerlink" title="Library編譯的檔案格式"></a>Library編譯的檔案格式</h2><ul><li><p>Shared Libraries</p><ul><li>.so (Linus)</li><li>.dll (Win)</li><li>.dylib (Mac)</li></ul></li><li><p>Static Libraries</p><ul><li>.a</li><li>.lib</li></ul></li></ul><h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><p>Static vs. Shared Libraries<br><a href="https://www.youtube.com/watch?v=-vp9cFQCQCo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=-vp9cFQCQCo</a></p><p>Static 與 Shared 的函式庫撰寫<br><a href="https://fred-zone.blogspot.com/2006/03/static-shared.html" target="_blank" rel="noopener">https://fred-zone.blogspot.com/2006/03/static-shared.html</a></p><p>動態連結函式庫<br><a href="https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;剛好在複習Golang的時候看到Go有支援載入C Language的Static Library與Shared Libraries，於是來複習一下他們之間的差異&lt;/p&gt;
    
    </summary>
    
      <category term="Computer Science" scheme="http://a10000005588.github.io/categories/Computer-Science/"/>
    
    
      <category term="Computer Science" scheme="http://a10000005588.github.io/tags/Computer-Science/"/>
    
  </entry>
  
  <entry>
    <title>State Pattern 狀態模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/08/08/Design-Pattern-Java-State-Pattern-%E7%8B%80%E6%85%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/08/08/Design-Pattern-Java-State-Pattern-狀態模式/</id>
    <published>2020-08-08T14:10:35.000Z</published>
    <updated>2021-01-28T12:17:50.577Z</updated>
    
    <content type="html"><![CDATA[<p>透過統一的”狀態類別”，來定義物件的內部狀態是如何</p><a id="more"></a><h2 id="以糖果機為例子，沒有使用State-Pattern的狀況"><a href="#以糖果機為例子，沒有使用State-Pattern的狀況" class="headerlink" title="以糖果機為例子，沒有使用State Pattern的狀況"></a>以糖果機為例子，沒有使用State Pattern的狀況</h2><p>我們現在有個糖果機，通常一台糖果機可以進行投幣，轉動手把，並吐出一顆糖果</p><p>所以該糖果機共有四種狀態 (NoCoinState目前沒有錢幣, HasCoinState目前有錢幣, SoldCandyState售出糖果中, NoCandyState沒有糖果中)，如附圖所示：</p><p><img src="https://i.imgur.com/ulduLlN.png" alt=""></p><p>我們會很直覺的定義糖果機類別與這四個狀態為全域變數，並且實作一下糖果機具備的動作方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CandyMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> NoCandyState = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> NoCoinState = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> HasCoinState = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> SoldCandyState = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> state = NoCandyState; <span class="comment">// 一開始糖果機是沒有糖果的</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">// 糖果數目</span></span><br><span class="line"></span><br><span class="line">    CandyMachine(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        <span class="keyword">this</span>.state = NoCoinState; <span class="comment">// 有了糖果，等待被投錢</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"投入錢幣"</span>);</span><br><span class="line">        <span class="keyword">this</span>.state = HasCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"轉動把手中......"</span>);</span><br><span class="line">        <span class="comment">// 判斷目前是否有錢</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state == HasCoinState) &#123;</span><br><span class="line">            <span class="keyword">this</span>.state = SoldCandyState;</span><br><span class="line">           <span class="keyword">this</span>.dispense();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"目前沒有錢幣"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 有錢的話就吐一顆糖果出來</span></span><br><span class="line">        System.out.println(<span class="string">"糖果機吐了一顆糖果"</span>);</span><br><span class="line">        <span class="keyword">this</span>.count--;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 沒有糖果了，回歸到沒糖果狀態</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCandyState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 還有糖果的話，顯示目前沒有錢幣</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCoinState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那我們現在可以來跟糖果機互動一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CandyMachine candyMachine = <span class="keyword">new</span> CandyMachine(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先投錢，在轉動</span></span><br><span class="line">        System.out.println(<span class="string">"====先投錢，在轉動===="</span>);</span><br><span class="line">        candyMachine.insertCoin();</span><br><span class="line">        candyMachine.turnCrank();</span><br><span class="line">        <span class="comment">// 不投錢，直接轉動</span></span><br><span class="line">        System.out.println(<span class="string">"====不投錢，直接轉動===="</span>);</span><br><span class="line">        candyMachine.turnCrank();</span><br><span class="line">        <span class="comment">// 投錢，但糖果機目前沒糖果了</span></span><br><span class="line">        System.out.println(<span class="string">"=====投錢，但糖果機目前沒糖果了===="</span>);</span><br><span class="line">        candyMachine.insertCoin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">====先投錢，在轉動====</span><br><span class="line">投入錢幣</span><br><span class="line">轉動把手中......</span><br><span class="line">糖果機吐了一顆糖果</span><br><span class="line">====不投錢，直接轉動====</span><br><span class="line">轉動把手中......</span><br><span class="line">目前沒有錢幣</span><br><span class="line">=====投錢，但糖果機目前沒糖果了====</span><br><span class="line">投入錢幣</span><br><span class="line">目前沒有糖果，錢退還給您</span><br></pre></td></tr></table></figure><p>目前看起來運作的很正常</p><h3 id="假如有新需求：轉動時會有機率可以再多送一顆！"><a href="#假如有新需求：轉動時會有機率可以再多送一顆！" class="headerlink" title="假如有新需求：轉動時會有機率可以再多送一顆！"></a>假如有新需求：轉動時會有機率可以再多送一顆！</h3><p>那這時候…我們得對CandyMachine的<code>dispense()</code>做個調整：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定義機率，如果機率小於10%就吐出兩顆糖果</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">if</span> (rand.nextInt(<span class="number">10</span>) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"恭喜中獎，糖果機吐了二顆糖果"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.count &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// 吐出兩顆糖果</span></span><br><span class="line">                <span class="keyword">this</span>.count--;</span><br><span class="line">                <span class="keyword">this</span>.count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 沒中獎，只吐一顆</span></span><br><span class="line">            <span class="keyword">this</span>.count--;</span><br><span class="line">            <span class="comment">// 有錢的話就吐一顆糖果出來</span></span><br><span class="line">            System.out.println(<span class="string">"糖果機吐了一顆糖果"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 沒有糖果了，回歸到沒糖果狀態</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCandyState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 還有糖果的話，顯示目前沒有錢幣</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCoinState;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時可以看到，每次若有新需求，就需要一直對CandyMachine類別一直做修正，其未來若有更多狀態時，程式碼會變得不好維護</p><h2 id="使用狀態模式改善目前糖果機的設計"><a href="#使用狀態模式改善目前糖果機的設計" class="headerlink" title="使用狀態模式改善目前糖果機的設計"></a>使用狀態模式改善目前糖果機的設計</h2><p>先來看看該設計模式的圖表是長怎樣</p><h3 id="狀態模式的類別圖"><a href="#狀態模式的類別圖" class="headerlink" title="狀態模式的類別圖"></a>狀態模式的類別圖</h3><p><img src="https://i.imgur.com/umZlxP3.png" alt=""></p><p>這時我們可以看到，將原本糖果機內的static全域變數狀態，都統一變成一個state變數 (為StateComponent介面型態)。</p><p>這時我們就想把每個狀態 (NoCoinState目前沒有錢幣, HasCoinState目前有錢幣, SoldCandyState售出糖果中, NoCandyState沒有糖果中) 都統一變成 <code>ConcreteState</code>類別，來實作<code>State抽象介面</code>，以利<code>Client類別</code>可以抽換狀態</p><p>接著直接來改造糖果機，先定義每個狀態都會有對應的方法</p><p>因為當糖果機為某種狀態時，若呼叫其動作，就會印出對應的資訊</p><p>這裡我們先為每個動作都先拋出例外，因為有些方法有的狀態可能不需要使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="定義糖果機的雛形"><a href="#定義糖果機的雛形" class="headerlink" title="定義糖果機的雛形"></a>定義糖果機的雛形</h3><p>糖果機擁有了各個狀態的類別，並且提供<code>getXXX()</code>方法，供其他狀態可以抽換自己的狀態</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CandyMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> State state;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    State noCoinState;</span><br><span class="line">    State hasCoinState;</span><br><span class="line">    State soldCandyState;</span><br><span class="line">    State noCandyState;</span><br><span class="line"></span><br><span class="line">    CandyMachine(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        noCoinState = <span class="keyword">new</span> NoCoinState(<span class="keyword">this</span>);</span><br><span class="line">        hasCoinState = <span class="keyword">new</span> HasCoinState(<span class="keyword">this</span>);</span><br><span class="line">        soldCandyState = <span class="keyword">new</span> SoldCandyState(<span class="keyword">this</span>);</span><br><span class="line">        noCandyState = <span class="keyword">new</span> NoCandyState(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoCoinState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.noCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasCoinState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.hasCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldCandyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.soldCandyState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoCandyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.noCandyState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="實作各個狀態"><a href="#實作各個狀態" class="headerlink" title="實作各個狀態"></a>實作各個狀態</h3><p>每個狀態都會引入<code>CandyMachin</code>類別，以便能夠幫助糖果機進行狀態變化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCoinState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    NoCoinState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"投入錢幣"</span>);</span><br><span class="line">        <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getHasCoinState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前沒有錢幣"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HasCoinState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    HasCoinState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前已經有錢幣了！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"轉動手把中"</span>);</span><br><span class="line">        <span class="comment">// 切換到下一個狀態</span></span><br><span class="line">        candyMachine.setState(<span class="keyword">this</span>.candyMachine.getSoldCandyState());</span><br><span class="line">        <span class="keyword">this</span>.candyMachine.state.dispense();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前沒有錢幣"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoldCandyState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    SoldCandyState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前正在吐糖果中，請勿投幣！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前正在吐糖果中，請勿轉動！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"開始吐糖果"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定義機率，如果機率小於10%就吐出兩顆糖果</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">if</span> (rand.nextInt(<span class="number">10</span>) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"恭喜中獎，糖果機吐了二顆糖果"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.candyMachine.count &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// 吐出兩顆糖果</span></span><br><span class="line">                <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">                <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 沒中獎，只吐一顆</span></span><br><span class="line">            <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">            <span class="comment">// 有錢的話就吐一顆糖果出來</span></span><br><span class="line">            System.out.println(<span class="string">"糖果機吐了一顆糖果"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.candyMachine.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getNoCandyState());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getNoCoinState());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCandyState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    NoCandyState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前沒有糖果，請勿投幣！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"目前沒有糖果，請勿投幣"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="操作糖果機"><a href="#操作糖果機" class="headerlink" title="操作糖果機"></a>操作糖果機</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CandyMachine candyMachine = <span class="keyword">new</span> CandyMachine(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先投錢，在轉動</span></span><br><span class="line">        System.out.println(<span class="string">"====先投錢，在轉動===="</span>);</span><br><span class="line">        candyMachine.state.insertCoin();</span><br><span class="line">        candyMachine.state.turnCrank();</span><br><span class="line">        <span class="comment">// 不投錢，直接轉動</span></span><br><span class="line">        System.out.println(<span class="string">"====不投錢，直接轉動===="</span>);</span><br><span class="line">        candyMachine.state.turnCrank();</span><br><span class="line">        <span class="comment">// 投錢，但糖果機目前沒糖果了</span></span><br><span class="line">        System.out.println(<span class="string">"=====投錢，但糖果機可能目前沒糖果了===="</span>);</span><br><span class="line">        candyMachine.state.insertCoin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">====先投錢，在轉動====</span><br><span class="line">投入錢幣</span><br><span class="line">轉動手把中</span><br><span class="line">開始吐糖果</span><br><span class="line">恭喜中獎，糖果機吐了二顆糖果</span><br><span class="line">====不投錢，直接轉動====</span><br><span class="line">目前沒有糖果，請勿投幣</span><br><span class="line">=====投錢，但糖果機目前沒糖果了====</span><br><span class="line">目前沒有糖果，請勿投幣！</span><br></pre></td></tr></table></figure><p>用這張圖可以更了解糖果機是如何與狀態們做互動</p><p><img src="https://i.imgur.com/MjhyGVD.png" alt=""></p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>我們可以看到套用狀態模式後，若未來要新增狀態時，直接實作<code>State</code>抽象類別，並且只會需要更動到跟新增狀態類別的相關連狀態，使得我們程式更好維護</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;透過統一的”狀態類別”，來定義物件的內部狀態是如何&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Composite Pattern 合成模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/08/06/Design-Pattern-Java-Composite-Pattern-%E5%90%88%E6%88%90%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/08/06/Design-Pattern-Java-Composite-Pattern-合成模式/</id>
    <published>2020-08-06T13:34:16.000Z</published>
    <updated>2021-01-28T12:17:21.724Z</updated>
    
    <content type="html"><![CDATA[<p>將有階層關係的類別狀態給扁平化，給使用者看到的是一致性的關係</p><a id="more"></a><h2 id="若沒有合成模式會怎樣？"><a href="#若沒有合成模式會怎樣？" class="headerlink" title="若沒有合成模式會怎樣？"></a>若沒有合成模式會怎樣？</h2><p>假如現在我們來到一間自助吧，有一個菜單類別，但這個菜單類別裡面還會有甜點這個子菜單</p><p>大概長下面這樣</p><p><img src="https://i.imgur.com/iLWjwr3.png" alt=""></p><p>於是我們大概會這樣實作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuffetMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    DessertMenu dessertMenu;</span><br><span class="line"></span><br><span class="line">    BuffetMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"自助餐菜單"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.dessertMenu = <span class="keyword">new</span> DessertMenu();</span><br><span class="line">        <span class="comment">// 初始化項目</span></span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"牛肉麵"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"海鮮飯"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"牛排"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"開始介紹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">        showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    ChocolateMenu chocolateMenu;</span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"甜點菜單"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"雞蛋餅乾"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"巧克力"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"棉花糖"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"開始介紹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">        showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到DessertMenu類別包含在BuffetMenu類別了</p><p>我們現在有位服務生提供介紹菜單內容，定義如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    BuffetMenu buffetMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(BuffetMenu buffetMenu) &#123;</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu = buffetMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 介紹菜單</span></span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.showMenuItem();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然後我們請服務生開始介紹菜單</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BuffetMenu buffetMenu = <span class="keyword">new</span> BuffetMenu();</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(buffetMenu);</span><br><span class="line"></span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">開始介紹自助餐菜單</span><br><span class="line">自助餐菜單:牛肉麵</span><br><span class="line">自助餐菜單:海鮮飯</span><br><span class="line">自助餐菜單:牛排</span><br><span class="line">開始介紹甜點菜單</span><br><span class="line">甜點菜單:雞蛋餅乾</span><br><span class="line">甜點菜單:棉花糖</span><br><span class="line">甜點菜單:巧克力</span><br></pre></td></tr></table></figure><p>但假如現在變成這樣呢：甜點內的巧克力又有不同類型的巧克力，那我們又要再修改上面的程式碼，將Chocolate類別加入到Dessert類別內</p><p><img src="https://i.imgur.com/otznRfN.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    ChocolateMenu chocolateMenu; <span class="comment">// 多了巧克力菜單</span></span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.chocolateMenu = <span class="keyword">new</span> ChocolateMenu();</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"甜點菜單"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"雞蛋餅乾"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"棉花糖"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"開始介紹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多了巧克力菜單</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChocolateMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line"></span><br><span class="line">    ChocolateMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"巧克力菜單"</span>;</span><br><span class="line">        items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"白巧克力"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"黑巧克力"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"酒釀巧克力"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"開始介紹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時要修改服務生的腦袋，使其知道巧克力菜單的內容。。。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    BuffetMenu buffetMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(BuffetMenu buffetMenu) &#123;</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu = buffetMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 介紹菜單</span></span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.chocolateMenu.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但這時候就會發現，每次若新增一個子菜單時，呼叫者就需要直接對其操作，才能夠印出該子菜單的項目列表</p><p>一但子菜單內又有子菜單，那整個程式碼的維護的代價就會非常的高</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以看到子菜單內若又有子菜單，要印出該名稱的話，那這行程式碼會越來越長。。。</span><br><span class="line"></span><br><span class="line">this.buffetMenu.dessertMenu.chocolateMenu.print();</span><br></pre></td></tr></table></figure><h3 id="維護修改的代價"><a href="#維護修改的代價" class="headerlink" title="維護修改的代價"></a>維護修改的代價</h3><p>舉個例子，我們想要叫服務生說明，哪些菜/甜點是素食的，這時會改code改到想哭</p><h2 id="解決服務生不用笨拙地存取菜單與其子菜單們：合成模式登場"><a href="#解決服務生不用笨拙地存取菜單與其子菜單們：合成模式登場" class="headerlink" title="解決服務生不用笨拙地存取菜單與其子菜單們：合成模式登場"></a>解決服務生不用笨拙地存取菜單與其子菜單們：合成模式登場</h2><p>合成模式主要幫我們建立一個類別關係，建立起父類別與子類別的階層關係，並讓客戶端以一致的方式存取樹狀結構內的各個類別</p><p>先講結論，以上的菜單們，套用合成模式後，服務生不用透過以下方式存取子菜單並介紹出來了，而是直接可以用一致的方式將所有菜單與子菜單都呼叫出來<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void introduceMenu() &#123;</span><br><span class="line">       // 介紹菜單 &lt;-- 可以不用一一在呼叫菜單與子菜單和子菜單的子菜單。。。</span><br><span class="line">       public void introduceMenu() &#123;</span><br><span class="line">       // 介紹菜單</span><br><span class="line">       this.buffetMenu.print();</span><br><span class="line">       this.buffetMenu.showMenuItem();</span><br><span class="line">       this.buffetMenu.dessertMenu.print();</span><br><span class="line">       this.buffetMenu.dessertMenu.showMenuItem();</span><br><span class="line">       this.buffetMenu.dessertMenu.chocolateMenu.print();</span><br><span class="line">       this.buffetMenu.dessertMenu.chocolateMenu.showMenuItem();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>這時我們先來看 合成模式 的類別關係圖</p><p><img src="https://i.imgur.com/a4ZZBAI.png" alt=""></p><ul><li>Component類別：定義了其所有底下葉節點與合成類別的結構<ul><li>所有的Leaf節點與Composite節點都會繼承(實作)該Component類別</li><li>Component是老大哥，老大哥會的下面的也會學到</li></ul></li><li>Leaf類別：會實作Component類別，但由於Leaf節點沒有子類別，所以只會有operation()的方法供呼叫</li><li>Composite類別：合成類別，將以下兩點做合成<ul><li>所要執行的功能<code>operation()</code></li><li>管理子類別的方法 <code>add()</code> <code>remove()</code> <code>getChild()</code></li></ul></li></ul><p>對應Composite類別關係圖到我們上述所畫的菜單關係圖，就會長得如下：</p><p><img src="https://i.imgur.com/g5tB4GT.png" alt=""></p><p>把上面所提到的這張圖作轉換</p><p><img src="https://i.imgur.com/otznRfN.png" alt=""></p><p>就會變成這樣子 (省略Chocolate類別的菜單項目)</p><p><img src="https://i.imgur.com/Rez9N4I.png" alt=""></p><h3 id="定義MenuComponent抽象類別"><a href="#定義MenuComponent抽象類別" class="headerlink" title="定義MenuComponent抽象類別"></a>定義MenuComponent抽象類別</h3><p>定義MenuComponent, 提供菜單基本的方法</p><p>這邊主要不是定義成Interface, 而是抽象類別的主要原因是因為，我們會給 子菜單去繼承菜單所具有的方法</p><p>但又因會給菜單項目(MenuItem)繼承(如 牛肉麵, 海鮮飯, 牛排)，<br>但菜單項目不需要像是 <code>add()</code>, <code>remove()</code>等方法，所以會在該方法內先拋出 <code>UnsupportedOperationException()</code></p><h4 id="Menu-java"><a href="#Menu-java" class="headerlink" title="Menu.java"></a>Menu.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到我們定義了以下方法，並等待真正的菜單類別來實作其細節</p><ul><li>add(): 可新增 實作MenuComponent的物件</li><li>remove(): 移除 實作MenuComponent的物件</li><li>getChild(): 取得Menu內的菜單項目/子菜單</li><li>getName(): 取得菜單名稱</li><li>getPrice: 取得菜單項目價格</li><li>isVegetarian(): 確認是否為素食</li><li>print(): 印出自己的所有菜單項目/子菜單內容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">還記得最上面的若要請服務生確認菜色是否是素食，但要到處修改的慘痛的經驗嗎？</span><br><span class="line"></span><br><span class="line">這時候若在共通的介面，定義好一個isVegetarian(), 請菜色自行提供是否是素食，是的話回傳true, 不是就回傳false, 如此一來服務生就可以在呼叫print()時，可以直接判斷這道項目是否是素食囉</span><br><span class="line"></span><br><span class="line">關於print()的實現細節後面會介紹</span><br></pre></td></tr></table></figure><h3 id="開始實作菜單元件：定義自助式菜單"><a href="#開始實作菜單元件：定義自助式菜單" class="headerlink" title="開始實作菜單元件：定義自助式菜單"></a>開始實作菜單元件：定義自助式菜單</h3><p>接著開始實作自助餐的完整菜單吧！</p><p>BuffetMenu.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuffetMenu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宣告要放置菜單項目與子菜單的ArrayList</span></span><br><span class="line">    ArrayList&lt;MenuComponent&gt; menuItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// 菜單名稱</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    BuffetMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"自助式菜單"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.add(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.remove(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menuItems.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"自助式菜單提供了主菜們(牛肉麵, 海鮮飯, 牛排), 以及甜點菜單, 請盡情享用！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不用實作getPrice 因為菜單沒有價格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不用實作isVegetarian 因為菜單沒有價格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是菜單的話, print使用iterator, 將ArrayList型態的menus中的menuComponent一一取出來, 並呼叫</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line"></span><br><span class="line">        Iterator iterator = menuItems.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// 取出來的可能是菜單項目, 也可能是子菜單</span></span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            menuComponent.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到在BuffetMenu中，已經除了 <code>getPrice()</code>和<code>isVegetarian()</code>這兩項菜單不用去實作，其他都有定義邏輯</p><p>這邊要注意的是 <code>print()</code> 我們使用 iterator, 將菜單內的<code>MenuComponent</code>一一取出來，並且在呼叫其<code>print()</code>, 依序對自助式菜單內的菜單項目做介紹這樣</p><h3 id="定義菜單項目"><a href="#定義菜單項目" class="headerlink" title="定義菜單項目"></a>定義菜單項目</h3><p>接著我們定義一個牛肉麵類別 <code>BeefNoodles</code>, 實作 <code>MenuComponent</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeefNoodles</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 菜單名稱</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"好吃的牛肉麵, 道地的四川口味～～"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">120</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">// 牛肉麵不是素食</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不是菜單, 所以只要呼叫名稱與描述就好</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getPrice());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由於牛肉麵是菜單的項目，所以只要實作跟他自己有關的方法就好，在<code>print()</code>也只要就印出自己名稱是什麼，以及描述, 價格。</p><h3 id="實作子菜單-甜點菜單"><a href="#實作子菜單-甜點菜單" class="headerlink" title="實作子菜單: 甜點菜單"></a>實作子菜單: 甜點菜單</h3><p>跟剛剛實作自助餐的細節非常類似</p><p>DessertMenu.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宣告要放置菜單項目與子菜單的ArrayList</span></span><br><span class="line">    ArrayList&lt;MenuComponent&gt; menuItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// 菜單名稱</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"甜點菜單"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.add(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.remove(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menuItems.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"甜點菜單提供了一星米其林主廚所製作的甜點們！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不用實作getPrice 因為菜單沒有價格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不用實作isVegetarian 因為菜單沒有價格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是菜單的話, print使用iterator, 將ArrayList型態的menus中的menuComponent一一取出來, 並呼叫</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line"></span><br><span class="line">        Iterator iterator = menuItems.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// 取出來的可能是菜單項目, 也可能是子菜單</span></span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            menuComponent.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>最後也是一樣，將甜點項目都實作一輪，不過這邊都很類似就不敘述了</p><h3 id="重新定義服務生"><a href="#重新定義服務生" class="headerlink" title="重新定義服務生"></a>重新定義服務生</h3><p>可以看到服務生很快樂, 只要呼叫MenuComponent的<code>print()</code>, 就把所有菜單都介紹出來囉</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    MenuComponent menuComponent;</span><br><span class="line"></span><br><span class="line">    Waitress(MenuComponent menuComponent) &#123;</span><br><span class="line">        <span class="keyword">this</span>.menuComponent = menuComponent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 這時只要呼叫print(), 就可以把全部菜單的項目與名稱都介紹出來了！</span></span><br><span class="line">        <span class="keyword">this</span>.menuComponent.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="客戶開始進來，請服務生介紹"><a href="#客戶開始進來，請服務生介紹" class="headerlink" title="客戶開始進來，請服務生介紹"></a>客戶開始進來，請服務生介紹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MenuComponent buffetMenu = <span class="keyword">new</span> BuffetMenu();</span><br><span class="line">        MenuComponent beefNoodles = <span class="keyword">new</span> BeefNoodles();</span><br><span class="line">        MenuComponent seaRice = <span class="keyword">new</span> SeaRice();</span><br><span class="line">        MenuComponent steak = <span class="keyword">new</span> Steak();</span><br><span class="line">        buffetMenu.add(beefNoodles);</span><br><span class="line">        buffetMenu.add(seaRice);</span><br><span class="line">        buffetMenu.add(steak);</span><br><span class="line">        <span class="comment">// 定義子菜單</span></span><br><span class="line">        MenuComponent dessertMenu = <span class="keyword">new</span> DessertMenu();</span><br><span class="line">        MenuComponent eggCookie = <span class="keyword">new</span> EggCookie();</span><br><span class="line">        MenuComponent cottonCandy = <span class="keyword">new</span> CottonCandy();</span><br><span class="line">        dessertMenu.add(eggCookie);</span><br><span class="line">        dessertMenu.add(cottonCandy);</span><br><span class="line">        <span class="comment">// 將子菜單加入自助式菜單</span></span><br><span class="line">        buffetMenu.add(dessertMenu);</span><br><span class="line"></span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(buffetMenu);</span><br><span class="line">        <span class="comment">// 請服務生開始介紹！</span></span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">自助式菜單</span><br><span class="line">自助式菜單提供了主菜們(牛肉麵, 海鮮飯, 牛排), 以及甜點菜單, 請盡情享用！</span><br><span class="line">牛肉麵</span><br><span class="line">好吃的牛肉麵, 道地的四川口味～～</span><br><span class="line">120.0</span><br><span class="line">海鮮飯</span><br><span class="line">好吃的海鮮飯～～</span><br><span class="line">200.0</span><br><span class="line">牛排</span><br><span class="line">好吃的牛排～～</span><br><span class="line">400.0</span><br><span class="line">甜點菜單</span><br><span class="line">甜點菜單提供了一星米其林主廚所製作的甜點們！</span><br><span class="line">雞蛋餅乾</span><br><span class="line">雞蛋口味的餅單, 大人小孩都愛～～</span><br><span class="line">60.0</span><br><span class="line">棉花糖</span><br><span class="line">棉花糖好滋味～～</span><br><span class="line">30.0</span><br></pre></td></tr></table></figure><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>透過合成模式, 將取得菜單與子菜單的動作給一致化了</p><p>服務生只要呼叫實作MenuComponent的菜單與子菜單們, 就可以一口氣將所有菜單與子菜單的項目們全都介紹出來！</p><p>未來若要擴充子菜單的項目，也不用擔心需要再修改服務生的類別，只要新的菜單有實作MenuComponent就好</p><p>達到 “對修改關閉, 對擴充開放”的原則！</p><h2 id="將每個菜單的Iterator給合併起來-IteratorComposite"><a href="#將每個菜單的Iterator給合併起來-IteratorComposite" class="headerlink" title="將每個菜單的Iterator給合併起來: IteratorComposite"></a>將每個菜單的Iterator給合併起來: IteratorComposite</h2><p>還記得剛剛有提到如何判斷該菜單是否是素食的情況呢？？</p><p>(待續)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;將有階層關係的類別狀態給扁平化，給使用者看到的是一致性的關係&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Iterator Pattern 反覆器模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/08/03/Design-Pattern-Java-Iterator-Pattern-%E5%8F%8D%E8%A6%86%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/08/03/Design-Pattern-Java-Iterator-Pattern-反覆器模式/</id>
    <published>2020-08-03T15:50:41.000Z</published>
    <updated>2021-02-07T14:33:41.544Z</updated>
    
    <content type="html"><![CDATA[<p>將處理陣列或是取值方式的邏輯給封裝起來，不需讓使用者直接處理操作取值的邏輯</p><a id="more"></a><h2 id="沒有Iterator-Pattern的情況"><a href="#沒有Iterator-Pattern的情況" class="headerlink" title="沒有Iterator Pattern的情況"></a>沒有Iterator Pattern的情況</h2><p>假設現在有2種菜單, 分別叫做中式料理菜單 與 西式料理菜單</p><p>中式料理菜單是用ArrayList的方式儲存菜單項目</p><p>美式料理菜單是用Array[]儲存</p><p>中式料理菜單<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenu</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line"></span><br><span class="line">    ChineseMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"麻婆豆腐"</span>);</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"豬血糕"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>美式料理菜單<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanMenu</span> </span>&#123;</span><br><span class="line">    String[] menu;</span><br><span class="line"></span><br><span class="line">    AmericanMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">0</span>] = <span class="string">"漢堡"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">1</span>] = <span class="string">"薯條"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">2</span>] = <span class="string">"炸雞"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getMenu() &#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>接著定義一個類別：服務生，但服務生需要知道要怎麼撈內容, ArrayList與Array的撈法就會不一樣，要寫兩個for loop…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    ChineseMenu chineseMenu;</span><br><span class="line">    AmericanMenu americaMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(</span><br><span class="line">        ChineseMenu chMenu,</span><br><span class="line">        AmericanMenu amerMenu</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenu = chMenu;</span><br><span class="line">        <span class="keyword">this</span>.americaMenu = amerMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 這時候服務生需要針對各個menu做菜色介紹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======介紹中式料理========"</span>);</span><br><span class="line">        <span class="keyword">for</span>(String dish: chineseMenu.getMenu()) &#123;</span><br><span class="line">            System.out.println(dish);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"=======介紹美式式料理========"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;americaMenu.getMenu().length; i++) &#123;</span><br><span class="line">            System.out.println(americaMenu.menu[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著呼叫服務生，介紹菜單</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ChineseMenu chineseMenu = <span class="keyword">new</span> ChineseMenu();</span><br><span class="line">        AmericanMenu americanMenu = <span class="keyword">new</span> AmericanMenu();</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(chineseMenu, americanMenu);</span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=======介紹中式料理========</span><br><span class="line">麻婆豆腐</span><br><span class="line">豬血糕</span><br><span class="line">=======介紹美式式料理========</span><br><span class="line">漢堡</span><br><span class="line">薯條</span><br><span class="line">炸雞</span><br></pre></td></tr></table></figure><h3 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h3><p>可以看到服務生必須要了解如何從菜單取出來，變成每一次若又有新的菜單，那每次服務生又得曉得新菜單的取得方式是怎樣，如此一來就得一直增加for loop, 有N個菜單就有N個for loop, 不大好維護。</p><h2 id="Iterator模式登場"><a href="#Iterator模式登場" class="headerlink" title="Iterator模式登場"></a>Iterator模式登場</h2><p>該模式主要目的：『讓服務生不需知道其取出細節是如何，只要透過一個標準的介面(Iterator)，就可以直接呼叫菜單內容』</p><h3 id="定義-Iterator-介面"><a href="#定義-Iterator-介面" class="headerlink" title="定義 Iterator 介面"></a>定義 Iterator 介面</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">Boolean <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="改良一下Menu-將各個Menu實作同一個介面"><a href="#改良一下Menu-將各個Menu實作同一個介面" class="headerlink" title="改良一下Menu 將各個Menu實作同一個介面"></a>改良一下Menu 將各個Menu實作同一個介面</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Menu</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">getMenu</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenu</span> <span class="keyword">implements</span> <span class="title">Menu</span>&lt;<span class="title">ArrayList</span>&lt;<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line"></span><br><span class="line">    ChineseMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"麻婆豆腐"</span>);</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"豬血糕"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class AmericanMenu implements Menu&lt;String[]&gt; &#123;</span><br><span class="line">    String[] menu;</span><br><span class="line"></span><br><span class="line">    AmericanMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">0</span>] = <span class="string">"漢堡"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">1</span>] = <span class="string">"薯條"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">2</span>] = <span class="string">"炸雞"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getMenu() &#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時改用實作兩個Iterator類別 <code>ChineseMenuIterator</code>與<code>AmericanMenuIterator</code>，負責定義如何取出菜單內容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line">    <span class="keyword">int</span> count = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChineseMenuIterator</span><span class="params">(Menu&lt;ArrayList&lt;String&gt;&gt; menu)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = menu.getMenu();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ChineseMenu是使用ArrayList定義菜單列表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count + <span class="number">1</span> &gt;= menu.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menu.get(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    String[] menu;</span><br><span class="line">    <span class="keyword">int</span> count = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AmericanMenuIterator</span><span class="params">(Menu&lt;String[]&gt; menu)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = menu.getMenu();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count + <span class="number">1</span> &gt;= menu.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menu[count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時回到服務生，若要介紹菜單內容的話，只要使用上面定義的 <code>ChineseMenuIterator</code>與<code>AmericanMenuIterator</code>, 就可以直接取出菜單項目內容了，服務生不需要在曉得要怎麼處理撈取的細節，看到一堆for loop了</p><p>Waitress class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    ChineseMenu chineseMenu;</span><br><span class="line">    AmericanMenu americaMenu;</span><br><span class="line"></span><br><span class="line">    ChineseMenuIterator chineseMenuIterator;</span><br><span class="line">    AmericanMenuIterator americanMenuIterator;</span><br><span class="line">    Waitress(</span><br><span class="line">        ChineseMenu chMenu,</span><br><span class="line">        AmericanMenu amerMenu,</span><br><span class="line">        ChineseMenuIterator chineseMenuIterator,</span><br><span class="line">        AmericanMenuIterator americanMenuIterator</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenu = chMenu;</span><br><span class="line">        <span class="keyword">this</span>.americaMenu = amerMenu;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenuIterator = chineseMenuIterator;</span><br><span class="line">        <span class="keyword">this</span>.americanMenuIterator = americanMenuIterator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 這時候服務生只要透過iterator, 就可以直接用一個for loop全部取出來</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======介紹中式料理========"</span>);</span><br><span class="line">        <span class="keyword">while</span>(chineseMenuIterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(chineseMenuIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"=======介紹美式料理========"</span>);</span><br><span class="line">        <span class="keyword">while</span>(americanMenuIterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(americanMenuIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>再度呼叫服務生介紹菜單</p><p>Main class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ChineseMenu chineseMenu = <span class="keyword">new</span> ChineseMenu();</span><br><span class="line">        ChineseMenuIterator chineseMenuIterator = <span class="keyword">new</span> ChineseMenuIterator(chineseMenu);</span><br><span class="line">        AmericanMenu americanMenu = <span class="keyword">new</span> AmericanMenu();</span><br><span class="line">        AmericanMenuIterator americanMenuIterator = <span class="keyword">new</span> AmericanMenuIterator(americanMenu);</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(</span><br><span class="line">                chineseMenu,</span><br><span class="line">                americanMenu,</span><br><span class="line">                chineseMenuIterator,</span><br><span class="line">                americanMenuIterator);</span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>透過Iterator介面定義如何實作抽取資料結構的內容，讓使用者可以不用費心去了解要怎麼取得，直接呼叫已經有實作Iterator介面的class</p><h2 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h2><p>Collection 類別中其實就已經定義了Iterator介面，不過為了介紹反覆器模式，故在ArrayList中簡單實作了Iterator介面內容</p><p><img src="https://i.imgur.com/KGnuRr5.png" alt=""></p><p>Reference: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;將處理陣列或是取值方式的邏輯給封裝起來，不需讓使用者直接處理操作取值的邏輯&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Template Pattern 樣板模式  [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Template-Pattern-%E6%A8%A3%E6%9D%BF%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Template-Pattern-樣板模式/</id>
    <published>2020-07-29T15:33:47.000Z</published>
    <updated>2021-01-28T12:17:59.406Z</updated>
    
    <content type="html"><![CDATA[<p>樣板, 顧名思義就是把同樣的邏輯定義成一個樣板, 可讓其他類別共同使用</p><p>樣板也會開放可客製化的方法 (抽象方法), 供其他類別實作</p><a id="more"></a><p>樣板主要核心</p><ol><li>將共同演算法邏輯包裝好</li><li>定義非共同的方法為抽像方法, 請使用樣板方法的類別自行實作</li></ol><h2 id="透過泡茶與泡咖啡來瞭解樣板模式吧"><a href="#透過泡茶與泡咖啡來瞭解樣板模式吧" class="headerlink" title="透過泡茶與泡咖啡來瞭解樣板模式吧"></a>透過泡茶與泡咖啡來瞭解樣板模式吧</h2><p>這時候若直接寫code, 會分別定義出 <code>Tea</code> 與 <code>Coffee</code> class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> </span>&#123;</span><br><span class="line">    Tea() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======開始準備茶的動作======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        steepTeaBag();</span><br><span class="line">        addLenmon();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======結束======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"燒開水"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">steepTeaBag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"泡開茶包"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addLenmon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"加入檸檬"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"倒入杯中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    Coffee() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======開始準備咖啡的動作======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        greedCoffeeGrinds();</span><br><span class="line">        addCreamer();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======結束======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"燒開水"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">greedCoffeeGrinds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"磨咖啡豆"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCreamer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"加奶精"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"倒入杯中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用以上定義的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tea tea = <span class="keyword">new</span> Tea();</span><br><span class="line">        tea.prepare();</span><br><span class="line"></span><br><span class="line">        Coffee coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line">        coffee.prepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/1PXbn6b.png" alt=""></p><h2 id="套用Template-Pattern吧"><a href="#套用Template-Pattern吧" class="headerlink" title="套用Template Pattern吧"></a>套用Template Pattern吧</h2><p>仔細比較泡茶和泡咖啡, 都會有著以下類似的動作</p><ol><li>煮沸開水</li><li>將(茶的茶包/咖啡藥磨成粉)泡開  &lt;– 這個動作一樣, 但茶是用茶包, 咖啡是需要先磨成粉</li><li>添加有的沒的 (咖啡會用奶精/茶會放檸檬) &lt;– 這邊的也是一樣</li><li>倒進杯中</li></ol><p>剛好茶與咖啡都是含有咖啡因的飲料，這時就可以定義一個樣板叫做 <code>CaffeineBeverage</code>, 並把上述 2,3步驟,定義成抽象方法, 讓茶與咖啡類別自己去實作自己的邏輯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line">    String name = <span class="string">"咖啡因飲料"</span>;</span><br><span class="line">    CaffeineBeverage(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======開始準備 "</span> + <span class="keyword">this</span>.name + <span class="string">" 的動作======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======結束======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"燒開水"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定義如何泡的抽象方法, 讓茶與咖啡自行定義</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 定義要添加其他配料, 讓茶與咖啡自行定義</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"倒進杯中"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著<code>Tea</code>與<code>Coffee</code>實現該樣板類別 <code>CaffeineBeverage</code><br>並根據自己的邏輯實作abstract方法 <code>brew()</code>與<code>addCondiments()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line">    Tea(String name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======開始準備茶的動作======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======結束======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"泡開茶包"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"加入檸檬"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span></span>&#123;</span><br><span class="line">    Coffee(String name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======開始準備咖啡的動作======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======結束======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"磨咖啡豆"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"加奶精"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著一樣使用之</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CaffeineBeverage tea = <span class="keyword">new</span> Tea(<span class="string">"茶"</span>);</span><br><span class="line">        tea.prepare();</span><br><span class="line"></span><br><span class="line">        CaffeineBeverage coffee = <span class="keyword">new</span> Coffee(<span class="string">"咖啡"</span>);</span><br><span class="line">        coffee.prepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/lT9g7lA.png" alt=""></p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>透過以上方法可以看到 樣板模式 將重複的地方給統整起來成為演算法邏輯, 並定義一個抽象類別, 將需要客製化的部分定義成抽象方法, 統一的部分就直接定義實體方法</p><p>如此一來各個類別在實作時，就不用在自己去做重複一樣的動作(例如燒開水, 倒入杯中) 只要直接繼承樣板抽象類別就有囉, 然後在自己實作自己需要的部分 (如茶有自己的茶包泡法, 咖啡則有自己的咖啡豆要磨 才能泡)</p><p>以實現樣板模式的精神</p><h2 id="透過hook方法將封裝的演算法邏輯部分做控制使用"><a href="#透過hook方法將封裝的演算法邏輯部分做控制使用" class="headerlink" title="透過hook方法將封裝的演算法邏輯部分做控制使用"></a>透過hook方法將封裝的演算法邏輯部分做控制使用</h2><p>待補充</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;樣板, 顧名思義就是把同樣的邏輯定義成一個樣板, 可讓其他類別共同使用&lt;/p&gt;
&lt;p&gt;樣板也會開放可客製化的方法 (抽象方法), 供其他類別實作&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Facade Pattern 表象模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Facade-Pattern-%E8%A1%A8%E8%B1%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Facade-Pattern-表象模式/</id>
    <published>2020-07-29T12:20:24.000Z</published>
    <updated>2021-01-28T12:17:26.218Z</updated>
    
    <content type="html"><![CDATA[<p>將複雜的類別關係, 用一個類別包裝起來, 供呼叫</p><p>不會讓使用者直接看到背後複雜的邏輯, 只會看到 “表面的現象”, 故叫做表象模式</p><a id="more"></a><h2 id="以一個家庭劇院來解說"><a href="#以一個家庭劇院來解說" class="headerlink" title="以一個家庭劇院來解說"></a>以一個家庭劇院來解說</h2><p>如果坐在客廳, 想要營造一個家庭劇院</p><p>我們得做以下事情：</p><ol><li>打開燈, 調整亮度</li><li>打開電視, 切換到DVD模式</li><li>打開音響, 調整大小聲</li><li>打開DVD, 讀取要看的片</li></ol><p>等等之類的, 以下定義這些服務的class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightService</span> </span>&#123;</span><br><span class="line">    LightService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lightOn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TVService</span> </span>&#123;</span><br><span class="line">    TVService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openTV</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the TV"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoundService</span> </span>&#123;</span><br><span class="line">    SoundService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openSound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the Sound"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DVDPlayerService</span> </span>&#123;</span><br><span class="line">    DVDPlayerService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openDVD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the DVD"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然後直覺上會呼叫之</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LightService lightService = <span class="keyword">new</span> LightService();</span><br><span class="line">        TVService tvService = <span class="keyword">new</span> TVService();</span><br><span class="line">        SoundService soundService = <span class="keyword">new</span> SoundService();</span><br><span class="line">        DVDPlayerService dvdPlayerService = <span class="keyword">new</span> DVDPlayerService();</span><br><span class="line"></span><br><span class="line">        lightService.lightOn();</span><br><span class="line">        tvService.openTV();</span><br><span class="line">        soundService.openSound();</span><br><span class="line">        dvdPlayerService.openDVD();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其結果為：</p><p><img src="https://i.imgur.com/4zTs3XQ.png" alt=""></p><h2 id="表象模式登場"><a href="#表象模式登場" class="headerlink" title="表象模式登場"></a>表象模式登場</h2><p>不過對於使用者來說, 其實就只想要享受家庭劇院的娛樂, 所以其實我們可以用包裝的方式, 將上面main裡面相關服務的class都包在一個class內, 叫做<code>MovieTheaterFacadeService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieTheaterFacadeService</span> </span>&#123;</span><br><span class="line">    MovieTheaterFacadeService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startMovieTheaterService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LightService lightService = <span class="keyword">new</span> LightService();</span><br><span class="line">        TVService tvService = <span class="keyword">new</span> TVService();</span><br><span class="line">        SoundService soundService = <span class="keyword">new</span> SoundService();</span><br><span class="line">        DVDPlayerService dvdPlayerService = <span class="keyword">new</span> DVDPlayerService();</span><br><span class="line"></span><br><span class="line">        lightService.lightOn();</span><br><span class="line">        tvService.openTV();</span><br><span class="line">        soundService.openSound();</span><br><span class="line">        dvdPlayerService.openDVD();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此一來, 我們的使用者(main()), 只要呼叫 <code>MovieTheaterFacadeService</code> 就可以直接享受家庭劇院, 不用親自去處理過程中的事</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       MovieTheaterFacadeService movieTheaterFacadeService = <span class="keyword">new</span> MovieTheaterFacadeService();</span><br><span class="line"></span><br><span class="line">       movieTheaterFacadeService.startMovieTheaterService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>透過以上的例子, 可以看到表象模式最大的用處就是將複雜的服務類別們給包裝在一起, 並開放單一個類別供使用者使用, 讓使用者僅需要看到表面即可, 不用理解細節是什麼。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;將複雜的類別關係, 用一個類別包裝起來, 供呼叫&lt;/p&gt;
&lt;p&gt;不會讓使用者直接看到背後複雜的邏輯, 只會看到 “表面的現象”, 故叫做表象模式&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Adaptor Pattern 轉接器模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Adaptor-Pattern-%E8%BD%89%E6%8E%A5%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Adaptor-Pattern-轉接器模式/</id>
    <published>2020-07-29T00:15:30.000Z</published>
    <updated>2021-01-28T12:17:17.461Z</updated>
    
    <content type="html"><![CDATA[<p>假如要使用A, 但無法直接使用, 只能使用B介面</p><p>所以我們用轉接器類別包裝A的方法，並且實作B，達到轉接的效果</p><a id="more"></a><h2 id="用螢幕轉接器的例子直接解釋"><a href="#用螢幕轉接器的例子直接解釋" class="headerlink" title="用螢幕轉接器的例子直接解釋"></a>用螢幕轉接器的例子直接解釋</h2><p>例如我們有個 HDMI的線, 叫做 HDMI interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">HDMI</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定義連接裝置的方法格式</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但現在有個螢幕只有支援VGA的插孔</p><p>所以我們需要個 HDMI轉VGA的Adaptor類別, 把VGA的類別引入進來, 並使用之</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HdmiToVgaAdpator</span> <span class="keyword">implements</span> <span class="title">HDMI</span> </span>&#123;</span><br><span class="line">    VGA vgaCable = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    HdmiToVgaAdpator(VGA vgaCable) &#123;</span><br><span class="line">        <span class="keyword">this</span>.vgaCable = vgaCable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 必須要實作HDMI的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 介接Vga線的connect功能</span></span><br><span class="line">        System.out.println(<span class="string">"使用轉接器的connect功能!"</span>);</span><br><span class="line">        vgaCable.connect(device);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因為有使用到VGA類別, 所以來定義一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">VGA</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定義連接裝置的方法格式</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VGACable</span> <span class="keyword">implements</span> <span class="title">VGA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"VGA線連接: "</span> + device);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>來定義有台筆電, 是只有具備hdmi孔, 但具備著可以連接到某裝置進行投影</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Labtop</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 該台筆電只有hdmi孔, 並指定要連接的螢幕(device)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectToDevice</span><span class="params">(HDMI hdmi, String device)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"筆電只有hdmi孔, 使用實作hdmi介面的 'hdmi轉vga的轉接器' 類別！"</span>);</span><br><span class="line">        hdmi.connect(device);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著來使用吧</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Labtop laptop = <span class="keyword">new</span> Labtop();</span><br><span class="line">        <span class="comment">// 如果某筆電只有hdmi插孔, 但要接的投影螢幕只有vga</span></span><br><span class="line">        laptop.connectToDevice(</span><br><span class="line">                <span class="keyword">new</span> HdmiToVgaAdpator( <span class="comment">// 這時可以使用Hdmi轉Vga的轉接器！ 轉接器需要帶入實際具有VGA功能的VGA線物件</span></span><br><span class="line">                        <span class="keyword">new</span> VGACable()),</span><br><span class="line">                <span class="string">"老舊投影機"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我們可以看到結果為:</p><p><img src="https://i.imgur.com/pwtgvua.png" alt=""></p><ol><li>筆電使用了 實作hdmi介面的轉接器 (轉接器因為實作了hdmi interface, 所以可以插入筆電的hdmi孔)</li><li>接著轉接器引入了VGA cable類別, 故轉接器就可以使用VGA的connect()功能</li><li>最後就觸發VGA功能, 與投影裝置連動</li></ol><h2 id="實際應用場景"><a href="#實際應用場景" class="headerlink" title="實際應用場景"></a>實際應用場景</h2><p>通常轉接器模式可用在轉接那些已經過時的模組&amp;方法</p><p>例如有模組是用Java較舊迭代Collection的版本去寫的, 為Enumeration Interface</p><p>但現在新的專案中，是使用Iterator方式去迭代Collection</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLoopService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用Java 5版本之後支援的Iterator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopCollection</span><span class="params">(Collection col, Iterator itr)</span> </span>&#123;</span><br><span class="line">        itr = col.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(itr.hasNext()) &#123;</span><br><span class="line">            System.out.println(itr.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用NewLoopService<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">main</span>() </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"apple"</span>);</span><br><span class="line">        list.add(<span class="string">"banana"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 宣告Iterator的變數</span></span><br><span class="line">        Iterator itr;</span><br><span class="line">        </span><br><span class="line">        NewLoopService loopService = <span class="keyword">new</span> NewLoopService();</span><br><span class="line">        loopService.loopCollection(list, itr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>但現在若只能用舊版的 <code>Enumeration</code> 方式去迭代</p><p>這時就可以寫一個 <code>EnumeratorAdaptor</code> 來實作可兼容<code>Iterator</code>的類別, 並可呼叫 <code>Enumeration</code>的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 實作Iterator的方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnumeratorAdaptor</span>&lt;<span class="title">E</span>&gt; <span class="title">implement</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    Enumeration&lt;E&gt; enumeration;</span><br><span class="line">    </span><br><span class="line">    EnumeratorAdaptor(Enumeration&lt;E&gt; enumeration) &#123;</span><br><span class="line">        <span class="keyword">this</span>.enumeration = enumeration;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 實作Iterator 介面所需的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 但實際上是使用Enumeration的方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.enumeration.hasMoreElements();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.enumeration.nextElement();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 但這時候會遇到Enumeration沒有的方法, 但又必須要實作 滿足Iterator的介面規範, 這時可以throw Exception來處理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這時我們可以在<code>main()</code>中改用轉接器, 來間接使用Enumeration了！</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">main</span>() </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"apple"</span>);</span><br><span class="line">        list.add(<span class="string">"banana"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 `實作Iterator介面` 的轉接器</span></span><br><span class="line">        EnumeratorAdaptor itr;</span><br><span class="line">        </span><br><span class="line">        NewLoopService loopService = <span class="keyword">new</span> NewLoopService();</span><br><span class="line">        loopService.loopCollection(list, itr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLoopService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用Java 5版本之後支援的Iterator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopCollection</span><span class="params">(Collection col, Iterator itr)</span> </span>&#123;</span><br><span class="line">        itr = col.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 這時會是使用EnumeratorAdaptor內的hasNext()與next() 達到轉接的效果</span></span><br><span class="line">        <span class="keyword">while</span>(itr.hasNext()) &#123;</span><br><span class="line">            System.out.println(itr.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>透過以上方法, 可以把要使用Enumeration方式的service, 但該Service又是只能吃Iterator的輸入, 那就可以實作一個 <code>EnumeratorAdaptor</code>, 帶入Service, 並透過轉接器使用 Enumeration的方式去撈出Collection內容.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;假如要使用A, 但無法直接使用, 只能使用B介面&lt;/p&gt;
&lt;p&gt;所以我們用轉接器類別包裝A的方法，並且實作B，達到轉接的效果&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Observer Pattern 觀察者模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Observer-Pattern-%E8%A7%80%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Observer-Pattern-觀察者模式/</id>
    <published>2020-07-26T08:59:48.000Z</published>
    <updated>2021-01-28T12:17:41.422Z</updated>
    
    <content type="html"><![CDATA[<p>觀察者模式可以讓物件了解資料變化的情況。<br>物件甚至可以在執行期間決定是否要繼續被通知，又或者是可以主動去詢問資料的狀態。<br>在此模式中也會了解一對多，以及物件鬆綁的意義是如何。</p><a id="more"></a><h3 id="以氣象監測系統的概況來當做例子"><a href="#以氣象監測系統的概況來當做例子" class="headerlink" title="以氣象監測系統的概況來當做例子"></a>以氣象監測系統的概況來當做例子</h3><p>假設系統中有三個組成要件：<br>(1) 氣象站: 獲取實際氣象的物理裝置，假設有三個:溫度,濕度,壓力感應<br>(2) Weather Data物件: 追蹤來自氣象站的資料，並且顯示在佈告版上<br>(3) 佈告版: 將Weather Data物件給予的資料呈現出來</p><p>整個例子會有，一個氣象站(產出假的氣象資料)，Weather Data物件(獲取氣象資料並通知佈告版)，佈告版將拿到的資料給呈現出來</p><h3 id="沒使用觀察者模式-Observer-Pattern的情況"><a href="#沒使用觀察者模式-Observer-Pattern的情況" class="headerlink" title="沒使用觀察者模式 Observer Pattern的情況"></a>沒使用觀察者模式 Observer Pattern的情況</h3><p>初學者會很直覺的寫出這樣的程式架構：</p><h4 id="佈告欄"><a href="#佈告欄" class="headerlink" title="佈告欄"></a>佈告欄</h4><p>CurrentConditionsDisplay.class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentConditionsDisplay</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pressure;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.temp = temp;</span><br><span class="line">       <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">       <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 顯示資料</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(temp);</span><br><span class="line">        System.out.println(humidity);</span><br><span class="line">        System.out.println(pressure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="WeatherData-class"><a href="#WeatherData-class" class="headerlink" title="WeatherData.class"></a>WeatherData.class</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherData</span> </span>&#123;</span><br><span class="line">    <span class="comment">// instance variable declarations</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 宣告佈告欄</span></span><br><span class="line">    CurrentConditionsDisplay currentConditionsDisplay;</span><br><span class="line">    StatisticsDisplay statisticsDisplay;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// 建構子</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CurrentConditionsDisplay currentConditionsDisplay,</span></span></span><br><span class="line"><span class="function"><span class="params">        StatisticsDisplay statisticsDisplay</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentConditionsDisplay = currentConditionsDisplay;</span><br><span class="line">        <span class="keyword">this</span>.statisticsDisplay = statisticsDisplay;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTemperature</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHumidity</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPressure</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measurementsChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> temp = getTemperature();</span><br><span class="line">        <span class="keyword">float</span> humidity = getHumidity();</span><br><span class="line">        <span class="keyword">float</span> pressure = getPressure();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 對佈告欄類別進行更新他們的顯示內容</span></span><br><span class="line">        currentConditionsDisplay.update(temp, humidity, pressure);</span><br><span class="line">        statisticsDisplay.update(temp, humidity, pressure);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 其他WeatherData function...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是以上程式結構會有耦合性的狀況：</p><p><img src="https://i.imgur.com/gpIs58H.png" alt=""></p><p>所以接下來來了解觀察者模式的內涵</p><h4 id="觀察者模式解析"><a href="#觀察者模式解析" class="headerlink" title="觀察者模式解析"></a>觀察者模式解析</h4><p>定義了物件之間一對多關係，如此一來，當一個物件改變狀態時，其他相依者都會收到通知並自動做改變</p><p>其示意圖如下：</p><p><img src="https://i.imgur.com/d1zWR3x.png" alt=""></p><p>主題與觀察者們定義了一對多的關係</p><p>若要實踐出可以隔離主題和觀察者們的方式，以 <code>Subject</code>介面和<code>Observer</code>介面最為常見</p><p><img src="https://i.imgur.com/C155cCF.png" alt=""></p><p>在這張圖要注意一個重點是，由於現在已經針對介面實作，現在的Subject中的註冊Observer都是以註冊”<span style="color:red">介面</span>“為主！而非是像上面一開始的新手例子是直接針對實踐而寫</p><p>如此一來如果要在新增一個佈告欄叫做ForecastDisplay，直接實踐Observer就好，這樣就不用動到實踐Subject介面的WeatherData之程式碼</p><p><img src="https://i.imgur.com/GJTGp80.png" alt=""></p><h4 id="以觀察者模式來重寫氣象監測系統"><a href="#以觀察者模式來重寫氣象監測系統" class="headerlink" title="以觀察者模式來重寫氣象監測系統"></a>以觀察者模式來重寫氣象監測系統</h4><p>Subject.interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ObserverInterface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">float</span> temperature, <span class="keyword">float</span> humidity, <span class="keyword">float</span> pressure)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WeatherData.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherData</span> <span class="keyword">implements</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList observers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        observers = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = observers.indexOf(o);</span><br><span class="line">        observers.add(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = observers.indexOf(o);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">            observers.remove(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向觀察者們送以改動的資料</span></span><br><span class="line">    <span class="comment">// 可以看到現在我們是直接註冊Observer介面，如此一來觀察者類別的實作就不用去在意</span></span><br><span class="line">    <span class="comment">// 只要知道要註冊的對象必須要有實作Observer介面就好</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;observers.size(); i++) &#123;</span><br><span class="line">            Observer observer = (Observer)observers.get(i);</span><br><span class="line">            observer.update(temperature, humidity, pressure);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 執行向觀察者們通知資料</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measurementsChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 讀取假資料，可以改動這地方，改為向氣象局網站爬資料</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMeasurements</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> temperature,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> humidity,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> pressure)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">        <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">        <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">        measurementsChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這裡我們只實踐一個佈告欄 CurrentConditionDisplay</p><p>CurrentConditionDisplay.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentConditionDisplay</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> pressure;</span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CurrentConditionDisplay</span><span class="params">(Subject weatherData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weatherData = weatherData;</span><br><span class="line">        weatherData.registerObserver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">float</span> temperature, <span class="keyword">float</span> humidity, <span class="keyword">float</span> pressure)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">        <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">        <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Current condition: "</span>+temperature + <span class="string">"F degrees and "</span> + humidity + <span class="string">"% humidity and "</span>+ pressure + <span class="string">" pressure"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>執行程式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        WeatherData weatherData = <span class="keyword">new</span> WeatherData();</span><br><span class="line"></span><br><span class="line">        CurrentConditionDisplay currentDisplay = <span class="keyword">new</span> CurrentConditionDisplay(weatherData);</span><br><span class="line"></span><br><span class="line">        weatherData.setMeasurements(<span class="number">80</span>, <span class="number">64</span>, <span class="number">30.4f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到以下結果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Current condition: 80.0F degrees and 64.0% humidity and 30.4 pressure</span><br></pre></td></tr></table></figure><p>之後只要透過主題呼叫觀察者的update()的方法，就可以通知新的資料給觀察者</p><p>並且透過註冊的方式+只加入針對實踐Observer介面的觀察者，如此一來可以達到分離主題物件與觀察者物件的邏輯，之後新增新的佈告欄就不用動到主題的程式邏輯。</p><h3 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h3><h4 id="java-sdk也有自行提供Observer方法"><a href="#java-sdk也有自行提供Observer方法" class="headerlink" title="java sdk也有自行提供Observer方法"></a>java sdk也有自行提供Observer方法</h4><p>其中會有<code>setChange()</code>的方法，主要讓呼叫者定義什麼時候才要通知新的資料給觀察者，避免每次資料一改變就一直通知觀察者。Ex: 如果沒有setChanged的方法，WeahterData物件就會持續不斷的通知觀察者，所以若我們希望溫度差距半度才更新，溫度差距插到半度以上，主題才會呼叫觀察者的update()的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">setChanged() &#123;</span><br><span class="line">    changed = ture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObservers(Object arg) &#123;</span><br><span class="line">    if(changed) &#123;</span><br><span class="line">        for every observer on the list &#123;</span><br><span class="line">            call update(this. org)</span><br><span class="line">        &#125;</span><br><span class="line">        changed = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObsergers() &#123;</span><br><span class="line">    notifyObservers(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;觀察者模式可以讓物件了解資料變化的情況。&lt;br&gt;物件甚至可以在執行期間決定是否要繼續被通知，又或者是可以主動去詢問資料的狀態。&lt;br&gt;在此模式中也會了解一對多，以及物件鬆綁的意義是如何。&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Strategy Pattern 策略模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Strategy-Pattern-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Strategy-Pattern-策略模式/</id>
    <published>2020-07-26T08:58:12.000Z</published>
    <updated>2021-01-28T12:17:55.339Z</updated>
    
    <content type="html"><![CDATA[<p>可以在執行期動態更換物件的行為</p><p>『策略模式』定義了演算法家族，將他們個別封裝起來，可以讓他們之間互相替換，此模式不會影響到使用此演算法的程式。</p><a id="more"></a><h2 id="沒有思考使用設計模式的時候-模擬鴨子版本"><a href="#沒有思考使用設計模式的時候-模擬鴨子版本" class="headerlink" title="沒有思考使用設計模式的時候:模擬鴨子版本"></a>沒有思考使用設計模式的時候:模擬鴨子版本</h2><p>假設我們要開發模擬鴨子遊戲，會有各種不同的鴨子，這時候會們通常都會先設計出一個class叫做 Duck，然後Duck會包含鴨子的共同行為：發出叫聲 quack(), 游泳 swin(), 以及展現外觀 display()，然後有綠頭鴨 MallardDuck class和 紅頭鴨 RedheadDuck class分別繼承 Duck類別</p><p>(做UML)</p><p>若現在需要讓每隻鴨子都會飛，我們會很直覺的在 Duck class中加入 fly()</p><p>但若現在有個橡皮鴨子，會不小心繼承到Duck class的fly(), 但橡皮鴨不會飛！</p><h3 id="用繼承的可以改善作法"><a href="#用繼承的可以改善作法" class="headerlink" title="用繼承的可以改善作法"></a>用繼承的可以改善作法</h3><p>直接在橡皮鴨 class中的fly() 不定義任何事情</p><p>(做UML)</p><h4 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h4><p>若又遇到誘餌鴨，就會面臨fly()沒定義任何事情，quack()也沒定義任何事情<br>因為若有很多新型態的鴨子，會導致每一個不同的鴨子都得檢視該鴨子是否可飛或可叫</p><p>(做UML)</p><h3 id="改用介面做改善"><a href="#改用介面做改善" class="headerlink" title="改用介面做改善"></a>改用介面做改善</h3><p>將fly與quack從Duck抽離出來變成 Flyable與Quackable介面，讓有需要飛或叫的鴨子實作之</p><h4 id="問題-1"><a href="#問題-1" class="headerlink" title="問題"></a>問題</h4><p>重複的程式碼會變超多，因為同樣會飛或叫的鴨子都各自實作了Flyable與Quackable介面的程式碼，該程式碼邏輯都是相同的。</p><h3 id="設計守則-一"><a href="#設計守則-一" class="headerlink" title="設計守則(一)"></a>設計守則(一)</h3><ul><li><p>找出程式中需要更動之處，並將之獨立出來，不要和那些不需要更動的程式碼混在一起</p></li><li><p>把會變動的部分取出來並將之封裝起來，以便以後可以輕易地擴充此部分，而不影響不需要更動的部分。</p></li></ul><blockquote><p>將鴨子的行為從Duck類別取出來！</p></blockquote><h3 id="抽離會變動的部分成為獨立類別"><a href="#抽離會變動的部分成為獨立類別" class="headerlink" title="抽離會變動的部分成為獨立類別"></a>抽離會變動的部分成為獨立類別</h3><p>將飛行行為 fly,與呱呱叫行為 quack獨立成class</p><p>並且在Duck類別設置 “可以設定行為的方法”，可以在“執行期”動態地改變鴨子的飛行或呱呱叫行為</p><h3 id="設計守則-二"><a href="#設計守則-二" class="headerlink" title="設計守則(二)"></a>設計守則(二)</h3><p>寫程式是針對介面而寫，而不是針對實踐</p><h3 id="用介面代表每個行為-FlyBehavior-QuackBehavior"><a href="#用介面代表每個行為-FlyBehavior-QuackBehavior" class="headerlink" title="用介面代表每個行為: FlyBehavior, QuackBehavior"></a>用介面代表每個行為: FlyBehavior, QuackBehavior</h3><p>用各個鴨子的行為類別去實踐FlyBehavior和QuackBehavior介面<br>而不是由Duck類別實踐該介面</p><p>:::info<br>寫程式是針對介面去寫：其真正意思是『寫程式是針對超型態(supertype)而寫』</p><p>使用超型態的話可以不用理會以後執行時的真正物件型態：為“多型”的實踐</p><p>ex:</p><p>Animal interface { makeSound() }<br>Dog implment Animal { makeSound() { bark() }}<br>Cat implement Animal { makeSound() { meow() }}</p><p>Animal animal = new Dog();<br>animal.makeSound();</p><p>有個好處是，可以不用直接在一開始僵化某個變數的宣告型態 ex: Dog x = new dog(); // 僵化了x變數為dog型態</p><p>而是可以在執行期，也就是使用的時候指定該物件型態</p><p>ex:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 定義getAnimal為回傳Dog();</span><br><span class="line">x = getAnimal(); // 得到 Dog型態</span><br><span class="line">x.makeSound(); // 發出狗叫聲</span><br><span class="line"></span><br><span class="line">// 將getAnimal() 中改成傳回Cat();</span><br><span class="line">x = getAnimal(); // 得到 Cat型態</span><br><span class="line">x.makeSound(); // 發出貓叫聲</span><br></pre></td></tr></table></figure><p>:::</p><h2 id="實踐鴨子的行為"><a href="#實踐鴨子的行為" class="headerlink" title="實踐鴨子的行為"></a>實踐鴨子的行為</h2><ul><li><p>FlyBehavior介面，用FlyWithWings(實踐所有有翅膀的鴨子會飛的行為)與FlyNoWay(實踐所有不會飛的鴨子的動作)這兩個類別來實作</p></li><li><p>QuackBehavior介面，用Quack(真的呱呱叫)、Squeak(橡皮吱吱叫)與MuteQuack(叫不出聲音)這三個類別來實作</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以上設計將飛行與呱呱叫的行為可以被其他物件再三利用，將鴨子的行為抽離出來</span><br></pre></td></tr></table></figure><h3 id="問題與思考"><a href="#問題與思考" class="headerlink" title="問題與思考"></a>問題與思考</h3><ol><li>是否該先把系統做出來，在看看哪些地方需要更動，再回頭將需更動的邏輯獨立出來？<ul><li>答：不儘然，設計系統中可以預先考慮到未來哪些地方可能需要變動</li></ul></li><li>鴨子是不是也可以設計成一個介面？<ul><li>答: 不恰當，因為已經將會變動的邏輯(fly與quack)抽離出dock class, 那dock class就可以直接為每隻鴨子都會有同樣邏輯的類別，讓不同類型的鴨子直接繼承使用</li></ul></li></ol><h2 id="整合鴨子的行為"><a href="#整合鴨子的行為" class="headerlink" title="整合鴨子的行為"></a>整合鴨子的行為</h2><p>將飛行與呱呱叫的動作，委託其他人處理 (在Dock類別中宣告 FlyBehavior與QuackBehavior，透過Behavior介面取得 有實作該Behavior介面的行為們 ex: FlyBehavior介面會有FlyWithNoWings類別實作)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Duck &#123;</span><br><span class="line">    FlyBehavior flyBehavior;</span><br><span class="line">    QuackBehavior quackBehavior;</span><br><span class="line">    </span><br><span class="line">    public void performQuack() &#123;</span><br><span class="line">        quackBehavior.quack();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void performFly() &#123;</span><br><span class="line">        flyBehavior.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>現在由綠頭鴨(MallarDuck)來使用Duck的quackBehavior所擁有的有實踐自己的子類別 Quack()<br>用flyBehavior的FlyWithNoWings</p><p>且MallarDuck繼承了Duck類別，所以可以使用quackBehavior和flyBehavior取用自己對應的動作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class MallardDuck extends Duck &#123;</span><br><span class="line">    // constructor</span><br><span class="line">    pubilc MallardDuck() &#123;</span><br><span class="line">        quackBehavior = new Quack();</span><br><span class="line">        flyBehavior = new FlyWithNoWings();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    quackBehavior.performQuack(); </span><br><span class="line">    flyBehavior.performFly();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="完整測試的code：實作一個MiniDuck"><a href="#完整測試的code：實作一個MiniDuck" class="headerlink" title="完整測試的code：實作一個MiniDuck"></a>完整測試的code：實作一個MiniDuck</h2><h3 id="Duck-class"><a href="#Duck-class" class="headerlink" title="Duck class"></a>Duck class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    FlyBehavior flyBehavior;</span><br><span class="line">    QuackBehavior quackBehavior;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Duck</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performFly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flyBehavior.fly();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performQuack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quackBehavior.quack();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"All ducks float, even decoys!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="FlyBehavior-and-QuackBehavior介面與實踐之的動作"><a href="#FlyBehavior-and-QuackBehavior介面與實踐之的動作" class="headerlink" title="FlyBehavior and QuackBehavior介面與實踐之的動作"></a>FlyBehavior and QuackBehavior介面與實踐之的動作</h3><p>FlyBehavior.inrface<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>各種實踐Fly的類別</p><p>FlyWithWings.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyWithWings</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am flying"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>FlyNoWay.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyNoWay</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I cannot fly"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>QuackBehavior.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>各種實踐Quack的類別</p><p>Quack.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Quack</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Quack"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>MuteQuack.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MuteQuack</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"&lt;&lt;Silence&gt;&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Squeak.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Squeak</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Squeak"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="實踐綠頭鴨的類別：MallardDuck-java"><a href="#實踐綠頭鴨的類別：MallardDuck-java" class="headerlink" title="實踐綠頭鴨的類別：MallardDuck.java"></a>實踐綠頭鴨的類別：MallardDuck.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallardDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    <span class="comment">// constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MallardDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quackBehavior = <span class="keyword">new</span> Quack();</span><br><span class="line">        flyBehavior = <span class="keyword">new</span> FlyWithWings();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am a real Mallard duck"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="測試用類別：MiniDuckSimulator-java"><a href="#測試用類別：MiniDuckSimulator-java" class="headerlink" title="測試用類別：MiniDuckSimulator.java"></a>測試用類別：MiniDuckSimulator.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiniDuckSimulator</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       Duck mallard = <span class="keyword">new</span> MallardDuck();</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 會呼叫 MallardDuck繼承來的performQuack()</span></span><br><span class="line">       <span class="comment">// 進而委託 quackBehavior處理quack行為，而非在自己class內處理</span></span><br><span class="line">       mallard.performQuack();</span><br><span class="line">       mallard.performFly();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="動態設定行為"><a href="#動態設定行為" class="headerlink" title="動態設定行為"></a>動態設定行為</h2><p>在鴨子類別中可以加入設置flyBehavior和quackBehavior的方法</p><p>可以隨時呼叫以下方法改變鴨子的行為<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlyBehavior</span><span class="params">(FlyBehavior fb)</span> </span>&#123;</span><br><span class="line">       flyBehavior = fb;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuackBehavior</span><span class="params">(QuackBehavior qb)</span> </span>&#123;</span><br><span class="line">       quackBehavior = qb;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>例如有個 “模型鴨“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ModelDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flyBehavior = <span class="keyword">new</span> FlyNoWay();</span><br><span class="line">        quackBehavior = <span class="keyword">new</span> Quack();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Model duck"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建立一個新的FlyBehavior型態，具有火箭噴射的功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyRocketPowered</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am flying a rocket"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改變測試類別，加上模型鴨子，使模型鴨具有火箭動力！</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiniDuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Duck mallard = <span class="keyword">new</span> MallardDuck();</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 具有噴射動力的模型鴨子</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Duck modelDuck = <span class="keyword">new</span> ModelDuck();</span><br><span class="line">        modelDuck.performFly(); <span class="comment">// 不會飛</span></span><br><span class="line">        <span class="comment">// 動態地更換飛行的行為</span></span><br><span class="line">        modelDuck.setFlyBehavior(<span class="keyword">new</span> FlyRocketPowered());</span><br><span class="line">        modelDuck.performFly(); <span class="comment">// 噴射！</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上的行為為將兩個類別(FlyBehavior與QuackBehavior)組合起來使用，為”Composition 合成”的精神，與繼承不一樣的是，鴨子Duck的行為不是繼承而來，而是透過適當的行為物件『合成』而來！</p><h3 id="設計守則"><a href="#設計守則" class="headerlink" title="設計守則"></a>設計守則</h3><p>多用合成，少用繼承</p><p>合成可以將演算法封裝成類別，更可以『在執行動態地改變行為』，只要合成的行為物件，符合特定的介面標準即可</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;可以在執行期動態更換物件的行為&lt;/p&gt;
&lt;p&gt;『策略模式』定義了演算法家族，將他們個別封裝起來，可以讓他們之間互相替換，此模式不會影響到使用此演算法的程式。&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Factory Pattern 工廠模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Factory-Pattern-%E5%B7%A5%E5%BB%A0%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Factory-Pattern-工廠模式/</id>
    <published>2020-07-26T08:57:20.000Z</published>
    <updated>2021-01-28T12:17:31.169Z</updated>
    
    <content type="html"><![CDATA[<p>工廠模式提供了可創建(new)各種不同類別(class)的實例(instance)</p><p>工廠模式主要又涵蓋了 (1) 簡單工廠模式 Simple Factory Pattern (2) 工廠方法模式 (3) 抽象方法模式</p><p>簡單工廠方法是最初階的用法，會違反OOP的Open-close principle(OCP)<br>然而工廠方法和抽象方法則比較能讓模組間耦合度降低。</p><p>以下會依序做介紹</p><a id="more"></a><h2 id="簡單工廠模式-Simple-Factory-Method"><a href="#簡單工廠模式-Simple-Factory-Method" class="headerlink" title="簡單工廠模式 Simple Factory Method"></a>簡單工廠模式 Simple Factory Method</h2><p>簡單工廠模式僅提供一個工廠類別，接收參數(決定生產哪種產品)，來產生出對應的產品物件(Object)</p><p>以生產Pizza為例，假設我們有個披薩簡單工廠(SimplePizzaFactory)可以生產兩種不同口味的Pizza(Cheese和Potato):</p><p>SimplePizzaFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工廠會回傳抽象的Pizza類別</p><p>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  String ingridient;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing"</span> + name);</span><br><span class="line">    System.out.println(<span class="string">"Ingredient"</span> + ingridient);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Bake for 20 mins"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>以及實作了兩個口味的披薩 CheesePizza和PotatoPizza</p><p>CheesePizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name = <span class="string">"CheesePizza"</span>;</span><br><span class="line">  String ingridient = <span class="string">"Cheese"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>PotatoPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PotatoPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name = <span class="string">"PotatoPizza"</span>;</span><br><span class="line">  String ingridient = <span class="string">"Potato"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>Pizza都定義完畢後，定義SimplePizzaFactory.java</p><p>SimplePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在Main.java透過SimplePizzaFactory製作兩個Pizza:</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SimplePizzaFactory simplePizzaFactory = <span class="keyword">new</span> SimplePizzaFactory();</span><br><span class="line">    </span><br><span class="line">    simplePizzaFactory.orderPizza(<span class="string">"cheese"</span>);</span><br><span class="line">    simplePizzaFactory.orderPizza(<span class="string">"potato"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>執行Main.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Preparing: CheesePizza</span><br><span class="line">Ingredient: Cheese</span><br><span class="line">Bake for 20 mins</span><br><span class="line">Preparing: PotatoPizza</span><br><span class="line">Ingredient: Potato</span><br><span class="line">Bake for 20 mins</span><br></pre></td></tr></table></figure><p>但此若之後要擴充Pizza的種類，例如要多一個叫做OnionPizza，勢必得修改SimplePizzaFacotory.java</p><p>SimplePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"onion"</span>)) &#123; <span class="comment">// 新增洋蔥口味pizza  </span></span><br><span class="line">      pizza = <span class="keyword">new</span> OnionPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::danger<br>上述做法破壞了OOD的OCP(Open-Close Principle)的原則，亦即進行擴充時不修改到SimplePizzaFactory的程式碼。<br>:::</p><h2 id="工廠方法模式"><a href="#工廠方法模式" class="headerlink" title="工廠方法模式"></a>工廠方法模式</h2><p>為了改善簡單工廠模式，工廠方法模式透過”抽象方法”的模式，讓之後擴充的工廠實作該”抽象方法”，以進行其他類別的擴充</p><p>舉例：有個PizzaFactory負責定義了Pizza工廠該做的一件事(抽象方法)<br>叫做 createPizza();</p><p>PizzaFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>原本我們已經有兩種口味(Cheese和Potato) Pizza，叫做原味披薩(OriginalPizzaFactory), 使OringinalPizzaFactory去實作PizzaFactory的createPizza()方法</p><p>OringinalPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OriginalPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>若要新增洋蔥口味的Pizza的話，那就直接在定義一個額外的工廠叫做，特別披薩工廠 (SpecialPizzaFactory)進行擴充，如此一來就不用更動到到原本原味披薩工廠(OriginalPizzaFactory)的程式碼</p><p>SpecialPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecialPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"onion"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> OnionPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>記得多新增一個洋蔥披薩的類別 </p><p>OnionPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnionPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">OnionPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"OnionPizza"</span>;</span><br><span class="line">    ingridient = <span class="string">"Onion"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在Main.java中呼叫原味和特別口味的披薩</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    PizzaFactory originalPizzaFactory = <span class="keyword">new</span> OriginalPizzaFactory();</span><br><span class="line">    </span><br><span class="line">    originalPizzaFactory.orderPizza(<span class="string">"cheese"</span>);</span><br><span class="line">    originalPizzaFactory.orderPizza(<span class="string">"potato"</span>);</span><br><span class="line"></span><br><span class="line">    PizzaFactory specialPizzaFactory = <span class="keyword">new</span> SpecialPizzaFactory();</span><br><span class="line">    specialPizzaFactory.orderPizza(<span class="string">"onion"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>透過下面的圖可以看到，透過定義一個抽象方法的工廠，若要擴充產品(在這裡我們用的是Pizza)類別的話，透過實作該抽象方法工廠，來進行擴充。</p><p><img src="https://i.imgur.com/cmWuZ3v.png" alt=""></p><p>由於我們亦把Pizza類別給獨立出來成為一個抽象類別，若要新增其他口味的Pizza也可以達到不違反OCP精神的擴充，如下圖所示：</p><p><img src="https://i.imgur.com/Wp4QRfE.png" alt=""></p><h2 id="抽象工廠"><a href="#抽象工廠" class="headerlink" title="抽象工廠"></a>抽象工廠</h2><p>抽象工廠顧名思義就是定義一個抽象介面工廠，欲擴充的話就實作該抽象介面工廠</p><p>以披薩原料工廠(PizzaIngredientFactory)為例，有醬料和蔬菜兩種原料：<br>方面給之後我們要製作的中式和美式披薩的原料實作，做擴展：</p><p>PizzaIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h3 id="抽象工廠-原料工廠-在透過工廠方法來製作原料產品"><a href="#抽象工廠-原料工廠-在透過工廠方法來製作原料產品" class="headerlink" title="抽象工廠(原料工廠)在透過工廠方法來製作原料產品"></a>抽象工廠(原料工廠)在透過工廠方法來製作原料產品</h3><p>我們再分別產生美式版本(AmericaIngredientFactory)和中式版本(ChinesePizzaFactory)的披薩原料工廠，可以看到使用了createSauce和createVegetable，透過工廠方法來產生原料產品</p><p>AmericaIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaIngredientFactory</span> <span class="keyword">implements</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TomatoSauce();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Potato();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ChineseIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChineseIngredientFactory</span> <span class="keyword">implements</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SoySauce();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Onion();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>接著定義剛剛原料工廠有使用到的原料類別們(Sauce: SoySauce與PotatoSauce; Vegetable: Onion和Potato，該原料亦在實作Pizza類別的具體類別亦會用到</p><p>:::info<br>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 在Pizza類別中已經有宣告會用到的原料有哪些，是以介面來實作，方便做擴展</span></span><br><span class="line">  Sauce sauce;</span><br><span class="line">  Vegetable vegetable;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::</p><p>定義醬料Sauce原料們：</p><p>Sauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getSauce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>SoySauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoySauce</span> <span class="keyword">extends</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoySauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"soy sauce"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"The sauce is :"</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TomatoSauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomatoSauce</span> <span class="keyword">extends</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TomatoSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"tomato sauce"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The sauce is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>接下來換定義Vegetable原料們</p><p>Vegetable.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getVegetable</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Onion.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Onion</span> <span class="keyword">extends</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Onion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"onion"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The vegetable is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Potato.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Potato</span> <span class="keyword">extends</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Potato</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"potato"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The vegetable is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>將披薩修改成包含上述原料 (Sauce和Vegetable)</p><p>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  </span><br><span class="line">  Sauce sauce;</span><br><span class="line">  Vegetable vegetable;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 將prepare修改成抽象，該方法需要收集Pizza所需的原料，原料來自於原料工廠！</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Bake for 30 mins"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>定義兩個style的Pizza: 中式披薩(Chinese Pizza)和美式披薩(America Pizza)，在這兩隻類別可以看到我們傳入了原料工廠，以決定哪種風格的披薩就用對應風格的原料工廠</p><p>ChinesePizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  PizzaIngredientFactory ingredientFactory;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ChinesePizza</span><span class="params">(PizzaIngredientFactory ingredientFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing: "</span> + name);</span><br><span class="line"></span><br><span class="line">    sauce = ingredientFactory.createSauce();</span><br><span class="line">    sauce.getSauce();</span><br><span class="line"></span><br><span class="line">    vegetable = ingredientFactory.createVegetable();</span><br><span class="line">    vegetable.getVegetable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>AmericaPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  PizzaIngredientFactory ingredientFactory;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AmericaPizza</span><span class="params">(PizzaIngredientFactory ingredientFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing: "</span> + name);</span><br><span class="line"></span><br><span class="line">    sauce = ingredientFactory.createSauce();</span><br><span class="line">    sauce.getSauce();</span><br><span class="line"></span><br><span class="line">    vegetable = ingredientFactory.createVegetable();</span><br><span class="line">    vegetable.getVegetable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>接著再利用工廠方法，定義中式和美式的披薩工廠，製作出中式和美式的披薩</p><p>PizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>AmericaPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Pizza <span class="title">createPizza</span><span class="params">(String style)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用了美式原料工廠</span></span><br><span class="line">    PizzaIngredientFactory ingredientFactory = <span class="keyword">new</span> AmericaIngredientFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(style.equals(<span class="string">"America"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> AmericaPizza(ingredientFactory);</span><br><span class="line">      pizza.setName(<span class="string">"America style pizza"</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::info<br>可以在對美式工廠新增其他種不同口味的Pizza，用不同的原料工廠來達成<br>:::</p><p>ChinesePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinesePizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Pizza <span class="title">createPizza</span><span class="params">(String style)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用了中式原料工廠</span></span><br><span class="line">    PizzaIngredientFactory ingredientFactory = <span class="keyword">new</span> ChineseIngredientFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(style.equals(<span class="string">"Chinese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> ChinesePizza(ingredientFactory);</span><br><span class="line">      pizza.setName(<span class="string">"Chinese style pizza"</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>最後在Main.java中來製作披薩：</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    PizzaFactory AmericaPizzaFactory = <span class="keyword">new</span> AmericaPizzaFactory();</span><br><span class="line">    </span><br><span class="line">    AmericaPizzaFactory.orderPizza(<span class="string">"America"</span>);</span><br><span class="line"></span><br><span class="line">    PizzaFactory ChinesePizzaFactory = <span class="keyword">new</span> ChinesePizzaFactory();</span><br><span class="line"></span><br><span class="line">    ChinesePizzaFactory.orderPizza(<span class="string">"Chinese"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以看到抽象工廠方法可以幫我們把相關產品集結起來(上述例子為原料們)，可以產生出不同組的原料類別們，另外抽象工廠通常還會再搭配工廠方法，來建立其產品(披薩們，各個披薩會用到各個不同的抽象工廠所建立的原料工廠)，如同該連結所做的-&gt;<a href="#抽象工廠(原料工廠">連結</a>在透過工廠方法來製作原料產品)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;工廠模式提供了可創建(new)各種不同類別(class)的實例(instance)&lt;/p&gt;
&lt;p&gt;工廠模式主要又涵蓋了 (1) 簡單工廠模式 Simple Factory Pattern (2) 工廠方法模式 (3) 抽象方法模式&lt;/p&gt;
&lt;p&gt;簡單工廠方法是最初階的用法，會違反OOP的Open-close principle(OCP)&lt;br&gt;然而工廠方法和抽象方法則比較能讓模組間耦合度降低。&lt;/p&gt;
&lt;p&gt;以下會依序做介紹&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Singleton Pattern 獨體模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Singleton-Pattern-%E7%8D%A8%E9%AB%94%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Singleton-Pattern-獨體模式/</id>
    <published>2020-07-26T08:56:27.000Z</published>
    <updated>2021-01-28T12:24:58.355Z</updated>
    
    <content type="html"><![CDATA[<p>每次引用類別都只會產出相同的物件</p><p>適合用在: 執行緒池(thread pool)，快取區(cache)，對話盒、處理對話設定和登錄的物件，和驅動程式溝通的物件。</p><a id="more"></a><h2 id="作法"><a href="#作法" class="headerlink" title="作法"></a>作法</h2><p>假如有一個類別叫做MyClass，現在要讓MyClass變成獨體模式，讓外面的類別只能透過 MyClass.getInstance() 取得MyClass物件。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 設定成private與static，不能給外面類別存取</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 將建構式設定成 private，這樣就可以避免直接被類別 new出來</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 設置成static，使外面類別可以直接存取MyClass.getInstance方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 若第一次取得MyClass， new 出MyClass();</span></span><br><span class="line">        <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> MyClass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他類別要取用MyClass</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[]) &#123;</span><br><span class="line">    // 1. 第一次取用getInstance</span><br><span class="line">    Myclass instance = MyClass.getInstance();</span><br><span class="line">    // 2. 第二次取用getInstance時，MyClass的uniqueInstance已經有值了，得到與上面instance一樣的object</span><br><span class="line">    Myclass instance1 = MyClass.getInstance();</span><br><span class="line">    </span><br><span class="line">    if(instance == instance1) &#123;</span><br><span class="line">        System.out.println(&quot;instance and instance1 are the same&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多執行緒下獨體模式會遇到的狀況"><a href="#多執行緒下獨體模式會遇到的狀況" class="headerlink" title="多執行緒下獨體模式會遇到的狀況"></a>多執行緒下獨體模式會遇到的狀況</h2><p>假如有兩個thread(thread 1和thread 2)，同時要跟MyClass取得物件，但會面臨thread1和thread2會取得不同的MyClass物件，情況如下：</p><p><img src="https://i.imgur.com/OjAKXpb.png" alt=""></p><h3 id="解法一：只要把getInstance-給同步化-會有效能不佳的狀況，可能造成效率下降100倍"><a href="#解法一：只要把getInstance-給同步化-會有效能不佳的狀況，可能造成效率下降100倍" class="headerlink" title="解法一：只要把getInstance()給同步化 (會有效能不佳的狀況，可能造成效率下降100倍)"></a>解法一：只要把getInstance()給同步化 (會有效能不佳的狀況，可能造成效率下降100倍)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 設定成synchronized，就可以讓執行緒依序進入getInstance內</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> MyClass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但我們只需要第一次進入getInstance才進行同步化就好，不然其他次要取得uniqueInstnace都得變成同步的方式，造成取用Instance的緩慢</p><h3 id="解法二：率先建立實體，不要等到有人呼叫getInstance才new出MyClass實體"><a href="#解法二：率先建立實體，不要等到有人呼叫getInstance才new出MyClass實體" class="headerlink" title="解法二：率先建立實體，不要等到有人呼叫getInstance才new出MyClass實體"></a>解法二：率先建立實體，不要等到有人呼叫getInstance才new出MyClass實體</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 直接初始話MyClass()，並設成private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstnace = <span class="keyword">new</span> MyClass();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此作法依賴JVM載入此類別時，馬上建立此唯一的獨體物件，JVM保證在任何執行緒存取uniqueInstnace靜態變數之前，一定先建立此實體</p><h3 id="解法三：利用-“雙重檢查上鎖”-在getInstance-中減少使用同步化"><a href="#解法三：利用-“雙重檢查上鎖”-在getInstance-中減少使用同步化" class="headerlink" title="解法三：利用 “雙重檢查上鎖” 在getInstance()中減少使用同步化"></a>解法三：利用 “雙重檢查上鎖” 在getInstance()中減少使用同步化</h3><p>利用雙重檢查上鎖，首先檢查是否實體已經建立了，<br>若沒有，“才”進行同步化，如此一來只有第一次進入getInstance才同步化，才是我們所想要的。</p><p><code>`</code>java=<br>public class MyClass {<br>    // volatile為Java 6之後才有的關鍵字，能夠使執行緒們取得相同的uniqueInstance<br>    private volatile static MyClass uniqueInstance;</p><pre><code>private MyClass() {}public static MyClass getInstance() {    // 只有第一次才徹底執行以下程式碼     // 當執行緒遇到被宣告成volatile的uniqueInstnace，會變得謹慎    if(uniqueInstance == null) {        synchronized(MyClass.class) {            // 再檢查一次，若為null則new MyClass();            if(uniqueInstance == null) {                uniqueInstance = new MyClass();            }        }    }    return uniqueInstance;}</code></pre><p>}</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;每次引用類別都只會產出相同的物件&lt;/p&gt;
&lt;p&gt;適合用在: 執行緒池(thread pool)，快取區(cache)，對話盒、處理對話設定和登錄的物件，和驅動程式溝通的物件。&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Command Pattern 命令模式 [Design Pattern in Java]</title>
    <link href="http://a10000005588.github.io/2020/07/26/Design-Pattern-Command-Pattern-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
    <id>http://a10000005588.github.io/2020/07/26/Design-Pattern-Command-Pattern-命令模式/</id>
    <published>2020-07-26T08:52:42.000Z</published>
    <updated>2021-01-28T12:17:01.716Z</updated>
    
    <content type="html"><![CDATA[<p>命令模式主要將執行的命令, 與執行者做鬆綁的動作</p><a id="more"></a><h2 id="沒有命令模式會是怎樣的寫法？？"><a href="#沒有命令模式會是怎樣的寫法？？" class="headerlink" title="沒有命令模式會是怎樣的寫法？？"></a>沒有命令模式會是怎樣的寫法？？</h2><p>假如我們現在要寫一個 遙控器 RemoteControl (執行者), 上面會有很多按鈕功能 (命令)</p><p>每個按鈕可能都對應各個功能, 例如 打開, 關閉某些房間的燈</p><p>於是我們定義了 <code>Light</code> 抽象類別, 有著 <code>on()</code>與<code>off()</code>開關燈的方法, 並且實作了 <code>LivingRoomLight</code>, <code>KitchenLight</code>這兩個房間並繼承 <code>Light</code>抽象類別的方法, 使他們都有開關的功能！</p><p>接著在遙控器 <code>RemoteControl</code>類別內定義了 <code>Light[]</code> 陣列, 儲存欲執行的功能 (實作Light的類別們)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定義出一個遙控器instance</span></span><br><span class="line">        RemoteControl remoteControl =</span><br><span class="line">                <span class="keyword">new</span> RemoteControl(</span><br><span class="line">                <span class="keyword">new</span> Light[]&#123;</span><br><span class="line">                        <span class="keyword">new</span> LivingRoomLight(),</span><br><span class="line">                        <span class="keyword">new</span> KitchenLight()</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// 0: 打開LivingRoom Light</span></span><br><span class="line">        <span class="comment">// 1: 打開Kitchen Light</span></span><br><span class="line">        remoteControl.turnOnLight(<span class="number">0</span>);</span><br><span class="line">        remoteControl.turnOnLight(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 0: 關閉LivingRoom Light</span></span><br><span class="line">        <span class="comment">// 1: 關閉Kitchen Light</span></span><br><span class="line">        remoteControl.turnOffLight(<span class="number">0</span>);</span><br><span class="line">        remoteControl.turnOffLight(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Light[] lights = <span class="keyword">new</span> Light[<span class="number">10</span>];</span><br><span class="line">    RemoteControl(Light[] lights) &#123;</span><br><span class="line">        <span class="comment">// 將傳進來的lights放入到lights內</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.lights[i] = lights[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOnLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].on();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOffLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    Light() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LivingRoomLight</span> <span class="keyword">extends</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    LivingRoomLight() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the living room light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the living room light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KitchenLight</span> <span class="keyword">extends</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    KitchenLight() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the kitchen light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the kitchem light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行結果如下</p><p><img src="https://i.imgur.com/AvxerGU.png" alt=""></p><h3 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h3><p>假如現在又想要添加電視與冷氣開關的功能 <code>TV</code>, <code>AirConditioner</code>, 那不就又要在<code>RemoteControl</code>類別內進行修改</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 又新增了HomeDevice陣列...定義家具集合的類別</span></span><br><span class="line">    HomeDevice[] homeDevices = <span class="keyword">new</span> HomeDevice[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    Light[] lights = <span class="keyword">new</span> Light[<span class="number">10</span>];</span><br><span class="line">    RemoteControl(Light[] lights) &#123;</span><br><span class="line">        <span class="comment">// 將傳進來的lights放入到lights內</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.lights[i] = lights[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOnLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].on();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOffLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].off();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 又在定義HomeDevice的開關功能...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可看到每次若要為遙控器類別新增功能, 都要對<code>RemoteControl</code>進行修改的動作, 如此一來可能會造成其他已經內嵌好的功能可能被改壞的狀況發生, 這時我們可以使用 <code>Command 模式</code> 來避免這種狀況發生</p><h2 id="Command-命令模式的優勢"><a href="#Command-命令模式的優勢" class="headerlink" title="Command 命令模式的優勢"></a>Command 命令模式的優勢</h2><p>命令模式可以幫我們把要賦予<code>RemoteControl</code>的這些功能給封裝起來, 成為一個獨立的個體, 不會跟<code>RemoteControl</code>給耦合再一起 (像上面turnOnLight, turnOffLight等功能)</p><p>我們可以把 <code>Light</code> 的開關功能都視作為 <code>Command (命令)</code>抽象介面, 該介面包含了一個 <code>execute()</code>功能, </p><p>接著由Command (命令)衍伸出 <code>LightOnCommand</code>與<code>LightOffCommand</code>這兩個實作類別, 負責定義<code>Light</code>的開與關的動作</p><p><img src="https://i.imgur.com/t1zF1vQ.jpg" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定義一個命令, 包含的執行execute的動作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 實作燈的開關命令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the light"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the light"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightOnCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    Light light;</span><br><span class="line"></span><br><span class="line">    LightOnCommand() &#123;</span><br><span class="line">        <span class="keyword">this</span>.light = <span class="keyword">new</span> Light();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightOffCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    Light light;</span><br><span class="line"></span><br><span class="line">    LightOffCommand() &#123;</span><br><span class="line">        <span class="keyword">this</span>.light = <span class="keyword">new</span> Light();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    NoCommand() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Not yet defined"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接著我們需要在遙控器類別 <code>RemoteControl</code> 定義可放置Command的動作 <code>setXXXCommand()</code>, 以及呼叫Command的 <code>pressOnButton()</code>與<code>pressOffButton()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定義遙控器類別</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line">    Command[] onCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line">    Command[] offCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化一開始的插槽, 若沒功能就定義一個沒作用的command供呼叫 (可避免用 if (command != null) 這種判斷方式</span></span><br><span class="line">    RemoteControl() &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) &#123;</span><br><span class="line">            onCommands[i] = <span class="keyword">new</span> NoCommand();</span><br><span class="line">            offCommands[i] = <span class="keyword">new</span> NoCommand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnCommand</span><span class="params">(<span class="keyword">int</span> slot, Command onCommand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onCommands[slot] = onCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOffCommand</span><span class="params">(<span class="keyword">int</span> slot, Command offCommand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.offCommands[slot] = offCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pressOnButton</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onCommands[slot].execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pressOffButton</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.offCommands[slot].execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 顯示我們塞了哪些功能到slot內</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuffer stringBuff = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        stringBuff.append(<span class="string">"\n ------- Remote Control-------\n"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; onCommands.length; i++) &#123;</span><br><span class="line">            stringBuff.append(<span class="string">"[slot "</span> + i + <span class="string">"] "</span> + onCommands[i].getClass().getName() + <span class="string">"    "</span> + offCommands[i].getClass().getName() + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuff.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>透過這樣的做法, 我們可以看到原本<code>RemoteControl</code>內的與Light操作有關的動作, 都被我們透過 <code>Command</code> 抽象介面以及其 <code>LightOnCommand</code>與<code>LightOffCommand</code>實作類別給抽離出來了</p><p>於是我們可以來執行看看</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RemoteControl remoteControl = <span class="keyword">new</span> RemoteControl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定義出兩種房間的燈</span></span><br><span class="line">        Light LivingRoomLight = <span class="keyword">new</span> Light(<span class="string">"Living Room"</span>);</span><br><span class="line">        Light KitchenLight = <span class="keyword">new</span> Light(<span class="string">"Kitchen"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 設置Command按鈕</span></span><br><span class="line">        remoteControl.setOnCommand(<span class="number">0</span>, <span class="keyword">new</span> LightOnCommand(LivingRoomLight));</span><br><span class="line">        remoteControl.setOffCommand(<span class="number">0</span>, <span class="keyword">new</span> LightOffCommand(LivingRoomLight));</span><br><span class="line"></span><br><span class="line">        remoteControl.setOnCommand(<span class="number">1</span>, <span class="keyword">new</span> LightOnCommand(KitchenLight));</span><br><span class="line">        remoteControl.setOffCommand(<span class="number">1</span>, <span class="keyword">new</span> LightOffCommand(KitchenLight));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 顯示有哪些功能</span></span><br><span class="line">        System.out.println(remoteControl.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 執行命令</span></span><br><span class="line">        <span class="comment">//// 客廳的</span></span><br><span class="line">        remoteControl.pressOnButton(<span class="number">0</span>);</span><br><span class="line">        remoteControl.pressOffButton(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//// 廚房的</span></span><br><span class="line">        remoteControl.pressOnButton(<span class="number">1</span>);</span><br><span class="line">        remoteControl.pressOffButton(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/q9PTG18.png" alt=""></p><p>若接下來需要新增如浴室開關, 電視開關, 只要透過<code>RemoteConrol</code>的<code>setCommand()</code>方法, 即可以動態做設置, 不需更動到遙控器類別原本的程式碼！ (除非要改變遙控器的slot大小了)</p><h2 id="進階的Command-Pattern技巧"><a href="#進階的Command-Pattern技巧" class="headerlink" title="進階的Command Pattern技巧"></a>進階的Command Pattern技巧</h2><p>等待補充 (為Command介面新增 undo()方法, 使動作復原)</p><h2 id="應用場景"><a href="#應用場景" class="headerlink" title="應用場景"></a>應用場景</h2><p>運用在任務序列中, 多執行緒只要拿到Command物件, 並且執行<code>execute</code>方法負責執行完就好</p><p>或是用在日誌管理, 將執行過的動作給記錄起來, 並且若後續伺服器當機, 可將命令給復原</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;命令模式主要將執行的命令, 與執行者做鬆綁的動作&lt;/p&gt;
    
    </summary>
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/categories/Design-Pattern/"/>
    
    
      <category term="Design Pattern" scheme="http://a10000005588.github.io/tags/Design-Pattern/"/>
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>下班自修的經驗分享</title>
    <link href="http://a10000005588.github.io/2020/05/16/%E4%B8%8B%E7%8F%AD%E8%87%AA%E4%BF%AE%E7%9A%84%E7%B6%93%E9%A9%97%E5%88%86%E4%BA%AB/"/>
    <id>http://a10000005588.github.io/2020/05/16/下班自修的經驗分享/</id>
    <published>2020-05-16T12:47:39.000Z</published>
    <updated>2021-01-28T12:13:44.948Z</updated>
    
    <content type="html"><![CDATA[<p>最近剛好在Backend版上看到有人Po文問說: “下班後要如何精進自修”, 意外看到許多大大們在下面留言, 正好最近我也在思考要如何精進自己, 所以趁這機會來統整一下大大們提出來的想法並且與自己目前的進修方式做結合, 主要會以Full-Stack engineer的精進方式來做個紀錄分享.</p><a id="more"></a><h2 id="如果對某程式語言-amp-框架掌握度還不夠-請先熟悉之！"><a href="#如果對某程式語言-amp-框架掌握度還不夠-請先熟悉之！" class="headerlink" title="如果對某程式語言&amp;框架掌握度還不夠, 請先熟悉之！"></a>如果對某程式語言&amp;框架掌握度還不夠, 請先熟悉之！</h2><p>如果上班接觸到某種自己不熟悉的語言或框架, 像我目前需要寫Java &amp; Spring, 與Angular &amp; Typescript.</p><p>所以我會偏好先到線上程式語言線上平台進修之, 因為這些學習平台能夠提供完整的學習輪廓, 能夠讓我快速掌握該程式語言&amp;框架所需具備的硬知識為何.</p><p>說到線上程式學習平台, 我蠻推薦 <a href="https://app.pluralsight.com/" target="_blank" rel="noopener">Pluralsight</a>, 因為該平台提供了該程式語言或框架推薦學習的影片, 並且透過測驗推估你對該技術的知識程度為何.</p><p><img src="https://i.imgur.com/2vtrkLm.png" alt=""></p><p>有興趣可以到該平台試試看, 不過每個月會收取29美元的花費, 不過這花費當作投資是蠻值得的.</p><h2 id="若已經對程式語言-amp-框架有經驗-可以嘗試看看Side-Project"><a href="#若已經對程式語言-amp-框架有經驗-可以嘗試看看Side-Project" class="headerlink" title="若已經對程式語言&amp;框架有經驗, 可以嘗試看看Side Project"></a>若已經對程式語言&amp;框架有經驗, 可以嘗試看看Side Project</h2><p>為什麼會特地提到Side Project?? 那是因為在公司其實很難自己能夠負責專案的所有全貌, 例如可能只是負責寫API, 也可能只負責前端頁面的刻畫.</p><p>所以透過Side Project, 便能夠有機會嘗試所有技術的機會, 並且從中去體會到自己最想要加強的領域是哪邊, 例如後端效能? 前端渲染速度? Container, CI/CD的運作? 諸如此類, 從而培養一個Full-Stack的經驗.</p><p>所以下班後自己跑一個Side Project是個不錯的精進方式.</p><h3 id="但要怎麼樣想出一個Side-Project"><a href="#但要怎麼樣想出一個Side-Project" class="headerlink" title="但要怎麼樣想出一個Side Project?"></a>但要怎麼樣想出一個Side Project?</h3><p>我覺得學習最快的方式就是模仿, 可以到Github上搜尋有興趣的專案, 並且試著用自己的程式語言與框架自己做出一套是最快的方式.</p><p>像我因為很喜歡用Markdown方式來做筆記, 目前打算自己做個小型的線上筆記編輯系統, 並看到Github上有提供<a href="https://github.com/codimd/server" target="_blank" rel="noopener">CodiMD</a> 的開源專案可參考,<br>來試著自己建造出一個看看. 之後有機會再分享到自己的部落格上怎麼一步一步進行的.</p><h2 id="嘗試撰寫線上筆記或部落格吧"><a href="#嘗試撰寫線上筆記或部落格吧" class="headerlink" title="嘗試撰寫線上筆記或部落格吧"></a>嘗試撰寫線上筆記或部落格吧</h2><p>我認為現在技術真的太多太多了, 如果沒有將自己看過的技術文章或學習影片給消化和記錄起來, 很快就又會忘記. 所以最好的方式是有個做筆記的習慣!</p><p>做筆記的話我都是用Hackmd先記錄起來, 之後等有空的時間會再消化審視自己寫過的內容, 並發佈到自己的Bloger上, 這樣有助於將學習過的知識給內化到自己的腦海中.</p><h2 id="其他更進階的進修方法"><a href="#其他更進階的進修方法" class="headerlink" title="其他更進階的進修方法"></a>其他更進階的進修方法</h2><h3 id="根據技能樹-RoadMap-來補充自己最常用-有興趣但所缺乏的觀念與技術"><a href="#根據技能樹-RoadMap-來補充自己最常用-有興趣但所缺乏的觀念與技術" class="headerlink" title="根據技能樹(RoadMap)來補充自己最常用,有興趣但所缺乏的觀念與技術"></a>根據技能樹(RoadMap)來補充自己最常用,有興趣但所缺乏的觀念與技術</h3><p>這網站<a href="https://roadmap.sh/roadmaps" target="_blank" rel="noopener">Roadmap</a>提供了各開發者(Frontend, Backend, DevOps)所需要具備的技能樹為何<br>, 若想要往後端精進, 可以看到下面這張圖會碰到哪些所需具備的能力.</p><p><img src="https://i.imgur.com/tGdhgGX.png" alt=""></p><p>看完之後會發覺有太多東西需要Cover了, 學海無涯 (茶).</p><h3 id="經營-Stackoverflow"><a href="#經營-Stackoverflow" class="headerlink" title="經營 Stackoverflow"></a>經營 Stackoverflow</h3><p>這點是我看到大大們提出來可以嘗試的方式, 不過我目前也只有在Stackoverflow上面問幾個小問題, 對這方面還沒有涉略, 可參考下面大大所寫的Stackoverflow的介紹, 未來我會想在這邊嘗試看看能不能也試著回答別人遇到的問題.</p><p><a href="https://lab.howie.tw/2019/04/learn-from-stackoverflow.html?fbclid=IwAR2VuMNEjP8gvE-IFa69zJZaHNROM8-pj8dgt0-641gcjGwmkCNuBzNal8k" target="_blank" rel="noopener">工程師鍛鍊接軌世界的能力從stackoverflow 開始 - 阿貝好威的實驗室</a></p><h2 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h2><p>下班後要再自修真的需要有興趣使然以及強大的毅力, 否則很容易就會半途而廢.</p><p>所以最重要的還是要讓自己有個規劃, 並且從實踐規劃中內化成自己的日常習慣, 久而久之就會讓自己變得更強的！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近剛好在Backend版上看到有人Po文問說: “下班後要如何精進自修”, 意外看到許多大大們在下面留言, 正好最近我也在思考要如何精進自己, 所以趁這機會來統整一下大大們提出來的想法並且與自己目前的進修方式做結合, 主要會以Full-Stack engineer的精進方式來做個紀錄分享.&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="http://a10000005588.github.io/categories/Life/"/>
    
    
      <category term="Mindset" scheme="http://a10000005588.github.io/tags/Mindset/"/>
    
  </entry>
  
  <entry>
    <title>Spring Security 功能介紹</title>
    <link href="http://a10000005588.github.io/2020/04/11/Spring-Security%E4%BB%8B%E7%B4%B9/"/>
    <id>http://a10000005588.github.io/2020/04/11/Spring-Security介紹/</id>
    <published>2020-04-11T13:34:23.000Z</published>
    <updated>2020-08-03T14:32:05.404Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Security-功能介紹"><a href="#Spring-Security-功能介紹" class="headerlink" title="Spring Security 功能介紹"></a>Spring Security 功能介紹</h1><p>先介紹以下常用認證功能</p><a id="more"></a><h2 id="User-name-password-基本認證"><a href="#User-name-password-基本認證" class="headerlink" title="User name / password 基本認證"></a>User name / password 基本認證</h2><p>使用使用者名稱/密碼做驗證</p><h2 id="SSO-Okta-LDAP"><a href="#SSO-Okta-LDAP" class="headerlink" title="SSO / Okta / LDAP"></a>SSO / Okta / LDAP</h2><h3 id="SSO-Single-Sign-On"><a href="#SSO-Single-Sign-On" class="headerlink" title="SSO (Single Sign On)"></a>SSO (Single Sign On)</h3><p>為OAuth的近一步實現，若已經透過Google取得token, 就可以在其他服務的小網站，都使用Google提供的身份驗證服務</p><h3 id="Okta"><a href="#Okta" class="headerlink" title="Okta"></a>Okta</h3><p>協助非營利組織的方式。從基本的單一登入（single sign-on，簡稱為 SSO）到進階的身份認證和存取權限的管理方案</p><h3 id="LDAP-Lightweight-Directory-Access-Protocol"><a href="#LDAP-Lightweight-Directory-Access-Protocol" class="headerlink" title="LDAP (Lightweight Directory Access Protocol)"></a>LDAP (Lightweight Directory Access Protocol)</h3><p>為一種輕量的目錄服務協定，像是通訊錄一樣紀錄人員資訊，可以拿來做帳號整合,驗證。</p><p>LDAP目錄服務通常有層級結構，像是公司組織階層</p><h2 id="OAuth-Intra-App-Authorization"><a href="#OAuth-Intra-App-Authorization" class="headerlink" title="OAuth (Intra App Authorization)"></a>OAuth (Intra App Authorization)</h2><p>OAuth讓用戶可以授權第三方網站存取他們在另外服務提供者(ex: Facebook, Line)的某些特定資訊，而非所有內容。</p><h3 id="為什麼有OAuth出現？"><a href="#為什麼有OAuth出現？" class="headerlink" title="為什麼有OAuth出現？"></a>為什麼有OAuth出現？</h3><p>因為各個網站都做會員機制很麻煩，且小網站可能有資安風險。</p><p>故大網站像是Facebook, Line早已經做好超級安全的會員管理機制，大網站幫你管理個資，提供登入的服務。</p><p>但提供這樣服務的大廠越來越多，若小網站同時要提供用戶連結到多個有提供身分服務的大網站會變得很複雜，於是就訂定的工業標準：OAuth.</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul><li>進入小網站 -&gt;   </li><li>跳轉到大網站登入畫面 -&gt;  </li><li>登入成功大網站給予一個有時效的token 給小網站 -&gt; </li><li>小網站透過token跟大網站索取用戶的資訊 (這也是為什麼每次登入第三方都會詢問你是否要揭露以下資訊給小網站)</li></ul><p>不過一般小網站”無法”直接取得token, 而是取得一個code, 再用這個code向大網站換得一個token<br>(多這道手續的原因是因為，Internet可能會被路上經手的router或其他設備擷取,偽造,變更)</p><h3 id="實際情況"><a href="#實際情況" class="headerlink" title="實際情況"></a>實際情況</h3><p>在 Line Login時, Line Notify中，組出一個URL，取得Authorization Code, 這一段取得的Code為明碼, 走的是http get，透過瀏覽器網址列來傳遞 (若沒有用SSL傳遞的話，會被任何人擷取看到). </p><p>接下來小網站取得Authorization Code後，在透過http post，從後端跟大網站換得token (因為走後端 大網站就知道小網站的身份和所拿的code)</p><p>:::warning<br>OAuth主要功能是授權，不是認證，所以後來才延伸出OpenID Connect (OIDC)來提供認證用。<br>:::<br>:::info<br>Authentication 檢查發送檢查人的身份是誰、是否合格;<br>Authorization 則是規範使用者權限的規則，規定哪些能做、哪些不能</p><p>因此如果該 Request 未帶 token 或是 token 過期、不合法皆算是 Authentication Error ，跟 http status code 的 401 意思一樣 ; </p><p>如果 Request 的 token 認證成功但是該使用者的權限不足以執行該 Request 則是 Forbidden Error (即 因 Authorization 發生的錯誤) ，如 http status code 的 403 意思相同。</p><p>:::</p><p>:::success<br>單純用大網站的OAuth當自己的會員系統還是有很大的問題<br>最明顯的是當使用者同時有Google 與 Facebook的帳號時<br>兩個帳號上面的Email可能不是一樣的<br>自己的網站很可能無法辨認這是同一個人的帳戶<br>所以一般還是會需要自己的會員系統做整合<br>:::</p><h3 id="Microservice-security-using-tokens-JWT"><a href="#Microservice-security-using-tokens-JWT" class="headerlink" title="Microservice security (using tokens, JWT)"></a>Microservice security (using tokens, JWT)</h3><p>JWT (JSON web token):</p><ul><li>JWT基於JSON的開放標準 (RFC 7519)</li><li>被用在身份提供者和服務提供者間傳遞，被認證的用戶身份訊息</li><li>可額外增加聲明訊息，該JWT token可以直接被用於認證(Authorization)，也可被加密</li><li>特別適用於SSO</li></ul><h4 id="JWT-與-Session差別："><a href="#JWT-與-Session差別：" class="headerlink" title="JWT 與 Session差別："></a>JWT 與 Session差別：</h4><h4 id="Session"><a href="#Session" class="headerlink" title="Session:"></a>Session:</h4><p>由於http協議為stateless,無法知道每次request是誰，但每次request若都要帳號密碼很麻煩</p><p>故用戶第一次發Request時，就產生一組token紀錄在db與session, 並將token給用戶，告訴用戶將token存在cookie，當下次發送request時，透過token證明自己身份。</p><h4 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h4><p>組成內容有三個部分(Header, Paylaod,Signature)並由<code>.</code> 做區隔，最後透過這三個部分，串成一個 Jwt 字串</p><p>Header: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &apos;typ&apos;: &apos;JWT&apos;, # 聲明類型</span><br><span class="line">  &apos;alg&apos;: &apos;HS256&apos; # 加密的方法: HMAC、SHA256、RSA 進行 Base64 編碼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Payload: 放聲明內容，可以說就是存放溝通訊息的地方</p><p>在定義上有 3 種聲明 (Claims)</p><ul><li>Reserved (註冊聲明)</li><li>Public (公開聲明)</li><li>Private (私有聲明)</li></ul><p>註冊聲明參數 (建議但不強制使用)</p><ul><li>iss (Issuer) - jwt簽發者</li><li>sub (Subject) - jwt所面向的用戶</li><li>aud (Audience) - 接收jwt的一方</li><li>exp (Expiration Time) - jwt的過期時間，這個過期時間必須要大於簽發時間</li><li>nbf (Not Before) - 定義在什麼時間之前，該jwt都是不可用的</li><li>iat (Issued At) - jwt的簽發時間</li><li>jti (JWT ID) - jwt的唯一身份標識，主要用來作為一次性token,從而迴避重放攻擊</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;sub&quot;: &quot;1234567890&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;John Doe&quot;,</span><br><span class="line">  &quot;iat&quot;: 1516239022</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Signature: 由三個部分組成</p><ul><li>header (base64後的)</li><li>payload (base64後的)</li><li>secret </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), &apos;secret&apos;)</span><br></pre></td></tr></table></figure><p>:::warning<br>secret 要保存在 server 端，jwt 的 簽發驗證都必須使用這個 secret，當其他人得知這個 secret，那就意味著客戶端是可以自我簽發 jwt ，因此在任何場景都不應該外流<br>:::</p><p>最後將 Header, Payload, Signature做base64編碼，組成</p><p>使用的時候，在reqeust的header加上 <code>Authorization: Bearer &lt;token&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post(&apos;api/user/1&apos;, &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Authorization&apos;: &apos;Bearer &apos; + token</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="JWT-前後端互動示意圖"><a href="#JWT-前後端互動示意圖" class="headerlink" title="JWT 前後端互動示意圖"></a>JWT 前後端互動示意圖</h3><p><img src="https://i.imgur.com/wGqdCkr.png" alt=""></p><h3 id="JWT優點"><a href="#JWT優點" class="headerlink" title="JWT優點"></a>JWT優點</h3><ul><li>跨語言，因為 json 格式大部分語言都可使用</li><li>可儲存一些簡單但非敏感的商業邏輯 - role ..</li><li>構成內容簡單，佔用 Size 小方便傳輸</li><li>!!! 不需在 server 保存 session，所以它易於應用的擴展</li></ul><h2 id="Spring-Security-教學視頻"><a href="#Spring-Security-教學視頻" class="headerlink" title="Spring Security 教學視頻"></a>Spring Security 教學視頻</h2><p>Spring Boot + Spring Security + JWT from scratch - Java Brains<br><a href="https://www.youtube.com/watch?v=X80nJ5T7YpE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=X80nJ5T7YpE</a></p><h2 id="參考資源："><a href="#參考資源：" class="headerlink" title="參考資源："></a>參考資源：</h2><p>Okta 如何協助非營利組織-從 25 個免費的授權開始<br><a href="https://www.techsoup-taiwan.org.tw/okta" target="_blank" rel="noopener">https://www.techsoup-taiwan.org.tw/okta</a></p><p>LDAP 簡介<br><a href="https://poychang.github.io/ldap-introduction/" target="_blank" rel="noopener">https://poychang.github.io/ldap-introduction/</a></p><p>一次搞懂OAuth與SSO在幹什麼?<br><a href="http://studyhost.blogspot.com/2017/01/oauthsso.html" target="_blank" rel="noopener">http://studyhost.blogspot.com/2017/01/oauthsso.html</a></p><p>GraphQL 設計： Autentication 與 Authorization 大全<br><a href="https://ithelp.ithome.com.tw/articles/10208278" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10208278</a></p><p>JSON Web Token(JWT) 簡單介紹<br><a href="https://mgleon08.github.io/blog/2018/07/16/jwt/" target="_blank" rel="noopener">https://mgleon08.github.io/blog/2018/07/16/jwt/</a></p><p>What is Spring Security really all about? Java Brains Brain Bytes</p><p><a href="https://www.youtube.com/watch?v=sm-8qfMWEV8&amp;list=PLqq-6Pq4lTTYTEooakHchTGglSvkZAjnE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=sm-8qfMWEV8&amp;list=PLqq-6Pq4lTTYTEooakHchTGglSvkZAjnE</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Spring-Security-功能介紹&quot;&gt;&lt;a href=&quot;#Spring-Security-功能介紹&quot; class=&quot;headerlink&quot; title=&quot;Spring Security 功能介紹&quot;&gt;&lt;/a&gt;Spring Security 功能介紹&lt;/h1&gt;&lt;p&gt;先介紹以下常用認證功能&lt;/p&gt;
    
    </summary>
    
      <category term="Spring" scheme="http://a10000005588.github.io/categories/Spring/"/>
    
    
      <category term="Java" scheme="http://a10000005588.github.io/tags/Java/"/>
    
      <category term="Spring" scheme="http://a10000005588.github.io/tags/Spring/"/>
    
      <category term="Authentication" scheme="http://a10000005588.github.io/tags/Authentication/"/>
    
  </entry>
  
</feed>
