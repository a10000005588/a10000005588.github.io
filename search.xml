<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Go CLI Playbook å­¸ç¿’ç­†è¨˜</title>
      <link href="/2021/02/15/go-cli/"/>
      <url>/2021/02/15/go-cli/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹ç‚ºå­¸ç¿’æœ¬èª²ç¨‹ <a href="https://app.pluralsight.com/library/courses/go-cli-playbook/table-of-contents" target="_blank" rel="noopener">Pluralshight: The Go CLI Playbook</a> æ‰€è¨˜éŒ„çš„ç­†è¨˜ï¼Œäº†è§£Golangæœ¬èº«æ‰€æä¾›çš„æŒ‡ä»¤é›†å·¥å…·è¦å¦‚ä½•ä½¿ç”¨</p><p><a href="https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48" target="_blank" rel="noopener">https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48</a></p><h2 id="Go-Command-åŠŸèƒ½"><a href="#Go-Command-åŠŸèƒ½" class="headerlink" title="Go Command åŠŸèƒ½"></a>Go Command åŠŸèƒ½</h2><p>Go çš„åŸºæœ¬Commandå¯ä»¥æä¾›ä»¥ä¸‹åŠŸèƒ½</p><ul><li>Building Application: æŠŠ<code>.go</code>æª”æ¡ˆç·¨è­¯æˆåŸ·è¡Œæª”</li><li>Testing Application: æ¸¬è©¦<code>.go</code>ç¨‹å¼</li><li>Profiling Application: æ•ˆèƒ½æ¸¬è©¦</li><li>Managing Workspaces: ç®¡ç†é–‹ç™¼ç’°å¢ƒ</li><li>Interacting with Environment: èˆ‡ç’°å¢ƒäº’å‹•</li></ul><h3 id="Go-Commandçš„åˆ—è¡¨"><a href="#Go-Commandçš„åˆ—è¡¨" class="headerlink" title="Go Commandçš„åˆ—è¡¨"></a>Go Commandçš„åˆ—è¡¨</h3><p>åœ¨çµ‚ç«¯æ©Ÿä¸‹ <code>go</code> æŒ‡ä»¤ï¼Œå°±æœƒé¡¯ç¤ºgo commandçš„è©³ç´°è³‡è¨Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">âœ go</span><br><span class="line">Go is a tool for managing Go source code.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"></span><br><span class="line">        go command [arguments]</span><br><span class="line"></span><br><span class="line">The commands are:</span><br><span class="line"></span><br><span class="line">        build       compile packages and dependencies</span><br><span class="line">        clean       remove object files and cached files</span><br><span class="line">        doc         show documentation for package or symbol</span><br><span class="line">        env         print Go environment information</span><br><span class="line">        bug         start a bug report</span><br><span class="line">        fix         update packages to use new APIs</span><br><span class="line">        fmt         gofmt (reformat) package sources</span><br><span class="line">        generate    generate Go files by processing source</span><br><span class="line">        get         download and install packages and dependencies</span><br><span class="line">        install     compile and install packages and dependencies</span><br><span class="line">        list        list packages</span><br><span class="line">        run         compile and run Go program</span><br><span class="line">        test        test packages</span><br><span class="line">        tool        run specified go tool</span><br><span class="line">        version     print Go version</span><br><span class="line">        vet         report likely mistakes in packages</span><br><span class="line"></span><br><span class="line">Use &quot;go help [command]&quot; for more information about a command.</span><br><span class="line"></span><br><span class="line">Additional help topics:</span><br><span class="line"></span><br><span class="line">        c           calling between Go and C</span><br><span class="line">        buildmode   build modes</span><br><span class="line">        cache       build and test caching</span><br><span class="line">        filetype    file types</span><br><span class="line">        gopath      GOPATH environment variable</span><br><span class="line">        environment environment variables</span><br><span class="line">        importpath  import path syntax</span><br><span class="line">        packages    package lists</span><br><span class="line">        testflag    testing flags</span><br><span class="line">        testfunc    testing functions</span><br><span class="line"></span><br><span class="line">Use &quot;go help [topic]&quot; for more information about that topic.</span><br></pre></td></tr></table></figure></p><h3 id="å¯é€é-go-help-å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤"><a href="#å¯é€é-go-help-å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤" class="headerlink" title="å¯é€é go help å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤"></a>å¯é€é <code>go help</code> å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤</h3><p>å‡å¦‚è¦çœ‹go testçš„ä»‹ç´¹ï¼Œé‚£å°±ä¸‹é€™è¡ŒæŒ‡ä»¤ <code>go help test</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">âœ go help test</span><br><span class="line">usage: go test [build/test flags] [packages] [build/test flags &amp; test binary flags]</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; automates testing the packages named by the import paths.</span><br><span class="line">It prints a summary of the test results in the format:</span><br><span class="line"></span><br><span class="line">        ok   archive/tar   0.011s</span><br><span class="line">        FAIL archive/zip   0.022s</span><br><span class="line">        ok   compress/gzip 0.033s</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">followed by detailed output for each failed package.</span><br><span class="line"></span><br><span class="line">&apos;Go test&apos; recompiles each package along with any files with names matching</span><br><span class="line">the file pattern &quot;*_test.go&quot;.</span><br><span class="line">These additional files can contain test functions, benchmark functions, and</span><br><span class="line">example functions. See &apos;go help testfunc&apos; for more.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The test binary also accepts flags that control execution of the test; these</span><br><span class="line">flags are also accessible by &apos;go test&apos;. See &apos;go help testflag&apos; for details.</span><br><span class="line"></span><br><span class="line">For more about build flags, see &apos;go help build&apos;.</span><br><span class="line">For more about specifying packages, see &apos;go help packages&apos;.</span><br></pre></td></tr></table></figure><h2 id="go-env-æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸"><a href="#go-env-æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸" class="headerlink" title="go env æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸"></a><code>go env</code> æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; go env</span><br><span class="line"></span><br><span class="line">GOARCH=&quot;amd64&quot;</span><br><span class="line">GOBIN=&quot;/Users/username/go/bin&quot;</span><br><span class="line">GOCACHE=&quot;/Users/username/Library/Caches/go-build&quot;</span><br><span class="line">GOEXE=&quot;&quot;</span><br><span class="line">GOHOSTARCH=&quot;amd64&quot;</span><br><span class="line">GOHOSTOS=&quot;darwin&quot;</span><br><span class="line">GOOS=&quot;darwin&quot;</span><br><span class="line">GOPATH=&quot;/Users/username/go&quot;</span><br><span class="line">GORACE=&quot;&quot;</span><br><span class="line">GOROOT=&quot;/usr/local/Cellar/go/1.10.2/libexec&quot;</span><br><span class="line">GOTMPDIR=&quot;&quot;</span><br><span class="line">GOTOOLDIR=&quot;/usr/local/Cellar/go/1.10.2/libexec/pkg/tool/darwin_amd64&quot;</span><br><span class="line">GCCGO=&quot;gccgo&quot;</span><br><span class="line">CC=&quot;clang&quot;</span><br><span class="line">CXX=&quot;clang++&quot;</span><br><span class="line">CGO_ENABLED=&quot;1&quot;</span><br><span class="line">CGO_CFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_CPPFLAGS=&quot;&quot;</span><br><span class="line">CGO_CXXFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_FFLAGS=&quot;-g -O2&quot;</span><br><span class="line">CGO_LDFLAGS=&quot;-g -O2&quot;</span><br><span class="line">PKG_CONFIG=&quot;pkg-config&quot;</span><br><span class="line">GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build760606218=/tmp/go-build -gno-record-gcc-switches -fno-common&quot;</span><br></pre></td></tr></table></figure><h2 id="go-run-åŸ·è¡Œç¨‹å¼"><a href="#go-run-åŸ·è¡Œç¨‹å¼" class="headerlink" title="go run åŸ·è¡Œç¨‹å¼"></a><code>go run</code> åŸ·è¡Œç¨‹å¼</h2><blockquote><p>æ³¨æ„ï¼Œè‹¥è¦é‹ç¨‹<code>go run</code>ï¼Œéœ€è¦åœ¨<code>$GOPATH</code>åº•ä¸‹çš„<code>src</code>ç›®éŒ„é€²è¡Œ</p></blockquote><p>é‹è¡Œä¸€å€‹åŒ…å«main()æ–¹æ³•çš„ç¨‹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; go run main.go</span><br></pre></td></tr></table></figure><h3 id="é€é-go-run-raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race-conditionçš„ç‹€æ³ç™¼ç”Ÿ"><a href="#é€é-go-run-raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race-conditionçš„ç‹€æ³ç™¼ç”Ÿ" class="headerlink" title="é€é go run --raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿ"></a>é€é <code>go run --race</code>ä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿ</h3><p>è‹¥ç›®å‰æœ‰å€‹ä½¿ç”¨<code>gorouting</code>çš„ç¨‹å¼ï¼Œè‹¥è¦åµæ¸¬æ˜¯å¦æœƒç™¼ç”Ÿrace conditionç‹€æ³ï¼Œå¯ä»¥åŠ ä¸Š<code>-race</code>é€™å€‹flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‹¥æœ‰race conditionï¼Œgo toolæœƒç”¢å‡ºå ±å‘Šä¾†è§£é‡‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">âœ go run -race race_condition/main.go </span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 8:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 8 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">==================</span><br><span class="line">WARNING: DATA RACE</span><br><span class="line">Read at 0x00c00013e010 by goroutine 7:</span><br><span class="line">  main.main.func1()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:13 +0x3c</span><br><span class="line"></span><br><span class="line">Previous write at 0x00c00013e010 by main goroutine:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:10 +0x108</span><br><span class="line"></span><br><span class="line">Goroutine 7 (running) created at:</span><br><span class="line">  main.main()</span><br><span class="line">      /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4</span><br><span class="line">==================</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line">Found 2 data race(s)</span><br><span class="line">exit status 66</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€èˆ¬ä¾†èªªåœ¨devæ¨¡å¼æ™‚ï¼Œæœƒå»ºè­°æ¯æ¬¡é‹è¡Œå°ˆæ¡ˆæ™‚ï¼Œéƒ½åŠ ä¸Š-race</span><br></pre></td></tr></table></figure><h2 id="go-build-ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´"><a href="#go-build-ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´" class="headerlink" title="go build ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´"></a><code>go build</code> ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´</h2><p><code>go build</code>æœƒæŠŠå°ˆæ¡ˆç·¨è­¯æˆåŸ·è¡Œæª”</p><p>è‹¥ç›®å‰æœ‰å€‹åœ¨cmdsè³‡æ–™å¤¾å…§çš„å°ˆæ¡ˆå«åš <code>hello</code> ä¸¦å¼•ç”¨äº†<code>helloService</code>é€™å€‹ä¾è³´å…§çš„æ–¹æ³•</p><p>cmds/hello.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"helloService"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">helloService.SayHello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>helloService/msg.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHello represents a greeting to developer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£åœ¨ <code>/cmds/hello</code>å°ˆæ¡ˆä¸­åŸ·è¡Œ <code>go build</code>ï¼Œæœƒåœ¨ç•¶å‰ç›®éŒ„ç”¢ç”Ÿ<code>hello</code>åŸ·è¡Œæª”</p><p><img src="./pics/01.png" alt=""></p><p>å¯ç›´æ¥åŸ·è¡Œè©²åŸ·è¡Œæª”</p><p><img src="./pics/02.png" alt=""></p><h3 id="ä½¿ç”¨-go-build-oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±"><a href="#ä½¿ç”¨-go-build-oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±" class="headerlink" title="ä½¿ç”¨ go build -oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±"></a>ä½¿ç”¨ <code>go build -o</code>å®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±</h3><p>å‡å¦‚è¦æŠŠç·¨è­¯æª”æ¡ˆå«åš<code>hello_exe.a</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ <span class="keyword">go</span> build -o hello_exe.a</span><br></pre></td></tr></table></figure><p><img src="./pics/03.png" alt=""></p><h3 id="ä½¿ç”¨-go-build-i-ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´"><a href="#ä½¿ç”¨-go-build-i-ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´" class="headerlink" title="ä½¿ç”¨ go build -i ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´"></a>ä½¿ç”¨ <code>go build -i</code> ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´</h3><p>è‹¥å°å°ˆæ¡ˆé€²è¡Œç·¨è­¯æ™‚ï¼ŒåŠ ä¸Š<code>-i</code>åƒæ•¸ï¼ŒæœƒåŒæ™‚å°‡importçš„ä¾è³´ (ex:<code>helloService</code>)ä¹Ÿæœƒç·¨è­¯è©²ä¾è³´å€‘ä¸¦å®‰è£åœ¨ <code>$GOPATH/pkg</code>åº•ä¸‹</p><p><img src="./pics/04.png" alt=""></p><h3 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h3><p>Go Official Docs: Command go<br><a href="https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies" target="_blank" rel="noopener">https://golang.org/cmd/go/#Compile%20packages%20and%20dependencies</a></p><h2 id="go-install-ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage"><a href="#go-install-ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage" class="headerlink" title="go install ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage"></a><code>go install</code> ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackage</h2><p>æœƒå°‡å°ˆæ¡ˆ (main) é€²è¡Œç·¨è­¯æˆbinæª”æ¡ˆä¸¦æ”¾ç½®åœ¨<code>$GOPATH/bin</code>åº•ä¸‹</p><p>æœƒå°‡ä¾è³´ (package) é€²è¡Œç·¨è­¯ä¸¦å®‰è£åœ¨<code>$GOPATH/pkg</code>åº•ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœå·²ç¶“æœ‰å­˜åœ¨çš„ä¾è³´æˆ–æ˜¯binaryæª”æ¡ˆã€é‚£go installå°±ä¸æœƒæœ‰ä½œç”¨</span><br></pre></td></tr></table></figure><h3 id="go-install-nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ"><a href="#go-install-nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ" class="headerlink" title="go install -nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ"></a><code>go install -n</code>ï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œ</h3><p>å‡å¦‚æˆ‘å€‘åœ¨å°å‰›å‰›çš„helloServiceé€™å€‹ä¾è³´ï¼Œé€²è¡Œ<code>go install -n</code></p><p>æœƒçœ‹åˆ°ä¸æœƒåšä»€éº¼å‹•ä½œï¼Œå› ç‚ºå·²ç¶“æœ‰å®‰è£è©²ä¾è³´åœ¨<code>pkg</code>åº•ä¸‹</p><p><img src="./pics/05.png" alt=""></p><p>å°‡è©²ä¾è³´ç§»é™¤ï¼Œå†æ¬¡åŸ·è¡Œä¸€éï¼Œæœƒçœ‹åˆ°go toolåŸ·è¡Œäº†ä»€éº¼å‹•ä½œ</p><p><img src="./pics/06.png" alt=""></p><h3 id="go-install-xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ"><a href="#go-install-xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ" class="headerlink" title="go install -xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ"></a><code>go install -x</code>ï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œ</h3><h4 id="å…¶ä»–flag"><a href="#å…¶ä»–flag" class="headerlink" title="å…¶ä»–flag"></a>å…¶ä»–flag</h4><ul><li>-p n: æŒ‡å®šç”¨å¤šå°‘å€‹cpuä¾†é€²è¡Œinstall, é è¨­æ˜¯å¯å–å¾—çš„æ•¸é‡</li></ul><h3 id="ç”¢ç”ŸShared-Librariesï¼Œä½¿ç”¨-buildmode-flag"><a href="#ç”¢ç”ŸShared-Librariesï¼Œä½¿ç”¨-buildmode-flag" class="headerlink" title="ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨-buildmode flag"></a>ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨<code>-buildmode</code> flag</h3><p>é€é <code>go build -buildmode</code> æˆ–æ˜¯ <code>go install -buildmode</code><br>å¯ä»¥åƒCæˆ–C++é‚£æ¨£ç”¢ç”ŸShared Librariesï¼Œä¾›å‹•æ…‹è¼‰å…¥</p><p>é€é<code>go help buildmode</code>å¯æŸ¥çœ‹æœ‰æä¾›å“ªäº›æ¨¡å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é è¨­-buildmodeæœƒä½¿ç”¨ archiveï¼šå°‡æª”æ¡ˆç·¨è­¯æˆ .a</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ -buildmode=sharedï¼šå°‡æª”æ¡ˆç·¨è­¯æˆå¯å‹•æ…‹è¼‰å…¥çš„shared libï¼Œæˆ–æ˜¯åœ¨runtimeæ™‚å¯é€£çµ</span><br></pre></td></tr></table></figure><p>å‡å¦‚å†ç”¨å‰›å‰›çš„ç¯„ä¾‹ï¼Œä¸€å€‹<code>cmds/hello.go</code>ä¸­å¼•ç”¨äº† helloServiceé€™å€‹package</p><p><img src="./pics/07.png" alt=""></p><h4 id="ä½¿ç”¨-buildmode-shared-ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-shared-ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=shared ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=shared</code> ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Libraries</h4><p>è‹¥è¦å°‡æŸå€‹packageç·¨è­¯æˆshared libraryï¼Œ</p><p>èˆ‰å€‹ä¾‹å­ï¼ŒæŠŠ<code>helloService</code> ç·¨è­¯æˆshared libraryä¸¦å®‰è£åœ¨<code>pkg</code>è³‡æ–™å¤¾ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go install -buildmode=shared helloService</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„: Macosä¸æ”¯æ´ -buildmode=shared<br>-buildmode=shared not supported on darwin/amd64</p></blockquote><p>æ¥è‘—ç·¨è­¯ä¸»ç¨‹å¼ï¼Œä¸¦æŒ‡å®šå…¶åŸ·è¡Œæª”å¯ä»¥å‹•æ…‹è¼‰å…¥(-linkshared) shared library</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go build -linkshared cmds/hello</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œç·¨è­¯å¾Œçš„åŸ·è¡Œæª” <code>./hello</code> ï¼Œå¯çœ‹åˆ°å…¶çµæœ</p><p>ä¸éè‹¥å°‡<code>pkg</code>ä¸­ï¼Œå‰›å‰›go installçš„<code>helloService</code>çš„shared libraryçµ¦åˆªé™¤çš„è©±ï¼Œå†æ¬¡åŸ·è¡Œ <code>/.hello</code> é‚£å°±æœƒç™¼ç”Ÿç„¡æ³•åŸ·è¡Œç‹€æ³ã€‚</p><h4 id="ä½¿ç”¨-buildmode-c-archive-ç”¢ç”Ÿä¾›C-language-â€œéœæ…‹â€é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-c-archive-ç”¢ç”Ÿä¾›C-language-â€œéœæ…‹â€é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=c-archive ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=c-archive</code> ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Libraries</h4><p>å¦‚æœæƒ³è¦å°‡pakcageç·¨è­¯æˆCå¯ä»¥è¼‰å…¥çš„shared libraryçš„è©±ï¼Œéœ€è¦å°pakcageçš„methodï¼ŒåŠ ä¸Š <code>//export functionName</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> helloService</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//export SayHello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello gofer! I came from `cmds/hello` package."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‹¥ä½¿ç”¨ <code>-buildmode=c-archive</code>çš„è©±ï¼Œå‰‡æœƒç”¢ç”Ÿå‡º <code>.h</code>èˆ‡<code>.a</code>çš„shared library</p><blockquote><p>æ³¨æ„: Macosé‹è¡Œ<code>-buildmode=c-archive</code> æœƒç„¡æ³•ç”¢ç”Ÿ <code>.h</code>æª”æ¡ˆ goç‰ˆæœ¬: go1.15 darwin/amd64</p></blockquote><p>æ¥è‘—å°±å¯ä»¥åœ¨Cèªè¨€å…§å¼•å…¥ç”¨Go buildå¥½çš„share library</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello.a"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  SayHello();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œä¹‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc hello.c ./hello</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-buildmode-c-shared-ç”¢ç”Ÿä¾›C-language-â€œå‹•æ…‹â€é€£çµçš„Shared-Libraries"><a href="#ä½¿ç”¨-buildmode-c-shared-ç”¢ç”Ÿä¾›C-language-â€œå‹•æ…‹â€é€£çµçš„Shared-Libraries" class="headerlink" title="ä½¿ç”¨ -buildmode=c-shared ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared Libraries"></a>ä½¿ç”¨ <code>-buildmode=c-shared</code> ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared Libraries</h4><p>åŒç”¨goç”¢ç”Ÿå‡ºshared library</p><h4 id="ä½¿ç”¨-buildmode-plugin-å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo-plugin"><a href="#ä½¿ç”¨-buildmode-plugin-å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo-plugin" class="headerlink" title="ä½¿ç”¨ -buildmode=plugin å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo plugin"></a>ä½¿ç”¨ <code>-buildmode=plugin</code> å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo plugin</h4><p>å¯ä»¥æŠŠå°ˆæ¡ˆéœ€è¦importçš„packageï¼Œæ‰“åŒ…æˆplugin</p><p>èˆ‰å€‹ä¾‹å­ï¼Œè‹¥ç¾åœ¨æˆ‘å€‘è¦å°‡pluginé€™ä¸€å€‹pakcageæ‰“åŒ…æˆplugin</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ThingToDo</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Executing action"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éä»¥ä¸‹æŒ‡ä»¤ï¼Œåšå‡ºä¸€å€‹pluginï¼Œæª”åå«åš plugin å‰¯æª”åç‚º<code>.so</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go build -buildmode=plugin -o=plugin.so plugin/plugin.go</span><br></pre></td></tr></table></figure></p><p>æ¥è‘—æˆ‘å€‘å®šç¾©äº†ä¸€å€‹å°å°ˆæ¡ˆï¼Œä¾†ä½¿ç”¨plugin</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"flag"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"plugin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">path := flag.String(<span class="string">"plugin"</span>, <span class="string">""</span>, <span class="string">"Plugin to execute"</span>)</span><br><span class="line"></span><br><span class="line">flag.Parse()</span><br><span class="line">    <span class="comment">// å¦‚æœåŸ·è¡Œgoæ™‚æ²’æœ‰å¸¶ -pluginæŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">if</span> *path == <span class="string">""</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">"Path to plugin must be provided"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®€å–plugin</span></span><br><span class="line">p, err := plugin.Open(*path)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°‹æ‰¾pluginæ˜¯å¦æœ‰ThingToDoé€™å€‹æ–¹æ³•</span></span><br><span class="line">f, err := p.Lookup(<span class="string">"ThingToDo"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">thingToDo, ok := f.(<span class="function"><span class="keyword">func</span><span class="params">()</span>)</span></span><br><span class="line"><span class="function"><span class="title">if</span> !<span class="title">ok</span></span> &#123;</span><br><span class="line">log.Fatal(<span class="string">"Could not find function 'ThingToDo' in plugin"</span>)</span><br><span class="line">&#125;</span><br><span class="line">thingToDo()</span><br><span class="line">log.Println(<span class="string">"Did the thing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—é‹è¡Œä¸‹é¢æŒ‡ä»¤ä½¿ç”¨plugin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ go run action/action.go -plugin=./plugin.so</span><br></pre></td></tr></table></figure><p>å¦‚æœpluginå­˜åœ¨çš„è©±ï¼Œå°±å¯ä»¥åŸ·è¡Œ <code>plugin.so</code>å…§çš„<code>ThingToDo</code>æ–¹æ³•</p><p>åŸ·è¡Œçµæœ<br><img src="./pics/08.png" alt=""></p><h4 id="åƒè€ƒ-1"><a href="#åƒè€ƒ-1" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h4><p>Golangçš„æ„å»ºæ¨¡å¼ - Chen Jiehua<br><a href="https://chenjiehua.me/golang/golang-buildmode.html" target="_blank" rel="noopener">https://chenjiehua.me/golang/golang-buildmode.html</a></p><h2 id="go-test-æ’°å¯«å–®å…ƒæ¸¬è©¦Unit-Testing-Programs"><a href="#go-test-æ’°å¯«å–®å…ƒæ¸¬è©¦Unit-Testing-Programs" class="headerlink" title="go test æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programs"></a><code>go test</code> æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programs</h2><p>é€é <code>go test</code> å¯æ¸¬è©¦golangæ’°å¯«çš„ç¨‹å¼çš„Inputèˆ‡Outputæ˜¯å¦æ­£ç¢º</p><h3 id="æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡"><a href="#æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡" class="headerlink" title="æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡"></a>æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡</h3><p>ç”±æ–¼goæœ¬èº«å°æ¸¬è©¦æœ‰è‘—åš´è¬¹çš„è¦å‰‡ï¼Œæ•…å¯ä»¥é¿å…åƒå…¶ä»–èªè¨€é‚£æ¨£æœ‰å„ç¨®ä¸åŒæ¸¬è©¦çš„æ¡†æ¶ï¼Œä»¥çµ±ä¸€æ¸¬è©¦çš„æ¨£å¼</p><p>å…¶è¦å‰‡å¦‚ä¸‹ï¼š</p><ul><li>è‹¥æœ‰å®šç¾©æ¸¬è©¦çš„æª”æ¡ˆåç¨±ï¼Œéœ€è¦ä»¥ <code>_test.go</code>æœ€çµå°¾å‘½å</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mylib_test.go</span><br></pre></td></tr></table></figure><ul><li>è‹¥éœ€è¦è¢«æ¸¬è©¦çš„æ–¹æ³•ï¼Œè«‹ä»¥ <code>Test_</code> ç‚ºé–‹é ­</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func Test_MyFunction() &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸ·è¡Œæ¸¬è©¦"><a href="#åŸ·è¡Œæ¸¬è©¦" class="headerlink" title="åŸ·è¡Œæ¸¬è©¦"></a>åŸ·è¡Œæ¸¬è©¦</h3><p>è‹¥æœ‰å€‹å°ˆæ¡ˆå«åš <code>testing_example</code>ï¼Œå…¶ç›®éŒ„æ¶æ§‹å¦‚ä¸‹</p><p><img src="./pics/09.png" alt=""></p><p><code>testing_example/mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">t.Run(<span class="string">"Go can concatenate strings"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="string">"Hello, "</span>+<span class="string">"Go"</span> != <span class="string">"Hello, Go"</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶å­packageä¹Ÿæœ‰å®šç¾©testing file <code></code>testing_example/childlib/childlib_test.go`<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> childlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_MoreBasics</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">10</span><span class="number">-5</span> != <span class="number">5</span> &#123;</span><br><span class="line">t.Error(<span class="string">"Failed to subtract correctly"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡"><a href="#åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡" class="headerlink" title="åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡"></a>åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡</h3><p>è‹¥è¦å°å°ˆæ¡ˆåŸ·è¡ŒUnit Testï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test testing_example </span><br><span class="line">ok      testing_example 0.014s</span><br></pre></td></tr></table></figure><p>ä½†æœƒç™¼ç¾child packageçš„æ¸¬è©¦æ²’æœ‰åŸ·è¡Œåˆ°ï¼Œæ‰€ä»¥è‹¥è¦å°packageå…§æ‰€æœ‰å­<br>packageéƒ½é€²è¡Œæ¸¬è©¦ï¼Œé‚£éœ€è¦åŠ ä¸Š <code>/...</code> åšéè¿´å°‹æ‰¾çš„å‹•ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via ğŸ¹ v1.15 </span><br><span class="line">âœ go test testing_example/...</span><br><span class="line">ok      testing_example (cached)</span><br><span class="line">ok      testing_example/childlib        0.015s</span><br></pre></td></tr></table></figure><h3 id="æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸-flags"><a href="#æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸-flags" class="headerlink" title="æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flags"></a>æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flags</h3><p>é€é <code>go help testflag</code> å¯ä»¥æŸ¥çœ‹åŸ·è¡Œæ¸¬è©¦æ™‚å¯ä»¥å®¢è£½åŒ–çš„é¸æ“‡</p><p>åˆ—èˆ‰ä¸€äº›å¸¸ä½¿ç”¨çš„ï¼š</p><ul><li><code>-cpu</code>: æŒ‡å®šæ¸¬è©¦æ™‚ä½¿ç”¨çš„CPUæ•¸é‡ï¼Œé è¨­æ˜¯æœƒä½¿ç”¨ <code>GOMAXPROCS</code>åƒæ•¸çš„å€¼</li><li><code>-parallel</code>: æ¸¬è©¦æ™‚å¯ä»¥ä¸¦è¡Œè™•ç†ï¼Œä½†åªæœ‰æŒ‡å®šFunctionæ‰æœƒè¢«ä¸¦è¡Œè™•ç†</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_BasicChecks</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">t.Parallel()  <span class="comment">// é€²è¡Œä¸¦è¡Œæ¸¬è©¦</span></span><br><span class="line">t.Run(<span class="string">"Go can add"</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span>+<span class="number">1</span> != <span class="number">2</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>-list</code>: å¯é€éæ­£å‰‡è¡¨é”å¼éæ¿¾å‡ºæ¸¬è©¦æ–¹æ³•åç¨±ï¼Œå†æ¸¬è©¦æ™‚æœƒåˆ—å‡ºç¬¦åˆçš„æ¸¬è©¦æ–¹æ³•çµ¦</li></ul><p>å‡å¦‚è¦åˆ—å‡ºæœ‰åŒ…å« <code>Basics</code>çš„æ¸¬è©¦æ–¹æ³•åç¨±ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -list Basics testing_example/...</span><br><span class="line">ok      testing_example 0.022s</span><br><span class="line">Test_MoreBasics   // åˆ—å‡º</span><br><span class="line">ok      testing_example/childlib        0.023s</span><br></pre></td></tr></table></figure></p><ul><li><code>-run</code>: è·ŸListå¾ˆåƒï¼Œä½†åªæœƒåŸ·è¡Œç¬¦åˆæ­£å‰‡è¡¨é”å¼çš„æ¸¬è©¦æ–¹æ³•<ul><li>ä½¿ç”¨æ™‚æ©Ÿï¼šè‹¥é–‹ç™¼å‡ºå­å°ˆæ¡ˆçš„æ¸¬è©¦æ–¹æ³•ï¼Œé€é<code>-run</code>æŒ‡å®šè©²å­å°ˆæ¡ˆçš„scopeåŸ·è¡Œæ¸¬è©¦å°±å¥½ï¼Œå°±å¯ä»¥çœå»ä¸å°‘æ™‚é–“</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -run Basics testing_example/...</span><br><span class="line">ok      testing_example 0.024s [no tests to run]</span><br><span class="line">ok      testing_example/childlib        0.022s</span><br></pre></td></tr></table></figure><ul><li><code>-timeout d</code>: è¶…éå¤šä¹…å°±åœæ­¢æ¸¬è©¦ï¼Œé è¨­ç‚º10åˆ†é˜</li><li><code>-v</code>: æ¸¬è©¦æ™‚å°‡è©³ç´°çµæœåˆ—å‡ºä¾†</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -v testing_example/...</span><br><span class="line">=== RUN   Test_BasicChecks</span><br><span class="line">=== PAUSE Test_BasicChecks</span><br><span class="line">=== CONT  Test_BasicChecks</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_add</span><br><span class="line">=== RUN   Test_BasicChecks/Go_can_concatenate_strings</span><br><span class="line">--- PASS: Test_BasicChecks (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_add (0.00s)</span><br><span class="line">    --- PASS: Test_BasicChecks/Go_can_concatenate_strings (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example 0.017s</span><br><span class="line">=== RUN   Test_MoreBasics</span><br><span class="line">=== PAUSE Test_MoreBasics</span><br><span class="line">=== CONT  Test_MoreBasics</span><br><span class="line">--- PASS: Test_MoreBasics (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example/childlib        0.025s</span><br></pre></td></tr></table></figure><ul><li><code>-count</code>: æŒ‡å®šåŸ·è¡Œæ¸¬è©¦çš„æ¬¡æ•¸</li><li><code>-cover</code>: é¡¯ç¤ºæ¸¬è©¦çš„æ¶µè“‹ç¯„åœè³‡è¨Š</li></ul><h3 id="æ¸¬è©¦çš„æ¶µè“‹-Code-Coverage"><a href="#æ¸¬è©¦çš„æ¶µè“‹-Code-Coverage" class="headerlink" title="æ¸¬è©¦çš„æ¶µè“‹ Code Coverage"></a>æ¸¬è©¦çš„æ¶µè“‹ Code Coverage</h3><p>å¯ä»¥é€é <code>go test -cover</code> ä¾†æŸ¥çœ‹ç›®å‰æ¸¬è©¦é …ç›®æ¶µè“‹äº†å¤šå°‘é–‹ç™¼çš„å…§å®¹</p><p>ä»¥ä¸‹ç‚ºæ¸¬è©¦çš„é …ç›®å…§å®¹ï¼š</p><p><img src="./pics/10.png" alt=""></p><p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subractor</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l - r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨é€™é‚Šåªæœ‰æ¸¬è©¦adderæ–¹æ³•ï¼Œæ²’æœ‰subractoræ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„ç¯„ä¾‹åªæ¸¬è©¦ä¸€å€‹æ–¹æ³•<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span> </span><br><span class="line">âœ <span class="keyword">go</span> test -cover testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.013s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure></p><h4 id="é€égo-test-coverpkg-æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package"><a href="#é€égo-test-coverpkg-æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package" class="headerlink" title="é€égo test -coverpkg æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package"></a>é€é<code>go test -coverpkg</code> æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„package</h4><p>å†ç”¨ä¸Šè¿°çš„ç¯„ä¾‹ï¼Œæˆ‘å€‘æ‰“ç®—æ¸¬è©¦å°ˆæ¡ˆ <code>testing_example_1</code>ä¸­çš„ <code>fmt</code> èˆ‡ <code>testing_example_1</code>æœ¬èº«è‡ªå·±é€™å…©å€‹pacakgeï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -coverpkg testing_example_1, fmt testing_example_1 </span><br><span class="line">warning: no packages being tested depend on matches for pattern </span><br><span class="line">ok      fmt     0.089s  coverage: 0.0% of statements in testing_example_1, </span><br><span class="line">ok      testing_example_1       0.019s  coverage: 50.0% of statements in testing_example_1,</span><br></pre></td></tr></table></figure><h4 id="é€égo-test-coverprofile-ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š"><a href="#é€égo-test-coverprofile-ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š" class="headerlink" title="é€égo test -coverprofile ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š"></a>é€é<code>go test -coverprofile</code> ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       0.012s  coverage: 50.0% of statements</span><br></pre></td></tr></table></figure><p>åŒæ™‚æœƒç”¢ç”Ÿ <code>cover.out</code>é€™å€‹æ¸¬è©¦å ±å‘Šæª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mode: set</span><br><span class="line">testing_example_1/mylib.go:3.26,5.2 1 1</span><br><span class="line">testing_example_1/mylib.go:7.30,9.2 1 0</span><br></pre></td></tr></table></figure></p><h4 id="é€é-go-tool-æŸ¥çœ‹æ¸¬è©¦å ±å‘Š"><a href="#é€é-go-tool-æŸ¥çœ‹æ¸¬è©¦å ±å‘Š" class="headerlink" title="é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Š"></a>é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Š</h4><p>å¯ä»¥é€é <code>go tool cover -html= æ¸¬è©¦å ±å‘Šæª”æ¡ˆåç¨±</code> ä¾†ç”¢ç”Ÿå‡ºä»¥ç¶²é æ–¹å¼ç€è¦½çš„å ±å‘Š</p><p>è‹¥è¦è§£æç”¢ç”Ÿå‡ºä¾†çš„å ±å‘Š <code>cover.out</code></p><p><code>go tool cover -html=cover.out</code></p><p>å¯ä»¥ç”¢å‡ºWebå‘ˆç¾ï¼Œæ¸¬è©¦çš„å ±å‘Š</p><p><img src="pics/11.png" alt=""><br><img src="https://i.imgur.com/SgATMg2.png" alt=""></p><p>å¦‚æœè¦çœ‹å‡ºæ›´è©³ç´°çš„æ¸¬è©¦å ±å‘Šçš„è©±ï¼Œä¾‹å¦‚æƒ³çœ‹åˆ°æ¸¬è©¦æ–¹æ³•è¢«åŸ·è¡Œå¹¾æ¬¡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/<span class="keyword">go</span>/src via v1<span class="number">.15</span></span><br><span class="line">âœ <span class="keyword">go</span> test -covermode count -coverprofile cover.out testing_example_1 </span><br><span class="line">ok      testing_example_1       <span class="number">0.018s</span>  coverage: <span class="number">50.0</span>% of statements</span><br></pre></td></tr></table></figure><p>ä¸€æ¨£æœƒç”¢ç”Ÿå‡º <code>cover.out</code>æª”æ¡ˆï¼Œé€™æ™‚å†é€é <code>go tool cover -html</code></p><p><img src="pics/12.png" alt=""><br><img src="https://i.imgur.com/mncGfk7.png" alt=""></p><h3 id="é€²è¡Œå£“åŠ›æ¸¬è©¦-Benchmark-Testing"><a href="#é€²è¡Œå£“åŠ›æ¸¬è©¦-Benchmark-Testing" class="headerlink" title="é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testing"></a>é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testing</h3><p>golangçš„testå·¥å…·äº¦æä¾›benchmarkçš„æ¸¬è©¦ï¼Œå¯ä»¥çœ‹å‡ºè©²æ–¹æ³•éœ€è¦è€—è²»å¤šå°‘CPUè³‡æº</p><h4 id="è¦å‰‡"><a href="#è¦å‰‡" class="headerlink" title="è¦å‰‡"></a>è¦å‰‡</h4><p>éœ€è¦å®šç¾©æ–¹æ³•åç¨±å‰ç¶´ç‚º <code>Benchmark</code> ä¾‹å¦‚:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŒ‡ä»¤-go-test-bench"><a href="#æŒ‡ä»¤-go-test-bench" class="headerlink" title="æŒ‡ä»¤: go test -bench"></a>æŒ‡ä»¤: <code>go test -bench</code></h4><p>è‹¥è¦å°testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆï¼š<br><img src="pics/13.png" alt=""><br><img src="https://i.imgur.com/FPmr2HU.png" alt=""></p><p><code>mylib.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€™æ™‚é€é <code>go test -bench Adder testing_example_2</code>ï¼Œå°<code>testing_example_2</code>é€™å°ˆæ¡ˆå…§æœ‰åŒ…å« <code>Adder</code>çš„å£“æ¸¬æ–¹æ³•é€²è¡Œå£“åŠ›æ¸¬è©¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15</span><br><span class="line">âœ go test -bench Adder testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4        1000000000               0.374 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.433s</span><br></pre></td></tr></table></figure><p>BenchmarkAdder é€™éš»æ–¹æ³•åŸ·è¡Œäº†1000000000æ¬¡, æ¯æ¬¡èŠ±äº† 0.374 ns</p><p>æˆ–æ˜¯ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ–¹æ³•Benchmarkåç¨± <code>go test -bench . testing_example_2</code></p><h4 id="æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š-go-test-benchtime"><a href="#æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š-go-test-benchtime" class="headerlink" title="æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š go test -benchtime"></a>æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š <code>go test -benchtime</code></h4><p>å¯æŒ‡å®šå£“æ¸¬æ¸¬å¤šå°‘æ™‚é–“ï¼Œå¯ä»¥æ“´å±•å£“æ¸¬çš„æ¬¡æ•¸</p><p>èˆ‰ä¾‹ï¼Œåªå£“æ¸¬0.001ç§’ï¼Œé‚£å¯çœ‹åˆ°åªæœƒæ¸¬å‡º 2864049æ¬¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -benchtime 0.001s -bench . testing_example_2</span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: testing_example_2</span><br><span class="line">BenchmarkAdder-4         2864049                 0.485 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      testing_example_2       0.024s</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### æª¢è¦–å£“åŠ›æ¸¬è©¦èŠ±å¤šå°‘è¨˜æ†¶é«”ï¼š `go test -bench . -benchmem`</span><br><span class="line"></span><br><span class="line">é€é `-bemchmem`é€™å€‹flagï¼Œå£“æ¸¬è³‡è¨Šæœƒå¤šäº† `B/op` èˆ‡ `allocs/op` ä¾†æª¢è¦–è©²æ–¹æ³•å£“æ¸¬æ™‚èŠ±äº†å¤šå°‘è¨˜æ†¶é«”è³‡æº</span><br></pre></td></tr></table></figure><p>~/go/src via v1.15<br>âœ go test -bench . -benchmem testing_example_2<br>goos: darwin<br>goarch: amd64<br>pkg: testing_example_2<br>BenchmarkAdder-4        1000000000               0.501 ns/op           0 B/op          0 allocs/op<br>PASS<br>ok      testing_example_2       0.586s<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### ä½¿ç”¨go tool pprof  (performance profiling tool) ç”¢ç”Ÿæ¸¬è©¦å ±å‘Š</span><br><span class="line"></span><br><span class="line">ç”¢å‡ºå ±å‘Šä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£ `graphviz`é€™å€‹å¥—ä»¶ï¼Œé€™æ¨£go toolæ‰èƒ½å¤ ç¹ªè£½æµç¨‹åœ–ä¾›æˆ‘å€‘æŸ¥çœ‹</span><br><span class="line"></span><br><span class="line">Linux/Macos</span><br></pre></td></tr></table></figure></p><p>sudo apt-get install graphyiz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; æ›´å¤šæœ‰é—œgraphyizè³‡è¨Šè«‹åˆ°ï¼š http://graphviz.org</span><br><span class="line">&gt; </span><br><span class="line"></span><br><span class="line">#### ç”¢ç”Ÿç¨‹å¼è¨˜æ†¶é«”èŠ±è²»å ±å‘Š `go test -memprofile`</span><br><span class="line"></span><br><span class="line">ä¸€æ¨£ç”¨testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆåšæ¸¬è©¦</span><br><span class="line"></span><br><span class="line">![](pics/14.png)</span><br><span class="line">![](https://i.imgur.com/FPmr2HU.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`mylib.go`</span><br><span class="line">```go=</span><br><span class="line">package mylib</span><br><span class="line"></span><br><span class="line">func adder(l, r int) int &#123;</span><br><span class="line">return l + r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>mylib_test.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> adder(<span class="number">2</span>, <span class="number">5</span>) != <span class="number">7</span> &#123;</span><br><span class="line">t.Fail()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdder</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">adder(<span class="number">5</span>, <span class="number">7</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€é <code>go test -memprofile mem.out testing_example_2</code> ä¾†ç”¢å‡ºå«åš <code>mem.out</code>çš„æ¸¬è©¦å ±å‘Š</p><p>æ¸¬è©¦çµæœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -memprofile mem.out testing_example_2</span><br><span class="line">ok      testing_example_2       0.018s</span><br></pre></td></tr></table></figure></p><p>ä»¥åŠæœƒç”¢ç”Ÿå…©å€‹æª”æ¡ˆ <code>mem.out</code> èˆ‡ <code>testing_example_2.test</code>ï¼Œå¾Œè€…ä¸»è¦æä¾›çµ¦ go tool pprofæª¢è¦–</p><p><img src="pics/15.png" alt=""><br><img src="https://i.imgur.com/KsJqL24.png" alt=""></p><p>æ¥è‘—é€é <code>go tool pprof</code>æª¢è¦–å…¶å ±å‘Š <code>testing_example_2.test</code>ï¼Œä¸¦æŒ‡å®šç”¨<code>-web</code> ç¶²é çš„æ–¹å¼ç€è¦½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure><p>ä¸éç”±æ–¼ç¯„ä¾‹æª”æ¡ˆè¦æ¨¡å¤ªå°ï¼Œgo toolç„¡æ³•æ•æ‰åˆ°æœ‰ç”¨çš„è³‡è¨Šï¼Œæ‰€ä»¥æŠ“ä¸åˆ°</p><p><img src="pics/16.png" alt=""></p><p>é€™æ™‚å¯ä»¥é€é <code>go test -mmprofilerate n</code>ä¾†æ”¹è®Šè®€å–å ±å‘Šçš„é »ç‡ï¼Œç•¶åŸ·è¡Œnå€‹æŒ‡ä»¤æ™‚ï¼Œå°±ç”¢å‡ºå ±å‘Š</p><p>æ¥è‘—å†æŸ¥çœ‹ä¸€æ¬¡ç”¢å‡ºçš„å ±å‘Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo go tool pprof -web testing_example_2.test mem.out</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æ¯å€‹æ–¹æ³•è©³ç´°çš„è¨˜æ†¶é«”æ¶ˆè€—è³‡è¨Šåœ–</p><p><img src="pics/17.png" alt=""></p><h4 id="ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š-go-test-cpuprofile"><a href="#ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š-go-test-cpuprofile" class="headerlink" title="ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š go test -cpuprofile"></a>ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š <code>go test -cpuprofile</code></h4><p>ä¸€æ¨£å¯ä»¥ç”¢ç”Ÿæ¯å€‹æ–¹æ³•æˆ–packageä½¿ç”¨å¤šå°‘çš„CPUé—œè¯åœ–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/go/src via v1.15 </span><br><span class="line">âœ go test -cpuprofile cpu.out testing_example_2 </span><br><span class="line">ok      testing_example_2       0.224s</span><br></pre></td></tr></table></figure></p><p>ç”¢ç”Ÿå‡º<code>cpu.out</code>èˆ‡<code>testing_example_2.test</code>ï¼Œç„¶å¾Œå¾Œè€…ä¹Ÿæ˜¯é€é <code>pprof</code>æª¢è¦–</p><p><img src="pics/18.png" alt=""></p><p>ä¸éä¹Ÿæ˜¯ä¸€æ¨£æ²’çœ‹åˆ°è±å¯Œçš„æ¸¬è©¦è³‡è¨Šï¼Œå› ç‚ºæ•´å€‹æ¸¬è©¦åªæœ‰åŸ·è¡Œä¸€éï¼Œå°è‡´pprofç„¡æ³•æŠ“åˆ°æœ‰ç”¨çš„è³‡è¨Š</p><p><img src="pics/19.png" alt=""></p><p>é€™æ™‚å¯ä»¥é€é <code>-count</code> å¯ä»¥æ¸¬è©¦å¤šæ¬¡ä»¥å–å¾—è¶³å¤ çš„CPUä½¿ç”¨é‡å ±å‘Š</p><p><code>go test -cpuprofile cpu.out -count 1000000 testing_example_2</code></p><p>åœ¨æŸ¥çœ‹ä¸€éå°±æœƒæœ‰æ–¹æ³•å‘¼å«çš„CPUæ¶ˆè€—æµç¨‹åœ–å¯ä»¥æª¢è¦–äº†</p><p><img src="pics/20.png" alt=""></p><h4 id="ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š-go-test-trace"><a href="#ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š-go-test-trace" class="headerlink" title="ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š go test -trace"></a>ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š <code>go test -trace</code></h4><p>é€é<code>-trace</code>é€™å€‹flag, å¯ä»¥ç”¢å‡ºè¨±å¤šæª¢è¦–ç¨‹å¼çš„åŸ·è¡Œå ±å‘Š</p><p>ä¸€æ¨£é€é <code>go test -trace trace.out testing_example_2</code>ä¾†ç”¢ç”Ÿå«åš <code>trace.out</code>çš„å ±å‘Š</p><p>ä»¥ <code>go tool trace trace.out</code> æª¢è¦–å…§å®¹</p><p><img src="pics/21.png" alt=""></p><p>é»é–‹View traceå¯çœ‹åˆ°å¦‚ä¸‹</p><p><img src="pics/22.png" alt=""></p><h2 id="åƒè€ƒè³‡æº"><a href="#åƒè€ƒè³‡æº" class="headerlink" title="åƒè€ƒè³‡æº"></a>åƒè€ƒè³‡æº</h2><ul><li><p><a href="https://golang.org/cmd/trace/" target="_blank" rel="noopener">Go-Command trace</a></p></li><li><p><a href="https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d" target="_blank" rel="noopener">Using Go 1.10 new trace features to debug an integration test</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨Golangæ’°å¯«Packageçš„Best Practice</title>
      <link href="/2021/02/15/go-package-best-practice/"/>
      <url>/2021/02/15/go-package-best-practice/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹æ”¶éŒ„æ’°å¯«golang packageå¯ä»¥éµå¾ªçš„å…§å®¹</p><h2 id="Package-æ¦‚è¦½"><a href="#Package-æ¦‚è¦½" class="headerlink" title="Package æ¦‚è¦½"></a>Package æ¦‚è¦½</h2><p>ä¸€å€‹Go Pakcageçš„åŸºæœ¬å…ƒç´ åŒ…å«äº†å¦‚ä¸‹ï¼š</p><ul><li>Package declaration: åŸºæœ¬å®šç¾©ï¼Œå‘Šè¨´developer packageçš„åŠŸèƒ½æ˜¯ä»€éº¼</li><li>Documentation: æä¾›Packageå…§æ‰€åŒ…å«çš„functionæ˜¯ä»€éº¼ï¼Œè¦å¦‚ä½•ä½¿ç”¨</li><li>Imports: å¦‚ä½•å¼•å…¥pakcageå…§çš„function</li><li>var &amp; const blocks: ä½¿ç”¨çš„è®Šæ•¸å®£å‘Š</li><li>Types &amp; interfaces: å®šç¾©packageå…§æœƒä½¿ç”¨çš„å‹æ…‹ä»¥åŠä»‹é¢</li><li>Functions: functionsçš„å¯¦ä½œ<h3 id="Packageçš„ç¯„åœï¼šä¸€å€‹è³‡æ–™å¤¾å…§çš„æ‰€æœ‰-goæª”æ¡ˆï¼Œå…¶ä»–é™¤å¤–"><a href="#Packageçš„ç¯„åœï¼šä¸€å€‹è³‡æ–™å¤¾å…§çš„æ‰€æœ‰-goæª”æ¡ˆï¼Œå…¶ä»–é™¤å¤–" class="headerlink" title="Packageçš„ç¯„åœï¼šä¸€å€‹è³‡æ–™å¤¾å…§çš„æ‰€æœ‰.goæª”æ¡ˆï¼Œå…¶ä»–é™¤å¤–"></a>Packageçš„ç¯„åœï¼šä¸€å€‹è³‡æ–™å¤¾å…§çš„æ‰€æœ‰<code>.go</code>æª”æ¡ˆï¼Œå…¶ä»–é™¤å¤–</h3>åŸºæœ¬ä¸Šä¸€å€‹Go PackageåªæœƒåŒ…å«å–®ä¸€ç›®éŒ„å…§æ‰€æœ‰çš„Go Source.</li></ul><p>èˆ‰å€‹ä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---services</span><br><span class="line"> |--- events (Package)</span><br><span class="line">   |-- data (è³‡æ–™å¤¾)</span><br><span class="line">   |-- handlers.go</span><br><span class="line">   |-- serve.go</span><br></pre></td></tr></table></figure><p>ä¸Šé¢<code>events</code>é€™å€‹packageï¼ŒåªæœƒåŒ…å« <code>handlers.go</code> ä»¥åŠ <code>serve.go</code> é€™å…©éš»æª”æ¡ˆçš„å…§å®¹ï¼Œ<code>data</code>è³‡æ–™å¤¾æœƒè¢«æ’é™¤</p><h2 id="Packageç¨®é¡"><a href="#Packageç¨®é¡" class="headerlink" title="Packageç¨®é¡"></a>Packageç¨®é¡</h2><h3 id="Library-Packages"><a href="#Library-Packages" class="headerlink" title="Library Packages"></a>Library Packages</h3><p>å®šç¾©Golang Packageçš„å…§å®¹ï¼Œæä¾›ç›¸åŒåŠŸèƒ½æ€§çš„functionã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .../services</span></span><br><span class="line"><span class="keyword">package</span> services</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>Library Pakcageé€šå¸¸è¢«å…¶ä»–çš„packageæ‰€å¼•å…¥é€²ä¾†</li><li>Library Packageçš„åç¨±å¿…é ˆè¦è·Ÿè‡ªå·±çš„è³‡æ–™å¤¾åç¨±ä¸€æ¨£</li><li>pakcageå…§çš„æœ€å¥½æ˜¯æä¾›ç›¸ä¼¼çš„åŠŸèƒ½<h3 id="Main-Package"><a href="#Main-Package" class="headerlink" title="Main Package"></a>Main Package</h3></li></ul><p>å®šç¾©äº†Applicationçš„é€²å…¥é»ï¼Œç¨‹å¼è¦å•Ÿå‹•å°±æœƒæ˜¯å¾main packageé–‹å§‹ï¼Œæ³¨é‡åœ¨appçš„è¨­ç½®ä»¥åŠåˆå§‹åŒ–çš„é‚è¼¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒ…å« main() function</li><li>å¯ä»¥åœ¨ä»»ä½•çš„è³‡æ–™å¤¾</li></ul><h3 id="ç¯„ä¾‹"><a href="#ç¯„ä¾‹" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h3><p><code>http</code> package: <a href="https://golang.org/pkg/net/http/" target="_blank" rel="noopener">https://golang.org/pkg/net/http/</a></p><ul><li>Constants: å®šç¾©å¸¸æ•¸å…§å®¹</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    StatusContinue           = <span class="number">100</span> <span class="comment">// RFC 7231, 6.2.1</span></span><br><span class="line">    StatusSwitchingProtocols = <span class="number">101</span> <span class="comment">// RFC 7231, 6.2.2</span></span><br><span class="line">    StatusProcessing         = <span class="number">102</span> <span class="comment">// RFC 2518, 10.1</span></span><br><span class="line">    StatusEarlyHints         = <span class="number">103</span> <span class="comment">// RFC 8297</span></span><br><span class="line"></span><br><span class="line">    StatusOK                   = <span class="number">200</span> <span class="comment">// RFC 7231, 6.3.1</span></span><br><span class="line">    StatusCreated              = <span class="number">201</span> <span class="comment">// RFC 7231, 6.3.2</span></span><br><span class="line">    StatusAccepted             = <span class="number">202</span> <span class="comment">// RFC 7231, 6.3.3</span></span><br><span class="line">    StatusNonAuthoritativeInfo = <span class="number">203</span> <span class="comment">// RFC 7231, 6.3.4</span></span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li><p>Variables: å®šç¾©è®Šæ•¸å…§å®¹ï¼Œä¸”çµ¦äºˆèªªæ˜</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    <span class="comment">// ErrNotSupported is returned by the Push method of Pusher</span></span><br><span class="line">    <span class="comment">// implementations to indicate that HTTP/2 Push support is not</span></span><br><span class="line">    <span class="comment">// available.</span></span><br><span class="line">    ErrNotSupported = &amp;ProtocolError&#123;<span class="string">"feature not supported"</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Deprecated: ErrUnexpectedTrailer is no longer returned by</span></span><br><span class="line">    <span class="comment">// anything in the net/http package. Callers should not</span></span><br><span class="line">    <span class="comment">// compare errors against this variable.</span></span><br><span class="line">    ErrUnexpectedTrailer = &amp;ProtocolError&#123;<span class="string">"trailer header without chunked transfer encoding"</span>&#125;</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>Types: å®šç¾©å®¢è£½åŒ–å‹æ…‹ï¼Œä¸¦çµ¦äºˆèªªæ˜</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Client is an HTTP client. Its zero value (DefaultClient) is a usable client that uses DefaultTransport. ...</span></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// Transport specifies the mechanism by which individual</span></span><br><span class="line">    <span class="comment">// HTTP requests are made.</span></span><br><span class="line">    <span class="comment">// If nil, DefaultTransport is used.</span></span><br><span class="line">    Transport RoundTripper</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>ä¹Ÿæä¾›äº†Clinetå½¢æ…‹çš„åˆå§‹åŒ–è®Šæ•¸è¨­ç½®ï¼Œä¸ç”¨ä¸€ç›´è‡ªè¡Œåˆå§‹åŒ–<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultClient is the default Client and is used by Get, Head, and Post.</span></span><br><span class="line"><span class="keyword">var</span> DefaultClient = &amp;Client&#123;&#125;</span><br></pre></td></tr></table></figure></p><ul><li>Function: å®šç¾©functionå…§å®¹ï¼Œä¸¦æ·»åŠ èªªæ˜</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CanonicalHeaderKey returns the canonical format of the header key s. The canonicalization converts the first letter and any letter following a hyphen to upper case; the rest are converted to lowercase. For example, the canonical key for "accept-encoding" is "Accept-Encoding". If s contains a space or invalid header field bytes, it is returned without modifications.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CanonicalHeaderKey</span></span> &#123;...&#125;</span><br></pre></td></tr></table></figure><h2 id="Pakcage-çš„ç”Ÿå‘½é€±æœŸ"><a href="#Pakcage-çš„ç”Ÿå‘½é€±æœŸ" class="headerlink" title="Pakcage çš„ç”Ÿå‘½é€±æœŸ"></a>Pakcage çš„ç”Ÿå‘½é€±æœŸ</h2><ol><li>Import æ‰€éœ€è¦çš„package</li><li>å°‡initial valueè¨­ç½®åœ¨variables</li><li>å‘¼å« <code>init()</code> æ–¹æ³•ï¼ŒåŸ·è¡Œåˆå§‹åŒ–è©²packageçš„å‹•ä½œ</li></ol><blockquote><p>æ³¨æ„ï¼Œç„¡æ³•ç›´æ¥å‘¼å« <code>init()</code> ï¼Œè©²æ–¹æ³•åªèƒ½åœ¨golangçš„compileræ™‚æœŸè¢«golangå‘¼å«åŸ·è¡Œã€‚</p></blockquote><h3 id="ç¯„ä¾‹-1"><a href="#ç¯„ä¾‹-1" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h3><p>å‡å¦‚æœ‰å€‹ç›®éŒ„å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- cmd</span><br><span class="line"> |--- startAll</span><br><span class="line"> |   |- main.go</span><br><span class="line"> |--- services</span><br><span class="line">     |- handlers.go</span><br><span class="line">     |- serve.go</span><br><span class="line"> |--- internal</span><br><span class="line">     |--- ports</span><br><span class="line">        |--- ports.go</span><br></pre></td></tr></table></figure></p><p>è‹¥ <code>main.go</code> import <code>services</code> é€™å€‹package</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Package events provides a webservice that manages the libary's special events.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> events</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/pluralsight/libmanager/services/internal/ports"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> port = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StartServer registers the handlers and initiates the web service.</span></span><br><span class="line"><span class="comment">// The service is started on the local machine with the port specified by</span></span><br><span class="line"><span class="comment">// .../lm/services/internal/ports#EventService</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartServer</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">sm := http.NewServeMux()</span><br><span class="line">sm.Handle(<span class="string">"/"</span>, <span class="built_in">new</span>(eventHandler))</span><br><span class="line"><span class="keyword">return</span> http.ListenAndServe(<span class="string">":"</span>+strconv.Itoa(port), sm)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"serve.go 1"</span>, port)</span><br><span class="line">port = ports.EventService</span><br><span class="line">fmt.Println(<span class="string">"serve.go 2"</span>, port)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"second init in serve.go"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°init() å¯ä»¥å¤šæ¬¡å®£å‘Š</p></blockquote><p>æ­¤æ™‚<code>main.go</code>å‘¼å«<code>services</code> pakcageå…§çš„<code>startServer</code> function</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package main is typically used to define a single, executable command and its associated logic.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Functions in the main package should normally avoid containing business logic; they</span></span><br><span class="line"><span class="comment">// should focus on initializing the application and handling any errors that are returned by</span></span><br><span class="line"><span class="comment">// any library calls.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/pluralsight/libmanager/services/events"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"init in main.go"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The main function, when defined in a main package, defines</span></span><br><span class="line"><span class="comment">// the entry and exit point for an executable command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Println(<span class="string">"Starting all services"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// start the services</span></span><br><span class="line">wg := <span class="built_in">new</span>(sync.WaitGroup)</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">// åŸ·è¡Œ events packageå…§çš„StartServeræ–¹æ³•</span></span><br><span class="line"><span class="keyword">go</span> startServer(wg, events.StartServer)</span><br><span class="line">wg.Wait()</span><br><span class="line">log.Println(<span class="string">"All services stopped"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// startServer is a function in the main package that supports the command.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startServer</span><span class="params">(wg *sync.WaitGroup, startFunc <span class="keyword">func</span>()</span> <span class="title">error</span>)</span> &#123;</span><br><span class="line">err := startFunc()</span><br><span class="line">wg.Done()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„ï¼Œservices importäº†internalå…§<code>ports</code> packageçš„è®Šæ•¸ï¼Œæ•…è‹¥å‘¼å«äº†<code>main.go</code> ä¸­çš„startServerï¼Œæœƒå…ˆå°å‡ºåˆå§‹åŒ–çš„<code>port = 42</code>, å†ä¾†æ˜¯é€é<code>init()</code>æ¥æ”¶åˆ°ports packageçš„ <code>port = 3000</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">fmt.Println(&quot;serve.go 1&quot;, port)</span><br><span class="line">port = ports.EventService</span><br><span class="line">fmt.Println(&quot;serve.go 2&quot;, port)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°å‡ºå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">serve.go 1 42</span><br><span class="line">serve.go 2 3000</span><br><span class="line">second init in serve.go</span><br></pre></td></tr></table></figure></p><h2 id="Pakcage-å­˜å–ç¯„ç–‡"><a href="#Pakcage-å­˜å–ç¯„ç–‡" class="headerlink" title="Pakcage å­˜å–ç¯„ç–‡"></a>Pakcage å­˜å–ç¯„ç–‡</h2><ul><li>Public Scope<ul><li>ä»¥å¤§å¯«å®£å‘Š</li><li>å¯è¢«å°ˆæ¡ˆå…§æ‰€æœ‰æˆå“¡å­˜å–</li></ul></li><li>Package Scope<ul><li>ä»¥å°å¯«å®£å‘Š</li><li>åªèƒ½è¢«åŒä¸€å€‹packageå…§å­˜å–</li></ul></li><li>Internal Package<ul><li>å¯åŒæ™‚ä½¿ç”¨public-level, package-level çš„æˆå“¡</li><li>åªé™æ–¼çˆ¶å±¤èˆ‡å­å±¤çš„æˆå“¡å­˜å–</li></ul></li></ul><h2 id="Pakcageè¨­è¨ˆçš„Best-Practice"><a href="#Pakcageè¨­è¨ˆçš„Best-Practice" class="headerlink" title="Pakcageè¨­è¨ˆçš„Best Practice"></a>Pakcageè¨­è¨ˆçš„Best Practice</h2><h3 id="Pakcage-åç¨±"><a href="#Pakcage-åç¨±" class="headerlink" title="Pakcage åç¨±"></a>Pakcage åç¨±</h3><ul><li>å„˜é‡ç°¡çŸ­ï¼Œä½¿ç”¨åè©</li><li>å°å¯«é–‹é ­ï¼Œä¸ä½¿ç”¨ <code>_</code>, <code></code>ç­‰ç‰¹æ®Šå­—å…ƒ</li><li>åˆ¥ä½¿ç”¨ä¸€èˆ¬ä½¿ç”¨è€…æœƒç”¨åˆ°çš„è®Šæ•¸åç¨± <code>event</code>, <code>temp</code> ç­‰åè©ä¾†å‘½å.</li></ul><h3 id="Package-èªªæ˜"><a href="#Package-èªªæ˜" class="headerlink" title="Package èªªæ˜"></a>Package èªªæ˜</h3><p>ä¸€å€‹å…¬é–‹çš„pakcageé€šå¸¸æœƒåŒ…å«å…©å€‹ä¸»è¦èªªæ˜å…§å®¹</p><ul><li>licensing: ä½¿ç”¨çš„é–‹æ”¾å”è­°</li><li>package comment: packageçš„åŠŸèƒ½èªªæ˜</li><li>èªªæ˜é–‹é ­æ‡‰åŒ…å« packageåç¨±ï¼Œæ–¹æ³•çš„è©±é–‹é ­æœƒfunctionçš„åç¨±</li></ul><p><code>helloworld/doc.go</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2009 The Go Authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by sa BSD-style</span></span><br><span class="line"><span class="comment">// license that can be found in the LICENSE file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package helloworld implements ....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld</span><br></pre></td></tr></table></figure></p><p>é€™æ™‚ä½¿ç”¨ <code>go doc helloworld</code>ï¼Œå°±æœƒé¡¯ç¤º <code>helloworld</code> packageå…§<code>doc.go</code>çš„èªªæ˜</p><h4 id="ä½¿ç”¨-doc-go-åšæ›´è¤‡é›œçš„èªªæ˜"><a href="#ä½¿ç”¨-doc-go-åšæ›´è¤‡é›œçš„èªªæ˜" class="headerlink" title="ä½¿ç”¨ doc.go åšæ›´è¤‡é›œçš„èªªæ˜"></a>ä½¿ç”¨ <code>doc.go</code> åšæ›´è¤‡é›œçš„èªªæ˜</h4><p>è‹¥æœ‰å¤ªå¤šçš„packageæ•˜è¿°è¦å‘ˆç¾ï¼Œé€šå¸¸æœƒåœ¨<code>doc.go</code> èªªæ˜</p><p><img src="./pics/pic01.png" alt="pic01"></p><h3 id="Pakcageå…§å®¹çš„æè¿°æ’°å¯«æŒ‡å¼•"><a href="#Pakcageå…§å®¹çš„æè¿°æ’°å¯«æŒ‡å¼•" class="headerlink" title="Pakcageå…§å®¹çš„æè¿°æ’°å¯«æŒ‡å¼•"></a>Pakcageå…§å®¹çš„æè¿°æ’°å¯«æŒ‡å¼•</h3><ul><li>é¿å…å†—ä½™</li></ul><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„packageåç¨±èˆ‡functionåç¨±éƒ½é‡è¤‡äº†ï¼Œæ‰€ä»¥å¯ä»¥å°‡functionåç¨±èˆ‡packageé‡è¤‡çš„éƒ¨åˆ†çµ¦å»æ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.HTTPServer -&gt; http.server</span><br><span class="line">json.JSONEncoder -&gt; json.encoder</span><br></pre></td></tr></table></figure></p><ul><li>ç›¡é‡ç°¡åŒ–</li></ul><p>ä¾‹å¦‚ï¼Œä¸‹é¢å¯ä»¥ç°¡åŒ–æˆå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time.NewTime -&gt; time.Time</span><br><span class="line">db.ConnectToDatabase -&gt; db.Connect</span><br></pre></td></tr></table></figure></p><h3 id="Packageå…§å®¹æº–å‰‡"><a href="#Packageå…§å®¹æº–å‰‡" class="headerlink" title="Packageå…§å®¹æº–å‰‡"></a>Packageå…§å®¹æº–å‰‡</h3><ul><li>æä¾›ç›´è¦ºçš„åŠŸèƒ½<ul><li>single reponsibility: å–®ä¸€åŠŸèƒ½</li><li>cohesive API: åŠŸèƒ½ç›¸ä¾çš„Application Programming Interface</li></ul></li><li>æä¾›å‹å–„çš„ä½¿ç”¨æ–¹æ³•<ul><li>simple to use</li><li>minimize API: å°‡åŠŸèƒ½é‡é»åŒ–</li><li>encapsulate changes: å°‡è®Šå‹•å°è£èµ·ä¾†ï¼Œä¸å½±éŸ¿åŸæœ¬ä½¿ç”¨è€…çš„input, outputçš„ä½¿ç”¨æ–¹å¼</li></ul></li><li>æœ€å¤§åŒ–å¯é‡è¤‡åˆ©ç”¨æ€§<ul><li>reduce dependencies: æ¸›å°‘ä¾è³´å…¶ä»–dependenciesçš„ç‹€æ³</li><li>minimize scope: ç¸®å°ç¯„ç–‡ï¼Œé¿å…åˆ°è™•éƒ½æ˜¯publicï¼Œé€ æˆpackageå…§éƒ¨çš„è®Šæ•¸è¢«å…¶ä»–åœ°æ–¹æ‰€å½±éŸ¿ã€‚</li></ul></li></ul><h3 id="çµæ§‹è¨­è¨ˆ"><a href="#çµæ§‹è¨­è¨ˆ" class="headerlink" title="çµæ§‹è¨­è¨ˆ"></a>çµæ§‹è¨­è¨ˆ</h3><table><thead><tr><th>Package Input</th><th>Package Output</th></tr></thead><tbody><tr><td>å°æ–¼configurationä½¿ç”¨ concrete types</td><td>å°æ–¼configuration &amp; behavior éƒ½ä½¿ç”¨concrete types</td></tr><tr><td>å°æ–¼behavior ä½¿ç”¨ interface</td><td>å°æ–¼errors è«‹é¿å…ä¸ç™¼ç”Ÿ panics: å› ç‚ºéŒ¯èª¤å³ä½¿ç™¼ç”Ÿäº†ï¼Œä½¿ç”¨è€…ä¹Ÿç„¡æ³•å°å…¶åšè™•ç†</td></tr></tbody></table><p>é€é <code>http</code> packageä¾†çœ‹çœ‹å…¶çµæ§‹è¨­è¨ˆ</p><table><thead><tr><th>Package Input</th><th>Package Output</th></tr></thead><tbody><tr><td><code>net/http.Request</code> å°æ–¼http.Reqeustæ‰€è¦ä½¿ç”¨çš„configurationï¼Œä¾‹å¦‚http bodyè¦ç”¨çš„åƒæ•¸æ ¼å¼æ˜¯ä»€éº¼ï¼Œä½¿ç”¨ concrete typesï¼Œæ˜ç¢ºè¦ç¯„ä½¿ç”¨è€…è¦æ”¾ç½®ä»€éº¼çµ¦package</td><td><code>net/http.Response</code> å°æ–¼å…¶å›å‚³çµæœï¼Œå°‡configuration &amp; behavior éƒ½ä½¿ç”¨concrete typeså®šç¾©å¥½ï¼Œé¿å…ä½¿ç”¨è€…æ··æ·†</td></tr><tr><td><code>net/http.Handler</code> å°æ–¼http.Handler, é€™å€‹è™•ç†httpçš„behavior ä½¿ç”¨ interfaceï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¯ä»¥é‡å°ä»–å€‘è‡ªå·±çš„http Requesté€²ä¾†çš„è¡Œç‚ºå®šç¾©è‡ªå·±çš„å‹æ…‹</td><td><code>net/http.Get</code> æ­£å¸¸ç‹€æ³ä¸‹ (ç”¨æˆ¶æ­£ç¢ºä½¿ç”¨ä¸‹)ï¼Œç”¨æˆ¶ä½¿ç”¨å…¶æ–¹æ³•æ˜¯ä¸æœƒç™¼ç”Ÿpanicçš„</td></tr></tbody></table><h2 id="Import-Packageæ–¹æ³•"><a href="#Import-Packageæ–¹æ³•" class="headerlink" title="Import Packageæ–¹æ³•"></a>Import Packageæ–¹æ³•</h2><h3 id="1-Typical-Imports"><a href="#1-Typical-Imports" class="headerlink" title="1. Typical Imports"></a>1. Typical Imports</h3><p>ä½¿ç”¨<code>fmt</code> pakcageçš„ <code>Println</code> function<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"hello, gophers!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-Alternative-Imports"><a href="#2-Alternative-Imports" class="headerlink" title="2. Alternative Imports"></a>2. Alternative Imports</h3><ul><li>Aliases å°‡pakcege åˆ¥å</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€™æ™‚æœƒå¼•å…¥äº†å…©å€‹å«åšjsonçš„pakcage, compileræœƒå‡ºç¾æ··æ·†</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"encoding/json"</span></span><br><span class="line">   <span class="string">"pluralsight.com/libmanager/json"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  data, err := json.Marshal(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯é€é alias ï¼Œå°‡å…¶ä¸­ä¸€å€‹packageåç¨±é€²è¡Œåˆ¥å</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"encode/json"</span></span><br><span class="line">  lmjson <span class="string">"pluralsight.com/libmanager/json"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="3-Import-for-side-effect-ç‚ºå¼•å…¥çš„packageï¼Œåœ¨å¼•å…¥å…¶ä»–çš„packageä½¿å…¶ä½œç”¨"><a href="#3-Import-for-side-effect-ç‚ºå¼•å…¥çš„packageï¼Œåœ¨å¼•å…¥å…¶ä»–çš„packageä½¿å…¶ä½œç”¨" class="headerlink" title="3. Import for side effect: ç‚ºå¼•å…¥çš„packageï¼Œåœ¨å¼•å…¥å…¶ä»–çš„packageä½¿å…¶ä½œç”¨"></a>3. Import for side effect: ç‚ºå¼•å…¥çš„packageï¼Œåœ¨å¼•å…¥å…¶ä»–çš„packageä½¿å…¶ä½œç”¨</h3><p>é€™æœ‰é»é›£ç†è§£ï¼Œç›´æ¥çœ‹ç¯„ä¾‹</p><p>ä¾‹å¦‚ä»¥ä¸‹æœ‰å¼•å…¥å…©å€‹packages, ä¸€å€‹æ˜¯<code>sql</code> package, å¦å¤–ä¸€å€‹æ˜¯ <code>pq</code> postgresé€™å€‹è³‡æ–™åº«çš„package.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"database/sql"</span></span><br><span class="line">  _ <span class="string">"github.com/lib/pq"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° <code>pq</code> æ˜¯ç”¨ <code>_</code> ä»£è¡¨ä»–æ˜¯ä¸€å€‹write onlyçš„package, æœ¬èº«ä½¿ç”¨è€…ä¸æœƒå»ä½¿ç”¨åˆ°å®ƒï¼Œè€Œæ˜¯æä¾›çµ¦ <code>sql</code> åšåˆå§‹åŒ–sqlå…§è¦æ¡ç”¨å“ªå€‹databaseåšä½¿ç”¨</p><p>å¯ä»¥çœ‹åˆ° <a href="https://github.com/lib/pq/blob/master/conn.go" target="_blank" rel="noopener">pg</a> packageå…§ æœ‰é€™ä¸€æ®µç¨‹å¼ç¢¼ï¼Œæä¾›<code>init()</code>çµ¦sqlåšæ³¨å…¥ä½¿ç”¨å…¶postgres dirveråšä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">sql.Register(<span class="string">"postgres"</span>, &amp;Driver&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Internal-packages"><a href="#4-Internal-packages" class="headerlink" title="4. Internal packages"></a>4. Internal packages</h3><p>ä¸»è¦æä¾›çˆ¶å±¤èˆ‡å­å±¤çš„pakcageåšå­˜å–ï¼Œç›®çš„æ˜¯è¦æä¾›è·³è„«è‡ªå·±ä¹‹å¤–çš„å­˜å–é™åˆ¶ï¼Œåˆä¸æœƒæ´©æ¼è‡ªå·±å…§éƒ¨è¨Šæ¯çµ¦å¤–éƒ¨ä½¿ç”¨è€…ã€‚</p><p>åªè¦æ˜¯å®£å‘Šç‚º <code>internal</code> çš„packageï¼Œå°±å¯ä»¥è¢«çˆ¶å±¤æˆ–å­å±¤å­˜å–</p><p>ä»¥ä¸‹ç¯„ä¾‹ç‚ºï¼Œ<code>services</code> ä¸‹æœ‰å®£å‘Š <code>internal</code> package, å¯æä¾›å…¶ä»–package <code>services/events/serve.go</code> åšå­˜å–ä½¿ç”¨</p><p><img src="pics/pic04.png" alt="pic04"></p><p>è‹¥åœ¨è¶…å‡ºinternalå®šç¾©çš„ç¯„ç–‡ (ä¸Šä¸€å€‹å±¤ç´šèˆ‡ä¸‹ä¸€å€‹å±¤ç´š)ï¼Œå‰‡æœƒcompilerç·¨è­¯æ™‚æœƒç™¼ç”ŸéŒ¯èª¤è¨Šæ¯</p><p><img src="pics/pic02.png" alt="pic02"></p><p><img src="pics/pic03.png" alt="pic03"></p><h3 id="4-Relative-Import"><a href="#4-Relative-Import" class="headerlink" title="4. Relative Import"></a>4. Relative Import</h3><p>é€é <code>../../package</code> çš„æ–¹å¼importï¼Œä¸éåœ¨Productionç’°å¢ƒä¸‹ä¸å»ºè­°ä½¿ç”¨; æˆ–è€…å¾—é€égolangæœ€æ–°çš„ <code>go mod</code> ç®¡ç†æ–¹å¼ã€‚</p><h2 id="åƒè€ƒè³‡æº"><a href="#åƒè€ƒè³‡æº" class="headerlink" title="åƒè€ƒè³‡æº"></a>åƒè€ƒè³‡æº</h2><ul><li><p><a href="https://app.pluralsight.com/library/courses/go-packages-deep-dive/description" target="_blank" rel="noopener">Pluralsight: Deep Dive into Go Packages by Mike Van Sickle </a></p></li><li><p><a href="https://github.com/lib/pq/blob/master/conn.go" target="_blank" rel="noopener">lib/pq/conn.go</a></p></li><li><p><a href="https://stackoverflow.com/questions/38517593/relative-imports-in-go" target="_blank" rel="noopener">Stackoverflow: Relative imports in Go</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go newèˆ‡makeçš„ä»‹ç´¹èˆ‡å·®ç•° [Golang]</title>
      <link href="/2020/11/08/Go-new%E8%88%87make%E7%9A%84%E4%BB%8B%E7%B4%B9%E8%88%87%E5%B7%AE%E7%95%B0/"/>
      <url>/2020/11/08/Go-new%E8%88%87make%E7%9A%84%E4%BB%8B%E7%B4%B9%E8%88%87%E5%B7%AE%E7%95%B0/</url>
      
        <content type="html"><![CDATA[<p>Golangä¸­ï¼Œ<code>make</code>èˆ‡<code>new</code>éƒ½æ˜¯å»ºæ§‹è®Šæ•¸ä¾†ä½¿ç”¨</p><a id="more"></a><h2 id="newçš„ä»‹ç´¹"><a href="#newçš„ä»‹ç´¹" class="headerlink" title="newçš„ä»‹ç´¹"></a>newçš„ä»‹ç´¹</h2><p>new(T)æœƒå»ºæ§‹ä¸€å€‹Tå‹åˆ¥çš„ â€œæ²’æœ‰åå­—â€ çš„è®Šæ•¸ï¼Œä»¥Tçš„zeroed valueä¾†åˆå§‹åŒ–Tï¼Œä¸”new(T) å›å‚³ â€œæŒ‡å‘Tçš„æŒ‡æ¨™â€</p><ul><li>è‹¥Tæ˜¯ stringï¼Œé‚£zeroedå€¼ç‚º <code>&quot;&quot;</code></li><li>è‹¥Tæ˜¯ intï¼Œé‚£zeroedå€¼ç‚º <code>0</code></li><li>è‹¥Tæ˜¯ channel, func, map, sliceï¼Œé‚£zeroedå€¼ç‚º <code>nil</code></li></ul><h3 id="ç¯„ä¾‹"><a href="#ç¯„ä¾‹" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p := <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// å®£å‘Šä¸€å€‹æŒ‡å‘intä¸å…·åè®Šæ•¸çš„`æŒ‡æ¨™p`ï¼Œ`æŒ‡æ¨™p`æŒ‡å‘ä¸€å€‹åˆå§‹åŒ–çš„zeroed valueç‚º0</span></span><br><span class="line"></span><br><span class="line">fmt.Print(*p) <span class="comment">// å°å‡º 0</span></span><br><span class="line"></span><br><span class="line">*p = <span class="number">2</span> <span class="comment">// å°‡ä¸å…·åè®Šæ•¸çš„å€¼è¨­ç½®ç‚º2</span></span><br><span class="line"></span><br><span class="line">fmt.Print(*p) <span class="comment">// å°å‡º 2</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­newç®—æ˜¯golangèªæ³•çš„ç°¡å¯«ï¼Œå…¶ä¸­<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newInt</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å°±ç­‰æ–¼ä¸‹åˆ—å¯«æ³•<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newInt</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> dummy <span class="keyword">int</span></span><br><span class="line">  <span class="keyword">return</span> &amp;dummy   <span class="comment">// å›å‚³dummyçš„æŒ‡æ¨™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ³¨æ„-è¬¹æ…æ“ä½œnewå‡ºä¾†çš„map"><a href="#æ³¨æ„-è¬¹æ…æ“ä½œnewå‡ºä¾†çš„map" class="headerlink" title="æ³¨æ„: è¬¹æ…æ“ä½œnewå‡ºä¾†çš„map"></a>æ³¨æ„: è¬¹æ…æ“ä½œnewå‡ºä¾†çš„map</h3><p>å› ç‚ºç”¨<code>new</code>åˆå§‹åŒ–çš„mapæœƒæ˜¯ nil mapï¼Œæ•…ä»¥ä¸‹æ“ä½œæœƒå‡ºç¾panic</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  book := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) </span><br><span class="line">  <span class="comment">// å®£å‘Šä¸€å€‹æŒ‡æ¨™å«åšbook, æŒ‡å‘ä¸€å€‹mapç‚ºindexæ˜¯string</span></span><br><span class="line">  <span class="comment">// æ˜ å°„åˆ°stringå‹æ…‹çš„bookåç¨±</span></span><br><span class="line"></span><br><span class="line">  b := *book  <span class="comment">// å–å¾—bookæŒ‡æ¨™æ‰€æŒ‡å‘çš„map</span></span><br><span class="line">  b[<span class="string">"ISBN-001"</span>] = <span class="string">"go programming language"</span> <span class="comment">// panic: assignment to entry in nil map</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç¯„ä¾‹æœƒå‡ºéŒ¯çš„åŸå› æ˜¯å› ç‚ºï¼Œ bæ˜¯ä¸€å€‹nil mapï¼Œæ²’æœ‰æŒ‡å‘ä»»ä½•çš„è¨˜æ†¶é«”ä½ç½®ï¼Œæ‰€ä»¥å°ä¸€å€‹nilå€¼æ“ä½œç•¶ç„¶æœƒå†’å‡ºerror</p><p>è§£æ³•å°±å¾—é€é <code>make</code> æ–¹æ³•ç‚ºnil mapåˆ†é…ç¢ºå®šçš„å…§å­˜åœ°å€äº†</p><h3 id="new-ä¸æ˜¯-Keyword"><a href="#new-ä¸æ˜¯-Keyword" class="headerlink" title="new ä¸æ˜¯ Keyword"></a><code>new</code> ä¸æ˜¯ Keyword</h3><p>è¦æ³¨æ„ä¸€é»æ˜¯ <code>new</code> ä¸¦éæ˜¯golangçš„é—œéµå­—ï¼Œæ•…å¯ä»¥åœ¨funcå…§é‡æ–°å®£å‘Š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">delta</span><span class="params">(old, <span class="built_in">new</span> <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">new</span> - old</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="makeçš„ä»‹ç´¹"><a href="#makeçš„ä»‹ç´¹" class="headerlink" title="makeçš„ä»‹ç´¹"></a>makeçš„ä»‹ç´¹</h2><ul><li><code>make(T, args)</code>ç”¨ä¾†ç‚º <code>slices</code>, <code>maps</code>, ä»¥åŠ <code>channel</code>åˆ†é…å…¶è¨˜æ†¶é«”ä½å€çš„ç©ºé–“èˆ‡åˆå§‹åŒ–å€¼ï¼Œä¸¦å›å‚³ä¸€å€‹å‹æ…‹<code>T</code>çš„åƒè€ƒï¼</li><li>makeä¸æœƒå›å‚³æŒ‡æ¨™ï¼</li></ul><h3 id="ç¯„ä¾‹-1"><a href="#ç¯„ä¾‹-1" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  books := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">100</span>) <span class="comment">// åˆå§‹åŒ–é•·åº¦ç‚º100çš„bookå­—ä¸²é™£åˆ—ï¼Œæ¯å€‹arrayå…§çš„å€¼éƒ½æ˜¯ ""</span></span><br><span class="line">  </span><br><span class="line">  receiver := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>) <span class="comment">// åˆå§‹åŒ–channelï¼Œä½†ä¸æœƒå›å‚³æŒ‡æ¨™</span></span><br><span class="line">  booksMapper := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±æ–¼<code>make</code>å›å‚³çš„æ˜¯åƒè€ƒï¼Œæ‰€ä»¥è‹¥å°‡makeå®£å‘Šçš„<code>s2</code> å‚³çµ¦func <code>modifySlice</code>å°<code>s2</code>åšä¿®æ”¹æ™‚ï¼Œä¹Ÿæœƒå½±éŸ¿<code>s2</code>çš„å…§å®¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifySlice</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    s[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s2 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">fmt.Printf(<span class="string">"%#v"</span>, s2) <span class="comment">// s2ç‚º []int&#123;0, 0, 0&#125;</span></span><br><span class="line">modifySlice(s2)</span><br><span class="line">fmt.Printf(<span class="string">"%#v"</span>, s2) <span class="comment">// s2è¢«modifySlice()æ–¹æ³•çµ¦è®Šæˆ []int&#123;1, 0, 0&#125;</span></span><br></pre></td></tr></table></figure><h2 id="newèˆ‡makeçš„å·®ç•°"><a href="#newèˆ‡makeçš„å·®ç•°" class="headerlink" title="newèˆ‡makeçš„å·®ç•°"></a>newèˆ‡makeçš„å·®ç•°</h2><ul><li>newæœƒå›å‚³æŒ‡æ¨™ï¼Œä½†æ˜¯åˆå§‹åŒ–çš„å€¼ç‚ºzeroed valueï¼Œç‰¹åˆ¥æ˜¯åœ¨å°mapåšåˆå§‹åŒ–æ™‚ï¼Œå…¶zeroed valuedç‚º <code>nil</code>ï¼Œæ„æ€å°±æ˜¯ä¸æœƒåˆ†é…å…¶è¨˜æ†¶é«”ä½ç½®</li><li>makeåªèƒ½ç”¨ä¾†å°ç‰¹åˆ¥å‹æ…‹(å¦‚map, slice, func, channle)åˆ†é…å…¶è¨˜æ†¶é«”å…§å­˜åœ°å€ï¼Œä»¥åŠç‚ºé€™äº›ç‰¹æ®Šå‹æ…‹è¨­å®šè©²åˆå§‹å€¼ (stringå°±æ˜¯â€â€, intç‚º0)</li></ul><p>æ‰€ä»¥è‹¥è¦å‚³æŒ‡æ¨™æ™‚ï¼Œå°±éœ€è¦è€ƒæ…®ç”¨<code>new</code>ï¼Œè€Œéæ˜¯<code>make</code>äº†</p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><ul><li>golang ç­†è¨˜ï¼šmake èˆ‡ new çš„å·®åˆ¥ by æ„·é–‹<ul><li><a href="https://medium.com/d-d-mag/golang-%E7%AD%86%E8%A8%98-make-%E8%88%87-new-%E7%9A%84%E5%B7%AE%E5%88%A5-68b05c7ce016" target="_blank" rel="noopener">https://medium.com/d-d-mag/golang-%E7%AD%86%E8%A8%98-make-%E8%88%87-new-%E7%9A%84%E5%B7%AE%E5%88%A5-68b05c7ce016</a></li></ul></li><li>Allocation with make<ul><li><a href="https://golang.org/doc/effective_go.html#allocation_make" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#allocation_make</a></li></ul></li><li>Allocation with new<ul><li><a href="https://golang.org/doc/effective_go.html#allocation_new" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#allocation_new</a></li></ul></li><li>The Go Programming Language, Author: Alan A. A. Donovan, Brian W. Kernighan</li><li>ä¸è¦å‘nil mapå†™å…¥(panic: assignment to entry in nil map) #7<ul><li><a href="https://github.com/kevinyan815/gocookbook/issues/7" target="_blank" rel="noopener">https://github.com/kevinyan815/gocookbook/issues/7</a></li></ul></li><li>ç†è§£ Go make å’Œ new çš„åŒºåˆ« by ä¸‰æœˆæ²™<ul><li><a href="https://sanyuesha.com/2017/07/26/go-make-and-new/" target="_blank" rel="noopener">https://sanyuesha.com/2017/07/26/go-make-and-new/</a></li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go Module å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹</title>
      <link href="/2020/11/07/Go-Module-%E5%85%A5%E9%96%80%E8%88%87%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%B4%B9%E4%BB%8B%E7%B4%B9/"/>
      <url>/2020/11/07/Go-Module-%E5%85%A5%E9%96%80%E8%88%87%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%B4%B9%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<p>Go Module ç‚ºç›®å‰æœ€ä¸»æµçš„ä¾è³´è§£æ±ºçš„æ–¹æ¡ˆ</p><p>ç™¼ä½ˆæ–¼ Go 11.1ç‰ˆï¼Œæ–¼Go 1.14æ¨è–¦åœ¨Productionç’°å¢ƒä¸Šä½¿ç”¨</p><a id="more"></a><p>Go Modulesçš„å‡ºç¾è§£æ±ºäº†ä»¥ä¸‹å¹¾é»çˆ­è­°ï¼š</p><ul><li>ä¾è³´å•é¡Œ</li><li>æ·˜æ±°GOPATHçš„æ©Ÿåˆ¶</li><li>çµ±ä¸€ç¤¾ç¾¤ä¸­å…¶ä»–ä¾è³´ç®¡ç†å·¥å…·</li></ul><h2 id="ç‚ºä½•-GOPATH-ä¸åœ¨è¢«æ¨è–¦ä½¿ç”¨"><a href="#ç‚ºä½•-GOPATH-ä¸åœ¨è¢«æ¨è–¦ä½¿ç”¨" class="headerlink" title="ç‚ºä½• GOPATH ä¸åœ¨è¢«æ¨è–¦ä½¿ç”¨"></a>ç‚ºä½• GOPATH ä¸åœ¨è¢«æ¨è–¦ä½¿ç”¨</h2><h3 id="ç°¡å–®ä»‹ç´¹"><a href="#ç°¡å–®ä»‹ç´¹" class="headerlink" title="ç°¡å–®ä»‹ç´¹"></a>ç°¡å–®ä»‹ç´¹</h3><p>GOPATHåŸå…ˆæ˜¯é€éå®šç¾©å¥½çš„ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">go</span><br><span class="line">|--bin</span><br><span class="line">|--pkg</span><br><span class="line">|--src</span><br><span class="line">    |--github.com</span><br><span class="line">    |--golang.org</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>å„ç›®éŒ„åˆ†åˆ¥ç‚ºï¼š</p><ul><li>bin: å„²å­˜æ‰€ç·¨è­¯ç”¢ç”Ÿçš„äºŒé€²ä½æª”æ¡ˆ</li><li>pkg: å„²å­˜é å…ˆç·¨è­¯çš„ç›®çš„æª”æ¡ˆï¼Œä»¥åŠ å¿«ç¨‹å¼çš„å¾ŒçºŒç·¨è­¯é€Ÿåº¦</li><li>src: å„²å­˜æ‰€æœ‰ .go æª”æ¡ˆæˆ–åŸå§‹ç¨‹å¼ç¢¼<ul><li>ä¸€èˆ¬æœƒä»¥ <code>$GOPATH/src/github.com/</code> å„²å­˜ Goçš„æ‡‰ç”¨ç¨‹å¼å’Œå‡½å¼åº«</li></ul></li></ul><h3 id="æ£„ç”¨åŸå› -ç„¡æ³•æ˜ç¢ºå®šç¾©èˆ‡åƒç…§ä¾è³´-Dependency-çš„ç‰ˆæœ¬"><a href="#æ£„ç”¨åŸå› -ç„¡æ³•æ˜ç¢ºå®šç¾©èˆ‡åƒç…§ä¾è³´-Dependency-çš„ç‰ˆæœ¬" class="headerlink" title="æ£„ç”¨åŸå› : ç„¡æ³•æ˜ç¢ºå®šç¾©èˆ‡åƒç…§ä¾è³´(Dependency)çš„ç‰ˆæœ¬"></a>æ£„ç”¨åŸå› : ç„¡æ³•æ˜ç¢ºå®šç¾©èˆ‡åƒç…§ä¾è³´(Dependency)çš„ç‰ˆæœ¬</h3><p>å› ç‚º<code>.go</code> å°ˆæ¡ˆéƒ½å¿…é ˆè¦å„²å­˜åœ¨ <code>$GOPATH/src</code> åº•ä¸‹ï¼Œä½†è©²ä¾è³´ç®¡ç†æ–¹å¼ä¸¦æ²’æœ‰æä¾›ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µï¼Œæœƒé€ æˆä»¥ä¸‹å•é¡Œï¼š</p><ol><li>åŸ·è¡Œ<code>go get</code> å–å¾—é ç«¯çš„ä¾è³´åŒ…æ™‚ï¼Œæœƒç„¡æ³•å¾—çŸ¥ç›®å‰æ‰€è¼‰çš„ç‰ˆæœ¬</li><li>ç„¡æ³•è™•ç† v1,v2,v3ç­‰ä¸åŒç‰ˆæœ¬çš„åƒè€ƒå•é¡Œï¼Œå‡è¨­æœ‰çš„Libraryå«åš <code>/foo/bar</code> ä½†ä¸ç®¡å¹¾ç‰ˆï¼Œéƒ½æœƒåœ¨GOPATHåº•ä¸‹ï¼Œå…¶è·¯å¾‘éƒ½æœƒæ˜¯ä¸€æ¨£çš„ (éƒ½åœ¨github.com/foo/bar)</li></ol><h2 id="Go-modulesçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼"><a href="#Go-modulesçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼" class="headerlink" title="Go modulesçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼"></a>Go modulesçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼</h2><h3 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h3><ul><li><code>go mod init</code>: ç”¢ç”Ÿ go.mod æª”æ¡ˆ</li><li><code>go mod download</code>: ä¸‹è¼‰go.modæª”æ¡ˆä¸­æŒ‡æ˜çš„æ‰€æœ‰ä¾è³´</li><li><code>go mod tidy</code>: æ•´ç†æ‰€æœ‰ä¾è³´</li><li><code>go mod graph</code>: æª¢è¦–ç¾æœ‰çš„ä¾è³´çµæ§‹</li><li><code>go mod edit</code>: ç·¨è¼¯ go.mod æª”æ¡ˆ</li><li><code>go mod vendor</code>: æœƒå‡ºå°ˆæ¡ˆæ‰€æœ‰çš„ä¾è³´åˆ°vendorç›®éŒ„</li><li><code>go mod verify</code>: é©—è­‰ä¸€å€‹æ¨¡çµ„æ˜¯å¦è¢«ç«„æ”¹é</li><li><code>go mod why</code>: æª¢è¦–ç‚ºä½•éœ€è¦ä¾è³´è©²æ¨¡çµ„</li></ul><h3 id="ç’°å¢ƒè®Šæ•¸"><a href="#ç’°å¢ƒè®Šæ•¸" class="headerlink" title="ç’°å¢ƒè®Šæ•¸"></a>ç’°å¢ƒè®Šæ•¸</h3><p>å¯é€é <code>go env</code> ä¾†æª¢è¦–å¸¸ç”¨çš„ç’°å¢ƒè®Šæ•¸ï¼Œä»¥ä¸‹ç‚ºèˆ‡Go Moduleç›¸é—œçš„ç’°å¢ƒè®Šæ•¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> GOMODULESæ–°å¢çš„ç’°å¢ƒè®Šæ•¸</span><br><span class="line">GO111MODULE="on"</span><br><span class="line">GOPROXY="https://proxy.golang.org,direct"</span><br><span class="line">GONOPROXY=""</span><br><span class="line">GOSUMDB="sum.golang.org"</span><br><span class="line">GONOSUMDB=""</span><br><span class="line">GOPRIVATE=""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ä»¥ä¸‹ç‚ºåŸæœ¬GOPATHå°±æœ‰çš„ç’°å¢ƒè®Šæ•¸</span><br><span class="line">GOARCH="amd64"</span><br><span class="line">GOBIN="/Users/user/go/bin"</span><br><span class="line">GOCACHE="/Users/user/Library/Caches/go-build"</span><br><span class="line">GOENV="/Users/user/Library/Application Support/go/env"</span><br><span class="line">GOEXE=""</span><br><span class="line">GOFLAGS=""</span><br><span class="line">GOHOSTARCH="amd64"</span><br><span class="line">GOHOSTOS="darwin"</span><br><span class="line">GOINSECURE=""</span><br><span class="line">GOMODCACHE="/Users/user/go/pkg/mod"</span><br><span class="line">GOOS="darwin"</span><br><span class="line">GOPATH="/Users/user/go"</span><br><span class="line">GOROOT="/usr/local/Cellar/go/1.15/libexec"</span><br><span class="line">GOTMPDIR=""</span><br><span class="line">GOTOOLDIR="/usr/local/Cellar/go/1.15/libexec/pkg/tool/darwin_amd64"</span><br><span class="line">GCCGO="gccgo"</span><br><span class="line">AR="ar"</span><br><span class="line">CC="clang"</span><br><span class="line">CXX="clang++"</span><br><span class="line">CGO_ENABLED="1"</span><br><span class="line">GOMOD="/dev/null"</span><br><span class="line">CGO_CFLAGS="-g -O2"</span><br><span class="line">CGO_CPPFLAGS=""</span><br><span class="line">CGO_CXXFLAGS="-g -O2"</span><br><span class="line">CGO_FFLAGS="-g -O2"</span><br><span class="line">CGO_LDFLAGS="-g -O2"</span><br><span class="line">PKG_CONFIG="pkg-config"</span><br><span class="line">GOGCCFLAGS="-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build233814295=/tmp/go-build -gno-record-gcc-switches -fno-common"</span><br></pre></td></tr></table></figure><h4 id="GO111MODULE"><a href="#GO111MODULE" class="headerlink" title="GO111MODULE"></a>GO111MODULE</h4><p>é€éGO111MODULEä½œç‚ºè©²å°ˆæ¡ˆæ˜¯å¦ä½¿ç”¨ Go modulesçš„é–‹é—œï¼Œå¯è¨­å®šä»¥ä¸‹å…§å®¹</p><ul><li>auto: åªè¦å°ˆæ¡ˆåŒ…å« <code>go.mod</code> æª”æ¡ˆï¼Œå°±ä½¿ç”¨Go modules (åœ¨Go 1.11~1.14ï¼Œç‚ºé è¨­)</li><li>on: å•Ÿç”¨Go modules (æ¨è–¦ä½¿ç”¨)</li><li>off: ç¦ç”¨Go modules</li></ul><div style="border-radius: 10px;padding: 20px;background-color: #C8FAFF;color: black;margin-bottom: 15px;"><br>ç‚ºä½•å«åš GO111MODULE?<br><br>å› ç‚ºgo modulesæ˜¯åœ¨ go1.11ç‰ˆæœ¬æ‰€æå‡ºçš„<br></div><h4 id="GOPROXY"><a href="#GOPROXY" class="headerlink" title="GOPROXY"></a>GOPROXY</h4><p>è¨­å®šGOæ¨¡çµ„çš„proxy, ä½¿Goåœ¨å¾ŒçºŒæ‹‰å–æ¨¡çµ„çš„ç‰ˆæœ¬æ™‚ï¼Œç›´æ¥é€éæ˜ åƒæª”ç¶²ç«™å¿«é€Ÿæ‹‰å–ï¼Œè€Œéåˆ°Githubé€™ç¨®Version control serviceå¹³å°</p><p>GOPROXYé è¨­å€¼ç‚º <code>https://proxy.golang.org,direct</code>ï¼Œé€éé€—è™Ÿå°‡ä»£ç†çš„åœ°æ–¹çµ¦éš”é–‹</p><p>è‹¥ä¸æƒ³ä½¿ç”¨GOPROXY, å¯è¨­ç½®ç‚º GOPROXY=â€offâ€</p><p>å…¶ä¸­æœ€å¾Œæœ‰ <code>direct</code> ä¸€è©çš„ç”¨æ„æ˜¯ï¼Œè‹¥å‰é¢çš„proxyå€¼éƒ½æ²’è¾¦æ³•è¼‰åˆ°<br>æ¨¡çµ„ï¼Œä¾‹å¦‚åœ¨ <code>https://proxy.golang.org</code>æŠ“ä¸åˆ°ï¼Œé‚£éº¼å°±æœƒå›åˆ°åŸä½ç½®(ä¾‹å¦‚Github)å»ä¸‹è¼‰</p><h4 id="GOSUMDB"><a href="#GOSUMDB" class="headerlink" title="GOSUMDB"></a>GOSUMDB</h4><p>GOSUMDBç‚ºGo checksum databaseï¼Œé©—è­‰æ‹‰å–çš„æ¨¡çµ„ç‰ˆæœ¬è³‡æ–™æœªç¶“éç«„æ”¹</p><p>é è¨­å€¼ç‚º <code>sum.golang.org</code>ï¼Œä¹Ÿå¯è¨­ç½®æˆ <code>off</code>ï¼Œç¦æ­¢Goåœ¨å¾ŒçºŒæ“ä½œä¸­åšé©—è­‰ç‰ˆæœ¬çš„å‹•ä½œ</p><h4 id="GONOPROXY-GONOSUMDB-GOPRIVATE"><a href="#GONOPROXY-GONOSUMDB-GOPRIVATE" class="headerlink" title="GONOPROXY/GONOSUMDB/GOPRIVATE"></a>GONOPROXY/GONOSUMDB/GOPRIVATE</h4><p>è¨­å®šç§æœ‰æ¨¡çµ„çš„ç’°å¢ƒè®Šæ•¸ï¼Œä¸€èˆ¬ä¾†èªªå»ºè­°ç›´æ¥è¨­å®š GONOPROXYï¼Œæœƒä½œç‚º GONOPROXYèˆ‡GONOSUMDBçš„é è¨­å€¼</p><p>å€¼å¯è¨­å®šå¤šçµ„ï¼Œä¾‹å¦‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GOPRIVATE="git.xxx.com,github.com/eddycjy/mquote"</span><br></pre></td></tr></table></figure></p><p>è¨­å®šä¹‹å¾Œå­—é¦–ç‚º <code>git.xxx.com</code> ä»¥åŠ <code>github.com/eddycjy/mquote</code> çš„æ¨¡çµ„æœƒè¢«èªç‚ºæ˜¯ç§æœ‰æ¨¡çµ„</p><p>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¨­å®š <code>*</code>ï¼Œä»¥ä¸‹è¡¨ç¤ºä¾†è‡ª<code>.example.com</code> çš„å­åŸŸåçš„éƒ½è¡¨ç¤ºä¾†è‡ªç§æœ‰å€‰åº«</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GOPRIVATE="*.example.com"</span><br></pre></td></tr></table></figure><h3 id="å•Ÿç”¨æ–¹å¼"><a href="#å•Ÿç”¨æ–¹å¼" class="headerlink" title="å•Ÿç”¨æ–¹å¼"></a>å•Ÿç”¨æ–¹å¼</h3><p>Go modulesé è¨­ä¸æ˜¯é–‹å•Ÿçš„ï¼Œé€é<code>GO111MODULE</code>ä¾†åšè¨­å®šï¼Œå¯ç”¨<code>auto</code>, <code>on</code>, <code>off</code>åšè¨­å®š</p><p>é€éenvé€²è¡Œè¨­å®š <code>go env -w</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go env -w GO111MODULE=on</span><br></pre></td></tr></table></figure></p><h3 id="åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ"><a href="#åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ" class="headerlink" title="åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ"></a>åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ</h3><p>åœ¨ä¸€å€‹è³‡æ–™å¤¾å…§ï¼Œé€é <code>go mod init</code> åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go mod init github.com/jellyhola/module-repo</span><br><span class="line">go: creating new go.mod: module github.com/jellyhola/module-repo</span><br></pre></td></tr></table></figure><p>é€™æ™‚æœƒç”¢ç”Ÿä¸€å€‹ <code>go.mod</code> æª”æ¡ˆï¼Œæœƒç´€éŒ„ç›®å‰å°ˆæ¡ˆæ¨¡çµ„ç‚º <code>github.com/jellyhola/module-repo</code>ï¼Œgoç‰ˆæœ¬ç‚º<code>1.15</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line">go 1.15</span><br></pre></td></tr></table></figure></p><p>é€™æ™‚å®šç¾©ä¸€ä»½ <code>main.go</code> æª”æ¡ˆï¼Œimport <code>github.com/example/hello</code><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"rsc.io/quote"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">Hello()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Hello :print quote.Hello()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> quote.Hello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€™æ™‚å°ˆæ¡ˆç›®éŒ„æœƒè‡ªå‹•ç”¢ç”Ÿ <code>go.sum</code>æª”æ¡ˆ, ä»¥åŠ<code>go.mod</code>æœƒå¤šç´€éŒ„ä½¿ç”¨äº† <code>rsc.io/quote</code>æ¨¡çµ„ä»¥åŠä½¿ç”¨çš„ç‰ˆæœ¬ç‚º <code>1.5.2</code></p><p>go.sum<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=</span><br><span class="line">rsc.io/quote v1.5.2 h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">rsc.io/quote v1.5.2/go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPXsUe+TKr0=</span><br><span class="line">rsc.io/sampler v1.3.0 h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=</span><br><span class="line">rsc.io/sampler v1.3.0/go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9JXDnKaTXpA=</span><br></pre></td></tr></table></figure></p><p>go.mod<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line">go 1.15</span><br><span class="line"></span><br><span class="line">require rsc.io/quote v1.5.2</span><br></pre></td></tr></table></figure></p><div style="border-radius: 10px;padding: 20px;background-color: #C8FAFF;color: black;margin-bottom: 15px;"><br><br>å»ºè­°å°‡ go.sumèˆ‡go.modé€™å…©å€‹æª”æ¡ˆæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶<br><br></div><p>ç”±æ–¼æœ¬èº«<code>rsc.io/quote</code>é€™å€‹æ¨¡çµ„ï¼Œä¸‹è¼‰goæ™‚å°±å·²ç¶“å®‰è£å®Œç•¢ï¼Œæ•…ä¸ç”¨é€é <code>go get</code>ä¾†é¡å¤–ä¸‹è¼‰</p><p>æ¥è‘—å¯ç”¨<code>go list -m all</code> æª¢è¦–ç›®å‰å°ˆæ¡ˆæ‰€ä½¿ç”¨çš„ä¾è³´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go list -m all</span><br><span class="line">github.com/jellyhola/module-repo</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br></pre></td></tr></table></figure><p>å¯çœ‹åˆ°ç›®å‰ <code>golang.org/x/text</code>é€™é …æ¨¡çµ„ï¼Œç‚ºuntaggedçš„ç‹€æ³ï¼Œæ¥è‘—å¯ä»¥é€é <code>go get</code>ä¾†æ›´æ–°æ­¤æ¨¡çµ„åˆ°æœ€æ–°çš„tag</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go get golang.org/x/text</span><br><span class="line">go: golang.org/x/text upgrade =&gt; v0.3.4</span><br><span class="line">go: downloading golang.org/x/text v0.3.4</span><br></pre></td></tr></table></figure><p>å¯çœ‹åˆ° go.modå…§å®¹æ”¹è®Šäº†<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module github.com/jellyhola/module-repo</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.15</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">golang.org/x/text v0<span class="number">.3</span><span class="number">.4</span> <span class="comment">// indirect</span></span><br><span class="line">rsc.io/quote v1<span class="number">.5</span><span class="number">.2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ <code>// indirect</code> è¡¨ç¤ºè©²æ¨¡çµ„ç‚ºé–“æ¥ä¾è³´ï¼Œè¡¨ç¤ºç›®å‰æ‡‰ç”¨ç¨‹å¼çš„importæ•˜è¿°ä¸­ï¼Œä¸¦æ²’æœ‰ç™¼ç¾é€™æ¨¡çµ„çš„æ˜ç¢ºåƒè€ƒï¼Œæœ‰å¯èƒ½æ˜¯</p><ul><li>äº‹å…ˆæ‰‹å‹•go getæ‹‰å–ä¸‹ä¾†çš„æ¨¡çµ„</li><li>è©²å°ˆæ¡ˆæ‰€ä¾è³´æ¨¡çµ„ä¹‹æ‰€ä¾è³´çš„</li></ul><p>è©¦è‘—è·‘ä¸€ä¸‹å°ˆæ¡ˆï¼Œé©—è­‰æ¨¡çµ„æ˜¯å¦èƒ½æ­£å¸¸é‹ä½œ</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go run main.go</span><br><span class="line">ä½ å¥½ï¼Œä¸–ç•Œã€‚%</span><br></pre></td></tr></table></figure><h3 id="æ‹‰å–çš„æ¨¡çµ„æœƒå­˜åœ¨å“ªï¼Ÿ"><a href="#æ‹‰å–çš„æ¨¡çµ„æœƒå­˜åœ¨å“ªï¼Ÿ" class="headerlink" title="æ‹‰å–çš„æ¨¡çµ„æœƒå­˜åœ¨å“ªï¼Ÿ"></a>æ‹‰å–çš„æ¨¡çµ„æœƒå­˜åœ¨å“ªï¼Ÿ</h3><p>go modæœƒå°‡æ‹‰å–çš„æ¨¡çµ„æ”¾ç½®åœ¨ <code>$GOPATH/pkg/mod</code> èˆ‡ <code>$GOPATH/pkg/sumdb</code> ç›®éŒ„ä¸‹ï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ls $GOPATH/pkg</span><br><span class="line">cache      github.com golang.org  rsc.io</span><br></pre></td></tr></table></figure><p>è‹¥æƒ³è¦æ¸…é™¤å·²ç¶“å¿«å–çš„æ¨¡çµ„ç‰ˆæœ¬ï¼Œä½¿ç”¨ <code>go clean -modcache</code> æŒ‡ä»¤</p><h2 id="Go-module-é€²éšæ¢è¨"><a href="#Go-module-é€²éšæ¢è¨" class="headerlink" title="Go module é€²éšæ¢è¨"></a>Go module é€²éšæ¢è¨</h2><h3 id="Go-modulesçš„go-getæ¢è¨"><a href="#Go-modulesçš„go-getæ¢è¨" class="headerlink" title="Go modulesçš„go getæ¢è¨"></a>Go modulesçš„go getæ¢è¨</h3><p>ä½¿ç”¨go getå–å¾—æ¨¡çµ„æ™‚ï¼Œæœƒåˆ†åˆ¥é€²è¡Œ3å€‹æ­¥é©Ÿ</p><ol><li>finding: æŸ¥æ‰¾æ¨¡çµ„æ˜¯å¦å­˜åœ¨</li><li>downloading: é€²è¡Œä¸‹è¼‰</li><li>extracting: åˆ†æä¸‹è¼‰çš„æ¨¡çµ„çš„é›œæ¹Šå€¼æ˜¯å¦æ­£ç¢º</li></ol><p>åƒä¸Šä¸€ç¯€æ‰€æ‹‰å–çš„æ¨¡çµ„ <code>golang.org/x/text</code> å…¶æ‹‰å–çš„è³‡è¨Šå¦‚ä¸‹</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæœ¬è³‡è¨Š-commitçš„æ™‚é–“-é›œæ¹Šå€¼</span><br><span class="line">v0.0.0-20170915032832-14c0d48ead0c</span><br></pre></td></tr></table></figure><ul><li>commitçš„æ™‚é–“æœƒæ˜¯ä»¥UTCæ™‚å€ç‚ºæº–</li><li>go getæ‹‰å–çš„æŒ‡ä»¤è‹¥æ²’æœ‰æŒ‡å®šç‰ˆæœ¬ï¼Œæœƒç›´æ¥æ‹‰å–åˆ° v0.0.0ç‰ˆ</li></ul><h3 id="go-getè¡Œç‚º"><a href="#go-getè¡Œç‚º" class="headerlink" title="go getè¡Œç‚º"></a>go getè¡Œç‚º</h3><ul><li>go get: ç›´æ¥æ‹‰å–dependencyï¼Œåªæœƒæ›´æ–°æŒ‡å®šçš„ä»–è‡ªå·±</li><li>go get -u: æ›´æ–°ç¾æœ‰çš„dependencyï¼Œæœƒå¼·åˆ¶æ›´æ–°è©²denpendencyæ‰€ä¾è³´çš„å…¶ä»–æ¨¡çµ„</li><li>go get -u -t: æ›´æ–°æ‰€æœ‰denpendencyï¼Œä»¥åŠåŒ…å«å–®å…ƒæ¸¬è©¦ä½¿ç”¨åˆ°çš„</li></ul><h3 id="go-getç‰ˆæœ¬æŒ‡å®š"><a href="#go-getç‰ˆæœ¬æŒ‡å®š" class="headerlink" title="go getç‰ˆæœ¬æŒ‡å®š"></a>go getç‰ˆæœ¬æŒ‡å®š</h3><ul><li>go get golang.org/x/text@latest : æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè‹¥å­˜åœ¨tagï¼Œå„ªå…ˆä½¿ç”¨ä¹‹</li><li>go get golang.org/x/text@master : æ‹‰å–masteråˆ†æ”¯çš„æœ€æ–°commit</li><li>go get <a href="mailto:golang.org/x/text@v0.3.2" target="_blank" rel="noopener">golang.org/x/text@v0.3.2</a> : æ‹‰å–tagç‚ºv0.3.2çš„commit</li><li>go get golang.org/x/text@342b2e : æ‹‰å–hashç‚º342b2eçš„commitï¼Œæœ€å¾Œè½‰ç‚º v0.3.2</li></ul><h2 id="Go-modulesçš„go-runèˆ‡go-build"><a href="#Go-modulesçš„go-runèˆ‡go-build" class="headerlink" title="Go modulesçš„go runèˆ‡go build"></a>Go modulesçš„go runèˆ‡go build</h2><p>åŸ·è¡Œgo buildæ™‚ï¼Œæœƒæ ¹æ“šgo.modè‡ªå‹•ä¸‹è¼‰è©²å°ˆæ¡ˆæ‰€éœ€çš„æ¨¡çµ„ï¼Œæ‰é€²è¡Œç·¨è­¯</p><div style="border-radius: 10px;padding: 20px;background-color: #FFF6C8;color: black;margin-bottom: 15px;"><br><br>è‹¥æ˜¯è¦ä½¿ç”¨ vendorç›®éŒ„ä½œç‚ºdenpendency, åœ¨åŸ·è¡Œ go mod vendorç”¢ç”Ÿvendorç›®éŒ„å¾Œï¼Œéœ€è¦åŸ·è¡Œ go build -mod=vendor<br>æ‰å¯ä½¿ç”¨ go build -mod=vendor ä½¿ç”¨vendorç›®éŒ„ä½œç‚ºdenpendencyä¾†ç·¨è­¯<br><br></div><h2 id="Go-modulesåŒ¯å…¥è·¯å¾‘èªªæ˜"><a href="#Go-modulesåŒ¯å…¥è·¯å¾‘èªªæ˜" class="headerlink" title="Go modulesåŒ¯å…¥è·¯å¾‘èªªæ˜"></a>Go modulesåŒ¯å…¥è·¯å¾‘èªªæ˜</h2><p>Go modulesåœ¨ä¸»ç‰ˆæœ¬ç·¨è™Ÿç‚º v0èˆ‡v1çš„æƒ…æ³æœƒçœç•¥å…¶ç·¨è™Ÿï¼Œåœ¨v2ä»¥ä¸Šå‰‡éœ€è¦æ˜ç¢ºæŒ‡å®šï¼</p><p>å‡å¦‚è¦åŒ¯å…¥ v2ä»¥ä¸Šçš„<a href="mailto:golang.org/example@v2.0.0" target="_blank" rel="noopener">golang.org/example@v2.0.0</a>ï¼Œå‰‡å¿…é ˆè¦åœ¨importåº•ä¸‹æ˜ç¢ºæŒ‡å®šv2</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/example/v2"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="ç‚ºä½•çœç•¥v0èˆ‡v1"><a href="#ç‚ºä½•çœç•¥v0èˆ‡v1" class="headerlink" title="ç‚ºä½•çœç•¥v0èˆ‡v1??"></a>ç‚ºä½•çœç•¥v0èˆ‡v1??</h3><p>å› ç‚ºå®˜æ–¹é¼“å‹µé–‹ç™¼äººå“¡å°‡æ¨¡çµ„å»ºç«‹åˆ°v1ç‰ˆæœ¬å°±ä¸åœ¨è®Šå‹•ã€‚</p><p>æ‰€ä»¥è‹¥é–‹ç™¼äººå“¡åœ¨ç™¼ä½ˆv2ç‰ˆæœ¬æ™‚ï¼Œæœƒè¢«æ“æœ‰æ˜ç¢ºçš„v1ç‰ˆæœ¬å°¾ç¶´ï¼Œè¿‘ä¸€æ­¥å°è‡´v1ç‰ˆæœ¬è®Šæˆé›œè¨Šä¸”æ²’æœ‰ä»€éº¼æ„ç¾©</p><p>åœ¨åŒ¯å…¥è·¯å¾‘å¿½ç•¥v0ç‰ˆæœ¬ï¼Œå› ç‚ºæ ¹æ“šèªæ„åŒ–ç‰ˆæœ¬æ¨™æº–ï¼Œv0çš„é€™äº›ç‰ˆæœ¬å¤§å¤šæ²’æœ‰ç›¸å®¹æ€§ä¿è­‰</p><h2 id="Go-modules-èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶"><a href="#Go-modules-èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="Go modules èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶"></a>Go modules èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶</h2><p>ä¸€å€‹go modulesçš„ç‰ˆæœ¬è³‡è¨Šå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//ä¸»ç‰ˆæœ¬è™Ÿ.æ¬¡ç‰ˆæœ¬è™Ÿ.ä¿®è¨‚è™Ÿ</span><br><span class="line">v1.2.3</span><br></pre></td></tr></table></figure></p><ul><li>ä¸»ç‰ˆæœ¬ç·¨è™Ÿï¼šåšäº†ä¸ç›¸å®¹çš„APIä¿®æ”¹ä¹‹é¡çš„</li><li>æ¬¡ç‰ˆæœ¬ç·¨è™Ÿ: åšäº†å‘ä¸‹ç›¸å®¹çš„åŠŸèƒ½æ€§æ–°å¢</li><li>ä¿®è¨‚å¥½: å‘ä¸‹ç›¸å®¹çš„åŠŸèƒ½é™¤éŒ¯</li></ul><p>è‹¥æ˜¯å…ˆè¡Œç‰ˆæœ¬çš„è©±ï¼Œé‚£åŠ ä¸Š <code>pre</code> å¾Œç¶´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1.2.3-pre</span><br></pre></td></tr></table></figure></p><div style="border-radius: 10px;padding: 20px;background-color: #FFF6C8;color: black;margin-bottom: 15px;"><br><br>ç™¼ä½ˆæ–°ç‰ˆæœ¬æ™‚æ‡‰éµå¾ªèªæ„åŒ–ç‰ˆæœ¬è¦å‰‡ï¼Œå¦å‰‡ç„¡æ³•è¢«go getæ‰€æ‹‰å–<br><br></div><h2 id="go-listçš„åŠŸèƒ½"><a href="#go-listçš„åŠŸèƒ½" class="headerlink" title="go listçš„åŠŸèƒ½"></a>go listçš„åŠŸèƒ½</h2><p>æä¾›è©²å°ˆæ¡ˆæ‰€æœ‰denpendencyçš„è³‡è¨Š</p><p>é€é <code>go list -m -u all</code> å¯ä»¥æª¢è¦–æ‰€æœ‰çš„dependencyè³‡è¨Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ go list -m -u all</span><br><span class="line">github.com/jellyhola/module-repo</span><br><span class="line">golang.org/x/text v0.3.4</span><br><span class="line">golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br></pre></td></tr></table></figure><ul><li>-m: é¡¯ç¤ºæ‰€æœ‰ä¾è³´çš„æ¨¡çµ„</li><li>-u: é¡¯ç¤ºèƒ½å¤ å‡ç´šçš„ç‰ˆæœ¬</li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitbookçš„ä½¿ç”¨ç´€éŒ„</title>
      <link href="/2020/10/04/gitbook-tutorial/"/>
      <url>/2020/10/04/gitbook-tutorial/</url>
      
        <content type="html"><![CDATA[<p>Gitbookæä¾›äº†èƒ½å¤ å°‡markdownæ ¼å¼è½‰å¯«æˆä¸€æœ¬é›»å­æ›¸çš„æ¨£å­</p><a id="more"></a><h2 id="æœ¬åœ°ç«¯åŸ·è¡Œ"><a href="#æœ¬åœ°ç«¯åŸ·è¡Œ" class="headerlink" title="æœ¬åœ°ç«¯åŸ·è¡Œ"></a>æœ¬åœ°ç«¯åŸ·è¡Œ</h2><p>å®‰è£æ–¹å¼ï¼Œç”¨ <a href="https://www.npmjs.com/package/gitbook" target="_blank" rel="noopener">npm</a> å®‰è£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g gitbook-cli</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>æ‰¾ä¸€å€‹è³‡æ–™å¤¾ï¼ŒåŸ·è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook init</span><br></pre></td></tr></table></figure></p><p>æœƒç”¢ç”Ÿ </p><ul><li>reamdme.md<ul><li>ä»‹ç´¹æœ¬æ›¸å…§å®¹</li></ul></li><li>summary.md<ul><li>ç”¨ä¾†å®šç¾©gitbookç›®éŒ„</li></ul></li></ul><h4 id="summary-md-çµæ§‹"><a href="#summary-md-çµæ§‹" class="headerlink" title="summary.md çµæ§‹"></a>summary.md çµæ§‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* ch1</span><br><span class="line">  * ch1-1</span><br><span class="line">  * ch1-2</span><br></pre></td></tr></table></figure><p>æª”æ¡ˆçµæ§‹çš„è©±å°±é•·é€™æ¨£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- ch1</span><br><span class="line">|- ch1-1</span><br><span class="line">|- ch1-2</span><br><span class="line">-readme.md</span><br><span class="line">-summary.md</span><br></pre></td></tr></table></figure></p><h2 id="é‹è¡Œgitbook"><a href="#é‹è¡Œgitbook" class="headerlink" title="é‹è¡Œgitbook"></a>é‹è¡Œgitbook</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook serve</span><br></pre></td></tr></table></figure><p>é è¨­æœƒé‹è¡Œåœ¨ <a href="http://localhost:4000" target="_blank" rel="noopener">localhost:4000</a></p><h3 id="å®‰è£Plugin"><a href="#å®‰è£Plugin" class="headerlink" title="å®‰è£Plugin"></a>å®‰è£Plugin</h3><p>äº‹å…ˆå®‰è£gitbook-pluginå¥—ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gitbook-plugin</span><br></pre></td></tr></table></figure></p><p>è‹¥è¦å®‰è£ç•™è¨€æ¿ç­‰å¥—ä»¶ï¼Œéœ€è¦å…ˆå®šç¾© book.json ï¼Œå¯ä»¥å®šç¾©ä½¿ç”¨çš„plugin</p><p>book.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [&quot;disqus&quot;],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;disqus&quot;: &#123;</span><br><span class="line">      &quot;shortName&quot;: &quot;ä½ çš„ç•™è¨€æ¿åç¨±&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å¦‚å¯ä½¿ç”¨ Google Analytics ( Google åˆ†æ )ã€Disqus ( ç¤¾ç¾¤&amp;ç•™è¨€æ¿ ) å’Œ youtube â€¦ç­‰å¤–æ›ï¼Œä¹Ÿå¯ä»¥åœ¨Gitbook npmç¶²ç«™ä¸­æ‰¾åˆ°è‡ªå·±è¦çš„plugin</p><p>å®šç¾©ç©ä½¿ç”¨çš„plunginå¤–æ›ï¼Œè«‹åŸ·è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook install</span><br></pre></td></tr></table></figure></p><h3 id="Disqusç•™è¨€æ¿"><a href="#Disqusç•™è¨€æ¿" class="headerlink" title="Disqusç•™è¨€æ¿"></a>Disqusç•™è¨€æ¿</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gitbook-plugin-disqus</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [&quot;disqus&quot;],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;disqus&quot;: &#123;</span><br><span class="line">      &quot;shortName&quot;: &quot;ä½ çš„ç•™è¨€æ¿åç¨±&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…§å®¹ç¶±è¦-InTopic-TOC"><a href="#å…§å®¹ç¶±è¦-InTopic-TOC" class="headerlink" title="å…§å®¹ç¶±è¦ InTopic TOC"></a>å…§å®¹ç¶±è¦ InTopic TOC</h3><p>å¦‚æœè¦å¯¦ç¾å³é‚Šå´é‚Šæ¬„æœ¬é mdæª”æ¡ˆçš„éšå±¤å¼ï¼Œå¯å®‰è£ InTopic TOC</p><p><a href="https://github.com/fzankl/gitbook-plugin-intopic-toc" target="_blank" rel="noopener">GitBook plugin: InTopic TOC</a></p><p>æ–¼book.jsonä¸­å®šç¾©<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;intopic-toc&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;pluginsConfig&quot;: &#123;</span><br><span class="line">    &quot;intopic-toc&quot;: &#123;</span><br><span class="line">      &quot;label&quot;: &quot;In this article&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥è‘—åŸ·è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook install</span><br></pre></td></tr></table></figure></p><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><p><a href="https://github.com/GitbookIO/gitbook" target="_blank" rel="noopener">Gitbook Github Docs</a></p><p><a href="https://docs.gitbook.com/getting-started/quick-start" target="_blank" rel="noopener">Gitbook Online Platform Docs</a></p><p><a href="https://www.oxxostudio.tw/articles/201502/gitbook.html" target="_blank" rel="noopener">ç”¨ GitBook ä¾†å¯«æœ¬æ›¸å§</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éœæ…‹èˆ‡å‹•æ…‹å‡½å¼åº«çš„ä»‹ç´¹èˆ‡å·®ç•°(Static èˆ‡ Shared Libraries)</title>
      <link href="/2020/08/17/Static_vs_Shared_Lib/"/>
      <url>/2020/08/17/Static_vs_Shared_Lib/</url>
      
        <content type="html"><![CDATA[<p>å‰›å¥½åœ¨è¤‡ç¿’Golangçš„æ™‚å€™çœ‹åˆ°Goæœ‰æ”¯æ´è¼‰å…¥C Languageçš„Static Libraryèˆ‡Shared Librariesï¼Œæ–¼æ˜¯ä¾†è¤‡ç¿’ä¸€ä¸‹ä»–å€‘ä¹‹é–“çš„å·®ç•°</p><a id="more"></a><h2 id="ä»‹ç´¹"><a href="#ä»‹ç´¹" class="headerlink" title="ä»‹ç´¹"></a>ä»‹ç´¹</h2><p>é¦–å…ˆè¦å…ˆäº†è§£ï¼ŒLibraryçš„æ„ç¾©ï¼Œå°±å–®ç´”ç‚ºä¸€å€‹æª”æ¡ˆ<br>å°‡æœƒå…±ç”¨çš„ç¨‹å¼ç¢¼æ‰“åŒ…å†ä¸€èµ·çš„æª”æ¡ˆå°±ç¨±ç‚ºLibrary</p><p>å‡è¨­ç¾åœ¨è‹¥è¦ä½¿ç”¨printé€™å€‹æ–¹æ³•ä¾†å°å‡ºæ±è¥¿åœ¨è¢å¹•ï¼Œ<br>æ•…å¯ä»¥å°‡printç·¨è­¯æˆLibraryï¼Œä¾›å„å€‹é–‹ç™¼è€…ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨è®“é–‹ç™¼è€…è‡ªå·±å®šç¾©printæ–¹æ³•ï¼Œè¦ç…©æƒ±å¦‚ä½•èˆ‡OSæºé€šä¸¦å°å‡ºç•«é¢çš„é‚è¼¯ç¨‹å¼ç¢¼</p><h3 id="Static-Library"><a href="#Static-Library" class="headerlink" title="Static Library"></a>Static Library</h3><p>Static Libararyé€šå¸¸ç‚ºæˆ‘å€‘è‡ªå·±å¯«å¥½çš„ç¨‹å¼ç¢¼ï¼Œç¶“éCompileä¹‹å¾Œï¼Œæ‰€å¾—åˆ°çš„å°±æ˜¯ Static Library</p><p>Sharedå‰‡æ˜¯æˆ‘å€‘ä¹Ÿæ˜¯å°‡ç¨‹å¼ç¢¼ç¶“éCompileï¼Œä¹Ÿæ˜¯å¾—åˆ° Shared Library</p><p>è½èµ·ä¾†éç¨‹éƒ½å¾ˆåƒï¼Œé‚£åˆ°åº•å·®ç•°åœ¨å“ªï¼Ÿ</p><p>å…¶å¯¦å¾å­—é¢ä¸Šæ›‰å¾—ï¼Œå¾ä½¿ç”¨å…¶æ„ç¾©ä¾†è§£é‡‹</p><p>åœ¨å°ˆæ¡ˆç¨‹å¼ä½¿ç”¨å…¶Static Libraryæ™‚ï¼Œè©²å°ˆæ¡ˆé€²è¡ŒCompileï¼ŒCompileræœƒåœ¨Compile Timeæ™‚å°‡Static Libraryçš„ç¨‹å¼ç¢¼çµ¦â€è¤‡è£½â€åˆ°å°ˆæ¡ˆç¨‹å¼ç¢¼ä¸­ã€‚</p><p>å‡å¦‚æˆ‘å€‘Static Libä¸­æœ‰å€‹<code>print()</code>æ–¹æ³•ï¼Œé‚£å°ˆæ¡ˆCompileæ™‚å°±æœƒæŠŠ<code>print()</code>æ–¹æ³•copyåˆ°APPä¸­ï¼ŒAPPå•Ÿå‹•æ™‚å°±æœƒæœ‰<code>print()</code>æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE (import static lib) -&gt; Compiled STATIC Lib</span><br><span class="line">APP å•Ÿå‹• -&gt; PRINT()</span><br></pre></td></tr></table></figure><h3 id="Shared-Library"><a href="#Shared-Library" class="headerlink" title="Shared Library"></a>Shared Library</h3><p>é¡§åæ€ç¾©å°±æ˜¯ç›´æ¥å…±äº«Libraryå…§çš„ç¨‹å¼ç¢¼</p><p>ç•¶å°ˆæ¡ˆä½¿ç”¨çš„æ˜¯Shared Libraryï¼Œé‚£å°ˆæ¡ˆé€²è¡ŒCompileæ™‚ï¼ŒCompileræœƒå»<code>Link</code> Shared Libarayçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç”¨è¤‡è£½çš„ã€‚</p><p>å‡å¦‚Shared Library Libä¸­åŒæ¨£æœ‰å€‹<code>print()</code>æ–¹æ³•ï¼Œé‚£å°ˆæ¡ˆCompileå°±æœƒé€£çµè©²Shared Libä¸­çš„<code>print()</code>æ–¹æ³•ï¼Œæ–¼æ˜¯APPå•Ÿå‹•ä¹ŸåŒæ¨£æœƒæœ‰<code>print()</code>æ–¹æ³•å¯ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CODE (import shared lib) -&gt; Compiled</span><br><span class="line">APP å•Ÿå‹• -&gt; é€£çµä½¿ç”¨ Shared Libå…§çš„ print()</span><br></pre></td></tr></table></figure><blockquote><p>Shared Libraryæ”¯æ´å‹•æ…‹é€£çµè¼‰å…¥</p></blockquote><h2 id="ä½¿ç”¨æƒ…å¢ƒ"><a href="#ä½¿ç”¨æƒ…å¢ƒ" class="headerlink" title="ä½¿ç”¨æƒ…å¢ƒ"></a>ä½¿ç”¨æƒ…å¢ƒ</h2><p>è‹¥è¦çµ¦å®¢æˆ¶æä¾›ä¸€å€‹æœ‰100å€‹åŠŸèƒ½çš„APP</p><p>äº¤ä»˜çµ¦å®¢æˆ¶çš„è‹¥æ˜¯ Static Libraryå»ºç¯‰å‡ºçš„APP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ¶è½è‘—ï¼Œä½ åªè¦æœ‰é€™ä¸€å€‹æª”æ¡ˆï¼Œå°±åŒ…å«äº†ä½ éœ€è¦çš„100å€‹åŠŸèƒ½</span><br></pre></td></tr></table></figure><p>è‹¥äº¤ä»˜çµ¦å®¢æˆ¶çš„åŠŸèƒ½ï¼Œæ¯ä¸€éš»åŠŸèƒ½éƒ½ç”¨Shared Libraryå¯¦ä½œï¼Œé‚£éº¼ã€‚ã€‚ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®¢æˆ¶è½è‘—ï¼Œæˆ‘é€™å€‹æª”æ¡ˆå¾ˆå°ï¼Œä½†åŒæ™‚è¦é€£çµ100çš„æª”æ¡ˆ (Shared Library)ï¼Œä¸€å€‹éƒ½ä¸èƒ½å°‘ï¼Œæ‰èƒ½å•Ÿå‹•</span><br></pre></td></tr></table></figure><h2 id="å„ªç¼ºé»"><a href="#å„ªç¼ºé»" class="headerlink" title="å„ªç¼ºé»"></a>å„ªç¼ºé»</h2><table><thead><tr><th></th><th>Static</th><th>Shared</th></tr></thead><tbody><tr><td>å°ˆæ¡ˆå¤§å°</td><td>å°ˆæ¡ˆsizeæ¯”è¼ƒè‚¥å¤§</td><td>å°ˆæ¡ˆçš„sizeè¼ƒå°</td></tr><tr><td>å•Ÿå‹•ç‹€æ³</td><td>ç¨‹å¼ç¢¼åœ¨Compileæ™‚éƒ½æ”¾åœ¨ä¸€èµ·äº†ï¼Œç›´æ¥é‹è¡Œè©²å°ˆæ¡ˆå°±å¥½</td><td>è‹¥æŸå€‹Shared Libä¸è¦‹ï¼Œå°ˆæ¡ˆæœƒç„¡æ³•å•Ÿå‹•</td></tr><tr><td>æ˜¯å¦æ”¯æ´å‹•æ…‹é€£çµ</td><td>ç„¡ï¼Œå°ˆæ¡ˆé‹ä½œæ™‚è¼ƒè€—è²»è¨˜æ†¶é«”</td><td>æœ‰æ”¯æ´ï¼Œç•¶åŸ·è¡Œåˆ°æœ‰ä½¿ç”¨Shared Libraryçš„classæ™‚ï¼Œæ‰æœƒè¼‰å…¥ä¹‹åˆ°è¨˜æ†¶é«”ï¼Œé¿å…è¨˜æ†¶é«”ç©ºé–“æµªè²»</td></tr></tbody></table><h2 id="Libraryç·¨è­¯çš„æª”æ¡ˆæ ¼å¼"><a href="#Libraryç·¨è­¯çš„æª”æ¡ˆæ ¼å¼" class="headerlink" title="Libraryç·¨è­¯çš„æª”æ¡ˆæ ¼å¼"></a>Libraryç·¨è­¯çš„æª”æ¡ˆæ ¼å¼</h2><ul><li><p>Shared Libraries</p><ul><li>.so (Linus)</li><li>.dll (Win)</li><li>.dylib (Mac)</li></ul></li><li><p>Static Libraries</p><ul><li>.a</li><li>.lib</li></ul></li></ul><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><p>Static vs. Shared Libraries<br><a href="https://www.youtube.com/watch?v=-vp9cFQCQCo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=-vp9cFQCQCo</a></p><p>Static èˆ‡ Shared çš„å‡½å¼åº«æ’°å¯«<br><a href="https://fred-zone.blogspot.com/2006/03/static-shared.html" target="_blank" rel="noopener">https://fred-zone.blogspot.com/2006/03/static-shared.html</a></p><p>å‹•æ…‹é€£çµå‡½å¼åº«<br><a href="https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93</a></p>]]></content>
      
      
      <categories>
          
          <category> Computer Science </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Science </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>State Pattern ç‹€æ…‹æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/08/08/Design-Pattern-Java-State-Pattern-%E7%8B%80%E6%85%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/08/Design-Pattern-Java-State-Pattern-%E7%8B%80%E6%85%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>é€éçµ±ä¸€çš„â€ç‹€æ…‹é¡åˆ¥â€ï¼Œä¾†å®šç¾©ç‰©ä»¶çš„å…§éƒ¨ç‹€æ…‹æ˜¯å¦‚ä½•</p><a id="more"></a><h2 id="ä»¥ç³–æœæ©Ÿç‚ºä¾‹å­ï¼Œæ²’æœ‰ä½¿ç”¨State-Patternçš„ç‹€æ³"><a href="#ä»¥ç³–æœæ©Ÿç‚ºä¾‹å­ï¼Œæ²’æœ‰ä½¿ç”¨State-Patternçš„ç‹€æ³" class="headerlink" title="ä»¥ç³–æœæ©Ÿç‚ºä¾‹å­ï¼Œæ²’æœ‰ä½¿ç”¨State Patternçš„ç‹€æ³"></a>ä»¥ç³–æœæ©Ÿç‚ºä¾‹å­ï¼Œæ²’æœ‰ä½¿ç”¨State Patternçš„ç‹€æ³</h2><p>æˆ‘å€‘ç¾åœ¨æœ‰å€‹ç³–æœæ©Ÿï¼Œé€šå¸¸ä¸€å°ç³–æœæ©Ÿå¯ä»¥é€²è¡ŒæŠ•å¹£ï¼Œè½‰å‹•æ‰‹æŠŠï¼Œä¸¦åå‡ºä¸€é¡†ç³–æœ</p><p>æ‰€ä»¥è©²ç³–æœæ©Ÿå…±æœ‰å››ç¨®ç‹€æ…‹ (NoCoinStateç›®å‰æ²’æœ‰éŒ¢å¹£, HasCoinStateç›®å‰æœ‰éŒ¢å¹£, SoldCandyStateå”®å‡ºç³–æœä¸­, NoCandyStateæ²’æœ‰ç³–æœä¸­)ï¼Œå¦‚é™„åœ–æ‰€ç¤ºï¼š</p><p><img src="https://i.imgur.com/ulduLlN.png" alt=""></p><p>æˆ‘å€‘æœƒå¾ˆç›´è¦ºçš„å®šç¾©ç³–æœæ©Ÿé¡åˆ¥èˆ‡é€™å››å€‹ç‹€æ…‹ç‚ºå…¨åŸŸè®Šæ•¸ï¼Œä¸¦ä¸”å¯¦ä½œä¸€ä¸‹ç³–æœæ©Ÿå…·å‚™çš„å‹•ä½œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CandyMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> NoCandyState = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> NoCoinState = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> HasCoinState = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> SoldCandyState = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> state = NoCandyState; <span class="comment">// ä¸€é–‹å§‹ç³–æœæ©Ÿæ˜¯æ²’æœ‰ç³–æœçš„</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">// ç³–æœæ•¸ç›®</span></span><br><span class="line"></span><br><span class="line">    CandyMachine(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        <span class="keyword">this</span>.state = NoCoinState; <span class="comment">// æœ‰äº†ç³–æœï¼Œç­‰å¾…è¢«æŠ•éŒ¢</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æŠ•å…¥éŒ¢å¹£"</span>);</span><br><span class="line">        <span class="keyword">this</span>.state = HasCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è½‰å‹•æŠŠæ‰‹ä¸­......"</span>);</span><br><span class="line">        <span class="comment">// åˆ¤æ–·ç›®å‰æ˜¯å¦æœ‰éŒ¢</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state == HasCoinState) &#123;</span><br><span class="line">            <span class="keyword">this</span>.state = SoldCandyState;</span><br><span class="line">           <span class="keyword">this</span>.dispense();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"ç›®å‰æ²’æœ‰éŒ¢å¹£"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾†</span></span><br><span class="line">        System.out.println(<span class="string">"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ"</span>);</span><br><span class="line">        <span class="keyword">this</span>.count--;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²’æœ‰ç³–æœäº†ï¼Œå›æ­¸åˆ°æ²’ç³–æœç‹€æ…‹</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCandyState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// é‚„æœ‰ç³–æœçš„è©±ï¼Œé¡¯ç¤ºç›®å‰æ²’æœ‰éŒ¢å¹£</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCoinState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘å€‘ç¾åœ¨å¯ä»¥ä¾†è·Ÿç³–æœæ©Ÿäº’å‹•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CandyMachine candyMachine = <span class="keyword">new</span> CandyMachine(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•</span></span><br><span class="line">        System.out.println(<span class="string">"====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•===="</span>);</span><br><span class="line">        candyMachine.insertCoin();</span><br><span class="line">        candyMachine.turnCrank();</span><br><span class="line">        <span class="comment">// ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•</span></span><br><span class="line">        System.out.println(<span class="string">"====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•===="</span>);</span><br><span class="line">        candyMachine.turnCrank();</span><br><span class="line">        <span class="comment">// æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†</span></span><br><span class="line">        System.out.println(<span class="string">"=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†===="</span>);</span><br><span class="line">        candyMachine.insertCoin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====</span><br><span class="line">æŠ•å…¥éŒ¢å¹£</span><br><span class="line">è½‰å‹•æŠŠæ‰‹ä¸­......</span><br><span class="line">ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ</span><br><span class="line">====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====</span><br><span class="line">è½‰å‹•æŠŠæ‰‹ä¸­......</span><br><span class="line">ç›®å‰æ²’æœ‰éŒ¢å¹£</span><br><span class="line">=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†====</span><br><span class="line">æŠ•å…¥éŒ¢å¹£</span><br><span class="line">ç›®å‰æ²’æœ‰ç³–æœï¼ŒéŒ¢é€€é‚„çµ¦æ‚¨</span><br></pre></td></tr></table></figure><p>ç›®å‰çœ‹èµ·ä¾†é‹ä½œçš„å¾ˆæ­£å¸¸</p><h3 id="å‡å¦‚æœ‰æ–°éœ€æ±‚ï¼šè½‰å‹•æ™‚æœƒæœ‰æ©Ÿç‡å¯ä»¥å†å¤šé€ä¸€é¡†ï¼"><a href="#å‡å¦‚æœ‰æ–°éœ€æ±‚ï¼šè½‰å‹•æ™‚æœƒæœ‰æ©Ÿç‡å¯ä»¥å†å¤šé€ä¸€é¡†ï¼" class="headerlink" title="å‡å¦‚æœ‰æ–°éœ€æ±‚ï¼šè½‰å‹•æ™‚æœƒæœ‰æ©Ÿç‡å¯ä»¥å†å¤šé€ä¸€é¡†ï¼"></a>å‡å¦‚æœ‰æ–°éœ€æ±‚ï¼šè½‰å‹•æ™‚æœƒæœ‰æ©Ÿç‡å¯ä»¥å†å¤šé€ä¸€é¡†ï¼</h3><p>é‚£é€™æ™‚å€™â€¦æˆ‘å€‘å¾—å°CandyMachineçš„<code>dispense()</code>åšå€‹èª¿æ•´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šç¾©æ©Ÿç‡ï¼Œå¦‚æœæ©Ÿç‡å°æ–¼10%å°±åå‡ºå…©é¡†ç³–æœ</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">if</span> (rand.nextInt(<span class="number">10</span>) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.count &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// åå‡ºå…©é¡†ç³–æœ</span></span><br><span class="line">                <span class="keyword">this</span>.count--;</span><br><span class="line">                <span class="keyword">this</span>.count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ²’ä¸­çï¼Œåªåä¸€é¡†</span></span><br><span class="line">            <span class="keyword">this</span>.count--;</span><br><span class="line">            <span class="comment">// æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾†</span></span><br><span class="line">            System.out.println(<span class="string">"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²’æœ‰ç³–æœäº†ï¼Œå›æ­¸åˆ°æ²’ç³–æœç‹€æ…‹</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCandyState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// é‚„æœ‰ç³–æœçš„è©±ï¼Œé¡¯ç¤ºç›®å‰æ²’æœ‰éŒ¢å¹£</span></span><br><span class="line">            <span class="keyword">this</span>.state = NoCoinState;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è‹¥æœ‰æ–°éœ€æ±‚ï¼Œå°±éœ€è¦ä¸€ç›´å°CandyMachineé¡åˆ¥ä¸€ç›´åšä¿®æ­£ï¼Œå…¶æœªä¾†è‹¥æœ‰æ›´å¤šç‹€æ…‹æ™‚ï¼Œç¨‹å¼ç¢¼æœƒè®Šå¾—ä¸å¥½ç¶­è­·</p><h2 id="ä½¿ç”¨ç‹€æ…‹æ¨¡å¼æ”¹å–„ç›®å‰ç³–æœæ©Ÿçš„è¨­è¨ˆ"><a href="#ä½¿ç”¨ç‹€æ…‹æ¨¡å¼æ”¹å–„ç›®å‰ç³–æœæ©Ÿçš„è¨­è¨ˆ" class="headerlink" title="ä½¿ç”¨ç‹€æ…‹æ¨¡å¼æ”¹å–„ç›®å‰ç³–æœæ©Ÿçš„è¨­è¨ˆ"></a>ä½¿ç”¨ç‹€æ…‹æ¨¡å¼æ”¹å–„ç›®å‰ç³–æœæ©Ÿçš„è¨­è¨ˆ</h2><p>å…ˆä¾†çœ‹çœ‹è©²è¨­è¨ˆæ¨¡å¼çš„åœ–è¡¨æ˜¯é•·æ€æ¨£</p><h3 id="ç‹€æ…‹æ¨¡å¼çš„é¡åˆ¥åœ–"><a href="#ç‹€æ…‹æ¨¡å¼çš„é¡åˆ¥åœ–" class="headerlink" title="ç‹€æ…‹æ¨¡å¼çš„é¡åˆ¥åœ–"></a>ç‹€æ…‹æ¨¡å¼çš„é¡åˆ¥åœ–</h3><p><img src="https://i.imgur.com/umZlxP3.png" alt=""></p><p>é€™æ™‚æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œå°‡åŸæœ¬ç³–æœæ©Ÿå…§çš„staticå…¨åŸŸè®Šæ•¸ç‹€æ…‹ï¼Œéƒ½çµ±ä¸€è®Šæˆä¸€å€‹stateè®Šæ•¸ (ç‚ºStateComponentä»‹é¢å‹æ…‹)ã€‚</p><p>é€™æ™‚æˆ‘å€‘å°±æƒ³æŠŠæ¯å€‹ç‹€æ…‹ (NoCoinStateç›®å‰æ²’æœ‰éŒ¢å¹£, HasCoinStateç›®å‰æœ‰éŒ¢å¹£, SoldCandyStateå”®å‡ºç³–æœä¸­, NoCandyStateæ²’æœ‰ç³–æœä¸­) éƒ½çµ±ä¸€è®Šæˆ <code>ConcreteState</code>é¡åˆ¥ï¼Œä¾†å¯¦ä½œ<code>StateæŠ½è±¡ä»‹é¢</code>ï¼Œä»¥åˆ©<code>Clienté¡åˆ¥</code>å¯ä»¥æŠ½æ›ç‹€æ…‹</p><p>æ¥è‘—ç›´æ¥ä¾†æ”¹é€ ç³–æœæ©Ÿï¼Œå…ˆå®šç¾©æ¯å€‹ç‹€æ…‹éƒ½æœƒæœ‰å°æ‡‰çš„æ–¹æ³•</p><p>å› ç‚ºç•¶ç³–æœæ©Ÿç‚ºæŸç¨®ç‹€æ…‹æ™‚ï¼Œè‹¥å‘¼å«å…¶å‹•ä½œï¼Œå°±æœƒå°å‡ºå°æ‡‰çš„è³‡è¨Š</p><p>é€™è£¡æˆ‘å€‘å…ˆç‚ºæ¯å€‹å‹•ä½œéƒ½å…ˆæ‹‹å‡ºä¾‹å¤–ï¼Œå› ç‚ºæœ‰äº›æ–¹æ³•æœ‰çš„ç‹€æ…‹å¯èƒ½ä¸éœ€è¦ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®šç¾©ç³–æœæ©Ÿçš„é››å½¢"><a href="#å®šç¾©ç³–æœæ©Ÿçš„é››å½¢" class="headerlink" title="å®šç¾©ç³–æœæ©Ÿçš„é››å½¢"></a>å®šç¾©ç³–æœæ©Ÿçš„é››å½¢</h3><p>ç³–æœæ©Ÿæ“æœ‰äº†å„å€‹ç‹€æ…‹çš„é¡åˆ¥ï¼Œä¸¦ä¸”æä¾›<code>getXXX()</code>æ–¹æ³•ï¼Œä¾›å…¶ä»–ç‹€æ…‹å¯ä»¥æŠ½æ›è‡ªå·±çš„ç‹€æ…‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CandyMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> State state;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    State noCoinState;</span><br><span class="line">    State hasCoinState;</span><br><span class="line">    State soldCandyState;</span><br><span class="line">    State noCandyState;</span><br><span class="line"></span><br><span class="line">    CandyMachine(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        noCoinState = <span class="keyword">new</span> NoCoinState(<span class="keyword">this</span>);</span><br><span class="line">        hasCoinState = <span class="keyword">new</span> HasCoinState(<span class="keyword">this</span>);</span><br><span class="line">        soldCandyState = <span class="keyword">new</span> SoldCandyState(<span class="keyword">this</span>);</span><br><span class="line">        noCandyState = <span class="keyword">new</span> NoCandyState(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoCoinState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.noCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getHasCoinState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.hasCoinState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getSoldCandyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.soldCandyState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getNoCandyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.noCandyState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¦ä½œå„å€‹ç‹€æ…‹"><a href="#å¯¦ä½œå„å€‹ç‹€æ…‹" class="headerlink" title="å¯¦ä½œå„å€‹ç‹€æ…‹"></a>å¯¦ä½œå„å€‹ç‹€æ…‹</h3><p>æ¯å€‹ç‹€æ…‹éƒ½æœƒå¼•å…¥<code>CandyMachin</code>é¡åˆ¥ï¼Œä»¥ä¾¿èƒ½å¤ å¹«åŠ©ç³–æœæ©Ÿé€²è¡Œç‹€æ…‹è®ŠåŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCoinState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    NoCoinState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æŠ•å…¥éŒ¢å¹£"</span>);</span><br><span class="line">        <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getHasCoinState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ²’æœ‰éŒ¢å¹£"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HasCoinState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    HasCoinState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰å·²ç¶“æœ‰éŒ¢å¹£äº†ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è½‰å‹•æ‰‹æŠŠä¸­"</span>);</span><br><span class="line">        <span class="comment">// åˆ‡æ›åˆ°ä¸‹ä¸€å€‹ç‹€æ…‹</span></span><br><span class="line">        candyMachine.setState(<span class="keyword">this</span>.candyMachine.getSoldCandyState());</span><br><span class="line">        <span class="keyword">this</span>.candyMachine.state.dispense();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ²’æœ‰éŒ¢å¹£"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoldCandyState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    SoldCandyState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ­£åœ¨åç³–æœä¸­ï¼Œè«‹å‹¿æŠ•å¹£ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ­£åœ¨åç³–æœä¸­ï¼Œè«‹å‹¿è½‰å‹•ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é–‹å§‹åç³–æœ"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šç¾©æ©Ÿç‡ï¼Œå¦‚æœæ©Ÿç‡å°æ–¼10%å°±åå‡ºå…©é¡†ç³–æœ</span></span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">if</span> (rand.nextInt(<span class="number">10</span>) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.candyMachine.count &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// åå‡ºå…©é¡†ç³–æœ</span></span><br><span class="line">                <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">                <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ²’ä¸­çï¼Œåªåä¸€é¡†</span></span><br><span class="line">            <span class="keyword">this</span>.candyMachine.count--;</span><br><span class="line">            <span class="comment">// æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾†</span></span><br><span class="line">            System.out.println(<span class="string">"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.candyMachine.count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getNoCandyState());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.candyMachine.setState(<span class="keyword">this</span>.candyMachine.getNoCoinState());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCandyState</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    CandyMachine candyMachine;</span><br><span class="line">    NoCandyState(CandyMachine candyMachine) &#123;</span><br><span class="line">        <span class="keyword">this</span>.candyMachine = candyMachine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCoin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£ï¼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ“ä½œç³–æœæ©Ÿ"><a href="#æ“ä½œç³–æœæ©Ÿ" class="headerlink" title="æ“ä½œç³–æœæ©Ÿ"></a>æ“ä½œç³–æœæ©Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CandyMachine candyMachine = <span class="keyword">new</span> CandyMachine(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•</span></span><br><span class="line">        System.out.println(<span class="string">"====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•===="</span>);</span><br><span class="line">        candyMachine.state.insertCoin();</span><br><span class="line">        candyMachine.state.turnCrank();</span><br><span class="line">        <span class="comment">// ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•</span></span><br><span class="line">        System.out.println(<span class="string">"====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•===="</span>);</span><br><span class="line">        candyMachine.state.turnCrank();</span><br><span class="line">        <span class="comment">// æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†</span></span><br><span class="line">        System.out.println(<span class="string">"=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿå¯èƒ½ç›®å‰æ²’ç³–æœäº†===="</span>);</span><br><span class="line">        candyMachine.state.insertCoin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====</span><br><span class="line">æŠ•å…¥éŒ¢å¹£</span><br><span class="line">è½‰å‹•æ‰‹æŠŠä¸­</span><br><span class="line">é–‹å§‹åç³–æœ</span><br><span class="line">æ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ</span><br><span class="line">====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====</span><br><span class="line">ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£</span><br><span class="line">=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†====</span><br><span class="line">ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£ï¼</span><br></pre></td></tr></table></figure><p>ç”¨é€™å¼µåœ–å¯ä»¥æ›´äº†è§£ç³–æœæ©Ÿæ˜¯å¦‚ä½•èˆ‡ç‹€æ…‹å€‘åšäº’å‹•</p><p><img src="https://i.imgur.com/MjhyGVD.png" alt=""></p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>æˆ‘å€‘å¯ä»¥çœ‹åˆ°å¥—ç”¨ç‹€æ…‹æ¨¡å¼å¾Œï¼Œè‹¥æœªä¾†è¦æ–°å¢ç‹€æ…‹æ™‚ï¼Œç›´æ¥å¯¦ä½œ<code>State</code>æŠ½è±¡é¡åˆ¥ï¼Œä¸¦ä¸”åªæœƒéœ€è¦æ›´å‹•åˆ°è·Ÿæ–°å¢ç‹€æ…‹é¡åˆ¥çš„ç›¸é—œé€£ç‹€æ…‹ï¼Œä½¿å¾—æˆ‘å€‘ç¨‹å¼æ›´å¥½ç¶­è­·</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Composite Pattern åˆæˆæ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/08/06/Design-Pattern-Java-Composite-Pattern-%E5%90%88%E6%88%90%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/06/Design-Pattern-Java-Composite-Pattern-%E5%90%88%E6%88%90%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å°‡æœ‰éšå±¤é—œä¿‚çš„é¡åˆ¥ç‹€æ…‹çµ¦æ‰å¹³åŒ–ï¼Œçµ¦ä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ä¸€è‡´æ€§çš„é—œä¿‚</p><a id="more"></a><h2 id="è‹¥æ²’æœ‰åˆæˆæ¨¡å¼æœƒæ€æ¨£ï¼Ÿ"><a href="#è‹¥æ²’æœ‰åˆæˆæ¨¡å¼æœƒæ€æ¨£ï¼Ÿ" class="headerlink" title="è‹¥æ²’æœ‰åˆæˆæ¨¡å¼æœƒæ€æ¨£ï¼Ÿ"></a>è‹¥æ²’æœ‰åˆæˆæ¨¡å¼æœƒæ€æ¨£ï¼Ÿ</h2><p>å‡å¦‚ç¾åœ¨æˆ‘å€‘ä¾†åˆ°ä¸€é–“è‡ªåŠ©å§ï¼Œæœ‰ä¸€å€‹èœå–®é¡åˆ¥ï¼Œä½†é€™å€‹èœå–®é¡åˆ¥è£¡é¢é‚„æœƒæœ‰ç”œé»é€™å€‹å­èœå–®</p><p>å¤§æ¦‚é•·ä¸‹é¢é€™æ¨£</p><p><img src="https://i.imgur.com/iLWjwr3.png" alt=""></p><p>æ–¼æ˜¯æˆ‘å€‘å¤§æ¦‚æœƒé€™æ¨£å¯¦ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuffetMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    DessertMenu dessertMenu;</span><br><span class="line"></span><br><span class="line">    BuffetMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"è‡ªåŠ©é¤èœå–®"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.dessertMenu = <span class="keyword">new</span> DessertMenu();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é …ç›®</span></span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"ç‰›è‚‰éºµ"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"æµ·é®®é£¯"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"ç‰›æ’"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é–‹å§‹ä»‹ç´¹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">        showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    ChocolateMenu chocolateMenu;</span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"ç”œé»èœå–®"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"é›è›‹é¤…ä¹¾"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"å·§å…‹åŠ›"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"æ£‰èŠ±ç³–"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é–‹å§‹ä»‹ç´¹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">        showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°DessertMenué¡åˆ¥åŒ…å«åœ¨BuffetMenué¡åˆ¥äº†</p><p>æˆ‘å€‘ç¾åœ¨æœ‰ä½æœå‹™ç”Ÿæä¾›ä»‹ç´¹èœå–®å…§å®¹ï¼Œå®šç¾©å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    BuffetMenu buffetMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(BuffetMenu buffetMenu) &#123;</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu = buffetMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»‹ç´¹èœå–®</span></span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.showMenuItem();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.showMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å¾Œæˆ‘å€‘è«‹æœå‹™ç”Ÿé–‹å§‹ä»‹ç´¹èœå–®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BuffetMenu buffetMenu = <span class="keyword">new</span> BuffetMenu();</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(buffetMenu);</span><br><span class="line"></span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é–‹å§‹ä»‹ç´¹è‡ªåŠ©é¤èœå–®</span><br><span class="line">è‡ªåŠ©é¤èœå–®:ç‰›è‚‰éºµ</span><br><span class="line">è‡ªåŠ©é¤èœå–®:æµ·é®®é£¯</span><br><span class="line">è‡ªåŠ©é¤èœå–®:ç‰›æ’</span><br><span class="line">é–‹å§‹ä»‹ç´¹ç”œé»èœå–®</span><br><span class="line">ç”œé»èœå–®:é›è›‹é¤…ä¹¾</span><br><span class="line">ç”œé»èœå–®:æ£‰èŠ±ç³–</span><br><span class="line">ç”œé»èœå–®:å·§å…‹åŠ›</span><br></pre></td></tr></table></figure><p>ä½†å‡å¦‚ç¾åœ¨è®Šæˆé€™æ¨£å‘¢ï¼šç”œé»å…§çš„å·§å…‹åŠ›åˆæœ‰ä¸åŒé¡å‹çš„å·§å…‹åŠ›ï¼Œé‚£æˆ‘å€‘åˆè¦å†ä¿®æ”¹ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œå°‡Chocolateé¡åˆ¥åŠ å…¥åˆ°Desserté¡åˆ¥å…§</p><p><img src="https://i.imgur.com/otznRfN.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line">    ChocolateMenu chocolateMenu; <span class="comment">// å¤šäº†å·§å…‹åŠ›èœå–®</span></span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.chocolateMenu = <span class="keyword">new</span> ChocolateMenu();</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"ç”œé»èœå–®"</span>;</span><br><span class="line">        <span class="keyword">this</span>.items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"é›è›‹é¤…ä¹¾"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"æ£‰èŠ±ç³–"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é–‹å§‹ä»‹ç´¹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šäº†å·§å…‹åŠ›èœå–®</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChocolateMenu</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    ArrayList&lt;String&gt; items;</span><br><span class="line"></span><br><span class="line">    ChocolateMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"å·§å…‹åŠ›èœå–®"</span>;</span><br><span class="line">        items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"ç™½å·§å…‹åŠ›"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"é»‘å·§å…‹åŠ›"</span>);</span><br><span class="line">        <span class="keyword">this</span>.items.add(<span class="string">"é…’é‡€å·§å…‹åŠ›"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String item: items) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.name + <span class="string">":"</span> + item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é–‹å§‹ä»‹ç´¹"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚è¦ä¿®æ”¹æœå‹™ç”Ÿçš„è…¦è¢‹ï¼Œä½¿å…¶çŸ¥é“å·§å…‹åŠ›èœå–®çš„å…§å®¹ã€‚ã€‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    BuffetMenu buffetMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(BuffetMenu buffetMenu) &#123;</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu = buffetMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»‹ç´¹èœå–®</span></span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.print();</span><br><span class="line">        <span class="keyword">this</span>.buffetMenu.dessertMenu.chocolateMenu.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†é€™æ™‚å€™å°±æœƒç™¼ç¾ï¼Œæ¯æ¬¡è‹¥æ–°å¢ä¸€å€‹å­èœå–®æ™‚ï¼Œå‘¼å«è€…å°±éœ€è¦ç›´æ¥å°å…¶æ“ä½œï¼Œæ‰èƒ½å¤ å°å‡ºè©²å­èœå–®çš„é …ç›®åˆ—è¡¨</p><p>ä¸€ä½†å­èœå–®å…§åˆæœ‰å­èœå–®ï¼Œé‚£æ•´å€‹ç¨‹å¼ç¢¼çš„ç¶­è­·çš„ä»£åƒ¹å°±æœƒéå¸¸çš„é«˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯ä»¥çœ‹åˆ°å­èœå–®å…§è‹¥åˆæœ‰å­èœå–®ï¼Œè¦å°å‡ºè©²åç¨±çš„è©±ï¼Œé‚£é€™è¡Œç¨‹å¼ç¢¼æœƒè¶Šä¾†è¶Šé•·ã€‚ã€‚ã€‚</span><br><span class="line"></span><br><span class="line">this.buffetMenu.dessertMenu.chocolateMenu.print();</span><br></pre></td></tr></table></figure><h3 id="ç¶­è­·ä¿®æ”¹çš„ä»£åƒ¹"><a href="#ç¶­è­·ä¿®æ”¹çš„ä»£åƒ¹" class="headerlink" title="ç¶­è­·ä¿®æ”¹çš„ä»£åƒ¹"></a>ç¶­è­·ä¿®æ”¹çš„ä»£åƒ¹</h3><p>èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æƒ³è¦å«æœå‹™ç”Ÿèªªæ˜ï¼Œå“ªäº›èœ/ç”œé»æ˜¯ç´ é£Ÿçš„ï¼Œé€™æ™‚æœƒæ”¹codeæ”¹åˆ°æƒ³å“­</p><h2 id="è§£æ±ºæœå‹™ç”Ÿä¸ç”¨ç¬¨æ‹™åœ°å­˜å–èœå–®èˆ‡å…¶å­èœå–®å€‘ï¼šåˆæˆæ¨¡å¼ç™»å ´"><a href="#è§£æ±ºæœå‹™ç”Ÿä¸ç”¨ç¬¨æ‹™åœ°å­˜å–èœå–®èˆ‡å…¶å­èœå–®å€‘ï¼šåˆæˆæ¨¡å¼ç™»å ´" class="headerlink" title="è§£æ±ºæœå‹™ç”Ÿä¸ç”¨ç¬¨æ‹™åœ°å­˜å–èœå–®èˆ‡å…¶å­èœå–®å€‘ï¼šåˆæˆæ¨¡å¼ç™»å ´"></a>è§£æ±ºæœå‹™ç”Ÿä¸ç”¨ç¬¨æ‹™åœ°å­˜å–èœå–®èˆ‡å…¶å­èœå–®å€‘ï¼šåˆæˆæ¨¡å¼ç™»å ´</h2><p>åˆæˆæ¨¡å¼ä¸»è¦å¹«æˆ‘å€‘å»ºç«‹ä¸€å€‹é¡åˆ¥é—œä¿‚ï¼Œå»ºç«‹èµ·çˆ¶é¡åˆ¥èˆ‡å­é¡åˆ¥çš„éšå±¤é—œä¿‚ï¼Œä¸¦è®“å®¢æˆ¶ç«¯ä»¥ä¸€è‡´çš„æ–¹å¼å­˜å–æ¨¹ç‹€çµæ§‹å…§çš„å„å€‹é¡åˆ¥</p><p>å…ˆè¬›çµè«–ï¼Œä»¥ä¸Šçš„èœå–®å€‘ï¼Œå¥—ç”¨åˆæˆæ¨¡å¼å¾Œï¼Œæœå‹™ç”Ÿä¸ç”¨é€éä»¥ä¸‹æ–¹å¼å­˜å–å­èœå–®ä¸¦ä»‹ç´¹å‡ºä¾†äº†ï¼Œè€Œæ˜¯ç›´æ¥å¯ä»¥ç”¨ä¸€è‡´çš„æ–¹å¼å°‡æ‰€æœ‰èœå–®èˆ‡å­èœå–®éƒ½å‘¼å«å‡ºä¾†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void introduceMenu() &#123;</span><br><span class="line">       // ä»‹ç´¹èœå–® &lt;-- å¯ä»¥ä¸ç”¨ä¸€ä¸€åœ¨å‘¼å«èœå–®èˆ‡å­èœå–®å’Œå­èœå–®çš„å­èœå–®ã€‚ã€‚ã€‚</span><br><span class="line">       public void introduceMenu() &#123;</span><br><span class="line">       // ä»‹ç´¹èœå–®</span><br><span class="line">       this.buffetMenu.print();</span><br><span class="line">       this.buffetMenu.showMenuItem();</span><br><span class="line">       this.buffetMenu.dessertMenu.print();</span><br><span class="line">       this.buffetMenu.dessertMenu.showMenuItem();</span><br><span class="line">       this.buffetMenu.dessertMenu.chocolateMenu.print();</span><br><span class="line">       this.buffetMenu.dessertMenu.chocolateMenu.showMenuItem();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>é€™æ™‚æˆ‘å€‘å…ˆä¾†çœ‹ åˆæˆæ¨¡å¼ çš„é¡åˆ¥é—œä¿‚åœ–</p><p><img src="https://i.imgur.com/a4ZZBAI.png" alt=""></p><ul><li>Componenté¡åˆ¥ï¼šå®šç¾©äº†å…¶æ‰€æœ‰åº•ä¸‹è‘‰ç¯€é»èˆ‡åˆæˆé¡åˆ¥çš„çµæ§‹<ul><li>æ‰€æœ‰çš„Leafç¯€é»èˆ‡Compositeç¯€é»éƒ½æœƒç¹¼æ‰¿(å¯¦ä½œ)è©²Componenté¡åˆ¥</li><li>Componentæ˜¯è€å¤§å“¥ï¼Œè€å¤§å“¥æœƒçš„ä¸‹é¢çš„ä¹Ÿæœƒå­¸åˆ°</li></ul></li><li>Leafé¡åˆ¥ï¼šæœƒå¯¦ä½œComponenté¡åˆ¥ï¼Œä½†ç”±æ–¼Leafç¯€é»æ²’æœ‰å­é¡åˆ¥ï¼Œæ‰€ä»¥åªæœƒæœ‰operation()çš„æ–¹æ³•ä¾›å‘¼å«</li><li>Compositeé¡åˆ¥ï¼šåˆæˆé¡åˆ¥ï¼Œå°‡ä»¥ä¸‹å…©é»åšåˆæˆ<ul><li>æ‰€è¦åŸ·è¡Œçš„åŠŸèƒ½<code>operation()</code></li><li>ç®¡ç†å­é¡åˆ¥çš„æ–¹æ³• <code>add()</code> <code>remove()</code> <code>getChild()</code></li></ul></li></ul><p>å°æ‡‰Compositeé¡åˆ¥é—œä¿‚åœ–åˆ°æˆ‘å€‘ä¸Šè¿°æ‰€ç•«çš„èœå–®é—œä¿‚åœ–ï¼Œå°±æœƒé•·å¾—å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/g5tB4GT.png" alt=""></p><p>æŠŠä¸Šé¢æ‰€æåˆ°çš„é€™å¼µåœ–ä½œè½‰æ›</p><p><img src="https://i.imgur.com/otznRfN.png" alt=""></p><p>å°±æœƒè®Šæˆé€™æ¨£å­ (çœç•¥Chocolateé¡åˆ¥çš„èœå–®é …ç›®)</p><p><img src="https://i.imgur.com/Rez9N4I.png" alt=""></p><h3 id="å®šç¾©MenuComponentæŠ½è±¡é¡åˆ¥"><a href="#å®šç¾©MenuComponentæŠ½è±¡é¡åˆ¥" class="headerlink" title="å®šç¾©MenuComponentæŠ½è±¡é¡åˆ¥"></a>å®šç¾©MenuComponentæŠ½è±¡é¡åˆ¥</h3><p>å®šç¾©MenuComponent, æä¾›èœå–®åŸºæœ¬çš„æ–¹æ³•</p><p>é€™é‚Šä¸»è¦ä¸æ˜¯å®šç¾©æˆInterface, è€Œæ˜¯æŠ½è±¡é¡åˆ¥çš„ä¸»è¦åŸå› æ˜¯å› ç‚ºï¼Œæˆ‘å€‘æœƒçµ¦ å­èœå–®å»ç¹¼æ‰¿èœå–®æ‰€å…·æœ‰çš„æ–¹æ³•</p><p>ä½†åˆå› æœƒçµ¦èœå–®é …ç›®(MenuItem)ç¹¼æ‰¿(å¦‚ ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’)ï¼Œ<br>ä½†èœå–®é …ç›®ä¸éœ€è¦åƒæ˜¯ <code>add()</code>, <code>remove()</code>ç­‰æ–¹æ³•ï¼Œæ‰€ä»¥æœƒåœ¨è©²æ–¹æ³•å…§å…ˆæ‹‹å‡º <code>UnsupportedOperationException()</code></p><h4 id="Menu-java"><a href="#Menu-java" class="headerlink" title="Menu.java"></a>Menu.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘å€‘å®šç¾©äº†ä»¥ä¸‹æ–¹æ³•ï¼Œä¸¦ç­‰å¾…çœŸæ­£çš„èœå–®é¡åˆ¥ä¾†å¯¦ä½œå…¶ç´°ç¯€</p><ul><li>add(): å¯æ–°å¢ å¯¦ä½œMenuComponentçš„ç‰©ä»¶</li><li>remove(): ç§»é™¤ å¯¦ä½œMenuComponentçš„ç‰©ä»¶</li><li>getChild(): å–å¾—Menuå…§çš„èœå–®é …ç›®/å­èœå–®</li><li>getName(): å–å¾—èœå–®åç¨±</li><li>getPrice: å–å¾—èœå–®é …ç›®åƒ¹æ ¼</li><li>isVegetarian(): ç¢ºèªæ˜¯å¦ç‚ºç´ é£Ÿ</li><li>print(): å°å‡ºè‡ªå·±çš„æ‰€æœ‰èœå–®é …ç›®/å­èœå–®å…§å®¹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é‚„è¨˜å¾—æœ€ä¸Šé¢çš„è‹¥è¦è«‹æœå‹™ç”Ÿç¢ºèªèœè‰²æ˜¯å¦æ˜¯ç´ é£Ÿï¼Œä½†è¦åˆ°è™•ä¿®æ”¹çš„æ…˜ç—›çš„ç¶“é©—å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">é€™æ™‚å€™è‹¥åœ¨å…±é€šçš„ä»‹é¢ï¼Œå®šç¾©å¥½ä¸€å€‹isVegetarian(), è«‹èœè‰²è‡ªè¡Œæä¾›æ˜¯å¦æ˜¯ç´ é£Ÿï¼Œæ˜¯çš„è©±å›å‚³true, ä¸æ˜¯å°±å›å‚³false, å¦‚æ­¤ä¸€ä¾†æœå‹™ç”Ÿå°±å¯ä»¥åœ¨å‘¼å«print()æ™‚ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–·é€™é“é …ç›®æ˜¯å¦æ˜¯ç´ é£Ÿå›‰</span><br><span class="line"></span><br><span class="line">é—œæ–¼print()çš„å¯¦ç¾ç´°ç¯€å¾Œé¢æœƒä»‹ç´¹</span><br></pre></td></tr></table></figure><h3 id="é–‹å§‹å¯¦ä½œèœå–®å…ƒä»¶ï¼šå®šç¾©è‡ªåŠ©å¼èœå–®"><a href="#é–‹å§‹å¯¦ä½œèœå–®å…ƒä»¶ï¼šå®šç¾©è‡ªåŠ©å¼èœå–®" class="headerlink" title="é–‹å§‹å¯¦ä½œèœå–®å…ƒä»¶ï¼šå®šç¾©è‡ªåŠ©å¼èœå–®"></a>é–‹å§‹å¯¦ä½œèœå–®å…ƒä»¶ï¼šå®šç¾©è‡ªåŠ©å¼èœå–®</h3><p>æ¥è‘—é–‹å§‹å¯¦ä½œè‡ªåŠ©é¤çš„å®Œæ•´èœå–®å§ï¼</p><p>BuffetMenu.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuffetMenu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®£å‘Šè¦æ”¾ç½®èœå–®é …ç›®èˆ‡å­èœå–®çš„ArrayList</span></span><br><span class="line">    ArrayList&lt;MenuComponent&gt; menuItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// èœå–®åç¨±</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    BuffetMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"è‡ªåŠ©å¼èœå–®"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.add(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.remove(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menuItems.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"è‡ªåŠ©å¼èœå–®æä¾›äº†ä¸»èœå€‘(ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’), ä»¥åŠç”œé»èœå–®, è«‹ç›¡æƒ…äº«ç”¨ï¼"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ç”¨å¯¦ä½œgetPrice å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ç”¨å¯¦ä½œisVegetarian å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯èœå–®çš„è©±, printä½¿ç”¨iterator, å°‡ArrayListå‹æ…‹çš„menusä¸­çš„menuComponentä¸€ä¸€å–å‡ºä¾†, ä¸¦å‘¼å«</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line"></span><br><span class="line">        Iterator iterator = menuItems.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// å–å‡ºä¾†çš„å¯èƒ½æ˜¯èœå–®é …ç›®, ä¹Ÿå¯èƒ½æ˜¯å­èœå–®</span></span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            menuComponent.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨BuffetMenuä¸­ï¼Œå·²ç¶“é™¤äº† <code>getPrice()</code>å’Œ<code>isVegetarian()</code>é€™å…©é …èœå–®ä¸ç”¨å»å¯¦ä½œï¼Œå…¶ä»–éƒ½æœ‰å®šç¾©é‚è¼¯</p><p>é€™é‚Šè¦æ³¨æ„çš„æ˜¯ <code>print()</code> æˆ‘å€‘ä½¿ç”¨ iterator, å°‡èœå–®å…§çš„<code>MenuComponent</code>ä¸€ä¸€å–å‡ºä¾†ï¼Œä¸¦ä¸”åœ¨å‘¼å«å…¶<code>print()</code>, ä¾åºå°è‡ªåŠ©å¼èœå–®å…§çš„èœå–®é …ç›®åšä»‹ç´¹é€™æ¨£</p><h3 id="å®šç¾©èœå–®é …ç›®"><a href="#å®šç¾©èœå–®é …ç›®" class="headerlink" title="å®šç¾©èœå–®é …ç›®"></a>å®šç¾©èœå–®é …ç›®</h3><p>æ¥è‘—æˆ‘å€‘å®šç¾©ä¸€å€‹ç‰›è‚‰éºµé¡åˆ¥ <code>BeefNoodles</code>, å¯¦ä½œ <code>MenuComponent</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeefNoodles</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// èœå–®åç¨±</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å¥½åƒçš„ç‰›è‚‰éºµ, é“åœ°çš„å››å·å£å‘³ï½ï½"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">120</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isVegetarian</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">// ç‰›è‚‰éºµä¸æ˜¯ç´ é£Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸æ˜¯èœå–®, æ‰€ä»¥åªè¦å‘¼å«åç¨±èˆ‡æè¿°å°±å¥½</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getPrice());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±æ–¼ç‰›è‚‰éºµæ˜¯èœå–®çš„é …ç›®ï¼Œæ‰€ä»¥åªè¦å¯¦ä½œè·Ÿä»–è‡ªå·±æœ‰é—œçš„æ–¹æ³•å°±å¥½ï¼Œåœ¨<code>print()</code>ä¹Ÿåªè¦å°±å°å‡ºè‡ªå·±åç¨±æ˜¯ä»€éº¼ï¼Œä»¥åŠæè¿°, åƒ¹æ ¼ã€‚</p><h3 id="å¯¦ä½œå­èœå–®-ç”œé»èœå–®"><a href="#å¯¦ä½œå­èœå–®-ç”œé»èœå–®" class="headerlink" title="å¯¦ä½œå­èœå–®: ç”œé»èœå–®"></a>å¯¦ä½œå­èœå–®: ç”œé»èœå–®</h3><p>è·Ÿå‰›å‰›å¯¦ä½œè‡ªåŠ©é¤çš„ç´°ç¯€éå¸¸é¡ä¼¼</p><p>DessertMenu.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DessertMenu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®£å‘Šè¦æ”¾ç½®èœå–®é …ç›®èˆ‡å­èœå–®çš„ArrayList</span></span><br><span class="line">    ArrayList&lt;MenuComponent&gt; menuItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// èœå–®åç¨±</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    DessertMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"ç”œé»èœå–®"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.add(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(MenuComponent menuComponent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menuItems.remove(menuComponent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">MenuComponent <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menuItems.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ç”œé»èœå–®æä¾›äº†ä¸€æ˜Ÿç±³å…¶æ—ä¸»å»šæ‰€è£½ä½œçš„ç”œé»å€‘ï¼"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ç”¨å¯¦ä½œgetPrice å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ç”¨å¯¦ä½œisVegetarian å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯èœå–®çš„è©±, printä½¿ç”¨iterator, å°‡ArrayListå‹æ…‹çš„menusä¸­çš„menuComponentä¸€ä¸€å–å‡ºä¾†, ä¸¦å‘¼å«</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName());</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getDescription());</span><br><span class="line"></span><br><span class="line">        Iterator iterator = menuItems.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// å–å‡ºä¾†çš„å¯èƒ½æ˜¯èœå–®é …ç›®, ä¹Ÿå¯èƒ½æ˜¯å­èœå–®</span></span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            menuComponent.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€å¾Œä¹Ÿæ˜¯ä¸€æ¨£ï¼Œå°‡ç”œé»é …ç›®éƒ½å¯¦ä½œä¸€è¼ªï¼Œä¸éé€™é‚Šéƒ½å¾ˆé¡ä¼¼å°±ä¸æ•˜è¿°äº†</p><h3 id="é‡æ–°å®šç¾©æœå‹™ç”Ÿ"><a href="#é‡æ–°å®šç¾©æœå‹™ç”Ÿ" class="headerlink" title="é‡æ–°å®šç¾©æœå‹™ç”Ÿ"></a>é‡æ–°å®šç¾©æœå‹™ç”Ÿ</h3><p>å¯ä»¥çœ‹åˆ°æœå‹™ç”Ÿå¾ˆå¿«æ¨‚, åªè¦å‘¼å«MenuComponentçš„<code>print()</code>, å°±æŠŠæ‰€æœ‰èœå–®éƒ½ä»‹ç´¹å‡ºä¾†å›‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    MenuComponent menuComponent;</span><br><span class="line"></span><br><span class="line">    Waitress(MenuComponent menuComponent) &#123;</span><br><span class="line">        <span class="keyword">this</span>.menuComponent = menuComponent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é€™æ™‚åªè¦å‘¼å«print(), å°±å¯ä»¥æŠŠå…¨éƒ¨èœå–®çš„é …ç›®èˆ‡åç¨±éƒ½ä»‹ç´¹å‡ºä¾†äº†ï¼</span></span><br><span class="line">        <span class="keyword">this</span>.menuComponent.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ¶é–‹å§‹é€²ä¾†ï¼Œè«‹æœå‹™ç”Ÿä»‹ç´¹"><a href="#å®¢æˆ¶é–‹å§‹é€²ä¾†ï¼Œè«‹æœå‹™ç”Ÿä»‹ç´¹" class="headerlink" title="å®¢æˆ¶é–‹å§‹é€²ä¾†ï¼Œè«‹æœå‹™ç”Ÿä»‹ç´¹"></a>å®¢æˆ¶é–‹å§‹é€²ä¾†ï¼Œè«‹æœå‹™ç”Ÿä»‹ç´¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MenuComponent buffetMenu = <span class="keyword">new</span> BuffetMenu();</span><br><span class="line">        MenuComponent beefNoodles = <span class="keyword">new</span> BeefNoodles();</span><br><span class="line">        MenuComponent seaRice = <span class="keyword">new</span> SeaRice();</span><br><span class="line">        MenuComponent steak = <span class="keyword">new</span> Steak();</span><br><span class="line">        buffetMenu.add(beefNoodles);</span><br><span class="line">        buffetMenu.add(seaRice);</span><br><span class="line">        buffetMenu.add(steak);</span><br><span class="line">        <span class="comment">// å®šç¾©å­èœå–®</span></span><br><span class="line">        MenuComponent dessertMenu = <span class="keyword">new</span> DessertMenu();</span><br><span class="line">        MenuComponent eggCookie = <span class="keyword">new</span> EggCookie();</span><br><span class="line">        MenuComponent cottonCandy = <span class="keyword">new</span> CottonCandy();</span><br><span class="line">        dessertMenu.add(eggCookie);</span><br><span class="line">        dessertMenu.add(cottonCandy);</span><br><span class="line">        <span class="comment">// å°‡å­èœå–®åŠ å…¥è‡ªåŠ©å¼èœå–®</span></span><br><span class="line">        buffetMenu.add(dessertMenu);</span><br><span class="line"></span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(buffetMenu);</span><br><span class="line">        <span class="comment">// è«‹æœå‹™ç”Ÿé–‹å§‹ä»‹ç´¹ï¼</span></span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">è‡ªåŠ©å¼èœå–®</span><br><span class="line">è‡ªåŠ©å¼èœå–®æä¾›äº†ä¸»èœå€‘(ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’), ä»¥åŠç”œé»èœå–®, è«‹ç›¡æƒ…äº«ç”¨ï¼</span><br><span class="line">ç‰›è‚‰éºµ</span><br><span class="line">å¥½åƒçš„ç‰›è‚‰éºµ, é“åœ°çš„å››å·å£å‘³ï½ï½</span><br><span class="line">120.0</span><br><span class="line">æµ·é®®é£¯</span><br><span class="line">å¥½åƒçš„æµ·é®®é£¯ï½ï½</span><br><span class="line">200.0</span><br><span class="line">ç‰›æ’</span><br><span class="line">å¥½åƒçš„ç‰›æ’ï½ï½</span><br><span class="line">400.0</span><br><span class="line">ç”œé»èœå–®</span><br><span class="line">ç”œé»èœå–®æä¾›äº†ä¸€æ˜Ÿç±³å…¶æ—ä¸»å»šæ‰€è£½ä½œçš„ç”œé»å€‘ï¼</span><br><span class="line">é›è›‹é¤…ä¹¾</span><br><span class="line">é›è›‹å£å‘³çš„é¤…å–®, å¤§äººå°å­©éƒ½æ„›ï½ï½</span><br><span class="line">60.0</span><br><span class="line">æ£‰èŠ±ç³–</span><br><span class="line">æ£‰èŠ±ç³–å¥½æ»‹å‘³ï½ï½</span><br><span class="line">30.0</span><br></pre></td></tr></table></figure><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€éåˆæˆæ¨¡å¼, å°‡å–å¾—èœå–®èˆ‡å­èœå–®çš„å‹•ä½œçµ¦ä¸€è‡´åŒ–äº†</p><p>æœå‹™ç”Ÿåªè¦å‘¼å«å¯¦ä½œMenuComponentçš„èœå–®èˆ‡å­èœå–®å€‘, å°±å¯ä»¥ä¸€å£æ°£å°‡æ‰€æœ‰èœå–®èˆ‡å­èœå–®çš„é …ç›®å€‘å…¨éƒ½ä»‹ç´¹å‡ºä¾†ï¼</p><p>æœªä¾†è‹¥è¦æ“´å……å­èœå–®çš„é …ç›®ï¼Œä¹Ÿä¸ç”¨æ“”å¿ƒéœ€è¦å†ä¿®æ”¹æœå‹™ç”Ÿçš„é¡åˆ¥ï¼Œåªè¦æ–°çš„èœå–®æœ‰å¯¦ä½œMenuComponentå°±å¥½</p><p>é”åˆ° â€œå°ä¿®æ”¹é—œé–‰, å°æ“´å……é–‹æ”¾â€çš„åŸå‰‡ï¼</p><h2 id="å°‡æ¯å€‹èœå–®çš„Iteratorçµ¦åˆä½µèµ·ä¾†-IteratorComposite"><a href="#å°‡æ¯å€‹èœå–®çš„Iteratorçµ¦åˆä½µèµ·ä¾†-IteratorComposite" class="headerlink" title="å°‡æ¯å€‹èœå–®çš„Iteratorçµ¦åˆä½µèµ·ä¾†: IteratorComposite"></a>å°‡æ¯å€‹èœå–®çš„Iteratorçµ¦åˆä½µèµ·ä¾†: IteratorComposite</h2><p>é‚„è¨˜å¾—å‰›å‰›æœ‰æåˆ°å¦‚ä½•åˆ¤æ–·è©²èœå–®æ˜¯å¦æ˜¯ç´ é£Ÿçš„æƒ…æ³å‘¢ï¼Ÿï¼Ÿ</p><p>(å¾…çºŒ)</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Iterator Pattern åè¦†å™¨æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/08/03/Design-Pattern-Java-Iterator-Pattern-%E5%8F%8D%E8%A6%86%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/03/Design-Pattern-Java-Iterator-Pattern-%E5%8F%8D%E8%A6%86%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å°‡è™•ç†é™£åˆ—æˆ–æ˜¯å–å€¼æ–¹å¼çš„é‚è¼¯çµ¦å°è£èµ·ä¾†ï¼Œä¸éœ€è®“ä½¿ç”¨è€…ç›´æ¥è™•ç†æ“ä½œå–å€¼çš„é‚è¼¯</p><a id="more"></a><h2 id="æ²’æœ‰Iterator-Patternçš„æƒ…æ³"><a href="#æ²’æœ‰Iterator-Patternçš„æƒ…æ³" class="headerlink" title="æ²’æœ‰Iterator Patternçš„æƒ…æ³"></a>æ²’æœ‰Iterator Patternçš„æƒ…æ³</h2><p>å‡è¨­ç¾åœ¨æœ‰2ç¨®èœå–®, åˆ†åˆ¥å«åšä¸­å¼æ–™ç†èœå–® èˆ‡ è¥¿å¼æ–™ç†èœå–®</p><p>ä¸­å¼æ–™ç†èœå–®æ˜¯ç”¨ArrayListçš„æ–¹å¼å„²å­˜èœå–®é …ç›®</p><p>ç¾å¼æ–™ç†èœå–®æ˜¯ç”¨Array[]å„²å­˜</p><p>ä¸­å¼æ–™ç†èœå–®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenu</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line"></span><br><span class="line">    ChineseMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"éº»å©†è±†è…"</span>);</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"è±¬è¡€ç³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¾å¼æ–™ç†èœå–®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanMenu</span> </span>&#123;</span><br><span class="line">    String[] menu;</span><br><span class="line"></span><br><span class="line">    AmericanMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">0</span>] = <span class="string">"æ¼¢å ¡"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">1</span>] = <span class="string">"è–¯æ¢"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">2</span>] = <span class="string">"ç‚¸é›"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getMenu() &#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥è‘—å®šç¾©ä¸€å€‹é¡åˆ¥ï¼šæœå‹™ç”Ÿï¼Œä½†æœå‹™ç”Ÿéœ€è¦çŸ¥é“è¦æ€éº¼æ’ˆå…§å®¹, ArrayListèˆ‡Arrayçš„æ’ˆæ³•å°±æœƒä¸ä¸€æ¨£ï¼Œè¦å¯«å…©å€‹for loopâ€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    ChineseMenu chineseMenu;</span><br><span class="line">    AmericanMenu americaMenu;</span><br><span class="line"></span><br><span class="line">    Waitress(</span><br><span class="line">        ChineseMenu chMenu,</span><br><span class="line">        AmericanMenu amerMenu</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenu = chMenu;</span><br><span class="line">        <span class="keyword">this</span>.americaMenu = amerMenu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€™æ™‚å€™æœå‹™ç”Ÿéœ€è¦é‡å°å„å€‹menuåšèœè‰²ä»‹ç´¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======ä»‹ç´¹ä¸­å¼æ–™ç†========"</span>);</span><br><span class="line">        <span class="keyword">for</span>(String dish: chineseMenu.getMenu()) &#123;</span><br><span class="line">            System.out.println(dish);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"=======ä»‹ç´¹ç¾å¼å¼æ–™ç†========"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;americaMenu.getMenu().length; i++) &#123;</span><br><span class="line">            System.out.println(americaMenu.menu[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—å‘¼å«æœå‹™ç”Ÿï¼Œä»‹ç´¹èœå–®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ChineseMenu chineseMenu = <span class="keyword">new</span> ChineseMenu();</span><br><span class="line">        AmericanMenu americanMenu = <span class="keyword">new</span> AmericanMenu();</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(chineseMenu, americanMenu);</span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=======ä»‹ç´¹ä¸­å¼æ–™ç†========</span><br><span class="line">éº»å©†è±†è…</span><br><span class="line">è±¬è¡€ç³•</span><br><span class="line">=======ä»‹ç´¹ç¾å¼å¼æ–™ç†========</span><br><span class="line">æ¼¢å ¡</span><br><span class="line">è–¯æ¢</span><br><span class="line">ç‚¸é›</span><br></pre></td></tr></table></figure><h3 id="å•é¡Œ"><a href="#å•é¡Œ" class="headerlink" title="å•é¡Œ"></a>å•é¡Œ</h3><p>å¯ä»¥çœ‹åˆ°æœå‹™ç”Ÿå¿…é ˆè¦äº†è§£å¦‚ä½•å¾èœå–®å–å‡ºä¾†ï¼Œè®Šæˆæ¯ä¸€æ¬¡è‹¥åˆæœ‰æ–°çš„èœå–®ï¼Œé‚£æ¯æ¬¡æœå‹™ç”Ÿåˆå¾—æ›‰å¾—æ–°èœå–®çš„å–å¾—æ–¹å¼æ˜¯æ€æ¨£ï¼Œå¦‚æ­¤ä¸€ä¾†å°±å¾—ä¸€ç›´å¢åŠ for loop, æœ‰Nå€‹èœå–®å°±æœ‰Nå€‹for loop, ä¸å¤§å¥½ç¶­è­·ã€‚</p><h2 id="Iteratoræ¨¡å¼ç™»å ´"><a href="#Iteratoræ¨¡å¼ç™»å ´" class="headerlink" title="Iteratoræ¨¡å¼ç™»å ´"></a>Iteratoræ¨¡å¼ç™»å ´</h2><p>è©²æ¨¡å¼ä¸»è¦ç›®çš„ï¼šã€è®“æœå‹™ç”Ÿä¸éœ€çŸ¥é“å…¶å–å‡ºç´°ç¯€æ˜¯å¦‚ä½•ï¼Œåªè¦é€éä¸€å€‹æ¨™æº–çš„ä»‹é¢(Iterator)ï¼Œå°±å¯ä»¥ç›´æ¥å‘¼å«èœå–®å…§å®¹ã€</p><h3 id="å®šç¾©-Iterator-ä»‹é¢"><a href="#å®šç¾©-Iterator-ä»‹é¢" class="headerlink" title="å®šç¾© Iterator ä»‹é¢"></a>å®šç¾© Iterator ä»‹é¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">Boolean <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ”¹è‰¯ä¸€ä¸‹Menu-å°‡å„å€‹Menuå¯¦ä½œåŒä¸€å€‹ä»‹é¢"><a href="#æ”¹è‰¯ä¸€ä¸‹Menu-å°‡å„å€‹Menuå¯¦ä½œåŒä¸€å€‹ä»‹é¢" class="headerlink" title="æ”¹è‰¯ä¸€ä¸‹Menu å°‡å„å€‹Menuå¯¦ä½œåŒä¸€å€‹ä»‹é¢"></a>æ”¹è‰¯ä¸€ä¸‹Menu å°‡å„å€‹Menuå¯¦ä½œåŒä¸€å€‹ä»‹é¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Menu</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">getMenu</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenu</span> <span class="keyword">implements</span> <span class="title">Menu</span>&lt;<span class="title">ArrayList</span>&lt;<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line"></span><br><span class="line">    ChineseMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"éº»å©†è±†è…"</span>);</span><br><span class="line">        <span class="keyword">this</span>.menu.add(<span class="string">"è±¬è¡€ç³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title">getMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class AmericanMenu implements Menu&lt;String[]&gt; &#123;</span><br><span class="line">    String[] menu;</span><br><span class="line"></span><br><span class="line">    AmericanMenu() &#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">this</span>.setMenuItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenuItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">0</span>] = <span class="string">"æ¼¢å ¡"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">1</span>] = <span class="string">"è–¯æ¢"</span>;</span><br><span class="line">        <span class="keyword">this</span>.menu[<span class="number">2</span>] = <span class="string">"ç‚¸é›"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getMenu() &#123;</span><br><span class="line">        <span class="keyword">return</span> menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚æ”¹ç”¨å¯¦ä½œå…©å€‹Iteratoré¡åˆ¥ <code>ChineseMenuIterator</code>èˆ‡<code>AmericanMenuIterator</code>ï¼Œè² è²¬å®šç¾©å¦‚ä½•å–å‡ºèœå–®å…§å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; menu;</span><br><span class="line">    <span class="keyword">int</span> count = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChineseMenuIterator</span><span class="params">(Menu&lt;ArrayList&lt;String&gt;&gt; menu)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = menu.getMenu();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ChineseMenuæ˜¯ä½¿ç”¨ArrayListå®šç¾©èœå–®åˆ—è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count + <span class="number">1</span> &gt;= menu.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menu.get(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    String[] menu;</span><br><span class="line">    <span class="keyword">int</span> count = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AmericanMenuIterator</span><span class="params">(Menu&lt;String[]&gt; menu)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menu = menu.getMenu();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count + <span class="number">1</span> &gt;= menu.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.menu[count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚å›åˆ°æœå‹™ç”Ÿï¼Œè‹¥è¦ä»‹ç´¹èœå–®å…§å®¹çš„è©±ï¼Œåªè¦ä½¿ç”¨ä¸Šé¢å®šç¾©çš„ <code>ChineseMenuIterator</code>èˆ‡<code>AmericanMenuIterator</code>, å°±å¯ä»¥ç›´æ¥å–å‡ºèœå–®é …ç›®å…§å®¹äº†ï¼Œæœå‹™ç”Ÿä¸éœ€è¦åœ¨æ›‰å¾—è¦æ€éº¼è™•ç†æ’ˆå–çš„ç´°ç¯€ï¼Œçœ‹åˆ°ä¸€å †for loopäº†</p><p>Waitress class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    ChineseMenu chineseMenu;</span><br><span class="line">    AmericanMenu americaMenu;</span><br><span class="line"></span><br><span class="line">    ChineseMenuIterator chineseMenuIterator;</span><br><span class="line">    AmericanMenuIterator americanMenuIterator;</span><br><span class="line">    Waitress(</span><br><span class="line">        ChineseMenu chMenu,</span><br><span class="line">        AmericanMenu amerMenu,</span><br><span class="line">        ChineseMenuIterator chineseMenuIterator,</span><br><span class="line">        AmericanMenuIterator americanMenuIterator</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenu = chMenu;</span><br><span class="line">        <span class="keyword">this</span>.americaMenu = amerMenu;</span><br><span class="line">        <span class="keyword">this</span>.chineseMenuIterator = chineseMenuIterator;</span><br><span class="line">        <span class="keyword">this</span>.americanMenuIterator = americanMenuIterator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€™æ™‚å€™æœå‹™ç”Ÿåªè¦é€éiterator, å°±å¯ä»¥ç›´æ¥ç”¨ä¸€å€‹for loopå…¨éƒ¨å–å‡ºä¾†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">introduceMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======ä»‹ç´¹ä¸­å¼æ–™ç†========"</span>);</span><br><span class="line">        <span class="keyword">while</span>(chineseMenuIterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(chineseMenuIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"=======ä»‹ç´¹ç¾å¼æ–™ç†========"</span>);</span><br><span class="line">        <span class="keyword">while</span>(americanMenuIterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(americanMenuIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å†åº¦å‘¼å«æœå‹™ç”Ÿä»‹ç´¹èœå–®</p><p>Main class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ChineseMenu chineseMenu = <span class="keyword">new</span> ChineseMenu();</span><br><span class="line">        ChineseMenuIterator chineseMenuIterator = <span class="keyword">new</span> ChineseMenuIterator(chineseMenu);</span><br><span class="line">        AmericanMenu americanMenu = <span class="keyword">new</span> AmericanMenu();</span><br><span class="line">        AmericanMenuIterator americanMenuIterator = <span class="keyword">new</span> AmericanMenuIterator(americanMenu);</span><br><span class="line">        Waitress waitress = <span class="keyword">new</span> Waitress(</span><br><span class="line">                chineseMenu,</span><br><span class="line">                americanMenu,</span><br><span class="line">                chineseMenuIterator,</span><br><span class="line">                americanMenuIterator);</span><br><span class="line">        waitress.introduceMenu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€éIteratorä»‹é¢å®šç¾©å¦‚ä½•å¯¦ä½œæŠ½å–è³‡æ–™çµæ§‹çš„å…§å®¹ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ä¸ç”¨è²»å¿ƒå»äº†è§£è¦æ€éº¼å–å¾—ï¼Œç›´æ¥å‘¼å«å·²ç¶“æœ‰å¯¦ä½œIteratorä»‹é¢çš„class</p><h2 id="å‚™è¨»"><a href="#å‚™è¨»" class="headerlink" title="å‚™è¨»"></a>å‚™è¨»</h2><p>Collection é¡åˆ¥ä¸­å…¶å¯¦å°±å·²ç¶“å®šç¾©äº†Iteratorä»‹é¢ï¼Œä¸éç‚ºäº†ä»‹ç´¹åè¦†å™¨æ¨¡å¼ï¼Œæ•…åœ¨ArrayListä¸­ç°¡å–®å¯¦ä½œäº†Iteratorä»‹é¢å…§å®¹</p><p><img src="https://i.imgur.com/KGnuRr5.png" alt=""></p><p>Reference: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Template Pattern æ¨£æ¿æ¨¡å¼  [Design Pattern in Java]</title>
      <link href="/2020/07/29/Design-Pattern-Java-Template-Pattern-%E6%A8%A3%E6%9D%BF%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/29/Design-Pattern-Java-Template-Pattern-%E6%A8%A3%E6%9D%BF%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>æ¨£æ¿, é¡§åæ€ç¾©å°±æ˜¯æŠŠåŒæ¨£çš„é‚è¼¯å®šç¾©æˆä¸€å€‹æ¨£æ¿, å¯è®“å…¶ä»–é¡åˆ¥å…±åŒä½¿ç”¨</p><p>æ¨£æ¿ä¹Ÿæœƒé–‹æ”¾å¯å®¢è£½åŒ–çš„æ–¹æ³• (æŠ½è±¡æ–¹æ³•), ä¾›å…¶ä»–é¡åˆ¥å¯¦ä½œ</p><a id="more"></a><p>æ¨£æ¿ä¸»è¦æ ¸å¿ƒ</p><ol><li>å°‡å…±åŒæ¼”ç®—æ³•é‚è¼¯åŒ…è£å¥½</li><li>å®šç¾©éå…±åŒçš„æ–¹æ³•ç‚ºæŠ½åƒæ–¹æ³•, è«‹ä½¿ç”¨æ¨£æ¿æ–¹æ³•çš„é¡åˆ¥è‡ªè¡Œå¯¦ä½œ</li></ol><h2 id="é€éæ³¡èŒ¶èˆ‡æ³¡å’–å•¡ä¾†ç­è§£æ¨£æ¿æ¨¡å¼å§"><a href="#é€éæ³¡èŒ¶èˆ‡æ³¡å’–å•¡ä¾†ç­è§£æ¨£æ¿æ¨¡å¼å§" class="headerlink" title="é€éæ³¡èŒ¶èˆ‡æ³¡å’–å•¡ä¾†ç­è§£æ¨£æ¿æ¨¡å¼å§"></a>é€éæ³¡èŒ¶èˆ‡æ³¡å’–å•¡ä¾†ç­è§£æ¨£æ¿æ¨¡å¼å§</h2><p>é€™æ™‚å€™è‹¥ç›´æ¥å¯«code, æœƒåˆ†åˆ¥å®šç¾©å‡º <code>Tea</code> èˆ‡ <code>Coffee</code> class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> </span>&#123;</span><br><span class="line">    Tea() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======é–‹å§‹æº–å‚™èŒ¶çš„å‹•ä½œ======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        steepTeaBag();</span><br><span class="line">        addLenmon();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======çµæŸ======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç‡’é–‹æ°´"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">steepTeaBag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ³¡é–‹èŒ¶åŒ…"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addLenmon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ å…¥æª¸æª¬"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å€’å…¥æ¯ä¸­"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    Coffee() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======é–‹å§‹æº–å‚™å’–å•¡çš„å‹•ä½œ======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        greedCoffeeGrinds();</span><br><span class="line">        addCreamer();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======çµæŸ======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç‡’é–‹æ°´"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">greedCoffeeGrinds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç£¨å’–å•¡è±†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addCreamer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ å¥¶ç²¾"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å€’å…¥æ¯ä¸­"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»¥ä¸Šå®šç¾©çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tea tea = <span class="keyword">new</span> Tea();</span><br><span class="line">        tea.prepare();</span><br><span class="line"></span><br><span class="line">        Coffee coffee = <span class="keyword">new</span> Coffee();</span><br><span class="line">        coffee.prepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/1PXbn6b.png" alt=""></p><h2 id="å¥—ç”¨Template-Patternå§"><a href="#å¥—ç”¨Template-Patternå§" class="headerlink" title="å¥—ç”¨Template Patternå§"></a>å¥—ç”¨Template Patternå§</h2><p>ä»”ç´°æ¯”è¼ƒæ³¡èŒ¶å’Œæ³¡å’–å•¡, éƒ½æœƒæœ‰è‘—ä»¥ä¸‹é¡ä¼¼çš„å‹•ä½œ</p><ol><li>ç…®æ²¸é–‹æ°´</li><li>å°‡(èŒ¶çš„èŒ¶åŒ…/å’–å•¡è—¥ç£¨æˆç²‰)æ³¡é–‹  &lt;â€“ é€™å€‹å‹•ä½œä¸€æ¨£, ä½†èŒ¶æ˜¯ç”¨èŒ¶åŒ…, å’–å•¡æ˜¯éœ€è¦å…ˆç£¨æˆç²‰</li><li>æ·»åŠ æœ‰çš„æ²’çš„ (å’–å•¡æœƒç”¨å¥¶ç²¾/èŒ¶æœƒæ”¾æª¸æª¬) &lt;â€“ é€™é‚Šçš„ä¹Ÿæ˜¯ä¸€æ¨£</li><li>å€’é€²æ¯ä¸­</li></ol><p>å‰›å¥½èŒ¶èˆ‡å’–å•¡éƒ½æ˜¯å«æœ‰å’–å•¡å› çš„é£²æ–™ï¼Œé€™æ™‚å°±å¯ä»¥å®šç¾©ä¸€å€‹æ¨£æ¿å«åš <code>CaffeineBeverage</code>, ä¸¦æŠŠä¸Šè¿° 2,3æ­¥é©Ÿ,å®šç¾©æˆæŠ½è±¡æ–¹æ³•, è®“èŒ¶èˆ‡å’–å•¡é¡åˆ¥è‡ªå·±å»å¯¦ä½œè‡ªå·±çš„é‚è¼¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line">    String name = <span class="string">"å’–å•¡å› é£²æ–™"</span>;</span><br><span class="line">    CaffeineBeverage(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======é–‹å§‹æº–å‚™ "</span> + <span class="keyword">this</span>.name + <span class="string">" çš„å‹•ä½œ======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======çµæŸ======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç‡’é–‹æ°´"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šç¾©å¦‚ä½•æ³¡çš„æŠ½è±¡æ–¹æ³•, è®“èŒ¶èˆ‡å’–å•¡è‡ªè¡Œå®šç¾©</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// å®šç¾©è¦æ·»åŠ å…¶ä»–é…æ–™, è®“èŒ¶èˆ‡å’–å•¡è‡ªè¡Œå®šç¾©</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pourIntoCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å€’é€²æ¯ä¸­"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—<code>Tea</code>èˆ‡<code>Coffee</code>å¯¦ç¾è©²æ¨£æ¿é¡åˆ¥ <code>CaffeineBeverage</code><br>ä¸¦æ ¹æ“šè‡ªå·±çš„é‚è¼¯å¯¦ä½œabstractæ–¹æ³• <code>brew()</code>èˆ‡<code>addCondiments()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line">    Tea(String name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======é–‹å§‹æº–å‚™èŒ¶çš„å‹•ä½œ======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======çµæŸ======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ³¡é–‹èŒ¶åŒ…"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ å…¥æª¸æª¬"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> <span class="keyword">extends</span> <span class="title">CaffeineBeverage</span></span>&#123;</span><br><span class="line">    Coffee(String name) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=======é–‹å§‹æº–å‚™å’–å•¡çš„å‹•ä½œ======="</span>);</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourIntoCup();</span><br><span class="line">        System.out.println(<span class="string">"=======çµæŸ======="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç£¨å’–å•¡è±†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ å¥¶ç²¾"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—ä¸€æ¨£ä½¿ç”¨ä¹‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CaffeineBeverage tea = <span class="keyword">new</span> Tea(<span class="string">"èŒ¶"</span>);</span><br><span class="line">        tea.prepare();</span><br><span class="line"></span><br><span class="line">        CaffeineBeverage coffee = <span class="keyword">new</span> Coffee(<span class="string">"å’–å•¡"</span>);</span><br><span class="line">        coffee.prepare();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/lT9g7lA.png" alt=""></p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€éä»¥ä¸Šæ–¹æ³•å¯ä»¥çœ‹åˆ° æ¨£æ¿æ¨¡å¼ å°‡é‡è¤‡çš„åœ°æ–¹çµ¦çµ±æ•´èµ·ä¾†æˆç‚ºæ¼”ç®—æ³•é‚è¼¯, ä¸¦å®šç¾©ä¸€å€‹æŠ½è±¡é¡åˆ¥, å°‡éœ€è¦å®¢è£½åŒ–çš„éƒ¨åˆ†å®šç¾©æˆæŠ½è±¡æ–¹æ³•, çµ±ä¸€çš„éƒ¨åˆ†å°±ç›´æ¥å®šç¾©å¯¦é«”æ–¹æ³•</p><p>å¦‚æ­¤ä¸€ä¾†å„å€‹é¡åˆ¥åœ¨å¯¦ä½œæ™‚ï¼Œå°±ä¸ç”¨åœ¨è‡ªå·±å»åšé‡è¤‡ä¸€æ¨£çš„å‹•ä½œ(ä¾‹å¦‚ç‡’é–‹æ°´, å€’å…¥æ¯ä¸­) åªè¦ç›´æ¥ç¹¼æ‰¿æ¨£æ¿æŠ½è±¡é¡åˆ¥å°±æœ‰å›‰, ç„¶å¾Œåœ¨è‡ªå·±å¯¦ä½œè‡ªå·±éœ€è¦çš„éƒ¨åˆ† (å¦‚èŒ¶æœ‰è‡ªå·±çš„èŒ¶åŒ…æ³¡æ³•, å’–å•¡å‰‡æœ‰è‡ªå·±çš„å’–å•¡è±†è¦ç£¨ æ‰èƒ½æ³¡)</p><p>ä»¥å¯¦ç¾æ¨£æ¿æ¨¡å¼çš„ç²¾ç¥</p><h2 id="é€éhookæ–¹æ³•å°‡å°è£çš„æ¼”ç®—æ³•é‚è¼¯éƒ¨åˆ†åšæ§åˆ¶ä½¿ç”¨"><a href="#é€éhookæ–¹æ³•å°‡å°è£çš„æ¼”ç®—æ³•é‚è¼¯éƒ¨åˆ†åšæ§åˆ¶ä½¿ç”¨" class="headerlink" title="é€éhookæ–¹æ³•å°‡å°è£çš„æ¼”ç®—æ³•é‚è¼¯éƒ¨åˆ†åšæ§åˆ¶ä½¿ç”¨"></a>é€éhookæ–¹æ³•å°‡å°è£çš„æ¼”ç®—æ³•é‚è¼¯éƒ¨åˆ†åšæ§åˆ¶ä½¿ç”¨</h2><p>å¾…è£œå……</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Facade Pattern è¡¨è±¡æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/29/Design-Pattern-Java-Facade-Pattern-%E8%A1%A8%E8%B1%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/29/Design-Pattern-Java-Facade-Pattern-%E8%A1%A8%E8%B1%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å°‡è¤‡é›œçš„é¡åˆ¥é—œä¿‚, ç”¨ä¸€å€‹é¡åˆ¥åŒ…è£èµ·ä¾†, ä¾›å‘¼å«</p><p>ä¸æœƒè®“ä½¿ç”¨è€…ç›´æ¥çœ‹åˆ°èƒŒå¾Œè¤‡é›œçš„é‚è¼¯, åªæœƒçœ‹åˆ° â€œè¡¨é¢çš„ç¾è±¡â€, æ•…å«åšè¡¨è±¡æ¨¡å¼</p><a id="more"></a><h2 id="ä»¥ä¸€å€‹å®¶åº­åŠ‡é™¢ä¾†è§£èªª"><a href="#ä»¥ä¸€å€‹å®¶åº­åŠ‡é™¢ä¾†è§£èªª" class="headerlink" title="ä»¥ä¸€å€‹å®¶åº­åŠ‡é™¢ä¾†è§£èªª"></a>ä»¥ä¸€å€‹å®¶åº­åŠ‡é™¢ä¾†è§£èªª</h2><p>å¦‚æœååœ¨å®¢å»³, æƒ³è¦ç‡Ÿé€ ä¸€å€‹å®¶åº­åŠ‡é™¢</p><p>æˆ‘å€‘å¾—åšä»¥ä¸‹äº‹æƒ…ï¼š</p><ol><li>æ‰“é–‹ç‡ˆ, èª¿æ•´äº®åº¦</li><li>æ‰“é–‹é›»è¦–, åˆ‡æ›åˆ°DVDæ¨¡å¼</li><li>æ‰“é–‹éŸ³éŸ¿, èª¿æ•´å¤§å°è²</li><li>æ‰“é–‹DVD, è®€å–è¦çœ‹çš„ç‰‡</li></ol><p>ç­‰ç­‰ä¹‹é¡çš„, ä»¥ä¸‹å®šç¾©é€™äº›æœå‹™çš„class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightService</span> </span>&#123;</span><br><span class="line">    LightService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lightOn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TVService</span> </span>&#123;</span><br><span class="line">    TVService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openTV</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the TV"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoundService</span> </span>&#123;</span><br><span class="line">    SoundService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openSound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the Sound"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DVDPlayerService</span> </span>&#123;</span><br><span class="line">    DVDPlayerService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openDVD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the DVD"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å¾Œç›´è¦ºä¸Šæœƒå‘¼å«ä¹‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LightService lightService = <span class="keyword">new</span> LightService();</span><br><span class="line">        TVService tvService = <span class="keyword">new</span> TVService();</span><br><span class="line">        SoundService soundService = <span class="keyword">new</span> SoundService();</span><br><span class="line">        DVDPlayerService dvdPlayerService = <span class="keyword">new</span> DVDPlayerService();</span><br><span class="line"></span><br><span class="line">        lightService.lightOn();</span><br><span class="line">        tvService.openTV();</span><br><span class="line">        soundService.openSound();</span><br><span class="line">        dvdPlayerService.openDVD();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶çµæœç‚ºï¼š</p><p><img src="https://i.imgur.com/4zTs3XQ.png" alt=""></p><h2 id="è¡¨è±¡æ¨¡å¼ç™»å ´"><a href="#è¡¨è±¡æ¨¡å¼ç™»å ´" class="headerlink" title="è¡¨è±¡æ¨¡å¼ç™»å ´"></a>è¡¨è±¡æ¨¡å¼ç™»å ´</h2><p>ä¸éå°æ–¼ä½¿ç”¨è€…ä¾†èªª, å…¶å¯¦å°±åªæƒ³è¦äº«å—å®¶åº­åŠ‡é™¢çš„å¨›æ¨‚, æ‰€ä»¥å…¶å¯¦æˆ‘å€‘å¯ä»¥ç”¨åŒ…è£çš„æ–¹å¼, å°‡ä¸Šé¢mainè£¡é¢ç›¸é—œæœå‹™çš„classéƒ½åŒ…åœ¨ä¸€å€‹classå…§, å«åš<code>MovieTheaterFacadeService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieTheaterFacadeService</span> </span>&#123;</span><br><span class="line">    MovieTheaterFacadeService() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startMovieTheaterService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LightService lightService = <span class="keyword">new</span> LightService();</span><br><span class="line">        TVService tvService = <span class="keyword">new</span> TVService();</span><br><span class="line">        SoundService soundService = <span class="keyword">new</span> SoundService();</span><br><span class="line">        DVDPlayerService dvdPlayerService = <span class="keyword">new</span> DVDPlayerService();</span><br><span class="line"></span><br><span class="line">        lightService.lightOn();</span><br><span class="line">        tvService.openTV();</span><br><span class="line">        soundService.openSound();</span><br><span class="line">        dvdPlayerService.openDVD();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€ä¾†, æˆ‘å€‘çš„ä½¿ç”¨è€…(main()), åªè¦å‘¼å« <code>MovieTheaterFacadeService</code> å°±å¯ä»¥ç›´æ¥äº«å—å®¶åº­åŠ‡é™¢, ä¸ç”¨è¦ªè‡ªå»è™•ç†éç¨‹ä¸­çš„äº‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       MovieTheaterFacadeService movieTheaterFacadeService = <span class="keyword">new</span> MovieTheaterFacadeService();</span><br><span class="line"></span><br><span class="line">       movieTheaterFacadeService.startMovieTheaterService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¸½çµ"><a href="#ç¸½çµ" class="headerlink" title="ç¸½çµ"></a>ç¸½çµ</h2><p>é€éä»¥ä¸Šçš„ä¾‹å­, å¯ä»¥çœ‹åˆ°è¡¨è±¡æ¨¡å¼æœ€å¤§çš„ç”¨è™•å°±æ˜¯å°‡è¤‡é›œçš„æœå‹™é¡åˆ¥å€‘çµ¦åŒ…è£åœ¨ä¸€èµ·, ä¸¦é–‹æ”¾å–®ä¸€å€‹é¡åˆ¥ä¾›ä½¿ç”¨è€…ä½¿ç”¨, è®“ä½¿ç”¨è€…åƒ…éœ€è¦çœ‹åˆ°è¡¨é¢å³å¯, ä¸ç”¨ç†è§£ç´°ç¯€æ˜¯ä»€éº¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Adaptor Pattern è½‰æ¥å™¨æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/29/Design-Pattern-Java-Adaptor-Pattern-%E8%BD%89%E6%8E%A5%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/29/Design-Pattern-Java-Adaptor-Pattern-%E8%BD%89%E6%8E%A5%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å‡å¦‚è¦ä½¿ç”¨A, ä½†ç„¡æ³•ç›´æ¥ä½¿ç”¨, åªèƒ½ä½¿ç”¨Bä»‹é¢</p><p>æ‰€ä»¥æˆ‘å€‘ç”¨è½‰æ¥å™¨é¡åˆ¥åŒ…è£Açš„æ–¹æ³•ï¼Œä¸¦ä¸”å¯¦ä½œBï¼Œé”åˆ°è½‰æ¥çš„æ•ˆæœ</p><a id="more"></a><h2 id="ç”¨è¢å¹•è½‰æ¥å™¨çš„ä¾‹å­ç›´æ¥è§£é‡‹"><a href="#ç”¨è¢å¹•è½‰æ¥å™¨çš„ä¾‹å­ç›´æ¥è§£é‡‹" class="headerlink" title="ç”¨è¢å¹•è½‰æ¥å™¨çš„ä¾‹å­ç›´æ¥è§£é‡‹"></a>ç”¨è¢å¹•è½‰æ¥å™¨çš„ä¾‹å­ç›´æ¥è§£é‡‹</h2><p>ä¾‹å¦‚æˆ‘å€‘æœ‰å€‹ HDMIçš„ç·š, å«åš HDMI interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">HDMI</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šç¾©é€£æ¥è£ç½®çš„æ–¹æ³•æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ç¾åœ¨æœ‰å€‹è¢å¹•åªæœ‰æ”¯æ´VGAçš„æ’å­”</p><p>æ‰€ä»¥æˆ‘å€‘éœ€è¦å€‹ HDMIè½‰VGAçš„Adaptoré¡åˆ¥, æŠŠVGAçš„é¡åˆ¥å¼•å…¥é€²ä¾†, ä¸¦ä½¿ç”¨ä¹‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HdmiToVgaAdpator</span> <span class="keyword">implements</span> <span class="title">HDMI</span> </span>&#123;</span><br><span class="line">    VGA vgaCable = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    HdmiToVgaAdpator(VGA vgaCable) &#123;</span><br><span class="line">        <span class="keyword">this</span>.vgaCable = vgaCable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿…é ˆè¦å¯¦ä½œHDMIçš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»‹æ¥Vgaç·šçš„connectåŠŸèƒ½</span></span><br><span class="line">        System.out.println(<span class="string">"ä½¿ç”¨è½‰æ¥å™¨çš„connectåŠŸèƒ½!"</span>);</span><br><span class="line">        vgaCable.connect(device);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ç‚ºæœ‰ä½¿ç”¨åˆ°VGAé¡åˆ¥, æ‰€ä»¥ä¾†å®šç¾©ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">VGA</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šç¾©é€£æ¥è£ç½®çš„æ–¹æ³•æ ¼å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VGACable</span> <span class="keyword">implements</span> <span class="title">VGA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connect</span><span class="params">(String device)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"VGAç·šé€£æ¥: "</span> + device);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾†å®šç¾©æœ‰å°ç­†é›», æ˜¯åªæœ‰å…·å‚™hdmiå­”, ä½†å…·å‚™è‘—å¯ä»¥é€£æ¥åˆ°æŸè£ç½®é€²è¡ŒæŠ•å½±</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Labtop</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è©²å°ç­†é›»åªæœ‰hdmiå­”, ä¸¦æŒ‡å®šè¦é€£æ¥çš„è¢å¹•(device)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectToDevice</span><span class="params">(HDMI hdmi, String device)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç­†é›»åªæœ‰hdmiå­”, ä½¿ç”¨å¯¦ä½œhdmiä»‹é¢çš„ 'hdmiè½‰vgaçš„è½‰æ¥å™¨' é¡åˆ¥ï¼"</span>);</span><br><span class="line">        hdmi.connect(device);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—ä¾†ä½¿ç”¨å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Labtop laptop = <span class="keyword">new</span> Labtop();</span><br><span class="line">        <span class="comment">// å¦‚æœæŸç­†é›»åªæœ‰hdmiæ’å­”, ä½†è¦æ¥çš„æŠ•å½±è¢å¹•åªæœ‰vga</span></span><br><span class="line">        laptop.connectToDevice(</span><br><span class="line">                <span class="keyword">new</span> HdmiToVgaAdpator( <span class="comment">// é€™æ™‚å¯ä»¥ä½¿ç”¨Hdmiè½‰Vgaçš„è½‰æ¥å™¨ï¼ è½‰æ¥å™¨éœ€è¦å¸¶å…¥å¯¦éš›å…·æœ‰VGAåŠŸèƒ½çš„VGAç·šç‰©ä»¶</span></span><br><span class="line">                        <span class="keyword">new</span> VGACable()),</span><br><span class="line">                <span class="string">"è€èˆŠæŠ•å½±æ©Ÿ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘å€‘å¯ä»¥çœ‹åˆ°çµæœç‚º:</p><p><img src="https://i.imgur.com/pwtgvua.png" alt=""></p><ol><li>ç­†é›»ä½¿ç”¨äº† å¯¦ä½œhdmiä»‹é¢çš„è½‰æ¥å™¨ (è½‰æ¥å™¨å› ç‚ºå¯¦ä½œäº†hdmi interface, æ‰€ä»¥å¯ä»¥æ’å…¥ç­†é›»çš„hdmiå­”)</li><li>æ¥è‘—è½‰æ¥å™¨å¼•å…¥äº†VGA cableé¡åˆ¥, æ•…è½‰æ¥å™¨å°±å¯ä»¥ä½¿ç”¨VGAçš„connect()åŠŸèƒ½</li><li>æœ€å¾Œå°±è§¸ç™¼VGAåŠŸèƒ½, èˆ‡æŠ•å½±è£ç½®é€£å‹•</li></ol><h2 id="å¯¦éš›æ‡‰ç”¨å ´æ™¯"><a href="#å¯¦éš›æ‡‰ç”¨å ´æ™¯" class="headerlink" title="å¯¦éš›æ‡‰ç”¨å ´æ™¯"></a>å¯¦éš›æ‡‰ç”¨å ´æ™¯</h2><p>é€šå¸¸è½‰æ¥å™¨æ¨¡å¼å¯ç”¨åœ¨è½‰æ¥é‚£äº›å·²ç¶“éæ™‚çš„æ¨¡çµ„&amp;æ–¹æ³•</p><p>ä¾‹å¦‚æœ‰æ¨¡çµ„æ˜¯ç”¨Javaè¼ƒèˆŠè¿­ä»£Collectionçš„ç‰ˆæœ¬å»å¯«çš„, ç‚ºEnumeration Interface</p><p>ä½†ç¾åœ¨æ–°çš„å°ˆæ¡ˆä¸­ï¼Œæ˜¯ä½¿ç”¨Iteratoræ–¹å¼å»è¿­ä»£Collection</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLoopService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Java 5ç‰ˆæœ¬ä¹‹å¾Œæ”¯æ´çš„Iterator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopCollection</span><span class="params">(Collection col, Iterator itr)</span> </span>&#123;</span><br><span class="line">        itr = col.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(itr.hasNext()) &#123;</span><br><span class="line">            System.out.println(itr.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨NewLoopService<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">main</span>() </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"apple"</span>);</span><br><span class="line">        list.add(<span class="string">"banana"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å®£å‘ŠIteratorçš„è®Šæ•¸</span></span><br><span class="line">        Iterator itr;</span><br><span class="line">        </span><br><span class="line">        NewLoopService loopService = <span class="keyword">new</span> NewLoopService();</span><br><span class="line">        loopService.loopCollection(list, itr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†ç¾åœ¨è‹¥åªèƒ½ç”¨èˆŠç‰ˆçš„ <code>Enumeration</code> æ–¹å¼å»è¿­ä»£</p><p>é€™æ™‚å°±å¯ä»¥å¯«ä¸€å€‹ <code>EnumeratorAdaptor</code> ä¾†å¯¦ä½œå¯å…¼å®¹<code>Iterator</code>çš„é¡åˆ¥, ä¸¦å¯å‘¼å« <code>Enumeration</code>çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¦ä½œIteratorçš„æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnumeratorAdaptor</span>&lt;<span class="title">E</span>&gt; <span class="title">implement</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    Enumeration&lt;E&gt; enumeration;</span><br><span class="line">    </span><br><span class="line">    EnumeratorAdaptor(Enumeration&lt;E&gt; enumeration) &#123;</span><br><span class="line">        <span class="keyword">this</span>.enumeration = enumeration;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¦ä½œIterator ä»‹é¢æ‰€éœ€çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä½†å¯¦éš›ä¸Šæ˜¯ä½¿ç”¨Enumerationçš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.enumeration.hasMoreElements();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.enumeration.nextElement();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½†é€™æ™‚å€™æœƒé‡åˆ°Enumerationæ²’æœ‰çš„æ–¹æ³•, ä½†åˆå¿…é ˆè¦å¯¦ä½œ æ»¿è¶³Iteratorçš„ä»‹é¢è¦ç¯„, é€™æ™‚å¯ä»¥throw Exceptionä¾†è™•ç†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚æˆ‘å€‘å¯ä»¥åœ¨<code>main()</code>ä¸­æ”¹ç”¨è½‰æ¥å™¨, ä¾†é–“æ¥ä½¿ç”¨Enumerationäº†ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">main</span>() </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"apple"</span>);</span><br><span class="line">        list.add(<span class="string">"banana"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨ `å¯¦ä½œIteratorä»‹é¢` çš„è½‰æ¥å™¨</span></span><br><span class="line">        EnumeratorAdaptor itr;</span><br><span class="line">        </span><br><span class="line">        NewLoopService loopService = <span class="keyword">new</span> NewLoopService();</span><br><span class="line">        loopService.loopCollection(list, itr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLoopService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Java 5ç‰ˆæœ¬ä¹‹å¾Œæ”¯æ´çš„Iterator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopCollection</span><span class="params">(Collection col, Iterator itr)</span> </span>&#123;</span><br><span class="line">        itr = col.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€™æ™‚æœƒæ˜¯ä½¿ç”¨EnumeratorAdaptorå…§çš„hasNext()èˆ‡next() é”åˆ°è½‰æ¥çš„æ•ˆæœ</span></span><br><span class="line">        <span class="keyword">while</span>(itr.hasNext()) &#123;</span><br><span class="line">            System.out.println(itr.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éä»¥ä¸Šæ–¹æ³•, å¯ä»¥æŠŠè¦ä½¿ç”¨Enumerationæ–¹å¼çš„service, ä½†è©²Serviceåˆæ˜¯åªèƒ½åƒIteratorçš„è¼¸å…¥, é‚£å°±å¯ä»¥å¯¦ä½œä¸€å€‹ <code>EnumeratorAdaptor</code>, å¸¶å…¥Service, ä¸¦é€éè½‰æ¥å™¨ä½¿ç”¨ Enumerationçš„æ–¹å¼å»æ’ˆå‡ºCollectionå…§å®¹.</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Observer Pattern è§€å¯Ÿè€…æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/26/Design-Pattern-Java-Observer-Pattern-%E8%A7%80%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/26/Design-Pattern-Java-Observer-Pattern-%E8%A7%80%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>è§€å¯Ÿè€…æ¨¡å¼å¯ä»¥è®“ç‰©ä»¶äº†è§£è³‡æ–™è®ŠåŒ–çš„æƒ…æ³ã€‚<br>ç‰©ä»¶ç”šè‡³å¯ä»¥åœ¨åŸ·è¡ŒæœŸé–“æ±ºå®šæ˜¯å¦è¦ç¹¼çºŒè¢«é€šçŸ¥ï¼Œåˆæˆ–è€…æ˜¯å¯ä»¥ä¸»å‹•å»è©¢å•è³‡æ–™çš„ç‹€æ…‹ã€‚<br>åœ¨æ­¤æ¨¡å¼ä¸­ä¹Ÿæœƒäº†è§£ä¸€å°å¤šï¼Œä»¥åŠç‰©ä»¶é¬†ç¶çš„æ„ç¾©æ˜¯å¦‚ä½•ã€‚</p><a id="more"></a><h3 id="ä»¥æ°£è±¡ç›£æ¸¬ç³»çµ±çš„æ¦‚æ³ä¾†ç•¶åšä¾‹å­"><a href="#ä»¥æ°£è±¡ç›£æ¸¬ç³»çµ±çš„æ¦‚æ³ä¾†ç•¶åšä¾‹å­" class="headerlink" title="ä»¥æ°£è±¡ç›£æ¸¬ç³»çµ±çš„æ¦‚æ³ä¾†ç•¶åšä¾‹å­"></a>ä»¥æ°£è±¡ç›£æ¸¬ç³»çµ±çš„æ¦‚æ³ä¾†ç•¶åšä¾‹å­</h3><p>å‡è¨­ç³»çµ±ä¸­æœ‰ä¸‰å€‹çµ„æˆè¦ä»¶ï¼š<br>(1) æ°£è±¡ç«™: ç²å–å¯¦éš›æ°£è±¡çš„ç‰©ç†è£ç½®ï¼Œå‡è¨­æœ‰ä¸‰å€‹:æº«åº¦,æ¿•åº¦,å£“åŠ›æ„Ÿæ‡‰<br>(2) Weather Dataç‰©ä»¶: è¿½è¹¤ä¾†è‡ªæ°£è±¡ç«™çš„è³‡æ–™ï¼Œä¸¦ä¸”é¡¯ç¤ºåœ¨ä½ˆå‘Šç‰ˆä¸Š<br>(3) ä½ˆå‘Šç‰ˆ: å°‡Weather Dataç‰©ä»¶çµ¦äºˆçš„è³‡æ–™å‘ˆç¾å‡ºä¾†</p><p>æ•´å€‹ä¾‹å­æœƒæœ‰ï¼Œä¸€å€‹æ°£è±¡ç«™(ç”¢å‡ºå‡çš„æ°£è±¡è³‡æ–™)ï¼ŒWeather Dataç‰©ä»¶(ç²å–æ°£è±¡è³‡æ–™ä¸¦é€šçŸ¥ä½ˆå‘Šç‰ˆ)ï¼Œä½ˆå‘Šç‰ˆå°‡æ‹¿åˆ°çš„è³‡æ–™çµ¦å‘ˆç¾å‡ºä¾†</p><h3 id="æ²’ä½¿ç”¨è§€å¯Ÿè€…æ¨¡å¼-Observer-Patternçš„æƒ…æ³"><a href="#æ²’ä½¿ç”¨è§€å¯Ÿè€…æ¨¡å¼-Observer-Patternçš„æƒ…æ³" class="headerlink" title="æ²’ä½¿ç”¨è§€å¯Ÿè€…æ¨¡å¼ Observer Patternçš„æƒ…æ³"></a>æ²’ä½¿ç”¨è§€å¯Ÿè€…æ¨¡å¼ Observer Patternçš„æƒ…æ³</h3><p>åˆå­¸è€…æœƒå¾ˆç›´è¦ºçš„å¯«å‡ºé€™æ¨£çš„ç¨‹å¼æ¶æ§‹ï¼š</p><h4 id="ä½ˆå‘Šæ¬„"><a href="#ä½ˆå‘Šæ¬„" class="headerlink" title="ä½ˆå‘Šæ¬„"></a>ä½ˆå‘Šæ¬„</h4><p>CurrentConditionsDisplay.class<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentConditionsDisplay</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pressure;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.temp = temp;</span><br><span class="line">       <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">       <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¡¯ç¤ºè³‡æ–™</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(temp);</span><br><span class="line">        System.out.println(humidity);</span><br><span class="line">        System.out.println(pressure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="WeatherData-class"><a href="#WeatherData-class" class="headerlink" title="WeatherData.class"></a>WeatherData.class</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherData</span> </span>&#123;</span><br><span class="line">    <span class="comment">// instance variable declarations</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®£å‘Šä½ˆå‘Šæ¬„</span></span><br><span class="line">    CurrentConditionsDisplay currentConditionsDisplay;</span><br><span class="line">    StatisticsDisplay statisticsDisplay;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// å»ºæ§‹å­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        CurrentConditionsDisplay currentConditionsDisplay,</span></span></span><br><span class="line"><span class="function"><span class="params">        StatisticsDisplay statisticsDisplay</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentConditionsDisplay = currentConditionsDisplay;</span><br><span class="line">        <span class="keyword">this</span>.statisticsDisplay = statisticsDisplay;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTemperature</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHumidity</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPressure</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measurementsChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> temp = getTemperature();</span><br><span class="line">        <span class="keyword">float</span> humidity = getHumidity();</span><br><span class="line">        <span class="keyword">float</span> pressure = getPressure();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°ä½ˆå‘Šæ¬„é¡åˆ¥é€²è¡Œæ›´æ–°ä»–å€‘çš„é¡¯ç¤ºå…§å®¹</span></span><br><span class="line">        currentConditionsDisplay.update(temp, humidity, pressure);</span><br><span class="line">        statisticsDisplay.update(temp, humidity, pressure);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…¶ä»–WeatherData function...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šç¨‹å¼çµæ§‹æœƒæœ‰è€¦åˆæ€§çš„ç‹€æ³ï¼š</p><p><img src="https://i.imgur.com/gpIs58H.png" alt=""></p><p>æ‰€ä»¥æ¥ä¸‹ä¾†ä¾†äº†è§£è§€å¯Ÿè€…æ¨¡å¼çš„å…§æ¶µ</p><h4 id="è§€å¯Ÿè€…æ¨¡å¼è§£æ"><a href="#è§€å¯Ÿè€…æ¨¡å¼è§£æ" class="headerlink" title="è§€å¯Ÿè€…æ¨¡å¼è§£æ"></a>è§€å¯Ÿè€…æ¨¡å¼è§£æ</h4><p>å®šç¾©äº†ç‰©ä»¶ä¹‹é–“ä¸€å°å¤šé—œä¿‚ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œç•¶ä¸€å€‹ç‰©ä»¶æ”¹è®Šç‹€æ…‹æ™‚ï¼Œå…¶ä»–ç›¸ä¾è€…éƒ½æœƒæ”¶åˆ°é€šçŸ¥ä¸¦è‡ªå‹•åšæ”¹è®Š</p><p>å…¶ç¤ºæ„åœ–å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/d1zWR3x.png" alt=""></p><p>ä¸»é¡Œèˆ‡è§€å¯Ÿè€…å€‘å®šç¾©äº†ä¸€å°å¤šçš„é—œä¿‚</p><p>è‹¥è¦å¯¦è¸å‡ºå¯ä»¥éš”é›¢ä¸»é¡Œå’Œè§€å¯Ÿè€…å€‘çš„æ–¹å¼ï¼Œä»¥ <code>Subject</code>ä»‹é¢å’Œ<code>Observer</code>ä»‹é¢æœ€ç‚ºå¸¸è¦‹</p><p><img src="https://i.imgur.com/C155cCF.png" alt=""></p><p>åœ¨é€™å¼µåœ–è¦æ³¨æ„ä¸€å€‹é‡é»æ˜¯ï¼Œç”±æ–¼ç¾åœ¨å·²ç¶“é‡å°ä»‹é¢å¯¦ä½œï¼Œç¾åœ¨çš„Subjectä¸­çš„è¨»å†ŠObserveréƒ½æ˜¯ä»¥è¨»å†Šâ€<span style="color:red">ä»‹é¢</span>â€œç‚ºä¸»ï¼è€Œéæ˜¯åƒä¸Šé¢ä¸€é–‹å§‹çš„æ–°æ‰‹ä¾‹å­æ˜¯ç›´æ¥é‡å°å¯¦è¸è€Œå¯«</p><p>å¦‚æ­¤ä¸€ä¾†å¦‚æœè¦åœ¨æ–°å¢ä¸€å€‹ä½ˆå‘Šæ¬„å«åšForecastDisplayï¼Œç›´æ¥å¯¦è¸Observerå°±å¥½ï¼Œé€™æ¨£å°±ä¸ç”¨å‹•åˆ°å¯¦è¸Subjectä»‹é¢çš„WeatherDataä¹‹ç¨‹å¼ç¢¼</p><p><img src="https://i.imgur.com/GJTGp80.png" alt=""></p><h4 id="ä»¥è§€å¯Ÿè€…æ¨¡å¼ä¾†é‡å¯«æ°£è±¡ç›£æ¸¬ç³»çµ±"><a href="#ä»¥è§€å¯Ÿè€…æ¨¡å¼ä¾†é‡å¯«æ°£è±¡ç›£æ¸¬ç³»çµ±" class="headerlink" title="ä»¥è§€å¯Ÿè€…æ¨¡å¼ä¾†é‡å¯«æ°£è±¡ç›£æ¸¬ç³»çµ±"></a>ä»¥è§€å¯Ÿè€…æ¨¡å¼ä¾†é‡å¯«æ°£è±¡ç›£æ¸¬ç³»çµ±</h4><p>Subject.interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ObserverInterface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">float</span> temperature, <span class="keyword">float</span> humidity, <span class="keyword">float</span> pressure)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WeatherData.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherData</span> <span class="keyword">implements</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList observers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeatherData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        observers = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = observers.indexOf(o);</span><br><span class="line">        observers.add(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = observers.indexOf(o);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">            observers.remove(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘è§€å¯Ÿè€…å€‘é€ä»¥æ”¹å‹•çš„è³‡æ–™</span></span><br><span class="line">    <span class="comment">// å¯ä»¥çœ‹åˆ°ç¾åœ¨æˆ‘å€‘æ˜¯ç›´æ¥è¨»å†ŠObserverä»‹é¢ï¼Œå¦‚æ­¤ä¸€ä¾†è§€å¯Ÿè€…é¡åˆ¥çš„å¯¦ä½œå°±ä¸ç”¨å»åœ¨æ„</span></span><br><span class="line">    <span class="comment">// åªè¦çŸ¥é“è¦è¨»å†Šçš„å°è±¡å¿…é ˆè¦æœ‰å¯¦ä½œObserverä»‹é¢å°±å¥½</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;observers.size(); i++) &#123;</span><br><span class="line">            Observer observer = (Observer)observers.get(i);</span><br><span class="line">            observer.update(temperature, humidity, pressure);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸ·è¡Œå‘è§€å¯Ÿè€…å€‘é€šçŸ¥è³‡æ–™</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measurementsChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®€å–å‡è³‡æ–™ï¼Œå¯ä»¥æ”¹å‹•é€™åœ°æ–¹ï¼Œæ”¹ç‚ºå‘æ°£è±¡å±€ç¶²ç«™çˆ¬è³‡æ–™</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMeasurements</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> temperature,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> humidity,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">float</span> pressure)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">        <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">        <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">        measurementsChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™è£¡æˆ‘å€‘åªå¯¦è¸ä¸€å€‹ä½ˆå‘Šæ¬„ CurrentConditionDisplay</p><p>CurrentConditionDisplay.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurrentConditionDisplay</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> pressure;</span><br><span class="line">    <span class="keyword">private</span> Subject weatherData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CurrentConditionDisplay</span><span class="params">(Subject weatherData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weatherData = weatherData;</span><br><span class="line">        weatherData.registerObserver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">float</span> temperature, <span class="keyword">float</span> humidity, <span class="keyword">float</span> pressure)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">        <span class="keyword">this</span>.humidity = humidity;</span><br><span class="line">        <span class="keyword">this</span>.pressure = pressure;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Current condition: "</span>+temperature + <span class="string">"F degrees and "</span> + humidity + <span class="string">"% humidity and "</span>+ pressure + <span class="string">" pressure"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸ·è¡Œç¨‹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        WeatherData weatherData = <span class="keyword">new</span> WeatherData();</span><br><span class="line"></span><br><span class="line">        CurrentConditionDisplay currentDisplay = <span class="keyword">new</span> CurrentConditionDisplay(weatherData);</span><br><span class="line"></span><br><span class="line">        weatherData.setMeasurements(<span class="number">80</span>, <span class="number">64</span>, <span class="number">30.4f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çµæœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Current condition: 80.0F degrees and 64.0% humidity and 30.4 pressure</span><br></pre></td></tr></table></figure><p>ä¹‹å¾Œåªè¦é€éä¸»é¡Œå‘¼å«è§€å¯Ÿè€…çš„update()çš„æ–¹æ³•ï¼Œå°±å¯ä»¥é€šçŸ¥æ–°çš„è³‡æ–™çµ¦è§€å¯Ÿè€…</p><p>ä¸¦ä¸”é€éè¨»å†Šçš„æ–¹å¼+åªåŠ å…¥é‡å°å¯¦è¸Observerä»‹é¢çš„è§€å¯Ÿè€…ï¼Œå¦‚æ­¤ä¸€ä¾†å¯ä»¥é”åˆ°åˆ†é›¢ä¸»é¡Œç‰©ä»¶èˆ‡è§€å¯Ÿè€…ç‰©ä»¶çš„é‚è¼¯ï¼Œä¹‹å¾Œæ–°å¢æ–°çš„ä½ˆå‘Šæ¬„å°±ä¸ç”¨å‹•åˆ°ä¸»é¡Œçš„ç¨‹å¼é‚è¼¯ã€‚</p><h3 id="è£œå……"><a href="#è£œå……" class="headerlink" title="è£œå……"></a>è£œå……</h3><h4 id="java-sdkä¹Ÿæœ‰è‡ªè¡Œæä¾›Observeræ–¹æ³•"><a href="#java-sdkä¹Ÿæœ‰è‡ªè¡Œæä¾›Observeræ–¹æ³•" class="headerlink" title="java sdkä¹Ÿæœ‰è‡ªè¡Œæä¾›Observeræ–¹æ³•"></a>java sdkä¹Ÿæœ‰è‡ªè¡Œæä¾›Observeræ–¹æ³•</h4><p>å…¶ä¸­æœƒæœ‰<code>setChange()</code>çš„æ–¹æ³•ï¼Œä¸»è¦è®“å‘¼å«è€…å®šç¾©ä»€éº¼æ™‚å€™æ‰è¦é€šçŸ¥æ–°çš„è³‡æ–™çµ¦è§€å¯Ÿè€…ï¼Œé¿å…æ¯æ¬¡è³‡æ–™ä¸€æ”¹è®Šå°±ä¸€ç›´é€šçŸ¥è§€å¯Ÿè€…ã€‚Ex: å¦‚æœæ²’æœ‰setChangedçš„æ–¹æ³•ï¼ŒWeahterDataç‰©ä»¶å°±æœƒæŒçºŒä¸æ–·çš„é€šçŸ¥è§€å¯Ÿè€…ï¼Œæ‰€ä»¥è‹¥æˆ‘å€‘å¸Œæœ›æº«åº¦å·®è·åŠåº¦æ‰æ›´æ–°ï¼Œæº«åº¦å·®è·æ’åˆ°åŠåº¦ä»¥ä¸Šï¼Œä¸»é¡Œæ‰æœƒå‘¼å«è§€å¯Ÿè€…çš„update()çš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">setChanged() &#123;</span><br><span class="line">    changed = ture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObservers(Object arg) &#123;</span><br><span class="line">    if(changed) &#123;</span><br><span class="line">        for every observer on the list &#123;</span><br><span class="line">            call update(this. org)</span><br><span class="line">        &#125;</span><br><span class="line">        changed = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObsergers() &#123;</span><br><span class="line">    notifyObservers(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Strategy Pattern ç­–ç•¥æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/26/Design-Pattern-Java-Strategy-Pattern-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/26/Design-Pattern-Java-Strategy-Pattern-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å¯ä»¥åœ¨åŸ·è¡ŒæœŸå‹•æ…‹æ›´æ›ç‰©ä»¶çš„è¡Œç‚º</p><p>ã€ç­–ç•¥æ¨¡å¼ã€å®šç¾©äº†æ¼”ç®—æ³•å®¶æ—ï¼Œå°‡ä»–å€‘å€‹åˆ¥å°è£èµ·ä¾†ï¼Œå¯ä»¥è®“ä»–å€‘ä¹‹é–“äº’ç›¸æ›¿æ›ï¼Œæ­¤æ¨¡å¼ä¸æœƒå½±éŸ¿åˆ°ä½¿ç”¨æ­¤æ¼”ç®—æ³•çš„ç¨‹å¼ã€‚</p><a id="more"></a><h2 id="æ²’æœ‰æ€è€ƒä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æ™‚å€™-æ¨¡æ“¬é´¨å­ç‰ˆæœ¬"><a href="#æ²’æœ‰æ€è€ƒä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æ™‚å€™-æ¨¡æ“¬é´¨å­ç‰ˆæœ¬" class="headerlink" title="æ²’æœ‰æ€è€ƒä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æ™‚å€™:æ¨¡æ“¬é´¨å­ç‰ˆæœ¬"></a>æ²’æœ‰æ€è€ƒä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æ™‚å€™:æ¨¡æ“¬é´¨å­ç‰ˆæœ¬</h2><p>å‡è¨­æˆ‘å€‘è¦é–‹ç™¼æ¨¡æ“¬é´¨å­éŠæˆ²ï¼Œæœƒæœ‰å„ç¨®ä¸åŒçš„é´¨å­ï¼Œé€™æ™‚å€™æœƒå€‘é€šå¸¸éƒ½æœƒå…ˆè¨­è¨ˆå‡ºä¸€å€‹classå«åš Duckï¼Œç„¶å¾ŒDuckæœƒåŒ…å«é´¨å­çš„å…±åŒè¡Œç‚ºï¼šç™¼å‡ºå«è² quack(), æ¸¸æ³³ swin(), ä»¥åŠå±•ç¾å¤–è§€ display()ï¼Œç„¶å¾Œæœ‰ç¶ é ­é´¨ MallardDuck classå’Œ ç´…é ­é´¨ RedheadDuck classåˆ†åˆ¥ç¹¼æ‰¿ Ducké¡åˆ¥</p><p>(åšUML)</p><p>è‹¥ç¾åœ¨éœ€è¦è®“æ¯éš»é´¨å­éƒ½æœƒé£›ï¼Œæˆ‘å€‘æœƒå¾ˆç›´è¦ºçš„åœ¨ Duck classä¸­åŠ å…¥ fly()</p><p>ä½†è‹¥ç¾åœ¨æœ‰å€‹æ©¡çš®é´¨å­ï¼Œæœƒä¸å°å¿ƒç¹¼æ‰¿åˆ°Duck classçš„fly(), ä½†æ©¡çš®é´¨ä¸æœƒé£›ï¼</p><h3 id="ç”¨ç¹¼æ‰¿çš„å¯ä»¥æ”¹å–„ä½œæ³•"><a href="#ç”¨ç¹¼æ‰¿çš„å¯ä»¥æ”¹å–„ä½œæ³•" class="headerlink" title="ç”¨ç¹¼æ‰¿çš„å¯ä»¥æ”¹å–„ä½œæ³•"></a>ç”¨ç¹¼æ‰¿çš„å¯ä»¥æ”¹å–„ä½œæ³•</h3><p>ç›´æ¥åœ¨æ©¡çš®é´¨ classä¸­çš„fly() ä¸å®šç¾©ä»»ä½•äº‹æƒ…</p><p>(åšUML)</p><h4 id="å•é¡Œ"><a href="#å•é¡Œ" class="headerlink" title="å•é¡Œ"></a>å•é¡Œ</h4><p>è‹¥åˆé‡åˆ°èª˜é¤Œé´¨ï¼Œå°±æœƒé¢è‡¨fly()æ²’å®šç¾©ä»»ä½•äº‹æƒ…ï¼Œquack()ä¹Ÿæ²’å®šç¾©ä»»ä½•äº‹æƒ…<br>å› ç‚ºè‹¥æœ‰å¾ˆå¤šæ–°å‹æ…‹çš„é´¨å­ï¼Œæœƒå°è‡´æ¯ä¸€å€‹ä¸åŒçš„é´¨å­éƒ½å¾—æª¢è¦–è©²é´¨å­æ˜¯å¦å¯é£›æˆ–å¯å«</p><p>(åšUML)</p><h3 id="æ”¹ç”¨ä»‹é¢åšæ”¹å–„"><a href="#æ”¹ç”¨ä»‹é¢åšæ”¹å–„" class="headerlink" title="æ”¹ç”¨ä»‹é¢åšæ”¹å–„"></a>æ”¹ç”¨ä»‹é¢åšæ”¹å–„</h3><p>å°‡flyèˆ‡quackå¾DuckæŠ½é›¢å‡ºä¾†è®Šæˆ Flyableèˆ‡Quackableä»‹é¢ï¼Œè®“æœ‰éœ€è¦é£›æˆ–å«çš„é´¨å­å¯¦ä½œä¹‹</p><h4 id="å•é¡Œ-1"><a href="#å•é¡Œ-1" class="headerlink" title="å•é¡Œ"></a>å•é¡Œ</h4><p>é‡è¤‡çš„ç¨‹å¼ç¢¼æœƒè®Šè¶…å¤šï¼Œå› ç‚ºåŒæ¨£æœƒé£›æˆ–å«çš„é´¨å­éƒ½å„è‡ªå¯¦ä½œäº†Flyableèˆ‡Quackableä»‹é¢çš„ç¨‹å¼ç¢¼ï¼Œè©²ç¨‹å¼ç¢¼é‚è¼¯éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><h3 id="è¨­è¨ˆå®ˆå‰‡-ä¸€"><a href="#è¨­è¨ˆå®ˆå‰‡-ä¸€" class="headerlink" title="è¨­è¨ˆå®ˆå‰‡(ä¸€)"></a>è¨­è¨ˆå®ˆå‰‡(ä¸€)</h3><ul><li><p>æ‰¾å‡ºç¨‹å¼ä¸­éœ€è¦æ›´å‹•ä¹‹è™•ï¼Œä¸¦å°‡ä¹‹ç¨ç«‹å‡ºä¾†ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦æ›´å‹•çš„ç¨‹å¼ç¢¼æ··åœ¨ä¸€èµ·</p></li><li><p>æŠŠæœƒè®Šå‹•çš„éƒ¨åˆ†å–å‡ºä¾†ä¸¦å°‡ä¹‹å°è£èµ·ä¾†ï¼Œä»¥ä¾¿ä»¥å¾Œå¯ä»¥è¼•æ˜“åœ°æ“´å……æ­¤éƒ¨åˆ†ï¼Œè€Œä¸å½±éŸ¿ä¸éœ€è¦æ›´å‹•çš„éƒ¨åˆ†ã€‚</p></li></ul><blockquote><p>å°‡é´¨å­çš„è¡Œç‚ºå¾Ducké¡åˆ¥å–å‡ºä¾†ï¼</p></blockquote><h3 id="æŠ½é›¢æœƒè®Šå‹•çš„éƒ¨åˆ†æˆç‚ºç¨ç«‹é¡åˆ¥"><a href="#æŠ½é›¢æœƒè®Šå‹•çš„éƒ¨åˆ†æˆç‚ºç¨ç«‹é¡åˆ¥" class="headerlink" title="æŠ½é›¢æœƒè®Šå‹•çš„éƒ¨åˆ†æˆç‚ºç¨ç«‹é¡åˆ¥"></a>æŠ½é›¢æœƒè®Šå‹•çš„éƒ¨åˆ†æˆç‚ºç¨ç«‹é¡åˆ¥</h3><p>å°‡é£›è¡Œè¡Œç‚º fly,èˆ‡å‘±å‘±å«è¡Œç‚º quackç¨ç«‹æˆclass</p><p>ä¸¦ä¸”åœ¨Ducké¡åˆ¥è¨­ç½® â€œå¯ä»¥è¨­å®šè¡Œç‚ºçš„æ–¹æ³•â€ï¼Œå¯ä»¥åœ¨â€œåŸ·è¡ŒæœŸâ€å‹•æ…‹åœ°æ”¹è®Šé´¨å­çš„é£›è¡Œæˆ–å‘±å‘±å«è¡Œç‚º</p><h3 id="è¨­è¨ˆå®ˆå‰‡-äºŒ"><a href="#è¨­è¨ˆå®ˆå‰‡-äºŒ" class="headerlink" title="è¨­è¨ˆå®ˆå‰‡(äºŒ)"></a>è¨­è¨ˆå®ˆå‰‡(äºŒ)</h3><p>å¯«ç¨‹å¼æ˜¯é‡å°ä»‹é¢è€Œå¯«ï¼Œè€Œä¸æ˜¯é‡å°å¯¦è¸</p><h3 id="ç”¨ä»‹é¢ä»£è¡¨æ¯å€‹è¡Œç‚º-FlyBehavior-QuackBehavior"><a href="#ç”¨ä»‹é¢ä»£è¡¨æ¯å€‹è¡Œç‚º-FlyBehavior-QuackBehavior" class="headerlink" title="ç”¨ä»‹é¢ä»£è¡¨æ¯å€‹è¡Œç‚º: FlyBehavior, QuackBehavior"></a>ç”¨ä»‹é¢ä»£è¡¨æ¯å€‹è¡Œç‚º: FlyBehavior, QuackBehavior</h3><p>ç”¨å„å€‹é´¨å­çš„è¡Œç‚ºé¡åˆ¥å»å¯¦è¸FlyBehaviorå’ŒQuackBehaviorä»‹é¢<br>è€Œä¸æ˜¯ç”±Ducké¡åˆ¥å¯¦è¸è©²ä»‹é¢</p><p>:::info<br>å¯«ç¨‹å¼æ˜¯é‡å°ä»‹é¢å»å¯«ï¼šå…¶çœŸæ­£æ„æ€æ˜¯ã€å¯«ç¨‹å¼æ˜¯é‡å°è¶…å‹æ…‹(supertype)è€Œå¯«ã€</p><p>ä½¿ç”¨è¶…å‹æ…‹çš„è©±å¯ä»¥ä¸ç”¨ç†æœƒä»¥å¾ŒåŸ·è¡Œæ™‚çš„çœŸæ­£ç‰©ä»¶å‹æ…‹ï¼šç‚ºâ€œå¤šå‹â€çš„å¯¦è¸</p><p>ex:</p><p>Animal interface { makeSound() }<br>Dog implment Animal { makeSound() { bark() }}<br>Cat implement Animal { makeSound() { meow() }}</p><p>Animal animal = new Dog();<br>animal.makeSound();</p><p>æœ‰å€‹å¥½è™•æ˜¯ï¼Œå¯ä»¥ä¸ç”¨ç›´æ¥åœ¨ä¸€é–‹å§‹åƒµåŒ–æŸå€‹è®Šæ•¸çš„å®£å‘Šå‹æ…‹ ex: Dog x = new dog(); // åƒµåŒ–äº†xè®Šæ•¸ç‚ºdogå‹æ…‹</p><p>è€Œæ˜¯å¯ä»¥åœ¨åŸ·è¡ŒæœŸï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨çš„æ™‚å€™æŒ‡å®šè©²ç‰©ä»¶å‹æ…‹</p><p>ex:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// å®šç¾©getAnimalç‚ºå›å‚³Dog();</span><br><span class="line">x = getAnimal(); // å¾—åˆ° Dogå‹æ…‹</span><br><span class="line">x.makeSound(); // ç™¼å‡ºç‹—å«è²</span><br><span class="line"></span><br><span class="line">// å°‡getAnimal() ä¸­æ”¹æˆå‚³å›Cat();</span><br><span class="line">x = getAnimal(); // å¾—åˆ° Catå‹æ…‹</span><br><span class="line">x.makeSound(); // ç™¼å‡ºè²“å«è²</span><br></pre></td></tr></table></figure><p>:::</p><h2 id="å¯¦è¸é´¨å­çš„è¡Œç‚º"><a href="#å¯¦è¸é´¨å­çš„è¡Œç‚º" class="headerlink" title="å¯¦è¸é´¨å­çš„è¡Œç‚º"></a>å¯¦è¸é´¨å­çš„è¡Œç‚º</h2><ul><li><p>FlyBehaviorä»‹é¢ï¼Œç”¨FlyWithWings(å¯¦è¸æ‰€æœ‰æœ‰ç¿…è†€çš„é´¨å­æœƒé£›çš„è¡Œç‚º)èˆ‡FlyNoWay(å¯¦è¸æ‰€æœ‰ä¸æœƒé£›çš„é´¨å­çš„å‹•ä½œ)é€™å…©å€‹é¡åˆ¥ä¾†å¯¦ä½œ</p></li><li><p>QuackBehaviorä»‹é¢ï¼Œç”¨Quack(çœŸçš„å‘±å‘±å«)ã€Squeak(æ©¡çš®å±å±å«)èˆ‡MuteQuack(å«ä¸å‡ºè²éŸ³)é€™ä¸‰å€‹é¡åˆ¥ä¾†å¯¦ä½œ</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸Šè¨­è¨ˆå°‡é£›è¡Œèˆ‡å‘±å‘±å«çš„è¡Œç‚ºå¯ä»¥è¢«å…¶ä»–ç‰©ä»¶å†ä¸‰åˆ©ç”¨ï¼Œå°‡é´¨å­çš„è¡Œç‚ºæŠ½é›¢å‡ºä¾†</span><br></pre></td></tr></table></figure><h3 id="å•é¡Œèˆ‡æ€è€ƒ"><a href="#å•é¡Œèˆ‡æ€è€ƒ" class="headerlink" title="å•é¡Œèˆ‡æ€è€ƒ"></a>å•é¡Œèˆ‡æ€è€ƒ</h3><ol><li>æ˜¯å¦è©²å…ˆæŠŠç³»çµ±åšå‡ºä¾†ï¼Œåœ¨çœ‹çœ‹å“ªäº›åœ°æ–¹éœ€è¦æ›´å‹•ï¼Œå†å›é ­å°‡éœ€æ›´å‹•çš„é‚è¼¯ç¨ç«‹å‡ºä¾†ï¼Ÿ<ul><li>ç­”ï¼šä¸å„˜ç„¶ï¼Œè¨­è¨ˆç³»çµ±ä¸­å¯ä»¥é å…ˆè€ƒæ…®åˆ°æœªä¾†å“ªäº›åœ°æ–¹å¯èƒ½éœ€è¦è®Šå‹•</li></ul></li><li>é´¨å­æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è¨­è¨ˆæˆä¸€å€‹ä»‹é¢ï¼Ÿ<ul><li>ç­”: ä¸æ°ç•¶ï¼Œå› ç‚ºå·²ç¶“å°‡æœƒè®Šå‹•çš„é‚è¼¯(flyèˆ‡quack)æŠ½é›¢å‡ºdock class, é‚£dock classå°±å¯ä»¥ç›´æ¥ç‚ºæ¯éš»é´¨å­éƒ½æœƒæœ‰åŒæ¨£é‚è¼¯çš„é¡åˆ¥ï¼Œè®“ä¸åŒé¡å‹çš„é´¨å­ç›´æ¥ç¹¼æ‰¿ä½¿ç”¨</li></ul></li></ol><h2 id="æ•´åˆé´¨å­çš„è¡Œç‚º"><a href="#æ•´åˆé´¨å­çš„è¡Œç‚º" class="headerlink" title="æ•´åˆé´¨å­çš„è¡Œç‚º"></a>æ•´åˆé´¨å­çš„è¡Œç‚º</h2><p>å°‡é£›è¡Œèˆ‡å‘±å‘±å«çš„å‹•ä½œï¼Œå§”è¨—å…¶ä»–äººè™•ç† (åœ¨Docké¡åˆ¥ä¸­å®£å‘Š FlyBehaviorèˆ‡QuackBehaviorï¼Œé€éBehaviorä»‹é¢å–å¾— æœ‰å¯¦ä½œè©²Behaviorä»‹é¢çš„è¡Œç‚ºå€‘ ex: FlyBehaviorä»‹é¢æœƒæœ‰FlyWithNoWingsé¡åˆ¥å¯¦ä½œ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Duck &#123;</span><br><span class="line">    FlyBehavior flyBehavior;</span><br><span class="line">    QuackBehavior quackBehavior;</span><br><span class="line">    </span><br><span class="line">    public void performQuack() &#123;</span><br><span class="line">        quackBehavior.quack();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void performFly() &#123;</span><br><span class="line">        flyBehavior.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¾åœ¨ç”±ç¶ é ­é´¨(MallarDuck)ä¾†ä½¿ç”¨Duckçš„quackBehavioræ‰€æ“æœ‰çš„æœ‰å¯¦è¸è‡ªå·±çš„å­é¡åˆ¥ Quack()<br>ç”¨flyBehaviorçš„FlyWithNoWings</p><p>ä¸”MallarDuckç¹¼æ‰¿äº†Ducké¡åˆ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨quackBehaviorå’ŒflyBehaviorå–ç”¨è‡ªå·±å°æ‡‰çš„å‹•ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class MallardDuck extends Duck &#123;</span><br><span class="line">    // constructor</span><br><span class="line">    pubilc MallardDuck() &#123;</span><br><span class="line">        quackBehavior = new Quack();</span><br><span class="line">        flyBehavior = new FlyWithNoWings();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    quackBehavior.performQuack(); </span><br><span class="line">    flyBehavior.performFly();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å®Œæ•´æ¸¬è©¦çš„codeï¼šå¯¦ä½œä¸€å€‹MiniDuck"><a href="#å®Œæ•´æ¸¬è©¦çš„codeï¼šå¯¦ä½œä¸€å€‹MiniDuck" class="headerlink" title="å®Œæ•´æ¸¬è©¦çš„codeï¼šå¯¦ä½œä¸€å€‹MiniDuck"></a>å®Œæ•´æ¸¬è©¦çš„codeï¼šå¯¦ä½œä¸€å€‹MiniDuck</h2><h3 id="Duck-class"><a href="#Duck-class" class="headerlink" title="Duck class"></a>Duck class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    FlyBehavior flyBehavior;</span><br><span class="line">    QuackBehavior quackBehavior;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Duck</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performFly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flyBehavior.fly();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performQuack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quackBehavior.quack();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"All ducks float, even decoys!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="FlyBehavior-and-QuackBehaviorä»‹é¢èˆ‡å¯¦è¸ä¹‹çš„å‹•ä½œ"><a href="#FlyBehavior-and-QuackBehaviorä»‹é¢èˆ‡å¯¦è¸ä¹‹çš„å‹•ä½œ" class="headerlink" title="FlyBehavior and QuackBehaviorä»‹é¢èˆ‡å¯¦è¸ä¹‹çš„å‹•ä½œ"></a>FlyBehavior and QuackBehaviorä»‹é¢èˆ‡å¯¦è¸ä¹‹çš„å‹•ä½œ</h3><p>FlyBehavior.inrface<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å„ç¨®å¯¦è¸Flyçš„é¡åˆ¥</p><p>FlyWithWings.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyWithWings</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am flying"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>FlyNoWay.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyNoWay</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I cannot fly"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>QuackBehavior.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å„ç¨®å¯¦è¸Quackçš„é¡åˆ¥</p><p>Quack.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Quack</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Quack"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>MuteQuack.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MuteQuack</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"&lt;&lt;Silence&gt;&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Squeak.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Squeak</span> <span class="keyword">implements</span> <span class="title">QuackBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Squeak"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å¯¦è¸ç¶ é ­é´¨çš„é¡åˆ¥ï¼šMallardDuck-java"><a href="#å¯¦è¸ç¶ é ­é´¨çš„é¡åˆ¥ï¼šMallardDuck-java" class="headerlink" title="å¯¦è¸ç¶ é ­é´¨çš„é¡åˆ¥ï¼šMallardDuck.java"></a>å¯¦è¸ç¶ é ­é´¨çš„é¡åˆ¥ï¼šMallardDuck.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallardDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    <span class="comment">// constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MallardDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        quackBehavior = <span class="keyword">new</span> Quack();</span><br><span class="line">        flyBehavior = <span class="keyword">new</span> FlyWithWings();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am a real Mallard duck"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¸¬è©¦ç”¨é¡åˆ¥ï¼šMiniDuckSimulator-java"><a href="#æ¸¬è©¦ç”¨é¡åˆ¥ï¼šMiniDuckSimulator-java" class="headerlink" title="æ¸¬è©¦ç”¨é¡åˆ¥ï¼šMiniDuckSimulator.java"></a>æ¸¬è©¦ç”¨é¡åˆ¥ï¼šMiniDuckSimulator.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiniDuckSimulator</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       Duck mallard = <span class="keyword">new</span> MallardDuck();</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// æœƒå‘¼å« MallardDuckç¹¼æ‰¿ä¾†çš„performQuack()</span></span><br><span class="line">       <span class="comment">// é€²è€Œå§”è¨— quackBehaviorè™•ç†quackè¡Œç‚ºï¼Œè€Œéåœ¨è‡ªå·±classå…§è™•ç†</span></span><br><span class="line">       mallard.performQuack();</span><br><span class="line">       mallard.performFly();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‹•æ…‹è¨­å®šè¡Œç‚º"><a href="#å‹•æ…‹è¨­å®šè¡Œç‚º" class="headerlink" title="å‹•æ…‹è¨­å®šè¡Œç‚º"></a>å‹•æ…‹è¨­å®šè¡Œç‚º</h2><p>åœ¨é´¨å­é¡åˆ¥ä¸­å¯ä»¥åŠ å…¥è¨­ç½®flyBehaviorå’ŒquackBehaviorçš„æ–¹æ³•</p><p>å¯ä»¥éš¨æ™‚å‘¼å«ä»¥ä¸‹æ–¹æ³•æ”¹è®Šé´¨å­çš„è¡Œç‚º<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlyBehavior</span><span class="params">(FlyBehavior fb)</span> </span>&#123;</span><br><span class="line">       flyBehavior = fb;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuackBehavior</span><span class="params">(QuackBehavior qb)</span> </span>&#123;</span><br><span class="line">       quackBehavior = qb;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å¦‚æœ‰å€‹ â€œæ¨¡å‹é´¨â€œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ModelDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flyBehavior = <span class="keyword">new</span> FlyNoWay();</span><br><span class="line">        quackBehavior = <span class="keyword">new</span> Quack();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Model duck"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å»ºç«‹ä¸€å€‹æ–°çš„FlyBehaviorå‹æ…‹ï¼Œå…·æœ‰ç«ç®­å™´å°„çš„åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyRocketPowered</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am flying a rocket"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹è®Šæ¸¬è©¦é¡åˆ¥ï¼ŒåŠ ä¸Šæ¨¡å‹é´¨å­ï¼Œä½¿æ¨¡å‹é´¨å…·æœ‰ç«ç®­å‹•åŠ›ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiniDuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Duck mallard = <span class="keyword">new</span> MallardDuck();</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å…·æœ‰å™´å°„å‹•åŠ›çš„æ¨¡å‹é´¨å­</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Duck modelDuck = <span class="keyword">new</span> ModelDuck();</span><br><span class="line">        modelDuck.performFly(); <span class="comment">// ä¸æœƒé£›</span></span><br><span class="line">        <span class="comment">// å‹•æ…‹åœ°æ›´æ›é£›è¡Œçš„è¡Œç‚º</span></span><br><span class="line">        modelDuck.setFlyBehavior(<span class="keyword">new</span> FlyRocketPowered());</span><br><span class="line">        modelDuck.performFly(); <span class="comment">// å™´å°„ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„è¡Œç‚ºç‚ºå°‡å…©å€‹é¡åˆ¥(FlyBehaviorèˆ‡QuackBehavior)çµ„åˆèµ·ä¾†ä½¿ç”¨ï¼Œç‚ºâ€Composition åˆæˆâ€çš„ç²¾ç¥ï¼Œèˆ‡ç¹¼æ‰¿ä¸ä¸€æ¨£çš„æ˜¯ï¼Œé´¨å­Duckçš„è¡Œç‚ºä¸æ˜¯ç¹¼æ‰¿è€Œä¾†ï¼Œè€Œæ˜¯é€éé©ç•¶çš„è¡Œç‚ºç‰©ä»¶ã€åˆæˆã€è€Œä¾†ï¼</p><h3 id="è¨­è¨ˆå®ˆå‰‡"><a href="#è¨­è¨ˆå®ˆå‰‡" class="headerlink" title="è¨­è¨ˆå®ˆå‰‡"></a>è¨­è¨ˆå®ˆå‰‡</h3><p>å¤šç”¨åˆæˆï¼Œå°‘ç”¨ç¹¼æ‰¿</p><p>åˆæˆå¯ä»¥å°‡æ¼”ç®—æ³•å°è£æˆé¡åˆ¥ï¼Œæ›´å¯ä»¥ã€åœ¨åŸ·è¡Œå‹•æ…‹åœ°æ”¹è®Šè¡Œç‚ºã€ï¼Œåªè¦åˆæˆçš„è¡Œç‚ºç‰©ä»¶ï¼Œç¬¦åˆç‰¹å®šçš„ä»‹é¢æ¨™æº–å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Factory Pattern å·¥å» æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/26/Design-Pattern-Java-Factory-Pattern-%E5%B7%A5%E5%BB%A0%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/26/Design-Pattern-Java-Factory-Pattern-%E5%B7%A5%E5%BB%A0%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å·¥å» æ¨¡å¼æä¾›äº†å¯å‰µå»º(new)å„ç¨®ä¸åŒé¡åˆ¥(class)çš„å¯¦ä¾‹(instance)</p><p>å·¥å» æ¨¡å¼ä¸»è¦åˆæ¶µè“‹äº† (1) ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Pattern (2) å·¥å» æ–¹æ³•æ¨¡å¼ (3) æŠ½è±¡æ–¹æ³•æ¨¡å¼</p><p>ç°¡å–®å·¥å» æ–¹æ³•æ˜¯æœ€åˆéšçš„ç”¨æ³•ï¼Œæœƒé•åOOPçš„Open-close principle(OCP)<br>ç„¶è€Œå·¥å» æ–¹æ³•å’ŒæŠ½è±¡æ–¹æ³•å‰‡æ¯”è¼ƒèƒ½è®“æ¨¡çµ„é–“è€¦åˆåº¦é™ä½ã€‚</p><p>ä»¥ä¸‹æœƒä¾åºåšä»‹ç´¹</p><a id="more"></a><h2 id="ç°¡å–®å·¥å» æ¨¡å¼-Simple-Factory-Method"><a href="#ç°¡å–®å·¥å» æ¨¡å¼-Simple-Factory-Method" class="headerlink" title="ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Method"></a>ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Method</h2><p>ç°¡å–®å·¥å» æ¨¡å¼åƒ…æä¾›ä¸€å€‹å·¥å» é¡åˆ¥ï¼Œæ¥æ”¶åƒæ•¸(æ±ºå®šç”Ÿç”¢å“ªç¨®ç”¢å“)ï¼Œä¾†ç”¢ç”Ÿå‡ºå°æ‡‰çš„ç”¢å“ç‰©ä»¶(Object)</p><p>ä»¥ç”Ÿç”¢Pizzaç‚ºä¾‹ï¼Œå‡è¨­æˆ‘å€‘æœ‰å€‹æŠ«è–©ç°¡å–®å·¥å» (SimplePizzaFactory)å¯ä»¥ç”Ÿç”¢å…©ç¨®ä¸åŒå£å‘³çš„Pizza(Cheeseå’ŒPotato):</p><p>SimplePizzaFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å» æœƒå›å‚³æŠ½è±¡çš„Pizzaé¡åˆ¥</p><p>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  String ingridient;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing"</span> + name);</span><br><span class="line">    System.out.println(<span class="string">"Ingredient"</span> + ingridient);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Bake for 20 mins"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥åŠå¯¦ä½œäº†å…©å€‹å£å‘³çš„æŠ«è–© CheesePizzaå’ŒPotatoPizza</p><p>CheesePizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name = <span class="string">"CheesePizza"</span>;</span><br><span class="line">  String ingridient = <span class="string">"Cheese"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>PotatoPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PotatoPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name = <span class="string">"PotatoPizza"</span>;</span><br><span class="line">  String ingridient = <span class="string">"Potato"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>Pizzaéƒ½å®šç¾©å®Œç•¢å¾Œï¼Œå®šç¾©SimplePizzaFactory.java</p><p>SimplePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨Main.javaé€éSimplePizzaFactoryè£½ä½œå…©å€‹Pizza:</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SimplePizzaFactory simplePizzaFactory = <span class="keyword">new</span> SimplePizzaFactory();</span><br><span class="line">    </span><br><span class="line">    simplePizzaFactory.orderPizza(<span class="string">"cheese"</span>);</span><br><span class="line">    simplePizzaFactory.orderPizza(<span class="string">"potato"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸ·è¡ŒMain.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Preparing: CheesePizza</span><br><span class="line">Ingredient: Cheese</span><br><span class="line">Bake for 20 mins</span><br><span class="line">Preparing: PotatoPizza</span><br><span class="line">Ingredient: Potato</span><br><span class="line">Bake for 20 mins</span><br></pre></td></tr></table></figure><p>ä½†æ­¤è‹¥ä¹‹å¾Œè¦æ“´å……Pizzaçš„ç¨®é¡ï¼Œä¾‹å¦‚è¦å¤šä¸€å€‹å«åšOnionPizzaï¼Œå‹¢å¿…å¾—ä¿®æ”¹SimplePizzaFacotory.java</p><p>SimplePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"onion"</span>)) &#123; <span class="comment">// æ–°å¢æ´‹è”¥å£å‘³pizza  </span></span><br><span class="line">      pizza = <span class="keyword">new</span> OnionPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::danger<br>ä¸Šè¿°åšæ³•ç ´å£äº†OODçš„OCP(Open-Close Principle)çš„åŸå‰‡ï¼Œäº¦å³é€²è¡Œæ“´å……æ™‚ä¸ä¿®æ”¹åˆ°SimplePizzaFactoryçš„ç¨‹å¼ç¢¼ã€‚<br>:::</p><h2 id="å·¥å» æ–¹æ³•æ¨¡å¼"><a href="#å·¥å» æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å» æ–¹æ³•æ¨¡å¼"></a>å·¥å» æ–¹æ³•æ¨¡å¼</h2><p>ç‚ºäº†æ”¹å–„ç°¡å–®å·¥å» æ¨¡å¼ï¼Œå·¥å» æ–¹æ³•æ¨¡å¼é€éâ€æŠ½è±¡æ–¹æ³•â€çš„æ¨¡å¼ï¼Œè®“ä¹‹å¾Œæ“´å……çš„å·¥å» å¯¦ä½œè©²â€æŠ½è±¡æ–¹æ³•â€ï¼Œä»¥é€²è¡Œå…¶ä»–é¡åˆ¥çš„æ“´å……</p><p>èˆ‰ä¾‹ï¼šæœ‰å€‹PizzaFactoryè² è²¬å®šç¾©äº†Pizzaå·¥å» è©²åšçš„ä¸€ä»¶äº‹(æŠ½è±¡æ–¹æ³•)<br>å«åš createPizza();</p><p>PizzaFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæœ¬æˆ‘å€‘å·²ç¶“æœ‰å…©ç¨®å£å‘³(Cheeseå’ŒPotato) Pizzaï¼Œå«åšåŸå‘³æŠ«è–©(OriginalPizzaFactory), ä½¿OringinalPizzaFactoryå»å¯¦ä½œPizzaFactoryçš„createPizza()æ–¹æ³•</p><p>OringinalPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OriginalPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"potato"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> PotatoPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‹¥è¦æ–°å¢æ´‹è”¥å£å‘³çš„Pizzaçš„è©±ï¼Œé‚£å°±ç›´æ¥åœ¨å®šç¾©ä¸€å€‹é¡å¤–çš„å·¥å» å«åšï¼Œç‰¹åˆ¥æŠ«è–©å·¥å»  (SpecialPizzaFactory)é€²è¡Œæ“´å……ï¼Œå¦‚æ­¤ä¸€ä¾†å°±ä¸ç”¨æ›´å‹•åˆ°åˆ°åŸæœ¬åŸå‘³æŠ«è–©å·¥å» (OriginalPizzaFactory)çš„ç¨‹å¼ç¢¼</p><p>SpecialPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecialPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(type.equals(<span class="string">"onion"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> OnionPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¨˜å¾—å¤šæ–°å¢ä¸€å€‹æ´‹è”¥æŠ«è–©çš„é¡åˆ¥ </p><p>OnionPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnionPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">OnionPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"OnionPizza"</span>;</span><br><span class="line">    ingridient = <span class="string">"Onion"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨Main.javaä¸­å‘¼å«åŸå‘³å’Œç‰¹åˆ¥å£å‘³çš„æŠ«è–©</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    PizzaFactory originalPizzaFactory = <span class="keyword">new</span> OriginalPizzaFactory();</span><br><span class="line">    </span><br><span class="line">    originalPizzaFactory.orderPizza(<span class="string">"cheese"</span>);</span><br><span class="line">    originalPizzaFactory.orderPizza(<span class="string">"potato"</span>);</span><br><span class="line"></span><br><span class="line">    PizzaFactory specialPizzaFactory = <span class="keyword">new</span> SpecialPizzaFactory();</span><br><span class="line">    specialPizzaFactory.orderPizza(<span class="string">"onion"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€éä¸‹é¢çš„åœ–å¯ä»¥çœ‹åˆ°ï¼Œé€éå®šç¾©ä¸€å€‹æŠ½è±¡æ–¹æ³•çš„å·¥å» ï¼Œè‹¥è¦æ“´å……ç”¢å“(åœ¨é€™è£¡æˆ‘å€‘ç”¨çš„æ˜¯Pizza)é¡åˆ¥çš„è©±ï¼Œé€éå¯¦ä½œè©²æŠ½è±¡æ–¹æ³•å·¥å» ï¼Œä¾†é€²è¡Œæ“´å……ã€‚</p><p><img src="https://i.imgur.com/cmWuZ3v.png" alt=""></p><p>ç”±æ–¼æˆ‘å€‘äº¦æŠŠPizzaé¡åˆ¥çµ¦ç¨ç«‹å‡ºä¾†æˆç‚ºä¸€å€‹æŠ½è±¡é¡åˆ¥ï¼Œè‹¥è¦æ–°å¢å…¶ä»–å£å‘³çš„Pizzaä¹Ÿå¯ä»¥é”åˆ°ä¸é•åOCPç²¾ç¥çš„æ“´å……ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š</p><p><img src="https://i.imgur.com/Wp4QRfE.png" alt=""></p><h2 id="æŠ½è±¡å·¥å» "><a href="#æŠ½è±¡å·¥å» " class="headerlink" title="æŠ½è±¡å·¥å» "></a>æŠ½è±¡å·¥å» </h2><p>æŠ½è±¡å·¥å» é¡§åæ€ç¾©å°±æ˜¯å®šç¾©ä¸€å€‹æŠ½è±¡ä»‹é¢å·¥å» ï¼Œæ¬²æ“´å……çš„è©±å°±å¯¦ä½œè©²æŠ½è±¡ä»‹é¢å·¥å» </p><p>ä»¥æŠ«è–©åŸæ–™å·¥å» (PizzaIngredientFactory)ç‚ºä¾‹ï¼Œæœ‰é†¬æ–™å’Œè”¬èœå…©ç¨®åŸæ–™ï¼š<br>æ–¹é¢çµ¦ä¹‹å¾Œæˆ‘å€‘è¦è£½ä½œçš„ä¸­å¼å’Œç¾å¼æŠ«è–©çš„åŸæ–™å¯¦ä½œï¼Œåšæ“´å±•ï¼š</p><p>PizzaIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h3 id="æŠ½è±¡å·¥å» -åŸæ–™å·¥å» -åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“"><a href="#æŠ½è±¡å·¥å» -åŸæ–™å·¥å» -åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“" class="headerlink" title="æŠ½è±¡å·¥å» (åŸæ–™å·¥å» )åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“"></a>æŠ½è±¡å·¥å» (åŸæ–™å·¥å» )åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“</h3><p>æˆ‘å€‘å†åˆ†åˆ¥ç”¢ç”Ÿç¾å¼ç‰ˆæœ¬(AmericaIngredientFactory)å’Œä¸­å¼ç‰ˆæœ¬(ChinesePizzaFactory)çš„æŠ«è–©åŸæ–™å·¥å» ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†createSauceå’ŒcreateVegetableï¼Œé€éå·¥å» æ–¹æ³•ä¾†ç”¢ç”ŸåŸæ–™ç”¢å“</p><p>AmericaIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaIngredientFactory</span> <span class="keyword">implements</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TomatoSauce();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Potato();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ChineseIngredientFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChineseIngredientFactory</span> <span class="keyword">implements</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SoySauce();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vegetable <span class="title">createVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Onion();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>æ¥è‘—å®šç¾©å‰›å‰›åŸæ–™å·¥å» æœ‰ä½¿ç”¨åˆ°çš„åŸæ–™é¡åˆ¥å€‘(Sauce: SoySauceèˆ‡PotatoSauce; Vegetable: Onionå’ŒPotatoï¼Œè©²åŸæ–™äº¦åœ¨å¯¦ä½œPizzaé¡åˆ¥çš„å…·é«”é¡åˆ¥äº¦æœƒç”¨åˆ°</p><p>:::info<br>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åœ¨Pizzaé¡åˆ¥ä¸­å·²ç¶“æœ‰å®£å‘Šæœƒç”¨åˆ°çš„åŸæ–™æœ‰å“ªäº›ï¼Œæ˜¯ä»¥ä»‹é¢ä¾†å¯¦ä½œï¼Œæ–¹ä¾¿åšæ“´å±•</span></span><br><span class="line">  Sauce sauce;</span><br><span class="line">  Vegetable vegetable;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::</p><p>å®šç¾©é†¬æ–™SauceåŸæ–™å€‘ï¼š</p><p>Sauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getSauce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>SoySauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoySauce</span> <span class="keyword">extends</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SoySauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        name = <span class="string">"soy sauce"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"The sauce is :"</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TomatoSauce.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomatoSauce</span> <span class="keyword">extends</span> <span class="title">Sauce</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TomatoSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"tomato sauce"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The sauce is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹ä¾†æ›å®šç¾©VegetableåŸæ–™å€‘</p><p>Vegetable.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getVegetable</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Onion.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Onion</span> <span class="keyword">extends</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Onion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"onion"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The vegetable is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Potato.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Potato</span> <span class="keyword">extends</span> <span class="title">Vegetable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Potato</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    name = <span class="string">"potato"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getVegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"The vegetable is :"</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>å°‡æŠ«è–©ä¿®æ”¹æˆåŒ…å«ä¸Šè¿°åŸæ–™ (Sauceå’ŒVegetable)</p><p>Pizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  </span><br><span class="line">  Sauce sauce;</span><br><span class="line">  Vegetable vegetable;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å°‡prepareä¿®æ”¹æˆæŠ½è±¡ï¼Œè©²æ–¹æ³•éœ€è¦æ”¶é›†Pizzaæ‰€éœ€çš„åŸæ–™ï¼ŒåŸæ–™ä¾†è‡ªæ–¼åŸæ–™å·¥å» ï¼</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Bake for 30 mins"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®šç¾©å…©å€‹styleçš„Pizza: ä¸­å¼æŠ«è–©(Chinese Pizza)å’Œç¾å¼æŠ«è–©(America Pizza)ï¼Œåœ¨é€™å…©éš»é¡åˆ¥å¯ä»¥çœ‹åˆ°æˆ‘å€‘å‚³å…¥äº†åŸæ–™å·¥å» ï¼Œä»¥æ±ºå®šå“ªç¨®é¢¨æ ¼çš„æŠ«è–©å°±ç”¨å°æ‡‰é¢¨æ ¼çš„åŸæ–™å·¥å» </p><p>ChinesePizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  PizzaIngredientFactory ingredientFactory;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ChinesePizza</span><span class="params">(PizzaIngredientFactory ingredientFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing: "</span> + name);</span><br><span class="line"></span><br><span class="line">    sauce = ingredientFactory.createSauce();</span><br><span class="line">    sauce.getSauce();</span><br><span class="line"></span><br><span class="line">    vegetable = ingredientFactory.createVegetable();</span><br><span class="line">    vegetable.getVegetable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>AmericaPizza.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">  PizzaIngredientFactory ingredientFactory;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AmericaPizza</span><span class="params">(PizzaIngredientFactory ingredientFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Preparing: "</span> + name);</span><br><span class="line"></span><br><span class="line">    sauce = ingredientFactory.createSauce();</span><br><span class="line">    sauce.getSauce();</span><br><span class="line"></span><br><span class="line">    vegetable = ingredientFactory.createVegetable();</span><br><span class="line">    vegetable.getVegetable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>æ¥è‘—å†åˆ©ç”¨å·¥å» æ–¹æ³•ï¼Œå®šç¾©ä¸­å¼å’Œç¾å¼çš„æŠ«è–©å·¥å» ï¼Œè£½ä½œå‡ºä¸­å¼å’Œç¾å¼çš„æŠ«è–©</p><p>PizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    pizza = createPizza(type);</span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>AmericaPizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AmericaPizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Pizza <span class="title">createPizza</span><span class="params">(String style)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨äº†ç¾å¼åŸæ–™å·¥å» </span></span><br><span class="line">    PizzaIngredientFactory ingredientFactory = <span class="keyword">new</span> AmericaIngredientFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(style.equals(<span class="string">"America"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> AmericaPizza(ingredientFactory);</span><br><span class="line">      pizza.setName(<span class="string">"America style pizza"</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::info<br>å¯ä»¥åœ¨å°ç¾å¼å·¥å» æ–°å¢å…¶ä»–ç¨®ä¸åŒå£å‘³çš„Pizzaï¼Œç”¨ä¸åŒçš„åŸæ–™å·¥å» ä¾†é”æˆ<br>:::</p><p>ChinesePizzaFactory.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinesePizzaFactory</span> <span class="keyword">extends</span> <span class="title">PizzaFactory</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Pizza <span class="title">createPizza</span><span class="params">(String style)</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨äº†ä¸­å¼åŸæ–™å·¥å» </span></span><br><span class="line">    PizzaIngredientFactory ingredientFactory = <span class="keyword">new</span> ChineseIngredientFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(style.equals(<span class="string">"Chinese"</span>)) &#123;</span><br><span class="line">      pizza = <span class="keyword">new</span> ChinesePizza(ingredientFactory);</span><br><span class="line">      pizza.setName(<span class="string">"Chinese style pizza"</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><p>æœ€å¾Œåœ¨Main.javaä¸­ä¾†è£½ä½œæŠ«è–©ï¼š</p><p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    PizzaFactory AmericaPizzaFactory = <span class="keyword">new</span> AmericaPizzaFactory();</span><br><span class="line">    </span><br><span class="line">    AmericaPizzaFactory.orderPizza(<span class="string">"America"</span>);</span><br><span class="line"></span><br><span class="line">    PizzaFactory ChinesePizzaFactory = <span class="keyword">new</span> ChinesePizzaFactory();</span><br><span class="line"></span><br><span class="line">    ChinesePizzaFactory.orderPizza(<span class="string">"Chinese"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æŠ½è±¡å·¥å» æ–¹æ³•å¯ä»¥å¹«æˆ‘å€‘æŠŠç›¸é—œç”¢å“é›†çµèµ·ä¾†(ä¸Šè¿°ä¾‹å­ç‚ºåŸæ–™å€‘)ï¼Œå¯ä»¥ç”¢ç”Ÿå‡ºä¸åŒçµ„çš„åŸæ–™é¡åˆ¥å€‘ï¼Œå¦å¤–æŠ½è±¡å·¥å» é€šå¸¸é‚„æœƒå†æ­é…å·¥å» æ–¹æ³•ï¼Œä¾†å»ºç«‹å…¶ç”¢å“(æŠ«è–©å€‘ï¼Œå„å€‹æŠ«è–©æœƒç”¨åˆ°å„å€‹ä¸åŒçš„æŠ½è±¡å·¥å» æ‰€å»ºç«‹çš„åŸæ–™å·¥å» )ï¼Œå¦‚åŒè©²é€£çµæ‰€åšçš„-&gt;<a href="#æŠ½è±¡å·¥å» (åŸæ–™å·¥å» ">é€£çµ</a>åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“)</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Singleton Pattern ç¨é«”æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/26/Design-Pattern-Java-Singleton-Pattern-%E7%8D%A8%E9%AB%94%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/26/Design-Pattern-Java-Singleton-Pattern-%E7%8D%A8%E9%AB%94%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>æ¯æ¬¡å¼•ç”¨é¡åˆ¥éƒ½åªæœƒç”¢å‡ºç›¸åŒçš„ç‰©ä»¶</p><p>é©åˆç”¨åœ¨: åŸ·è¡Œç·’æ± (thread pool)ï¼Œå¿«å–å€(cache)ï¼Œå°è©±ç›’ã€è™•ç†å°è©±è¨­å®šå’Œç™»éŒ„çš„ç‰©ä»¶ï¼Œå’Œé©…å‹•ç¨‹å¼æºé€šçš„ç‰©ä»¶ã€‚</p><a id="more"></a><h2 id="ä½œæ³•"><a href="#ä½œæ³•" class="headerlink" title="ä½œæ³•"></a>ä½œæ³•</h2><p>å‡å¦‚æœ‰ä¸€å€‹é¡åˆ¥å«åšMyClassï¼Œç¾åœ¨è¦è®“MyClassè®Šæˆç¨é«”æ¨¡å¼ï¼Œè®“å¤–é¢çš„é¡åˆ¥åªèƒ½é€é MyClass.getInstance() å–å¾—MyClassç‰©ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¨­å®šæˆprivateèˆ‡staticï¼Œä¸èƒ½çµ¦å¤–é¢é¡åˆ¥å­˜å–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°‡å»ºæ§‹å¼è¨­å®šæˆ privateï¼Œé€™æ¨£å°±å¯ä»¥é¿å…ç›´æ¥è¢«é¡åˆ¥ newå‡ºä¾†</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¨­ç½®æˆstaticï¼Œä½¿å¤–é¢é¡åˆ¥å¯ä»¥ç›´æ¥å­˜å–MyClass.getInstanceæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è‹¥ç¬¬ä¸€æ¬¡å–å¾—MyClassï¼Œ new å‡ºMyClass();</span></span><br><span class="line">        <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> MyClass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–é¡åˆ¥è¦å–ç”¨MyClass</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[]) &#123;</span><br><span class="line">    // 1. ç¬¬ä¸€æ¬¡å–ç”¨getInstance</span><br><span class="line">    Myclass instance = MyClass.getInstance();</span><br><span class="line">    // 2. ç¬¬äºŒæ¬¡å–ç”¨getInstanceæ™‚ï¼ŒMyClassçš„uniqueInstanceå·²ç¶“æœ‰å€¼äº†ï¼Œå¾—åˆ°èˆ‡ä¸Šé¢instanceä¸€æ¨£çš„object</span><br><span class="line">    Myclass instance1 = MyClass.getInstance();</span><br><span class="line">    </span><br><span class="line">    if(instance == instance1) &#123;</span><br><span class="line">        System.out.println(&quot;instance and instance1 are the same&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šåŸ·è¡Œç·’ä¸‹ç¨é«”æ¨¡å¼æœƒé‡åˆ°çš„ç‹€æ³"><a href="#å¤šåŸ·è¡Œç·’ä¸‹ç¨é«”æ¨¡å¼æœƒé‡åˆ°çš„ç‹€æ³" class="headerlink" title="å¤šåŸ·è¡Œç·’ä¸‹ç¨é«”æ¨¡å¼æœƒé‡åˆ°çš„ç‹€æ³"></a>å¤šåŸ·è¡Œç·’ä¸‹ç¨é«”æ¨¡å¼æœƒé‡åˆ°çš„ç‹€æ³</h2><p>å‡å¦‚æœ‰å…©å€‹thread(thread 1å’Œthread 2)ï¼ŒåŒæ™‚è¦è·ŸMyClasså–å¾—ç‰©ä»¶ï¼Œä½†æœƒé¢è‡¨thread1å’Œthread2æœƒå–å¾—ä¸åŒçš„MyClassç‰©ä»¶ï¼Œæƒ…æ³å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/OjAKXpb.png" alt=""></p><h3 id="è§£æ³•ä¸€ï¼šåªè¦æŠŠgetInstance-çµ¦åŒæ­¥åŒ–-æœƒæœ‰æ•ˆèƒ½ä¸ä½³çš„ç‹€æ³ï¼Œå¯èƒ½é€ æˆæ•ˆç‡ä¸‹é™100å€"><a href="#è§£æ³•ä¸€ï¼šåªè¦æŠŠgetInstance-çµ¦åŒæ­¥åŒ–-æœƒæœ‰æ•ˆèƒ½ä¸ä½³çš„ç‹€æ³ï¼Œå¯èƒ½é€ æˆæ•ˆç‡ä¸‹é™100å€" class="headerlink" title="è§£æ³•ä¸€ï¼šåªè¦æŠŠgetInstance()çµ¦åŒæ­¥åŒ– (æœƒæœ‰æ•ˆèƒ½ä¸ä½³çš„ç‹€æ³ï¼Œå¯èƒ½é€ æˆæ•ˆç‡ä¸‹é™100å€)"></a>è§£æ³•ä¸€ï¼šåªè¦æŠŠgetInstance()çµ¦åŒæ­¥åŒ– (æœƒæœ‰æ•ˆèƒ½ä¸ä½³çš„ç‹€æ³ï¼Œå¯èƒ½é€ æˆæ•ˆç‡ä¸‹é™100å€)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstance;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¨­å®šæˆsynchronizedï¼Œå°±å¯ä»¥è®“åŸ·è¡Œç·’ä¾åºé€²å…¥getInstanceå…§</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> MyClass();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘å€‘åªéœ€è¦ç¬¬ä¸€æ¬¡é€²å…¥getInstanceæ‰é€²è¡ŒåŒæ­¥åŒ–å°±å¥½ï¼Œä¸ç„¶å…¶ä»–æ¬¡è¦å–å¾—uniqueInstnaceéƒ½å¾—è®ŠæˆåŒæ­¥çš„æ–¹å¼ï¼Œé€ æˆå–ç”¨Instanceçš„ç·©æ…¢</p><h3 id="è§£æ³•äºŒï¼šç‡å…ˆå»ºç«‹å¯¦é«”ï¼Œä¸è¦ç­‰åˆ°æœ‰äººå‘¼å«getInstanceæ‰newå‡ºMyClasså¯¦é«”"><a href="#è§£æ³•äºŒï¼šç‡å…ˆå»ºç«‹å¯¦é«”ï¼Œä¸è¦ç­‰åˆ°æœ‰äººå‘¼å«getInstanceæ‰newå‡ºMyClasså¯¦é«”" class="headerlink" title="è§£æ³•äºŒï¼šç‡å…ˆå»ºç«‹å¯¦é«”ï¼Œä¸è¦ç­‰åˆ°æœ‰äººå‘¼å«getInstanceæ‰newå‡ºMyClasså¯¦é«”"></a>è§£æ³•äºŒï¼šç‡å…ˆå»ºç«‹å¯¦é«”ï¼Œä¸è¦ç­‰åˆ°æœ‰äººå‘¼å«getInstanceæ‰newå‡ºMyClasså¯¦é«”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥åˆå§‹è©±MyClass()ï¼Œä¸¦è¨­æˆprivate</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass uniqueInstnace = <span class="keyword">new</span> MyClass();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyClass</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyClass <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ä½œæ³•ä¾è³´JVMè¼‰å…¥æ­¤é¡åˆ¥æ™‚ï¼Œé¦¬ä¸Šå»ºç«‹æ­¤å”¯ä¸€çš„ç¨é«”ç‰©ä»¶ï¼ŒJVMä¿è­‰åœ¨ä»»ä½•åŸ·è¡Œç·’å­˜å–uniqueInstnaceéœæ…‹è®Šæ•¸ä¹‹å‰ï¼Œä¸€å®šå…ˆå»ºç«‹æ­¤å¯¦é«”</p><h3 id="è§£æ³•ä¸‰ï¼šåˆ©ç”¨-â€œé›™é‡æª¢æŸ¥ä¸Šé–â€-åœ¨getInstance-ä¸­æ¸›å°‘ä½¿ç”¨åŒæ­¥åŒ–"><a href="#è§£æ³•ä¸‰ï¼šåˆ©ç”¨-â€œé›™é‡æª¢æŸ¥ä¸Šé–â€-åœ¨getInstance-ä¸­æ¸›å°‘ä½¿ç”¨åŒæ­¥åŒ–" class="headerlink" title="è§£æ³•ä¸‰ï¼šåˆ©ç”¨ â€œé›™é‡æª¢æŸ¥ä¸Šé–â€ åœ¨getInstance()ä¸­æ¸›å°‘ä½¿ç”¨åŒæ­¥åŒ–"></a>è§£æ³•ä¸‰ï¼šåˆ©ç”¨ â€œé›™é‡æª¢æŸ¥ä¸Šé–â€ åœ¨getInstance()ä¸­æ¸›å°‘ä½¿ç”¨åŒæ­¥åŒ–</h3><p>åˆ©ç”¨é›™é‡æª¢æŸ¥ä¸Šé–ï¼Œé¦–å…ˆæª¢æŸ¥æ˜¯å¦å¯¦é«”å·²ç¶“å»ºç«‹äº†ï¼Œ<br>è‹¥æ²’æœ‰ï¼Œâ€œæ‰â€é€²è¡ŒåŒæ­¥åŒ–ï¼Œå¦‚æ­¤ä¸€ä¾†åªæœ‰ç¬¬ä¸€æ¬¡é€²å…¥getInstanceæ‰åŒæ­¥åŒ–ï¼Œæ‰æ˜¯æˆ‘å€‘æ‰€æƒ³è¦çš„ã€‚</p><p><code>`</code>java=<br>public class MyClass {<br>    // volatileç‚ºJava 6ä¹‹å¾Œæ‰æœ‰çš„é—œéµå­—ï¼Œèƒ½å¤ ä½¿åŸ·è¡Œç·’å€‘å–å¾—ç›¸åŒçš„uniqueInstance<br>    private volatile static MyClass uniqueInstance;</p><pre><code>private MyClass() {}public static MyClass getInstance() {    // åªæœ‰ç¬¬ä¸€æ¬¡æ‰å¾¹åº•åŸ·è¡Œä»¥ä¸‹ç¨‹å¼ç¢¼     // ç•¶åŸ·è¡Œç·’é‡åˆ°è¢«å®£å‘Šæˆvolatileçš„uniqueInstnaceï¼Œæœƒè®Šå¾—è¬¹æ…    if(uniqueInstance == null) {        synchronized(MyClass.class) {            // å†æª¢æŸ¥ä¸€æ¬¡ï¼Œè‹¥ç‚ºnullå‰‡new MyClass();            if(uniqueInstance == null) {                uniqueInstance = new MyClass();            }        }    }    return uniqueInstance;}</code></pre><p>}</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Command Pattern å‘½ä»¤æ¨¡å¼ [Design Pattern in Java]</title>
      <link href="/2020/07/26/Design-Pattern-Command-Pattern-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/26/Design-Pattern-Command-Pattern-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>å‘½ä»¤æ¨¡å¼ä¸»è¦å°‡åŸ·è¡Œçš„å‘½ä»¤, èˆ‡åŸ·è¡Œè€…åšé¬†ç¶çš„å‹•ä½œ</p><a id="more"></a><h2 id="æ²’æœ‰å‘½ä»¤æ¨¡å¼æœƒæ˜¯æ€æ¨£çš„å¯«æ³•ï¼Ÿï¼Ÿ"><a href="#æ²’æœ‰å‘½ä»¤æ¨¡å¼æœƒæ˜¯æ€æ¨£çš„å¯«æ³•ï¼Ÿï¼Ÿ" class="headerlink" title="æ²’æœ‰å‘½ä»¤æ¨¡å¼æœƒæ˜¯æ€æ¨£çš„å¯«æ³•ï¼Ÿï¼Ÿ"></a>æ²’æœ‰å‘½ä»¤æ¨¡å¼æœƒæ˜¯æ€æ¨£çš„å¯«æ³•ï¼Ÿï¼Ÿ</h2><p>å‡å¦‚æˆ‘å€‘ç¾åœ¨è¦å¯«ä¸€å€‹ é™æ§å™¨ RemoteControl (åŸ·è¡Œè€…), ä¸Šé¢æœƒæœ‰å¾ˆå¤šæŒ‰éˆ•åŠŸèƒ½ (å‘½ä»¤)</p><p>æ¯å€‹æŒ‰éˆ•å¯èƒ½éƒ½å°æ‡‰å„å€‹åŠŸèƒ½, ä¾‹å¦‚ æ‰“é–‹, é—œé–‰æŸäº›æˆ¿é–“çš„ç‡ˆ</p><p>æ–¼æ˜¯æˆ‘å€‘å®šç¾©äº† <code>Light</code> æŠ½è±¡é¡åˆ¥, æœ‰è‘— <code>on()</code>èˆ‡<code>off()</code>é–‹é—œç‡ˆçš„æ–¹æ³•, ä¸¦ä¸”å¯¦ä½œäº† <code>LivingRoomLight</code>, <code>KitchenLight</code>é€™å…©å€‹æˆ¿é–“ä¸¦ç¹¼æ‰¿ <code>Light</code>æŠ½è±¡é¡åˆ¥çš„æ–¹æ³•, ä½¿ä»–å€‘éƒ½æœ‰é–‹é—œçš„åŠŸèƒ½ï¼</p><p>æ¥è‘—åœ¨é™æ§å™¨ <code>RemoteControl</code>é¡åˆ¥å…§å®šç¾©äº† <code>Light[]</code> é™£åˆ—, å„²å­˜æ¬²åŸ·è¡Œçš„åŠŸèƒ½ (å¯¦ä½œLightçš„é¡åˆ¥å€‘)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šç¾©å‡ºä¸€å€‹é™æ§å™¨instance</span></span><br><span class="line">        RemoteControl remoteControl =</span><br><span class="line">                <span class="keyword">new</span> RemoteControl(</span><br><span class="line">                <span class="keyword">new</span> Light[]&#123;</span><br><span class="line">                        <span class="keyword">new</span> LivingRoomLight(),</span><br><span class="line">                        <span class="keyword">new</span> KitchenLight()</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// 0: æ‰“é–‹LivingRoom Light</span></span><br><span class="line">        <span class="comment">// 1: æ‰“é–‹Kitchen Light</span></span><br><span class="line">        remoteControl.turnOnLight(<span class="number">0</span>);</span><br><span class="line">        remoteControl.turnOnLight(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 0: é—œé–‰LivingRoom Light</span></span><br><span class="line">        <span class="comment">// 1: é—œé–‰Kitchen Light</span></span><br><span class="line">        remoteControl.turnOffLight(<span class="number">0</span>);</span><br><span class="line">        remoteControl.turnOffLight(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Light[] lights = <span class="keyword">new</span> Light[<span class="number">10</span>];</span><br><span class="line">    RemoteControl(Light[] lights) &#123;</span><br><span class="line">        <span class="comment">// å°‡å‚³é€²ä¾†çš„lightsæ”¾å…¥åˆ°lightså…§</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.lights[i] = lights[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOnLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].on();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOffLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    Light() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LivingRoomLight</span> <span class="keyword">extends</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    LivingRoomLight() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the living room light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the living room light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KitchenLight</span> <span class="keyword">extends</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    KitchenLight() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the kitchen light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the kitchem light"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸ·è¡Œçµæœå¦‚ä¸‹</p><p><img src="https://i.imgur.com/AvxerGU.png" alt=""></p><h3 id="å•é¡Œ"><a href="#å•é¡Œ" class="headerlink" title="å•é¡Œ"></a>å•é¡Œ</h3><p>å‡å¦‚ç¾åœ¨åˆæƒ³è¦æ·»åŠ é›»è¦–èˆ‡å†·æ°£é–‹é—œçš„åŠŸèƒ½ <code>TV</code>, <code>AirConditioner</code>, é‚£ä¸å°±åˆè¦åœ¨<code>RemoteControl</code>é¡åˆ¥å…§é€²è¡Œä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆæ–°å¢äº†HomeDeviceé™£åˆ—...å®šç¾©å®¶å…·é›†åˆçš„é¡åˆ¥</span></span><br><span class="line">    HomeDevice[] homeDevices = <span class="keyword">new</span> HomeDevice[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    Light[] lights = <span class="keyword">new</span> Light[<span class="number">10</span>];</span><br><span class="line">    RemoteControl(Light[] lights) &#123;</span><br><span class="line">        <span class="comment">// å°‡å‚³é€²ä¾†çš„lightsæ”¾å…¥åˆ°lightså…§</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;lights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.lights[i] = lights[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOnLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].on();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOffLight</span><span class="params">(<span class="keyword">int</span> buttonNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lights[buttonNumber].off();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆåœ¨å®šç¾©HomeDeviceçš„é–‹é—œåŠŸèƒ½...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯çœ‹åˆ°æ¯æ¬¡è‹¥è¦ç‚ºé™æ§å™¨é¡åˆ¥æ–°å¢åŠŸèƒ½, éƒ½è¦å°<code>RemoteControl</code>é€²è¡Œä¿®æ”¹çš„å‹•ä½œ, å¦‚æ­¤ä¸€ä¾†å¯èƒ½æœƒé€ æˆå…¶ä»–å·²ç¶“å…§åµŒå¥½çš„åŠŸèƒ½å¯èƒ½è¢«æ”¹å£çš„ç‹€æ³ç™¼ç”Ÿ, é€™æ™‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ <code>Command æ¨¡å¼</code> ä¾†é¿å…é€™ç¨®ç‹€æ³ç™¼ç”Ÿ</p><h2 id="Command-å‘½ä»¤æ¨¡å¼çš„å„ªå‹¢"><a href="#Command-å‘½ä»¤æ¨¡å¼çš„å„ªå‹¢" class="headerlink" title="Command å‘½ä»¤æ¨¡å¼çš„å„ªå‹¢"></a>Command å‘½ä»¤æ¨¡å¼çš„å„ªå‹¢</h2><p>å‘½ä»¤æ¨¡å¼å¯ä»¥å¹«æˆ‘å€‘æŠŠè¦è³¦äºˆ<code>RemoteControl</code>çš„é€™äº›åŠŸèƒ½çµ¦å°è£èµ·ä¾†, æˆç‚ºä¸€å€‹ç¨ç«‹çš„å€‹é«”, ä¸æœƒè·Ÿ<code>RemoteControl</code>çµ¦è€¦åˆå†ä¸€èµ· (åƒä¸Šé¢turnOnLight, turnOffLightç­‰åŠŸèƒ½)</p><p>æˆ‘å€‘å¯ä»¥æŠŠ <code>Light</code> çš„é–‹é—œåŠŸèƒ½éƒ½è¦–ä½œç‚º <code>Command (å‘½ä»¤)</code>æŠ½è±¡ä»‹é¢, è©²ä»‹é¢åŒ…å«äº†ä¸€å€‹ <code>execute()</code>åŠŸèƒ½, </p><p>æ¥è‘—ç”±Command (å‘½ä»¤)è¡ä¼¸å‡º <code>LightOnCommand</code>èˆ‡<code>LightOffCommand</code>é€™å…©å€‹å¯¦ä½œé¡åˆ¥, è² è²¬å®šç¾©<code>Light</code>çš„é–‹èˆ‡é—œçš„å‹•ä½œ</p><p><img src="https://i.imgur.com/t1zF1vQ.jpg" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šç¾©ä¸€å€‹å‘½ä»¤, åŒ…å«çš„åŸ·è¡Œexecuteçš„å‹•ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¦ä½œç‡ˆçš„é–‹é—œå‘½ä»¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn on the light"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Turn off the light"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightOnCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    Light light;</span><br><span class="line"></span><br><span class="line">    LightOnCommand() &#123;</span><br><span class="line">        <span class="keyword">this</span>.light = <span class="keyword">new</span> Light();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightOffCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    Light light;</span><br><span class="line"></span><br><span class="line">    LightOffCommand() &#123;</span><br><span class="line">        <span class="keyword">this</span>.light = <span class="keyword">new</span> Light();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    NoCommand() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Not yet defined"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥è‘—æˆ‘å€‘éœ€è¦åœ¨é™æ§å™¨é¡åˆ¥ <code>RemoteControl</code> å®šç¾©å¯æ”¾ç½®Commandçš„å‹•ä½œ <code>setXXXCommand()</code>, ä»¥åŠå‘¼å«Commandçš„ <code>pressOnButton()</code>èˆ‡<code>pressOffButton()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šç¾©é™æ§å™¨é¡åˆ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line">    Command[] onCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line">    Command[] offCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¸€é–‹å§‹çš„æ’æ§½, è‹¥æ²’åŠŸèƒ½å°±å®šç¾©ä¸€å€‹æ²’ä½œç”¨çš„commandä¾›å‘¼å« (å¯é¿å…ç”¨ if (command != null) é€™ç¨®åˆ¤æ–·æ–¹å¼</span></span><br><span class="line">    RemoteControl() &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) &#123;</span><br><span class="line">            onCommands[i] = <span class="keyword">new</span> NoCommand();</span><br><span class="line">            offCommands[i] = <span class="keyword">new</span> NoCommand();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnCommand</span><span class="params">(<span class="keyword">int</span> slot, Command onCommand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onCommands[slot] = onCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOffCommand</span><span class="params">(<span class="keyword">int</span> slot, Command offCommand)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.offCommands[slot] = offCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pressOnButton</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onCommands[slot].execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pressOffButton</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.offCommands[slot].execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¯ç¤ºæˆ‘å€‘å¡äº†å“ªäº›åŠŸèƒ½åˆ°slotå…§</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuffer stringBuff = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        stringBuff.append(<span class="string">"\n ------- Remote Control-------\n"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; onCommands.length; i++) &#123;</span><br><span class="line">            stringBuff.append(<span class="string">"[slot "</span> + i + <span class="string">"] "</span> + onCommands[i].getClass().getName() + <span class="string">"    "</span> + offCommands[i].getClass().getName() + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuff.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éé€™æ¨£çš„åšæ³•, æˆ‘å€‘å¯ä»¥çœ‹åˆ°åŸæœ¬<code>RemoteControl</code>å…§çš„èˆ‡Lightæ“ä½œæœ‰é—œçš„å‹•ä½œ, éƒ½è¢«æˆ‘å€‘é€é <code>Command</code> æŠ½è±¡ä»‹é¢ä»¥åŠå…¶ <code>LightOnCommand</code>èˆ‡<code>LightOffCommand</code>å¯¦ä½œé¡åˆ¥çµ¦æŠ½é›¢å‡ºä¾†äº†</p><p>æ–¼æ˜¯æˆ‘å€‘å¯ä»¥ä¾†åŸ·è¡Œçœ‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RemoteControl remoteControl = <span class="keyword">new</span> RemoteControl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šç¾©å‡ºå…©ç¨®æˆ¿é–“çš„ç‡ˆ</span></span><br><span class="line">        Light LivingRoomLight = <span class="keyword">new</span> Light(<span class="string">"Living Room"</span>);</span><br><span class="line">        Light KitchenLight = <span class="keyword">new</span> Light(<span class="string">"Kitchen"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¨­ç½®CommandæŒ‰éˆ•</span></span><br><span class="line">        remoteControl.setOnCommand(<span class="number">0</span>, <span class="keyword">new</span> LightOnCommand(LivingRoomLight));</span><br><span class="line">        remoteControl.setOffCommand(<span class="number">0</span>, <span class="keyword">new</span> LightOffCommand(LivingRoomLight));</span><br><span class="line"></span><br><span class="line">        remoteControl.setOnCommand(<span class="number">1</span>, <span class="keyword">new</span> LightOnCommand(KitchenLight));</span><br><span class="line">        remoteControl.setOffCommand(<span class="number">1</span>, <span class="keyword">new</span> LightOffCommand(KitchenLight));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é¡¯ç¤ºæœ‰å“ªäº›åŠŸèƒ½</span></span><br><span class="line">        System.out.println(remoteControl.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸ·è¡Œå‘½ä»¤</span></span><br><span class="line">        <span class="comment">//// å®¢å»³çš„</span></span><br><span class="line">        remoteControl.pressOnButton(<span class="number">0</span>);</span><br><span class="line">        remoteControl.pressOffButton(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//// å»šæˆ¿çš„</span></span><br><span class="line">        remoteControl.pressOnButton(<span class="number">1</span>);</span><br><span class="line">        remoteControl.pressOffButton(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/q9PTG18.png" alt=""></p><p>è‹¥æ¥ä¸‹ä¾†éœ€è¦æ–°å¢å¦‚æµ´å®¤é–‹é—œ, é›»è¦–é–‹é—œ, åªè¦é€é<code>RemoteConrol</code>çš„<code>setCommand()</code>æ–¹æ³•, å³å¯ä»¥å‹•æ…‹åšè¨­ç½®, ä¸éœ€æ›´å‹•åˆ°é™æ§å™¨é¡åˆ¥åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼ (é™¤éè¦æ”¹è®Šé™æ§å™¨çš„slotå¤§å°äº†)</p><h2 id="é€²éšçš„Command-PatternæŠ€å·§"><a href="#é€²éšçš„Command-PatternæŠ€å·§" class="headerlink" title="é€²éšçš„Command PatternæŠ€å·§"></a>é€²éšçš„Command PatternæŠ€å·§</h2><p>ç­‰å¾…è£œå…… (ç‚ºCommandä»‹é¢æ–°å¢ undo()æ–¹æ³•, ä½¿å‹•ä½œå¾©åŸ)</p><h2 id="æ‡‰ç”¨å ´æ™¯"><a href="#æ‡‰ç”¨å ´æ™¯" class="headerlink" title="æ‡‰ç”¨å ´æ™¯"></a>æ‡‰ç”¨å ´æ™¯</h2><p>é‹ç”¨åœ¨ä»»å‹™åºåˆ—ä¸­, å¤šåŸ·è¡Œç·’åªè¦æ‹¿åˆ°Commandç‰©ä»¶, ä¸¦ä¸”åŸ·è¡Œ<code>execute</code>æ–¹æ³•è² è²¬åŸ·è¡Œå®Œå°±å¥½</p><p>æˆ–æ˜¯ç”¨åœ¨æ—¥èªŒç®¡ç†, å°‡åŸ·è¡Œéçš„å‹•ä½œçµ¦è¨˜éŒ„èµ·ä¾†, ä¸¦ä¸”è‹¥å¾ŒçºŒä¼ºæœå™¨ç•¶æ©Ÿ, å¯å°‡å‘½ä»¤çµ¦å¾©åŸ</p>]]></content>
      
      
      <categories>
          
          <category> Design Pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Design Pattern </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº«</title>
      <link href="/2020/05/16/%E4%B8%8B%E7%8F%AD%E8%87%AA%E4%BF%AE%E7%9A%84%E7%B6%93%E9%A9%97%E5%88%86%E4%BA%AB/"/>
      <url>/2020/05/16/%E4%B8%8B%E7%8F%AD%E8%87%AA%E4%BF%AE%E7%9A%84%E7%B6%93%E9%A9%97%E5%88%86%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‰›å¥½åœ¨Backendç‰ˆä¸Šçœ‹åˆ°æœ‰äººPoæ–‡å•èªª: â€œä¸‹ç­å¾Œè¦å¦‚ä½•ç²¾é€²è‡ªä¿®â€, æ„å¤–çœ‹åˆ°è¨±å¤šå¤§å¤§å€‘åœ¨ä¸‹é¢ç•™è¨€, æ­£å¥½æœ€è¿‘æˆ‘ä¹Ÿåœ¨æ€è€ƒè¦å¦‚ä½•ç²¾é€²è‡ªå·±, æ‰€ä»¥è¶é€™æ©Ÿæœƒä¾†çµ±æ•´ä¸€ä¸‹å¤§å¤§å€‘æå‡ºä¾†çš„æƒ³æ³•ä¸¦ä¸”èˆ‡è‡ªå·±ç›®å‰çš„é€²ä¿®æ–¹å¼åšçµåˆ, ä¸»è¦æœƒä»¥Full-Stack engineerçš„ç²¾é€²æ–¹å¼ä¾†åšå€‹ç´€éŒ„åˆ†äº«.</p><a id="more"></a><h2 id="å¦‚æœå°æŸç¨‹å¼èªè¨€-amp-æ¡†æ¶æŒæ¡åº¦é‚„ä¸å¤ -è«‹å…ˆç†Ÿæ‚‰ä¹‹ï¼"><a href="#å¦‚æœå°æŸç¨‹å¼èªè¨€-amp-æ¡†æ¶æŒæ¡åº¦é‚„ä¸å¤ -è«‹å…ˆç†Ÿæ‚‰ä¹‹ï¼" class="headerlink" title="å¦‚æœå°æŸç¨‹å¼èªè¨€&amp;æ¡†æ¶æŒæ¡åº¦é‚„ä¸å¤ , è«‹å…ˆç†Ÿæ‚‰ä¹‹ï¼"></a>å¦‚æœå°æŸç¨‹å¼èªè¨€&amp;æ¡†æ¶æŒæ¡åº¦é‚„ä¸å¤ , è«‹å…ˆç†Ÿæ‚‰ä¹‹ï¼</h2><p>å¦‚æœä¸Šç­æ¥è§¸åˆ°æŸç¨®è‡ªå·±ä¸ç†Ÿæ‚‰çš„èªè¨€æˆ–æ¡†æ¶, åƒæˆ‘ç›®å‰éœ€è¦å¯«Java &amp; Spring, èˆ‡Angular &amp; Typescript.</p><p>æ‰€ä»¥æˆ‘æœƒåå¥½å…ˆåˆ°ç·šä¸Šç¨‹å¼èªè¨€ç·šä¸Šå¹³å°é€²ä¿®ä¹‹, å› ç‚ºé€™äº›å­¸ç¿’å¹³å°èƒ½å¤ æä¾›å®Œæ•´çš„å­¸ç¿’è¼ªå»“, èƒ½å¤ è®“æˆ‘å¿«é€ŸæŒæ¡è©²ç¨‹å¼èªè¨€&amp;æ¡†æ¶æ‰€éœ€å…·å‚™çš„ç¡¬çŸ¥è­˜ç‚ºä½•.</p><p>èªªåˆ°ç·šä¸Šç¨‹å¼å­¸ç¿’å¹³å°, æˆ‘è »æ¨è–¦ <a href="https://app.pluralsight.com/" target="_blank" rel="noopener">Pluralsight</a>, å› ç‚ºè©²å¹³å°æä¾›äº†è©²ç¨‹å¼èªè¨€æˆ–æ¡†æ¶æ¨è–¦å­¸ç¿’çš„å½±ç‰‡, ä¸¦ä¸”é€éæ¸¬é©—æ¨ä¼°ä½ å°è©²æŠ€è¡“çš„çŸ¥è­˜ç¨‹åº¦ç‚ºä½•.</p><p><img src="https://i.imgur.com/2vtrkLm.png" alt=""></p><p>æœ‰èˆˆè¶£å¯ä»¥åˆ°è©²å¹³å°è©¦è©¦çœ‹, ä¸éæ¯å€‹æœˆæœƒæ”¶å–29ç¾å…ƒçš„èŠ±è²», ä¸éé€™èŠ±è²»ç•¶ä½œæŠ•è³‡æ˜¯è »å€¼å¾—çš„.</p><h2 id="è‹¥å·²ç¶“å°ç¨‹å¼èªè¨€-amp-æ¡†æ¶æœ‰ç¶“é©—-å¯ä»¥å˜—è©¦çœ‹çœ‹Side-Project"><a href="#è‹¥å·²ç¶“å°ç¨‹å¼èªè¨€-amp-æ¡†æ¶æœ‰ç¶“é©—-å¯ä»¥å˜—è©¦çœ‹çœ‹Side-Project" class="headerlink" title="è‹¥å·²ç¶“å°ç¨‹å¼èªè¨€&amp;æ¡†æ¶æœ‰ç¶“é©—, å¯ä»¥å˜—è©¦çœ‹çœ‹Side Project"></a>è‹¥å·²ç¶“å°ç¨‹å¼èªè¨€&amp;æ¡†æ¶æœ‰ç¶“é©—, å¯ä»¥å˜—è©¦çœ‹çœ‹Side Project</h2><p>ç‚ºä»€éº¼æœƒç‰¹åœ°æåˆ°Side Project?? é‚£æ˜¯å› ç‚ºåœ¨å…¬å¸å…¶å¯¦å¾ˆé›£è‡ªå·±èƒ½å¤ è² è²¬å°ˆæ¡ˆçš„æ‰€æœ‰å…¨è²Œ, ä¾‹å¦‚å¯èƒ½åªæ˜¯è² è²¬å¯«API, ä¹Ÿå¯èƒ½åªè² è²¬å‰ç«¯é é¢çš„åˆ»ç•«.</p><p>æ‰€ä»¥é€éSide Project, ä¾¿èƒ½å¤ æœ‰æ©Ÿæœƒå˜—è©¦æ‰€æœ‰æŠ€è¡“çš„æ©Ÿæœƒ, ä¸¦ä¸”å¾ä¸­å»é«”æœƒåˆ°è‡ªå·±æœ€æƒ³è¦åŠ å¼·çš„é ˜åŸŸæ˜¯å“ªé‚Š, ä¾‹å¦‚å¾Œç«¯æ•ˆèƒ½? å‰ç«¯æ¸²æŸ“é€Ÿåº¦? Container, CI/CDçš„é‹ä½œ? è«¸å¦‚æ­¤é¡, å¾è€ŒåŸ¹é¤Šä¸€å€‹Full-Stackçš„ç¶“é©—.</p><p>æ‰€ä»¥ä¸‹ç­å¾Œè‡ªå·±è·‘ä¸€å€‹Side Projectæ˜¯å€‹ä¸éŒ¯çš„ç²¾é€²æ–¹å¼.</p><h3 id="ä½†è¦æ€éº¼æ¨£æƒ³å‡ºä¸€å€‹Side-Project"><a href="#ä½†è¦æ€éº¼æ¨£æƒ³å‡ºä¸€å€‹Side-Project" class="headerlink" title="ä½†è¦æ€éº¼æ¨£æƒ³å‡ºä¸€å€‹Side Project?"></a>ä½†è¦æ€éº¼æ¨£æƒ³å‡ºä¸€å€‹Side Project?</h3><p>æˆ‘è¦ºå¾—å­¸ç¿’æœ€å¿«çš„æ–¹å¼å°±æ˜¯æ¨¡ä»¿, å¯ä»¥åˆ°Githubä¸Šæœå°‹æœ‰èˆˆè¶£çš„å°ˆæ¡ˆ, ä¸¦ä¸”è©¦è‘—ç”¨è‡ªå·±çš„ç¨‹å¼èªè¨€èˆ‡æ¡†æ¶è‡ªå·±åšå‡ºä¸€å¥—æ˜¯æœ€å¿«çš„æ–¹å¼.</p><p>åƒæˆ‘å› ç‚ºå¾ˆå–œæ­¡ç”¨Markdownæ–¹å¼ä¾†åšç­†è¨˜, ç›®å‰æ‰“ç®—è‡ªå·±åšå€‹å°å‹çš„ç·šä¸Šç­†è¨˜ç·¨è¼¯ç³»çµ±, ä¸¦çœ‹åˆ°Githubä¸Šæœ‰æä¾›<a href="https://github.com/codimd/server" target="_blank" rel="noopener">CodiMD</a> çš„é–‹æºå°ˆæ¡ˆå¯åƒè€ƒ,<br>ä¾†è©¦è‘—è‡ªå·±å»ºé€ å‡ºä¸€å€‹çœ‹çœ‹. ä¹‹å¾Œæœ‰æ©Ÿæœƒå†åˆ†äº«åˆ°è‡ªå·±çš„éƒ¨è½æ ¼ä¸Šæ€éº¼ä¸€æ­¥ä¸€æ­¥é€²è¡Œçš„.</p><h2 id="å˜—è©¦æ’°å¯«ç·šä¸Šç­†è¨˜æˆ–éƒ¨è½æ ¼å§"><a href="#å˜—è©¦æ’°å¯«ç·šä¸Šç­†è¨˜æˆ–éƒ¨è½æ ¼å§" class="headerlink" title="å˜—è©¦æ’°å¯«ç·šä¸Šç­†è¨˜æˆ–éƒ¨è½æ ¼å§"></a>å˜—è©¦æ’°å¯«ç·šä¸Šç­†è¨˜æˆ–éƒ¨è½æ ¼å§</h2><p>æˆ‘èªç‚ºç¾åœ¨æŠ€è¡“çœŸçš„å¤ªå¤šå¤ªå¤šäº†, å¦‚æœæ²’æœ‰å°‡è‡ªå·±çœ‹éçš„æŠ€è¡“æ–‡ç« æˆ–å­¸ç¿’å½±ç‰‡çµ¦æ¶ˆåŒ–å’Œè¨˜éŒ„èµ·ä¾†, å¾ˆå¿«å°±åˆæœƒå¿˜è¨˜. æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯æœ‰å€‹åšç­†è¨˜çš„ç¿’æ…£!</p><p>åšç­†è¨˜çš„è©±æˆ‘éƒ½æ˜¯ç”¨Hackmdå…ˆè¨˜éŒ„èµ·ä¾†, ä¹‹å¾Œç­‰æœ‰ç©ºçš„æ™‚é–“æœƒå†æ¶ˆåŒ–å¯©è¦–è‡ªå·±å¯«éçš„å…§å®¹, ä¸¦ç™¼ä½ˆåˆ°è‡ªå·±çš„Blogerä¸Š, é€™æ¨£æœ‰åŠ©æ–¼å°‡å­¸ç¿’éçš„çŸ¥è­˜çµ¦å…§åŒ–åˆ°è‡ªå·±çš„è…¦æµ·ä¸­.</p><h2 id="å…¶ä»–æ›´é€²éšçš„é€²ä¿®æ–¹æ³•"><a href="#å…¶ä»–æ›´é€²éšçš„é€²ä¿®æ–¹æ³•" class="headerlink" title="å…¶ä»–æ›´é€²éšçš„é€²ä¿®æ–¹æ³•"></a>å…¶ä»–æ›´é€²éšçš„é€²ä¿®æ–¹æ³•</h2><h3 id="æ ¹æ“šæŠ€èƒ½æ¨¹-RoadMap-ä¾†è£œå……è‡ªå·±æœ€å¸¸ç”¨-æœ‰èˆˆè¶£ä½†æ‰€ç¼ºä¹çš„è§€å¿µèˆ‡æŠ€è¡“"><a href="#æ ¹æ“šæŠ€èƒ½æ¨¹-RoadMap-ä¾†è£œå……è‡ªå·±æœ€å¸¸ç”¨-æœ‰èˆˆè¶£ä½†æ‰€ç¼ºä¹çš„è§€å¿µèˆ‡æŠ€è¡“" class="headerlink" title="æ ¹æ“šæŠ€èƒ½æ¨¹(RoadMap)ä¾†è£œå……è‡ªå·±æœ€å¸¸ç”¨,æœ‰èˆˆè¶£ä½†æ‰€ç¼ºä¹çš„è§€å¿µèˆ‡æŠ€è¡“"></a>æ ¹æ“šæŠ€èƒ½æ¨¹(RoadMap)ä¾†è£œå……è‡ªå·±æœ€å¸¸ç”¨,æœ‰èˆˆè¶£ä½†æ‰€ç¼ºä¹çš„è§€å¿µèˆ‡æŠ€è¡“</h3><p>é€™ç¶²ç«™<a href="https://roadmap.sh/roadmaps" target="_blank" rel="noopener">Roadmap</a>æä¾›äº†å„é–‹ç™¼è€…(Frontend, Backend, DevOps)æ‰€éœ€è¦å…·å‚™çš„æŠ€èƒ½æ¨¹ç‚ºä½•<br>, è‹¥æƒ³è¦å¾€å¾Œç«¯ç²¾é€², å¯ä»¥çœ‹åˆ°ä¸‹é¢é€™å¼µåœ–æœƒç¢°åˆ°å“ªäº›æ‰€éœ€å…·å‚™çš„èƒ½åŠ›.</p><p><img src="https://i.imgur.com/tGdhgGX.png" alt=""></p><p>çœ‹å®Œä¹‹å¾Œæœƒç™¼è¦ºæœ‰å¤ªå¤šæ±è¥¿éœ€è¦Coveräº†, å­¸æµ·ç„¡æ¶¯ (èŒ¶).</p><h3 id="ç¶“ç‡Ÿ-Stackoverflow"><a href="#ç¶“ç‡Ÿ-Stackoverflow" class="headerlink" title="ç¶“ç‡Ÿ Stackoverflow"></a>ç¶“ç‡Ÿ Stackoverflow</h3><p>é€™é»æ˜¯æˆ‘çœ‹åˆ°å¤§å¤§å€‘æå‡ºä¾†å¯ä»¥å˜—è©¦çš„æ–¹å¼, ä¸éæˆ‘ç›®å‰ä¹Ÿåªæœ‰åœ¨Stackoverflowä¸Šé¢å•å¹¾å€‹å°å•é¡Œ, å°é€™æ–¹é¢é‚„æ²’æœ‰æ¶‰ç•¥, å¯åƒè€ƒä¸‹é¢å¤§å¤§æ‰€å¯«çš„Stackoverflowçš„ä»‹ç´¹, æœªä¾†æˆ‘æœƒæƒ³åœ¨é€™é‚Šå˜—è©¦çœ‹çœ‹èƒ½ä¸èƒ½ä¹Ÿè©¦è‘—å›ç­”åˆ¥äººé‡åˆ°çš„å•é¡Œ.</p><p><a href="https://lab.howie.tw/2019/04/learn-from-stackoverflow.html?fbclid=IwAR2VuMNEjP8gvE-IFa69zJZaHNROM8-pj8dgt0-641gcjGwmkCNuBzNal8k" target="_blank" rel="noopener">å·¥ç¨‹å¸«é›éŠæ¥è»Œä¸–ç•Œçš„èƒ½åŠ›å¾stackoverflow é–‹å§‹ - é˜¿è²å¥½å¨çš„å¯¦é©—å®¤</a></p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>ä¸‹ç­å¾Œè¦å†è‡ªä¿®çœŸçš„éœ€è¦æœ‰èˆˆè¶£ä½¿ç„¶ä»¥åŠå¼·å¤§çš„æ¯…åŠ›, å¦å‰‡å¾ˆå®¹æ˜“å°±æœƒåŠé€”è€Œå»¢.</p><p>æ‰€ä»¥æœ€é‡è¦çš„é‚„æ˜¯è¦è®“è‡ªå·±æœ‰å€‹è¦åŠƒ, ä¸¦ä¸”å¾å¯¦è¸è¦åŠƒä¸­å…§åŒ–æˆè‡ªå·±çš„æ—¥å¸¸ç¿’æ…£, ä¹…è€Œä¹…ä¹‹å°±æœƒè®“è‡ªå·±è®Šå¾—æ›´å¼·çš„ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mindset </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Security åŠŸèƒ½ä»‹ç´¹</title>
      <link href="/2020/04/11/Spring-Security%E4%BB%8B%E7%B4%B9/"/>
      <url>/2020/04/11/Spring-Security%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Security-åŠŸèƒ½ä»‹ç´¹"><a href="#Spring-Security-åŠŸèƒ½ä»‹ç´¹" class="headerlink" title="Spring Security åŠŸèƒ½ä»‹ç´¹"></a>Spring Security åŠŸèƒ½ä»‹ç´¹</h1><p>å…ˆä»‹ç´¹ä»¥ä¸‹å¸¸ç”¨èªè­‰åŠŸèƒ½</p><a id="more"></a><h2 id="User-name-password-åŸºæœ¬èªè­‰"><a href="#User-name-password-åŸºæœ¬èªè­‰" class="headerlink" title="User name / password åŸºæœ¬èªè­‰"></a>User name / password åŸºæœ¬èªè­‰</h2><p>ä½¿ç”¨ä½¿ç”¨è€…åç¨±/å¯†ç¢¼åšé©—è­‰</p><h2 id="SSO-Okta-LDAP"><a href="#SSO-Okta-LDAP" class="headerlink" title="SSO / Okta / LDAP"></a>SSO / Okta / LDAP</h2><h3 id="SSO-Single-Sign-On"><a href="#SSO-Single-Sign-On" class="headerlink" title="SSO (Single Sign On)"></a>SSO (Single Sign On)</h3><p>ç‚ºOAuthçš„è¿‘ä¸€æ­¥å¯¦ç¾ï¼Œè‹¥å·²ç¶“é€éGoogleå–å¾—token, å°±å¯ä»¥åœ¨å…¶ä»–æœå‹™çš„å°ç¶²ç«™ï¼Œéƒ½ä½¿ç”¨Googleæä¾›çš„èº«ä»½é©—è­‰æœå‹™</p><h3 id="Okta"><a href="#Okta" class="headerlink" title="Okta"></a>Okta</h3><p>å”åŠ©éç‡Ÿåˆ©çµ„ç¹”çš„æ–¹å¼ã€‚å¾åŸºæœ¬çš„å–®ä¸€ç™»å…¥ï¼ˆsingle sign-onï¼Œç°¡ç¨±ç‚º SSOï¼‰åˆ°é€²éšçš„èº«ä»½èªè­‰å’Œå­˜å–æ¬Šé™çš„ç®¡ç†æ–¹æ¡ˆ</p><h3 id="LDAP-Lightweight-Directory-Access-Protocol"><a href="#LDAP-Lightweight-Directory-Access-Protocol" class="headerlink" title="LDAP (Lightweight Directory Access Protocol)"></a>LDAP (Lightweight Directory Access Protocol)</h3><p>ç‚ºä¸€ç¨®è¼•é‡çš„ç›®éŒ„æœå‹™å”å®šï¼Œåƒæ˜¯é€šè¨ŠéŒ„ä¸€æ¨£ç´€éŒ„äººå“¡è³‡è¨Šï¼Œå¯ä»¥æ‹¿ä¾†åšå¸³è™Ÿæ•´åˆ,é©—è­‰ã€‚</p><p>LDAPç›®éŒ„æœå‹™é€šå¸¸æœ‰å±¤ç´šçµæ§‹ï¼Œåƒæ˜¯å…¬å¸çµ„ç¹”éšå±¤</p><h2 id="OAuth-Intra-App-Authorization"><a href="#OAuth-Intra-App-Authorization" class="headerlink" title="OAuth (Intra App Authorization)"></a>OAuth (Intra App Authorization)</h2><p>OAuthè®“ç”¨æˆ¶å¯ä»¥æˆæ¬Šç¬¬ä¸‰æ–¹ç¶²ç«™å­˜å–ä»–å€‘åœ¨å¦å¤–æœå‹™æä¾›è€…(ex: Facebook, Line)çš„æŸäº›ç‰¹å®šè³‡è¨Šï¼Œè€Œéæ‰€æœ‰å…§å®¹ã€‚</p><h3 id="ç‚ºä»€éº¼æœ‰OAuthå‡ºç¾ï¼Ÿ"><a href="#ç‚ºä»€éº¼æœ‰OAuthå‡ºç¾ï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼æœ‰OAuthå‡ºç¾ï¼Ÿ"></a>ç‚ºä»€éº¼æœ‰OAuthå‡ºç¾ï¼Ÿ</h3><p>å› ç‚ºå„å€‹ç¶²ç«™éƒ½åšæœƒå“¡æ©Ÿåˆ¶å¾ˆéº»ç…©ï¼Œä¸”å°ç¶²ç«™å¯èƒ½æœ‰è³‡å®‰é¢¨éšªã€‚</p><p>æ•…å¤§ç¶²ç«™åƒæ˜¯Facebook, Lineæ—©å·²ç¶“åšå¥½è¶…ç´šå®‰å…¨çš„æœƒå“¡ç®¡ç†æ©Ÿåˆ¶ï¼Œå¤§ç¶²ç«™å¹«ä½ ç®¡ç†å€‹è³‡ï¼Œæä¾›ç™»å…¥çš„æœå‹™ã€‚</p><p>ä½†æä¾›é€™æ¨£æœå‹™çš„å¤§å» è¶Šä¾†è¶Šå¤šï¼Œè‹¥å°ç¶²ç«™åŒæ™‚è¦æä¾›ç”¨æˆ¶é€£çµåˆ°å¤šå€‹æœ‰æä¾›èº«åˆ†æœå‹™çš„å¤§ç¶²ç«™æœƒè®Šå¾—å¾ˆè¤‡é›œï¼Œæ–¼æ˜¯å°±è¨‚å®šçš„å·¥æ¥­æ¨™æº–ï¼šOAuth.</p><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><ul><li>é€²å…¥å°ç¶²ç«™ -&gt;   </li><li>è·³è½‰åˆ°å¤§ç¶²ç«™ç™»å…¥ç•«é¢ -&gt;  </li><li>ç™»å…¥æˆåŠŸå¤§ç¶²ç«™çµ¦äºˆä¸€å€‹æœ‰æ™‚æ•ˆçš„token çµ¦å°ç¶²ç«™ -&gt; </li><li>å°ç¶²ç«™é€étokenè·Ÿå¤§ç¶²ç«™ç´¢å–ç”¨æˆ¶çš„è³‡è¨Š (é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æ¯æ¬¡ç™»å…¥ç¬¬ä¸‰æ–¹éƒ½æœƒè©¢å•ä½ æ˜¯å¦è¦æ­éœ²ä»¥ä¸‹è³‡è¨Šçµ¦å°ç¶²ç«™)</li></ul><p>ä¸éä¸€èˆ¬å°ç¶²ç«™â€ç„¡æ³•â€ç›´æ¥å–å¾—token, è€Œæ˜¯å–å¾—ä¸€å€‹code, å†ç”¨é€™å€‹codeå‘å¤§ç¶²ç«™æ›å¾—ä¸€å€‹token<br>(å¤šé€™é“æ‰‹çºŒçš„åŸå› æ˜¯å› ç‚ºï¼ŒInternetå¯èƒ½æœƒè¢«è·¯ä¸Šç¶“æ‰‹çš„routeræˆ–å…¶ä»–è¨­å‚™æ“·å–,å½é€ ,è®Šæ›´)</p><h3 id="å¯¦éš›æƒ…æ³"><a href="#å¯¦éš›æƒ…æ³" class="headerlink" title="å¯¦éš›æƒ…æ³"></a>å¯¦éš›æƒ…æ³</h3><p>åœ¨ Line Loginæ™‚, Line Notifyä¸­ï¼Œçµ„å‡ºä¸€å€‹URLï¼Œå–å¾—Authorization Code, é€™ä¸€æ®µå–å¾—çš„Codeç‚ºæ˜ç¢¼, èµ°çš„æ˜¯http getï¼Œé€éç€è¦½å™¨ç¶²å€åˆ—ä¾†å‚³é (è‹¥æ²’æœ‰ç”¨SSLå‚³éçš„è©±ï¼Œæœƒè¢«ä»»ä½•äººæ“·å–çœ‹åˆ°). </p><p>æ¥ä¸‹ä¾†å°ç¶²ç«™å–å¾—Authorization Codeå¾Œï¼Œåœ¨é€éhttp postï¼Œå¾å¾Œç«¯è·Ÿå¤§ç¶²ç«™æ›å¾—token (å› ç‚ºèµ°å¾Œç«¯ å¤§ç¶²ç«™å°±çŸ¥é“å°ç¶²ç«™çš„èº«ä»½å’Œæ‰€æ‹¿çš„code)</p><p>:::warning<br>OAuthä¸»è¦åŠŸèƒ½æ˜¯æˆæ¬Šï¼Œä¸æ˜¯èªè­‰ï¼Œæ‰€ä»¥å¾Œä¾†æ‰å»¶ä¼¸å‡ºOpenID Connect (OIDC)ä¾†æä¾›èªè­‰ç”¨ã€‚<br>:::<br>:::info<br>Authentication æª¢æŸ¥ç™¼é€æª¢æŸ¥äººçš„èº«ä»½æ˜¯èª°ã€æ˜¯å¦åˆæ ¼;<br>Authorization å‰‡æ˜¯è¦ç¯„ä½¿ç”¨è€…æ¬Šé™çš„è¦å‰‡ï¼Œè¦å®šå“ªäº›èƒ½åšã€å“ªäº›ä¸èƒ½</p><p>å› æ­¤å¦‚æœè©² Request æœªå¸¶ token æˆ–æ˜¯ token éæœŸã€ä¸åˆæ³•çš†ç®—æ˜¯ Authentication Error ï¼Œè·Ÿ http status code çš„ 401 æ„æ€ä¸€æ¨£ ; </p><p>å¦‚æœ Request çš„ token èªè­‰æˆåŠŸä½†æ˜¯è©²ä½¿ç”¨è€…çš„æ¬Šé™ä¸è¶³ä»¥åŸ·è¡Œè©² Request å‰‡æ˜¯ Forbidden Error (å³ å›  Authorization ç™¼ç”Ÿçš„éŒ¯èª¤) ï¼Œå¦‚ http status code çš„ 403 æ„æ€ç›¸åŒã€‚</p><p>:::</p><p>:::success<br>å–®ç´”ç”¨å¤§ç¶²ç«™çš„OAuthç•¶è‡ªå·±çš„æœƒå“¡ç³»çµ±é‚„æ˜¯æœ‰å¾ˆå¤§çš„å•é¡Œ<br>æœ€æ˜é¡¯çš„æ˜¯ç•¶ä½¿ç”¨è€…åŒæ™‚æœ‰Google èˆ‡ Facebookçš„å¸³è™Ÿæ™‚<br>å…©å€‹å¸³è™Ÿä¸Šé¢çš„Emailå¯èƒ½ä¸æ˜¯ä¸€æ¨£çš„<br>è‡ªå·±çš„ç¶²ç«™å¾ˆå¯èƒ½ç„¡æ³•è¾¨èªé€™æ˜¯åŒä¸€å€‹äººçš„å¸³æˆ¶<br>æ‰€ä»¥ä¸€èˆ¬é‚„æ˜¯æœƒéœ€è¦è‡ªå·±çš„æœƒå“¡ç³»çµ±åšæ•´åˆ<br>:::</p><h3 id="Microservice-security-using-tokens-JWT"><a href="#Microservice-security-using-tokens-JWT" class="headerlink" title="Microservice security (using tokens, JWT)"></a>Microservice security (using tokens, JWT)</h3><p>JWT (JSON web token):</p><ul><li>JWTåŸºæ–¼JSONçš„é–‹æ”¾æ¨™æº– (RFC 7519)</li><li>è¢«ç”¨åœ¨èº«ä»½æä¾›è€…å’Œæœå‹™æä¾›è€…é–“å‚³éï¼Œè¢«èªè­‰çš„ç”¨æˆ¶èº«ä»½è¨Šæ¯</li><li>å¯é¡å¤–å¢åŠ è²æ˜è¨Šæ¯ï¼Œè©²JWT tokenå¯ä»¥ç›´æ¥è¢«ç”¨æ–¼èªè­‰(Authorization)ï¼Œä¹Ÿå¯è¢«åŠ å¯†</li><li>ç‰¹åˆ¥é©ç”¨æ–¼SSO</li></ul><h4 id="JWT-èˆ‡-Sessionå·®åˆ¥ï¼š"><a href="#JWT-èˆ‡-Sessionå·®åˆ¥ï¼š" class="headerlink" title="JWT èˆ‡ Sessionå·®åˆ¥ï¼š"></a>JWT èˆ‡ Sessionå·®åˆ¥ï¼š</h4><h4 id="Session"><a href="#Session" class="headerlink" title="Session:"></a>Session:</h4><p>ç”±æ–¼httpå”è­°ç‚ºstateless,ç„¡æ³•çŸ¥é“æ¯æ¬¡requestæ˜¯èª°ï¼Œä½†æ¯æ¬¡requestè‹¥éƒ½è¦å¸³è™Ÿå¯†ç¢¼å¾ˆéº»ç…©</p><p>æ•…ç”¨æˆ¶ç¬¬ä¸€æ¬¡ç™¼Requestæ™‚ï¼Œå°±ç”¢ç”Ÿä¸€çµ„tokenç´€éŒ„åœ¨dbèˆ‡session, ä¸¦å°‡tokençµ¦ç”¨æˆ¶ï¼Œå‘Šè¨´ç”¨æˆ¶å°‡tokenå­˜åœ¨cookieï¼Œç•¶ä¸‹æ¬¡ç™¼é€requestæ™‚ï¼Œé€étokenè­‰æ˜è‡ªå·±èº«ä»½ã€‚</p><h4 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h4><p>çµ„æˆå…§å®¹æœ‰ä¸‰å€‹éƒ¨åˆ†(Header, Paylaod,Signature)ä¸¦ç”±<code>.</code> åšå€éš”ï¼Œæœ€å¾Œé€éé€™ä¸‰å€‹éƒ¨åˆ†ï¼Œä¸²æˆä¸€å€‹ Jwt å­—ä¸²</p><p>Header: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &apos;typ&apos;: &apos;JWT&apos;, # è²æ˜é¡å‹</span><br><span class="line">  &apos;alg&apos;: &apos;HS256&apos; # åŠ å¯†çš„æ–¹æ³•: HMACã€SHA256ã€RSA é€²è¡Œ Base64 ç·¨ç¢¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Payload: æ”¾è²æ˜å…§å®¹ï¼Œå¯ä»¥èªªå°±æ˜¯å­˜æ”¾æºé€šè¨Šæ¯çš„åœ°æ–¹</p><p>åœ¨å®šç¾©ä¸Šæœ‰ 3 ç¨®è²æ˜ (Claims)</p><ul><li>Reserved (è¨»å†Šè²æ˜)</li><li>Public (å…¬é–‹è²æ˜)</li><li>Private (ç§æœ‰è²æ˜)</li></ul><p>è¨»å†Šè²æ˜åƒæ•¸ (å»ºè­°ä½†ä¸å¼·åˆ¶ä½¿ç”¨)</p><ul><li>iss (Issuer) - jwtç°½ç™¼è€…</li><li>sub (Subject) - jwtæ‰€é¢å‘çš„ç”¨æˆ¶</li><li>aud (Audience) - æ¥æ”¶jwtçš„ä¸€æ–¹</li><li>exp (Expiration Time) - jwtçš„éæœŸæ™‚é–“ï¼Œé€™å€‹éæœŸæ™‚é–“å¿…é ˆè¦å¤§æ–¼ç°½ç™¼æ™‚é–“</li><li>nbf (Not Before) - å®šç¾©åœ¨ä»€éº¼æ™‚é–“ä¹‹å‰ï¼Œè©²jwtéƒ½æ˜¯ä¸å¯ç”¨çš„</li><li>iat (Issued At) - jwtçš„ç°½ç™¼æ™‚é–“</li><li>jti (JWT ID) - jwtçš„å”¯ä¸€èº«ä»½æ¨™è­˜ï¼Œä¸»è¦ç”¨ä¾†ä½œç‚ºä¸€æ¬¡æ€§token,å¾è€Œè¿´é¿é‡æ”¾æ”»æ“Š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;sub&quot;: &quot;1234567890&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;John Doe&quot;,</span><br><span class="line">  &quot;iat&quot;: 1516239022</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Signature: ç”±ä¸‰å€‹éƒ¨åˆ†çµ„æˆ</p><ul><li>header (base64å¾Œçš„)</li><li>payload (base64å¾Œçš„)</li><li>secret </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), &apos;secret&apos;)</span><br></pre></td></tr></table></figure><p>:::warning<br>secret è¦ä¿å­˜åœ¨ server ç«¯ï¼Œjwt çš„ ç°½ç™¼é©—è­‰éƒ½å¿…é ˆä½¿ç”¨é€™å€‹ secretï¼Œç•¶å…¶ä»–äººå¾—çŸ¥é€™å€‹ secretï¼Œé‚£å°±æ„å‘³è‘—å®¢æˆ¶ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç°½ç™¼ jwt ï¼Œå› æ­¤åœ¨ä»»ä½•å ´æ™¯éƒ½ä¸æ‡‰è©²å¤–æµ<br>:::</p><p>æœ€å¾Œå°‡ Header, Payload, Signatureåšbase64ç·¨ç¢¼ï¼Œçµ„æˆ</p><p>ä½¿ç”¨çš„æ™‚å€™ï¼Œåœ¨reqeustçš„headeråŠ ä¸Š <code>Authorization: Bearer &lt;token&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post(&apos;api/user/1&apos;, &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Authorization&apos;: &apos;Bearer &apos; + token</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="JWT-å‰å¾Œç«¯äº’å‹•ç¤ºæ„åœ–"><a href="#JWT-å‰å¾Œç«¯äº’å‹•ç¤ºæ„åœ–" class="headerlink" title="JWT å‰å¾Œç«¯äº’å‹•ç¤ºæ„åœ–"></a>JWT å‰å¾Œç«¯äº’å‹•ç¤ºæ„åœ–</h3><p><img src="https://i.imgur.com/wGqdCkr.png" alt=""></p><h3 id="JWTå„ªé»"><a href="#JWTå„ªé»" class="headerlink" title="JWTå„ªé»"></a>JWTå„ªé»</h3><ul><li>è·¨èªè¨€ï¼Œå› ç‚º json æ ¼å¼å¤§éƒ¨åˆ†èªè¨€éƒ½å¯ä½¿ç”¨</li><li>å¯å„²å­˜ä¸€äº›ç°¡å–®ä½†éæ•æ„Ÿçš„å•†æ¥­é‚è¼¯ - role ..</li><li>æ§‹æˆå…§å®¹ç°¡å–®ï¼Œä½”ç”¨ Size å°æ–¹ä¾¿å‚³è¼¸</li><li>!!! ä¸éœ€åœ¨ server ä¿å­˜ sessionï¼Œæ‰€ä»¥å®ƒæ˜“æ–¼æ‡‰ç”¨çš„æ“´å±•</li></ul><h2 id="Spring-Security-æ•™å­¸è¦–é »"><a href="#Spring-Security-æ•™å­¸è¦–é »" class="headerlink" title="Spring Security æ•™å­¸è¦–é »"></a>Spring Security æ•™å­¸è¦–é »</h2><p>Spring Boot + Spring Security + JWT from scratch - Java Brains<br><a href="https://www.youtube.com/watch?v=X80nJ5T7YpE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=X80nJ5T7YpE</a></p><h2 id="åƒè€ƒè³‡æºï¼š"><a href="#åƒè€ƒè³‡æºï¼š" class="headerlink" title="åƒè€ƒè³‡æºï¼š"></a>åƒè€ƒè³‡æºï¼š</h2><p>Okta å¦‚ä½•å”åŠ©éç‡Ÿåˆ©çµ„ç¹”-å¾ 25 å€‹å…è²»çš„æˆæ¬Šé–‹å§‹<br><a href="https://www.techsoup-taiwan.org.tw/okta" target="_blank" rel="noopener">https://www.techsoup-taiwan.org.tw/okta</a></p><p>LDAP ç°¡ä»‹<br><a href="https://poychang.github.io/ldap-introduction/" target="_blank" rel="noopener">https://poychang.github.io/ldap-introduction/</a></p><p>ä¸€æ¬¡ææ‡‚OAuthèˆ‡SSOåœ¨å¹¹ä»€éº¼?<br><a href="http://studyhost.blogspot.com/2017/01/oauthsso.html" target="_blank" rel="noopener">http://studyhost.blogspot.com/2017/01/oauthsso.html</a></p><p>GraphQL è¨­è¨ˆï¼š Autentication èˆ‡ Authorization å¤§å…¨<br><a href="https://ithelp.ithome.com.tw/articles/10208278" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10208278</a></p><p>JSON Web Token(JWT) ç°¡å–®ä»‹ç´¹<br><a href="https://mgleon08.github.io/blog/2018/07/16/jwt/" target="_blank" rel="noopener">https://mgleon08.github.io/blog/2018/07/16/jwt/</a></p><p>What is Spring Security really all about? Java Brains Brain Bytes</p><p><a href="https://www.youtube.com/watch?v=sm-8qfMWEV8&amp;list=PLqq-6Pq4lTTYTEooakHchTGglSvkZAjnE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=sm-8qfMWEV8&amp;list=PLqq-6Pq4lTTYTEooakHchTGglSvkZAjnE</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> Authentication </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Annotationç­†è¨˜æ•´ç†</title>
      <link href="/2020/03/10/Spring-Annotation%E4%BB%8B%E7%B4%B9/"/>
      <url>/2020/03/10/Spring-Annotation%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Annotation-ç­†è¨˜"><a href="#Spring-Annotation-ç­†è¨˜" class="headerlink" title="Spring Annotation ç­†è¨˜"></a>Spring Annotation ç­†è¨˜</h1><p>é€™é‚Šä¸»è¦æ•´ç†äº†æˆ‘ä½¿ç”¨æˆ–æ˜¯é‡åˆ°çš„Spring Annotationè³‡æ–™æŸ¥è©¢èˆ‡çµ±æ•´çš„ç´€éŒ„</p><a id="more"></a><h2 id="API-ç›¸é—œ-Annotation"><a href="#API-ç›¸é—œ-Annotation" class="headerlink" title="API ç›¸é—œ @Annotation"></a>API ç›¸é—œ @Annotation</h2><h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>å°‡classè¨­ç½®ç‚ºå¤–éƒ¨æ§åˆ¶å™¨</p><h4 id="RestControllerAdvice"><a href="#RestControllerAdvice" class="headerlink" title="@RestControllerAdvice"></a>@RestControllerAdvice</h4><p>ç­‰åŒæ–¼@ControllerAdvice + @ResponseBody</p><p>@ControllerAdviceç‚ºå¯åœ¨å®£å‘Šçš„å‡½å¼ä¸­ä½¿ç”¨@ExceptionHandler, @InitBinderæˆ– @ModelAttributeè¨»è§£çš„æ–¹æ³•</p><h5 id="ExceptionHandler"><a href="#ExceptionHandler" class="headerlink" title="@ExceptionHandler"></a>@ExceptionHandler</h5><p>æ””æˆªæ‰€æœ‰æ§åˆ¶å™¨æ‰€ç™¼å‡ºçš„exceptionï¼Œä¸¦è¿”å›bodyå‹å¼</p><h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>æ§åˆ¶å™¨è£¡é¢çš„æ–¹æ³•ï¼Œä½¿ä¹‹æˆç‚ºå¤–éƒ¨è«‹æ±‚</p><p>è‹¥è¦è¨­ç½®GET method, å¦‚ä¸‹<br>(ä¹Ÿå¯ä»¥æ”¹æˆ POST, PUT, DELETE)</p><p>å®šç¾©ä¸€çµ„restful apiå‰ç¶´è·¯ç”±<br>ex : @RequestMapping(â€œ/api/v1â€)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequstMapping</span>(<span class="string">"/api/v1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hello</span> </span>&#123;</span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"helloworld"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ä½¿ç”¨çš„è©±å¾—åœ¨postmanä¸­ç”¨ã€€<code>/api/v1/hello</code>ã€€</p><h3 id="HTTPå‹•ä½œAnnotation"><a href="#HTTPå‹•ä½œAnnotation" class="headerlink" title="HTTPå‹•ä½œAnnotation"></a>HTTPå‹•ä½œAnnotation</h3><h4 id="PostMapping"><a href="#PostMapping" class="headerlink" title="@PostMapping"></a>@PostMapping</h4><h4 id="GetMapping"><a href="#GetMapping" class="headerlink" title="@GetMapping"></a>@GetMapping</h4><h4 id="PutMapping"><a href="#PutMapping" class="headerlink" title="@PutMapping"></a>@PutMapping</h4><h4 id="DeleteMapping"><a href="#DeleteMapping" class="headerlink" title="@DeleteMapping"></a>@DeleteMapping</h4><h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p>å¯ä»¥æ¥æ”¶Bodyåƒæ•¸ï¼Œå¾—é€éclasså®£å‘Šä¸€çµ„objectä¾†æ¥æ”¶ã€€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> Integer number;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">setNumber</span><span class="params">(Integer number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> getType...</span><br><span class="line">    <span class="keyword">public</span> getNumber...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/v1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarController</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€éå®£å‘Šä¸€å€‹carï¼Œä¾†æ¥æ”¶Bodyçš„å€¼ (type, number)</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/car"</span>)</span><br><span class="line">    <span class="function">function <span class="title">getCar</span><span class="params">(@RequestBody Car car)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RequestHeaderã€-CookieValue"><a href="#RequestHeaderã€-CookieValue" class="headerlink" title="@RequestHeaderã€@CookieValue"></a>@RequestHeaderã€@CookieValue</h3><p>è™•ç†request headeréƒ¨åˆ†çš„æ³¨è§£ï¼š</p><p>Request Headerçš„å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host                    localhost:8080  </span><br><span class="line">Accept                  text/html,application/xhtml+xml,application/xml;q=0.9  </span><br><span class="line">Accept-Language         fr,en-gb;q=0.7,en;q=0.3  </span><br><span class="line">Accept-Encoding         gzip,deflate  </span><br><span class="line">Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7  </span><br><span class="line">Keep-Alive              300</span><br></pre></td></tr></table></figure></p><p>é€é @RequestHeader(â€œâ€)æ¥å—å…¶Headerå€¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/displayHeaderInfo.do&quot;)  </span><br><span class="line">public void displayHeaderInfo(@RequestHeader(&quot;Accept-Encoding&quot;) String encoding,  </span><br><span class="line">                              @RequestHeader(&quot;Keep-Alive&quot;) long keepAlive)  &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h3><p>è©²è¨»è§£ç”¨ä¾†ç¶å®šHttpSessionä¸­çš„attributeå°è±¡çš„å€¼ï¼Œä¾¿æ–¼åœ¨æ–¹æ³•ä¸­çš„åƒæ•¸é‡Œä½¿ç”¨ã€‚</p><p>è©²è¨»è§£æœ‰valueã€typeså…©å€‹å±¬æ€§ï¼Œå¯ä»¥é€šéåå­—å’Œé¡å‹æŒ‡å®šè¦ä½¿ç”¨çš„attribute å°è±¡ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>  </span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/editPet.do"</span>)  </span><br><span class="line"><span class="meta">@SessionAttributes</span>(<span class="string">"pet"</span>)  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EditPetForm</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// ...   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒè€ƒè³‡æ–™:<br>Spring MVCå¸¸ç”¨æ³¨è§£@PathVariableã€@RequestHeaderã€@CookieValueã€@RequestParamã€@RequestBodyã€@SessionAttributesã€@ModelAttribute</p><p><a href="https://www.cnblogs.com/EasonJim/p/8323017.html" target="_blank" rel="noopener">https://www.cnblogs.com/EasonJim/p/8323017.html</a></p><h3 id="JsonProperty-é‡é»ï¼Œé‡åˆ°æ¥ä¸åˆ°requestçš„å€¼ï¼Œç”¨é€™å°±å°äº†"><a href="#JsonProperty-é‡é»ï¼Œé‡åˆ°æ¥ä¸åˆ°requestçš„å€¼ï¼Œç”¨é€™å°±å°äº†" class="headerlink" title="@JsonProperty (é‡é»ï¼Œé‡åˆ°æ¥ä¸åˆ°requestçš„å€¼ï¼Œç”¨é€™å°±å°äº†)"></a>@JsonProperty (é‡é»ï¼Œé‡åˆ°æ¥ä¸åˆ°requestçš„å€¼ï¼Œç”¨é€™å°±å°äº†)</h3><p>ç”¨ä¾†æ¥æ”¶application/jsonä¸­ï¼Œæœ‰å¤§å°ä¸ä¸€å‹åˆ¥çš„è®Šæ•¸</p><p>ex: Postman script<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"contact"</span>:&#123;</span><br><span class="line">        <span class="attr">"cPhone"</span>:<span class="string">"0912345678"</span>, </span><br><span class="line">        <span class="attr">"cMail"</span>:<span class="string">" abc@test.com.tw "</span>, </span><br><span class="line">        <span class="attr">"cAddress"</span>:<span class="string">"å°åŒ—å¸‚ä¸­æ­£å€ä¿¡ç¾©è·¯ä¸€æ®µ21-3è™Ÿ"</span></span><br><span class="line">    &#125;,...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‹¥è¦æ¥åˆ° PHONEæˆ–Websiteï¼Œéœ€è¦å®šç¾© @JsonProperty(â€œPHONEâ€), @JsonProperty(â€œWebsiteâ€)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lia201iReqDTO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    contactDto contact;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">contactDto</span> </span>&#123;</span><br><span class="line">        <span class="meta">@NotNull</span></span><br><span class="line">        <span class="meta">@JsonProperty</span>(<span class="string">"cPhone"</span>)</span><br><span class="line">        String cPhone;</span><br><span class="line">        <span class="meta">@JsonProperty</span>(<span class="string">"cMail"</span>)</span><br><span class="line">        String cMail;</span><br><span class="line">        <span class="meta">@JsonProperty</span>(<span class="string">"cAddress"</span>)</span><br><span class="line">        String cAddress;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h4><p>Spring REST consuming JSON uppercase vs lowercase<br><a href="https://stackoverflow.com/questions/26890398/spring-rest-consuming-json-uppercase-vs-lowercase" target="_blank" rel="noopener">https://stackoverflow.com/questions/26890398/spring-rest-consuming-json-uppercase-vs-lowercase</a></p><h2 id="é©—è­‰ç›¸é—œçš„Annotation"><a href="#é©—è­‰ç›¸é—œçš„Annotation" class="headerlink" title="é©—è­‰ç›¸é—œçš„Annotation"></a>é©—è­‰ç›¸é—œçš„Annotation</h2><h3 id="Validèˆ‡-Validated"><a href="#Validèˆ‡-Validated" class="headerlink" title="@Validèˆ‡@Validated"></a>@Validèˆ‡@Validated</h3><p>è² è²¬é©—è­‰æœ‰è¢«å®šç¾©æ ¡æ­£çš„åƒæ•¸æˆ–object</p><p>å…ˆç”¢ç”Ÿè¦æ ¡æ­£çš„å¯¦é«”é¡(class)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;    </span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min</span>(<span class="number">18</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern</span>(regexp = <span class="string">"^1(3|4|5|7|8)\\d&#123;9&#125;$"</span>,message = <span class="string">"æ‰‹æœºå·ç æ ¼å¼é”™è¯¯"</span>)</span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email</span>(message = <span class="string">"é‚®ç®±æ ¼å¼é”™è¯¯"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//... getter setter</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–¼@Controllerä¸­ã€€ä½¿ç”¨Validåšæ ¡æ­£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class FooController &#123;</span><br><span class="line"></span><br><span class="line">    // å°Foo classç”¢ç”Ÿçš„fooåšæ ¡æ­£</span><br><span class="line">    @RequestMapping(&quot;/foo&quot;)</span><br><span class="line">    public String foo(@Validated Foo foo &lt;1&gt;, BindingResult bindingResult &lt;2&gt;) &#123;</span><br><span class="line">        if(bindingResult.hasErrors())&#123;</span><br><span class="line">            for (FieldError fieldError : bindingResult.getFieldErrors()) &#123;</span><br><span class="line">                //...</span><br><span class="line">            &#125;</span><br><span class="line">            return &quot;fail&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Validate-èˆ‡-Validå·®ç•°"><a href="#Validate-èˆ‡-Validå·®ç•°" class="headerlink" title="@Validate èˆ‡ @Validå·®ç•°"></a>@Validate èˆ‡ @Validå·®ç•°</h4><p>@Validèƒ½é€²è¡ŒåµŒå¥—é©—è­‰ï¼Œ @Validateä¸è¡Œ</p><p>å› ç‚º@Validèƒ½åŠ åœ¨æˆå“¡å±¬æ€§ä¸Šï¼Œåè€Œ@Validatedä¸èƒ½ç”¨åœ¨æˆå“¡å±¬æ€§ã€‚</p><p>èˆ‰ä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"idä¸èƒ½ç‚ºç©ºå€¼"</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">1</span>, message = <span class="string">"idå¿…é ˆç‚ºæ­£æ•´æ•¸"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"propsä¸èƒ½ç‚ºç©ºç›´"</span>)</span><br><span class="line">    <span class="meta">@Size</span>(min = <span class="number">1</span>, message = <span class="string">"è‡³å°‘è¦æœ‰ä¸€å€‹å±¬æ€§"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;Prop&gt; props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶è€Œ Prop classå¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Prop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"pidä¸èƒ½ç‚ºç©º"</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">1</span>, message = <span class="string">"pidå¿…é ˆç‚ºæ­£æ•´æ•¸"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long pid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"vidä¸èƒ½ç‚ºç©º"</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">1</span>, message = <span class="string">"vidå¿…é ˆç‚ºæ­£æ•´æ•¸"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long vid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"pidNameä¸èƒ½ç‚ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> String pidName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"vidNameä¸èƒ½ç‚ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> String vidName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¾åœ¨æˆ‘å€‘æœ‰å€‹ItemControlleræ¥å—ä¸€å€‹Itemçš„åƒæ•¸ï¼Œæƒ³è¦å°Itemé€²è¡Œé©—è­‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/item/add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(@Validated Item item, BindingResult bindingResult)</span> </span>&#123;</span><br><span class="line">        doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šåœ–ä¸­ï¼Œå¦‚æœItemå¯¦é«”çš„propså±¬æ€§ä¸é¡å¤–åŠ è¨»é‡‹ï¼Œåªæœ‰@NotNullå’Œ@Sizeï¼Œç„¡è«–å…¥åƒæ¡ç”¨@Validatedé‚„æ˜¯@Validé©—è­‰ï¼ŒSpring Validationæ¡†æ¶åªæœƒå°Itemçš„idå’Œpropsåšéç©ºå’Œæ•¸é‡é©—è­‰ï¼Œä¸æœƒå°propså­—æ®µè£¡çš„Propå¯¦é«”é€²è¡Œå­—æ®µé©—è­‰ï¼Œä¹Ÿå°±æ˜¯@Validatedå’Œ@ValidåŠ åœ¨æ–¹æ³•åƒæ•¸å‰ï¼Œ<span style="color:red">éƒ½ä¸æœƒè‡ªå‹•å°åƒæ•¸é€²è¡ŒåµŒå¥—é©—è­‰&lt;/ span&gt;</span></p><p>:::info<br>é€™é‚ŠæŒ‡çš„åµŒå¥—(Nested)é©—è­‰ï¼ŒæŒ‡çš„æ˜¯è‹¥class Itemä¸­é‚„æœ‰ä¸€å€‹è®Šæ•¸List<props> ä¸”é€™å€‹Propsçš„classå…§ä¹Ÿæœ‰è‡ªå·±å®šç¾©é©—è­‰@Notnull, @NotBlank, ä¸€å±¤classå…§é‚„æœ‰ä¸€å€‹classå®šç¾©è‡ªå·±çš„é©—è­‰ï¼Œå°±å«åšåµŒå¥—é©—è­‰<br>:::</props></p><p>è¦é€²è¡ŒåµŒå¥—é©—è­‰çš„è©±å¾—åœ¨ class Propsä¸­åŠ å…¥@Valid </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"idä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">1</span>, message = <span class="string">"idå¿…é¡»ä¸ºæ­£æ•´æ•°"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Valid</span> <span class="comment">// åµŒå¥—éªŒè¯å¿…é¡»ç”¨@Valid</span></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"propsä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="meta">@Size</span>(min = <span class="number">1</span>, message = <span class="string">"propsè‡³å°‘è¦æœ‰ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;Prop&gt; props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è£œå……-è² è²¬æ ¡é©—çš„Annotation"><a href="#è£œå……-è² è²¬æ ¡é©—çš„Annotation" class="headerlink" title="è£œå…… è² è²¬æ ¡é©—çš„Annotation"></a>è£œå…… è² è²¬æ ¡é©—çš„Annotation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Null è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º null</span><br><span class="line">@NotNull è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆä¸ç‚º null</span><br><span class="line">@AssertTrue è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º true</span><br><span class="line">@AssertFalse è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º false</span><br><span class="line">@Min(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å°å€¼</span><br><span class="line">@Max(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå°æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å¤§å€¼</span><br><span class="line">@DecimalMin(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å°å€¼</span><br><span class="line">@DecimalMax(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå°æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å¤§å€¼</span><br><span class="line">@Size(max=, min=) è¢«è¨»é‡‹çš„å…ƒç´ çš„å¤§å°å¿…é ˆåœ¨æŒ‡å®šçš„ç¯„åœå…§</span><br><span class="line">@Digits (integer, fraction) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆåœ¨å¯æ¥å—çš„ç¯„åœå…§</span><br><span class="line">@Past è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹éå»çš„æ—¥æœŸ</span><br><span class="line">@Future è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹å°‡ä¾†çš„æ—¥æœŸ</span><br><span class="line">@Pattern(regex=,flag=) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç¬¦åˆæŒ‡å®šçš„æ­£å‰‡è¡¨é”å¼</span><br><span class="line"></span><br><span class="line">@NotBlank(message =) é©—è­‰å­—ç¬¦ä¸²énullï¼Œä¸”é•·åº¦å¿…é ˆå¤§æ–¼0</span><br><span class="line">@Email è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯é›»å­éƒµç®±åœ°å€</span><br><span class="line">@Length(min=,max=) è¢«è¨»é‡‹çš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é ˆåœ¨æŒ‡å®šçš„ç¯„åœå…§</span><br><span class="line">@NotEmpty è¢«è¨»é‡‹çš„å­—ç¬¦ä¸²çš„å¿…é ˆéç©º</span><br><span class="line">@Range(min=,max=,message=) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆåœ¨åˆé©çš„ç¯„åœå…§</span><br></pre></td></tr></table></figure><h4 id="è£œå……-ç”¨BindingResultæ¥æ”¶-Validæ‹‹å‡ºä¾†çš„éŒ¯èª¤è¨Šæ¯"><a href="#è£œå……-ç”¨BindingResultæ¥æ”¶-Validæ‹‹å‡ºä¾†çš„éŒ¯èª¤è¨Šæ¯" class="headerlink" title="è£œå……: ç”¨BindingResultæ¥æ”¶@Validæ‹‹å‡ºä¾†çš„éŒ¯èª¤è¨Šæ¯"></a>è£œå……: ç”¨<code>BindingResult</code>æ¥æ”¶@Validæ‹‹å‡ºä¾†çš„éŒ¯èª¤è¨Šæ¯</h4><p>å‡è¨­æœ‰é©—è­‰éŒ¯èª¤çš„ç‰©ä»¶ç‚º BindingResult bindingResult<br>å¯é€ébindResultå–å¾—éŒ¯èª¤è³‡è¨Š</p><p>èˆ‰ä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class FlightDTO &#123;</span><br><span class="line">    @NotBlank</span><br><span class="line">    private String terminal; // èˆªå»ˆ</span><br><span class="line">    @NotBlank</span><br><span class="line">    private String type; // èˆªç­ç¨®é¡</span><br><span class="line">    @NotBlank</span><br><span class="line">    private String carrier; // èˆªç©ºå…¬å¸ä»£ç¢¼</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‹¥ä½¿ç”¨@Validå°FlightDTOåšåƒæ•¸é©—è­‰ï¼Œå‡è¨­æœ‰ä¸€Requestå°‘è¼¸å…¥terminalè³‡è¨Šï¼Œå°±æœƒç™¼å‡ºbindingResultè¨Šæ¯ï¼Œå…¶ä¸­åŒ…å«ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FieldError&gt; fieldErrors = bindingResult.getFieldErrors();</span><br><span class="line"><span class="keyword">for</span>(FieldError fieldError: fieldErrors) &#123;</span><br><span class="line">    <span class="comment">//ã€€å°è£éŒ¯èª¤æ ¼å¼</span></span><br><span class="line">    FieldResource fieldResource = <span class="keyword">new</span> FieldResource(</span><br><span class="line">        fieldError.getObjectName(), <span class="comment">// å–å¾—ç‰©ä»¶åç¨±ï¼šç‚ºFlightDTO</span></span><br><span class="line">        fieldError.getField(), <span class="comment">// ç‚ºproperties(terminal)</span></span><br><span class="line">        fieldError.getCode(), <span class="comment">// ç‚º@Notblank</span></span><br><span class="line">        fieldError.getDefaultMessage() <span class="comment">// ç‚º@Notblankçš„éŒ¯èª¤è³‡è¨Š</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>:::info<br>BindingResultç‚ºErrorçš„å­ä»‹é¢</p><p>BindingResult<br><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/BindingResult.html" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/BindingResult.html</a><br>Error:<br><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Errors.html" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Errors.html</a><br>:::</p><h4 id="åƒè€ƒè³‡æ–™ï¼š"><a href="#åƒè€ƒè³‡æ–™ï¼š" class="headerlink" title="åƒè€ƒè³‡æ–™ï¼š"></a>åƒè€ƒè³‡æ–™ï¼š</h4><p>ä½¿ç”¨spring validationå®Œæˆæ•°æ®åç«¯æ ¡éªŒ<br><a href="https://www.cnkirito.moe/spring-validation/" target="_blank" rel="noopener">https://www.cnkirito.moe/spring-validation/</a></p><p>@Validatedå’Œ@ValidåŒºåˆ«ï¼šSpring validationéªŒè¯æ¡†æ¶å¯¹å…¥å‚å®ä½“è¿›è¡ŒåµŒå¥—éªŒè¯å¿…é¡»åœ¨ç›¸åº”å±æ€§ï¼ˆå­—æ®µï¼‰åŠ ä¸Š@Validè€Œä¸æ˜¯@Validated<br><a href="https://blog.csdn.net/qq_27680317/article/details/79970590" target="_blank" rel="noopener">https://blog.csdn.net/qq_27680317/article/details/79970590</a></p><h2 id="æ“ä½œæ•¸æ“šåº«ç›¸é—œæ•¸æ“šç›¸é—œçš„Annotation"><a href="#æ“ä½œæ•¸æ“šåº«ç›¸é—œæ•¸æ“šç›¸é—œçš„Annotation" class="headerlink" title="æ“ä½œæ•¸æ“šåº«ç›¸é—œæ•¸æ“šç›¸é—œçš„Annotation"></a>æ“ä½œæ•¸æ“šåº«ç›¸é—œæ•¸æ“šç›¸é—œçš„Annotation</h2><h3 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h3><p>è¡¨ç¤ºæ˜¯ä¸€å€‹å°æ‡‰åˆ°DB Tableçš„ç‰©ä»¶</p><h3 id="Id"><a href="#Id" class="headerlink" title="@Id"></a>@Id</h3><p>è²æ˜è©²æ¬„ä½ç‚ºä¸»éµ</p><h3 id="GeneratedValue"><a href="#GeneratedValue" class="headerlink" title="@GeneratedValue"></a>@GeneratedValue</h3><p>æŒ‡å®šIDç”Ÿæˆçš„ç­–ç•¥ï¼Œè‹¥æ²’æœ‰è¨­ç½®çš„åŒ–, Hibernateå°æ‡‰çš„æ˜¯ç‚ºä¸€å€‹Not nullçš„ç‰©ä»¶ï¼Œå¾—è‡ªè¡Œè¨­å®šidåˆ°ç‰©ä»¶å…§ã€‚<br>ä½†é€šå¸¸æœƒè‡ªè¡Œåœ¨æ–°å¢è³‡æ–™æ™‚ç”¢ç”ŸID, æ•…@Idèˆ‡@GeneratedValueæœƒå¸¸å¸¸åŒæ™‚å‡ºç¾</p><p>å› ç‚ºHibernateæœƒé‡è¦‹ä¸åŒçš„Databaseï¼Œæ‰€ä»¥æœ‰å„ç¨®ä¸åŒçš„ç”Ÿæˆç­–ç•¥:</p><h4 id="GenerationType-Auto"><a href="#GenerationType-Auto" class="headerlink" title="GenerationType.Auto"></a>GenerationType.Auto</h4><p>Hibernateæœƒæ ¹æ“šæ¡ç”¨çš„Databaseç‚ºä½•ï¼Œä¾†æ±ºå®šè¦ç”¨ GenerationType.Identity æˆ– GenerationType.SEQUENCEã€‚<br>(å¤§éƒ¨åˆ†çš„æƒ…æ³éƒ½æœƒæ¡ç”¨ GenerationType.SEQUENCE)</p><h4 id="GenerationType-IDENTITY"><a href="#GenerationType-IDENTITY" class="headerlink" title="GenerationType.IDENTITY"></a>GenerationType.IDENTITY</h4><p>é€éauto-incremented database columnä¾†ç”¢ç”Ÿprimary key.<br>å¸¸è¦‹çš„MySQLå’ŒMMSQLéƒ½æ¡ç”¨è©²æ–¹å¼ï¼Œç›¸å°æ‡‰çš„DDLèªè¨€ç‚ºä»¥ä¸‹æ‰€ç¤º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id BIGINT NOT NULL AUTO_INCREMENT</span><br></pre></td></tr></table></figure></p><h4 id="GenerationType-SEQUENCE"><a href="#GenerationType-SEQUENCE" class="headerlink" title="GenerationType.SEQUENCE"></a>GenerationType.SEQUENCE</h4><p>è¨­å®šè©²ç­–ç•¥ï¼Œé€šå¸¸ä¹Ÿæœƒçµ¦å…¥å¦ä¸€å€‹Annotation <code>@SequenceGenerator</code>ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.SEQUENCE, generator = <span class="string">"author_generator"</span>)</span><br><span class="line"><span class="meta">@SequenceGenerator</span>(name=<span class="string">"author_generator"</span>, sequenceName = <span class="string">"author_seq"</span>, allocationSize=<span class="number">50</span>)</span><br><span class="line"><span class="meta">@Column</span>(name = <span class="string">"id"</span>, updatable = <span class="keyword">false</span>, nullable = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">private</span> Long id</span><br></pre></td></tr></table></figure><p>è‹¥æ²’æœ‰æŒ‡å®šï¼ŒHibernateæœƒä½¿ç”¨é è¨­çš„SequenceGenerator</p><p>å¯ä»¥çœ‹åˆ°è‹¥æŒ‡å®š sequenceGeneratorçš„nameç‚ºauthor_seq, Hibernateå°±æœƒåœ¨ <code>author_seq</code>é€™å€‹tableæŸ¥æ‰¾ä¸‹ä¸€å€‹idå€¼ç‚ºå¤šå°‘</p><p><img src="https://i.imgur.com/Uw8ebCO.jpg" alt=""></p><p>æ³¨æ„ï¼Œåœ¨Postgresæƒ…æ³ä¸‹ä¸é©åˆç”¨è©²æ–¹æ³•<br><a href="https://stackoverflow.com/questions/4288740/hibernate-use-of-postgresql-sequence-does-not-affect-sequence-table/4502062#4502062" target="_blank" rel="noopener">https://stackoverflow.com/questions/4288740/hibernate-use-of-postgresql-sequence-does-not-affect-sequence-table/4502062#4502062</a></p><h4 id="GenerationType-SEQUENCE-1"><a href="#GenerationType-SEQUENCE-1" class="headerlink" title="GenerationType.SEQUENCE"></a>GenerationType.SEQUENCE</h4><p>ç•¶ä¸å¸Œæœ›æ‡‰ç”¨ç¨‹å¼èˆ‡æŸä¸€ç¨® Database Engine ç¶æ­»çš„æ™‚å€™ï¼Œå¯ä»¥ä½¿ç”¨é€™ç¨®æ–¹æ³•ï¼Œé€éå¦å¤–ä¸€å€‹è¡¨æ ¼ä¾†å®šç¾© ID</p><p>æœƒé€éSQLï¼Œå»ºç«‹å­˜æ”¾å„ç¨®columnçš„seqeunce<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE APP_SEQ_STORE ( APP_SEQ_NAME VARCHAR(255) NOT NULL, APP_SEQ_VALUE BIGINT NOT NULL, PRIMARY KEY(APP_SEQ_NAME) );</span><br></pre></td></tr></table></figure></p><h5 id="Reference-https-thoughts-on-java-org-jpa-generate-primary-keys"><a href="#Reference-https-thoughts-on-java-org-jpa-generate-primary-keys" class="headerlink" title="Reference: https://thoughts-on-java.org/jpa-generate-primary-keys/"></a>Reference: <a href="https://thoughts-on-java.org/jpa-generate-primary-keys/" target="_blank" rel="noopener">https://thoughts-on-java.org/jpa-generate-primary-keys/</a></h5><h4 id="IdClass-å¤åˆä¸»é”®"><a href="#IdClass-å¤åˆä¸»é”®" class="headerlink" title="@IdClass å¤åˆä¸»é”®"></a>@IdClass å¤åˆä¸»é”®</h4><p>å¤åˆä¸»é”®ç”±å¤šä¸ªä¸»é”®å­—æ®µç»„æˆã€‚æ¯ä¸ªä¸»é”®å­—æ®µå¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ”¯æŒç±»å‹ä¹‹ä¸€ã€‚<br>ä¾‹å¦‚ï¼Œä»¥ä¸‹é¡¹ç›®å®ä½“ç±»çš„ä¸»é”®ç”±ä¸¤ä¸ªå­—æ®µç»„æˆ:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span> <span class="meta">@IdClass</span>(ProjectId.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Project</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="keyword">int</span> departmentId;</span><br><span class="line">    <span class="meta">@Id</span> <span class="keyword">long</span> projectId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨ProjectId.classä¸­è²æ˜å…©å€‹ä¸»éµå€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class ProjectId &#123;</span><br><span class="line">    <span class="keyword">int</span> departmentId;</span><br><span class="line">    <span class="keyword">long</span> projectId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Embeddable"><a href="#Embeddable" class="headerlink" title="@Embeddable"></a>@Embeddable</h4><p>åµŒå…¥å¼ä¸»é”®<br>è¡¨ç¤ºå¤åˆä¸»é”®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å¯åµŒå…¥çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Project</span> </span>&#123;</span><br><span class="line">    <span class="meta">@EmbeddedId</span> ProjectId id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line">Class ProjectId &#123;</span><br><span class="line">    <span class="keyword">int</span> departmentId;</span><br><span class="line">    <span class="keyword">long</span> projectId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h3><p>å®£å‘Šè©²è®Šæ•¸èˆ‡è³‡æ–™åº«æ¬„ä½çš„å°æ˜ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column</span>(nam=â€category_nameâ€ length=<span class="number">20</span>)</span><br><span class="line"><span class="function">Public <span class="keyword">void</span> <span class="title">getCategoryName</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Return <span class="keyword">this</span>.categoryName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åƒè€ƒè³‡æ–™-1"><a href="#åƒè€ƒè³‡æ–™-1" class="headerlink" title="åƒè€ƒè³‡æ–™:"></a>åƒè€ƒè³‡æ–™:</h4><p>SPRINGä¸­å¸¸ç”¨çš„æ³¨è§£ï¼ˆ@ENTITYï¼Œ@TABLEï¼Œ@COLUMNï¼Œ@REPOSITORYï¼Œ@SERVICEï¼‰<a href="https://www.cnblogs.com/hoojjack/p/6568920.html" target="_blank" rel="noopener">https://www.cnblogs.com/hoojjack/p/6568920.html</a></p><p>JPA ä¸»é”®@Idã€@IdClassã€@Embeddableã€@EmbeddedId<br><a href="https://blog.csdn.net/tracycater/article/details/78319021" target="_blank" rel="noopener">https://blog.csdn.net/tracycater/article/details/78319021</a></p><h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><p>@Data è‡ªå‹•ç”¢ç”Ÿ getter(), setter(), toString(), ç¯€çœä¸€å¤§å †ä»£ç¢¼çš„ç¥Annotation</p><h4 id="å‰ç½®ä½œæ¥­ï¼š-å¼•å…¥lombok"><a href="#å‰ç½®ä½œæ¥­ï¼š-å¼•å…¥lombok" class="headerlink" title="å‰ç½®ä½œæ¥­ï¼š å¼•å…¥lombok"></a>å‰ç½®ä½œæ¥­ï¼š å¼•å…¥lombok</h4><p>è¦ä½¿ç”¨ @Data æ³¨è§£è¦å…ˆå¼•å…¥lombok</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lombokç‚ºä¸€å€‹Libraryï¼Œå¯ä»¥ç”¨ç°¡å–®çš„è¨»è§£å½¢å¼ä¾†ç°¡åŒ–ä»£ç¢¼ï¼Œæé«˜é–‹ç™¼æ•ˆç‡ã€‚</span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•ä½¿ç”¨lobok"><a href="#å¦‚ä½•ä½¿ç”¨lobok" class="headerlink" title="å¦‚ä½•ä½¿ç”¨lobok"></a>å¦‚ä½•ä½¿ç”¨lobok</h4><ol><li><p>åœ¨<code>maven</code>ä¸­æ·»åŠ ä¾è³´</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.4&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ç·¨è­¯å™¨ä¸­æ·»åŠ æ’ä»¶</p></li></ol><p>ä»¥IDEAç‚ºä¾‹ï¼Œåœ¨settingçš„pluginè£¡æœç´¢lombok pluginï¼Œå®‰è£æ’ä»¶ã€‚</p><p>ç›´æ¥åœ¨Classä¸ŠåŠ ä¸Š@Dataå³å¯</p><p>ä¾‹å¦‚ä¸€ä¸ªç®€å•çš„Person Class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String hobbit;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, String address, Integer age, String hobbit, String phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.hobbit = hobbit;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHobbit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hobbit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHobbit</span><span class="params">(String hobbit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hobbit = hobbit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", hobbit='"</span> + hobbit + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", phone='"</span> + phone + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº† @Data</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String hobbit;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æŒ‰å¿«æ·éµ <code>Ctrl + F12</code>ï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°set,get,toString æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ @Data è¨»è§£å°±å¯ä»¥æœ‰ä¸‹é¢å¹¾å€‹è¨»è§£çš„åŠŸèƒ½ï¼š @ToStringã€@Getterã€@Setterã€@EqualsAndHashCodeã€@NoArgsConstructor ã€‚</p><p>:::info<br>å¸¸ç”¨çš„å¹¾å€‹è¨»è§£ï¼š<br>@Data ï¼š æ³¨åœ¨é¡ä¸Šï¼Œæä¾›é¡çš„getã€setã€equalsã€hashCodeã€canEqualã€toStringæ–¹æ³•<br>@Setter ï¼š æ³¨åœ¨å±¬æ€§ä¸Šï¼Œæä¾› set æ–¹æ³•<br>@Getter ï¼š æ³¨åœ¨å±¬æ€§ä¸Šï¼Œæä¾› get æ–¹æ³•<br>æ§‹é€ å‡½æ•¸</p><p>@AllArgsConstructor<br>ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å˜é‡ï¼ŒåŒæ—¶å¦‚æœå˜é‡ä½¿ç”¨äº†NotNull annotation ï¼Œ ä¼šè¿›è¡Œæ˜¯å¦ä¸ºç©ºçš„æ ¡éªŒï¼Œ<br>å…¨éƒ¨å‚æ•°çš„Constructorå‡½æ•°çš„è‡ªåŠ¨ç”Ÿæˆï¼Œè¯¥æ³¨è§£çš„ä½œç”¨åŸŸä¹Ÿæ˜¯åªæœ‰åœ¨å®ä½“ç±»ä¸Šï¼Œå‚æ•°çš„é¡ºåºä¸å±æ€§å®šä¹‰çš„é¡ºåºä¸€è‡´ã€‚</p><p>ç¯„ä¾‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line"></span><br><span class="line">@AllArgsConstructor</span><br><span class="line">class MyClass&#123;</span><br><span class="line">    private String one;</span><br><span class="line">    private Integer three;  </span><br><span class="line">    private Integer two;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è‡ªå‹•ç”Ÿæˆå»ºæ§‹å­:</span><br><span class="line">public MyClass(String one, Integer three, Integer two) &#123;</span><br><span class="line">    this.one = one;</span><br><span class="line">    this.three = three;</span><br><span class="line">    this.two = two;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åƒè€ƒ: <a href="https://stackoverflow.com/questions/49106072/how-to-specify-the-order-of-parameters-in-allargsconstructor-in-lombok" target="_blank" rel="noopener">https://stackoverflow.com/questions/49106072/how-to-specify-the-order-of-parameters-in-allargsconstructor-in-lombok</a></p><p>@NoArgsConstructor<br>ç”¢ç”Ÿæ²’æœ‰åƒæ•¸çš„å»ºæ§‹å­<br>generate a constructor with no parameters.</p><p>@RequiredArgsConstructor<br>ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«å¸¸é‡ï¼ˆfinalï¼‰ï¼Œå’Œæ ‡è¯†äº†@NotNullçš„å˜é‡ çš„æ„é€ æ–¹æ³•ã€‚</p><p>@EqualsAndHashCode ï¼š æ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ equals å’Œ hashCode æ–¹æ³•<br>@Log4j/@Slf4j ï¼š æ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ Logger å¯¹è±¡ï¼Œå˜é‡åä¸º log<br>:::</p><p>:::warning<br>æ³¨æ„çš„æ˜¯ï¼ŒåŒæ—¶ä½¿ç”¨@Data å’Œ @AllArgsConstructor å ï¼Œé»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°å¤±æ•ˆï¼Œå¦‚æœéœ€è¦å®ƒï¼Œè¦é‡æ–°è®¾ç½® @NoArgsConstructor<br>:::</p><p>åƒè€ƒè³‡æ–™</p><p>@Dataæ³¨è§£ ä¸ lombok<br><a href="https://www.jianshu.com/p/c1ee7e4247bf" target="_blank" rel="noopener">https://www.jianshu.com/p/c1ee7e4247bf</a><br>å­¦ä¹ Spring Bootï¼šï¼ˆåäº”ï¼‰ä½¿ç”¨Lombokæ¥ä¼˜é›…çš„ç¼–ç <br><a href="https://blog.wuwii.com/springboot-15.html" target="_blank" rel="noopener">https://blog.wuwii.com/springboot-15.html</a></p><h2 id="Springè¼‰å…¥Beanèˆ‡æ¨™ç¤ºç‚ºBeanæœ‰é—œçš„Annotation"><a href="#Springè¼‰å…¥Beanèˆ‡æ¨™ç¤ºç‚ºBeanæœ‰é—œçš„Annotation" class="headerlink" title="Springè¼‰å…¥Beanèˆ‡æ¨™ç¤ºç‚ºBeanæœ‰é—œçš„Annotation"></a>Springè¼‰å…¥Beanèˆ‡æ¨™ç¤ºç‚ºBeanæœ‰é—œçš„Annotation</h2><h3 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h3><p>å®šç¾©å¯å…±ç‰©ä»¶åŒ–çš„é¡åˆ¥ï¼Œå«åšBeanï¼Œä¸¦ä¸”æ”¾ç½®åœ¨Spring Ioc Containerä¸­ä¸¦ä¸”çµ¦å…¶ç®¡ç†ï¼Œç­‰å¾…è¢«å‘¼å«ä½¿ç”¨ã€‚</p><h4 id="é…ç½®æ–¹å¼"><a href="#é…ç½®æ–¹å¼" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h4><h5 id="1-ç¨‹å¼ç¢¼Java-Codeé…ç½®"><a href="#1-ç¨‹å¼ç¢¼Java-Codeé…ç½®" class="headerlink" title="1. ç¨‹å¼ç¢¼Java Codeé…ç½®"></a>1. ç¨‹å¼ç¢¼Java Codeé…ç½®</h5><p>Spring çš„@Beané€šå¸¸å®£å‘Šåœ¨æ›æœ‰@Configurationçš„Springé…ç½®é¡åˆ¥ä¸­çš„æ–¹æ³•å‰ï¼Œä¾‹å¦‚å®£å‘Šä¸€å€‹ AppConfig.javaï¼Œè‹¥æœ‰è¶…éä¸€å€‹ä»¥ä¸Šçš„beanï¼Œä½¿ç”¨ @Qualifierçµ¦äºˆåç¨±</p><p><img src="https://i.imgur.com/EsiQv3V.png" alt=""></p><p>AppConfig.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"add"</span>)</span><br><span class="line">    <span class="function">Calculator <span class="title">addCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AddCalculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"sub"</span>)</span><br><span class="line">    <span class="function">Calculator <span class="title">subCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SubCalculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"mul"</span>)</span><br><span class="line">    <span class="function">Calculator <span class="title">mulCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MulCalculator();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®šç¾©Calculatorçš„ä»‹é¢</p><p>Calculator.interface<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Calculator &#123;</span><br><span class="line">    int calc(int a, int b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®šç¾©ä¸€å€‹å¯¦ä½œCalculatorçš„é¡åˆ¥</p><p>CalculatorImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.will.advanced.demo.bean;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubCalculator</span> <span class="keyword">implements</span>  <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MulCalculator</span> <span class="keyword">implements</span>  <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å–å¾—è¨»å†Šçš„beançš„æ–¹å¼"><a href="#å–å¾—è¨»å†Šçš„beançš„æ–¹å¼" class="headerlink" title="å–å¾—è¨»å†Šçš„beançš„æ–¹å¼"></a>å–å¾—è¨»å†Šçš„beançš„æ–¹å¼</h4><h5 id="1-ä½¿ç”¨-Autowire-èˆ‡-Qualifier"><a href="#1-ä½¿ç”¨-Autowire-èˆ‡-Qualifier" class="headerlink" title="1. ä½¿ç”¨@Autowire èˆ‡ @Qualifier"></a>1. ä½¿ç”¨@Autowire èˆ‡ @Qualifier</h5><p>ç„¶å¾Œåœ¨ CommandLineRunnerä¸­ä½¿ç”¨ @AutoWireä½¿ç”¨@Bean<br>ï¼Œç„¶è€Œè‹¥è¦Autowiredçš„é¡åˆ¥å°è±¡æ˜¯ä»‹é¢çš„è©±ï¼Œä¸”ä»‹é¢æœ‰å¾ˆå¤šçš„å¯¦ä½œå­é¡åˆ¥<br>(AddCalculator, SubCalculator, MulCalculator)</p><p>é‚£å¾—é€é @Qualifierä¾†æŒ‡åæ˜¯å“ªä¸€å€‹å­é¡åˆ¥</p><p>CommandLineAppStartupRunner.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandLineAppStartupRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"add"</span>)</span><br><span class="line">    Calculator addCalculator;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"sub"</span>)</span><br><span class="line">    Calculator subCalculator;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"mul"</span>)</span><br><span class="line">    Calculator mulCaculator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String...args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(addCalculator.calc(<span class="number">1</span>,<span class="number">3</span>));</span><br><span class="line">        System.out.println(subCalculator.calc(<span class="number">3</span>,<span class="number">2</span>));</span><br><span class="line">        System.out.println(mulCaculator.calc(<span class="number">2</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="2-ä½¿ç”¨getBean"><a href="#2-ä½¿ç”¨getBean" class="headerlink" title="2. ä½¿ç”¨getBean()"></a>2. ä½¿ç”¨getBean()</h5><p>CommandLineAppStartupRunner.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandLineAppStartupRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String...args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//ã€€å–å¾—æ‰€æœ‰å·²ç¶“è¨»å†Šçš„bean</span></span><br><span class="line">        System.out.println(Arrays.asList(context.getBeanDefinitionNames()));</span><br><span class="line">        <span class="comment">// å–å¾—åç¨±ç‚ºaddçš„bean</span></span><br><span class="line">        Calculator addCalculator = context.getBean(<span class="string">"add"</span>, Calculator.class);</span><br><span class="line">        Calculator subCalculator = context.getBean(<span class="string">"sub"</span>, Calculator.class);</span><br><span class="line">        Calculator mulCalculator = context.getBean(<span class="string">"mul"</span>, Calculator.class);</span><br><span class="line">        </span><br><span class="line">        System.out.println(addCalculator.calc(<span class="number">1</span>,<span class="number">3</span>));</span><br><span class="line">        System.out.println(subCalculator.calc(<span class="number">3</span>,<span class="number">2</span>));</span><br><span class="line">        System.out.println(mulCalculator.calc(<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h6 id="è£œå……-ä½¿ç”¨CommandlineRunnerè®“Springè¨­ç½®å¯ä»¥å…ˆè¢«è¼‰å…¥ï¼Œç„¶å¾Œå¯é€érun-å®šç¾©è‡ªè¨‚ç¾©åŸ·è¡Œçš„å…§å®¹"><a href="#è£œå……-ä½¿ç”¨CommandlineRunnerè®“Springè¨­ç½®å¯ä»¥å…ˆè¢«è¼‰å…¥ï¼Œç„¶å¾Œå¯é€érun-å®šç¾©è‡ªè¨‚ç¾©åŸ·è¡Œçš„å…§å®¹" class="headerlink" title="è£œå……: ä½¿ç”¨CommandlineRunnerè®“Springè¨­ç½®å¯ä»¥å…ˆè¢«è¼‰å…¥ï¼Œç„¶å¾Œå¯é€érun()å®šç¾©è‡ªè¨‚ç¾©åŸ·è¡Œçš„å…§å®¹"></a>è£œå……: ä½¿ç”¨CommandlineRunnerè®“Springè¨­ç½®å¯ä»¥å…ˆè¢«è¼‰å…¥ï¼Œç„¶å¾Œå¯é€érun()å®šç¾©è‡ªè¨‚ç¾©åŸ·è¡Œçš„å…§å®¹</h6><p><a href="https://dzone.com/articles/spring-boot-applicationrunner-and-commandlinerunne" target="_blank" rel="noopener">https://dzone.com/articles/spring-boot-applicationrunner-and-commandlinerunne</a></p><h5 id="3-xmlæª”æ¡ˆé…ç½®"><a href="#3-xmlæª”æ¡ˆé…ç½®" class="headerlink" title="3. xmlæª”æ¡ˆé…ç½®"></a>3. xmlæª”æ¡ˆé…ç½®</h5><p>ä¸Šé¢çš„å¯«æ³•ç­‰åŒåœ¨ <code>appConfig.xml</code> å®£å‘Š:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;bean name=&quot;addCalculator&quot; class=&quot;com.will.advanced.TransferServiceImpl&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p><h4 id="ComponentScan-æƒææŒ‡å®špackageä¸­æ›æœ‰-Componentçš„é¡åˆ¥ï¼Œè‡ªå‹•è¨»å†ŠåŒ…å«çš„bean"><a href="#ComponentScan-æƒææŒ‡å®špackageä¸­æ›æœ‰-Componentçš„é¡åˆ¥ï¼Œè‡ªå‹•è¨»å†ŠåŒ…å«çš„bean" class="headerlink" title="@ComponentScan: æƒææŒ‡å®špackageä¸­æ›æœ‰@Componentçš„é¡åˆ¥ï¼Œè‡ªå‹•è¨»å†ŠåŒ…å«çš„bean"></a>@ComponentScan: æƒææŒ‡å®špackageä¸­æ›æœ‰@Componentçš„é¡åˆ¥ï¼Œè‡ªå‹•è¨»å†ŠåŒ…å«çš„bean</h4><p>ä¸éä¸€èˆ¬åœ¨æ²’æœ‰ç‰¹æ®Šéœ€æ±‚çš„æƒ…æ³ä¸‹éƒ½æœƒä½¿ç”¨@ComponentScanæƒææŒ‡å®špackageä¸­æ›æœ‰@Componentçš„é¡åˆ¥ä¾†è‡ªå‹•è¨»å†Šç‚ºbeanã€‚</p><p>è€Œæœƒä½¿ç”¨@Beançš„æ™‚æ©Ÿç‚ºï¼Œç•¶è¦è¢«è¨»å†Šç‚ºbeançš„é¡åˆ¥å»ºæ§‹æ­¥é©Ÿæˆ–é‚è¼¯æ¯”è¼ƒè¤‡é›œï¼Œæ­¤æ™‚å°±éœ€è¦@Beanè®“ä½ å¯ä»¥åœ¨æ§‹é€ beançš„æ–¹æ³•å…§æ’°å¯«æ§‹é€ çš„è©³ç´°é‚è¼¯ï¼Œè€Œ@ComponentScanå°±ç„¡æ³•æ»¿è¶³æ¯”è¼ƒç´°å¾®çš„é…ç½®ã€‚</p><p>ä¾‹å¦‚åœ¨ serviceå±¤ä¸­æ–°å¢ä¸€å€‹ TestService class<br>é€é@Componentå°‡TestServiceè¨»å†ŠæˆBean<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class TestService &#123;</span><br><span class="line">    public String test() &#123;</span><br><span class="line">        return &quot;testing&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€é@ComponentScanå¯ä½¿ç”¨@Componentè¨»å†Šçš„beanï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandLineAppStartupRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TestService testService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String...args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(testService.test());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åƒè€ƒè³‡æ–™-2"><a href="#åƒè€ƒè³‡æ–™-2" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h5><p>Spring: A Head Start ğŸ”¥ â€” Beans Configuration (Part 2)<br><a href="https://medium.com/omarelgabrys-blog/spring-a-head-start-beans-configuration-part-2-4a8c239b070a" target="_blank" rel="noopener">https://medium.com/omarelgabrys-blog/spring-a-head-start-beans-configuration-part-2-4a8c239b070a</a></p><h4 id="Scope-å®šç¾©Beanè¢«å¼•ç”¨æ™‚è¦æ€æ¨£è¢«ä½¿ç”¨"><a href="#Scope-å®šç¾©Beanè¢«å¼•ç”¨æ™‚è¦æ€æ¨£è¢«ä½¿ç”¨" class="headerlink" title="@Scope: å®šç¾©Beanè¢«å¼•ç”¨æ™‚è¦æ€æ¨£è¢«ä½¿ç”¨"></a>@Scope: å®šç¾©Beanè¢«å¼•ç”¨æ™‚è¦æ€æ¨£è¢«ä½¿ç”¨</h4><ul><li>singletonï¼šåœ¨Spring IoC Containerï¼Œè©²beanåªæœƒæœ‰å–®ä¸€å¯¦ä¾‹(a single instance)ï¼Œæ­¤ç‚ºSpringé è¨­å€¼</li><li>prototypeï¼šåœ¨Spring IoC Containerä¸­ï¼Œè©²beanå¯ä»¥æœ‰å¤šå€‹å¯¦ä¾‹(any number of object instances)</li><li>requestï¼š åœ¨æ¯ä¸€æ¬¡çš„HTTP Requestï¼Œspring containeræœƒæ ¹æ“šloginAction beançš„å®šç¾©ä¾†å»ºç«‹ä¸€å€‹å…¨æ–°çš„instanceï¼Œè€Œä¸”åƒ…åœ¨ç›®å‰çš„requestä¸­æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒçš„å»æ›´æ”¹instanceçš„å…§éƒ¨ç‹€æ…‹ï¼Œè«‹æ±‚çµæŸï¼Œrequest scopeçš„bean instanceæœƒè¢«destroy</li><li>sessionï¼šé‡å°æŸå€‹HTTP Sessionï¼Œspring containeræœƒæ ¹æ“šuserPreference beançš„å®šç¾©ä¾†å»ºç«‹ä¸€å€‹å…¨æ–°çš„instanceï¼ŒåŒæ¨£çš„ï¼Œå’Œrequest scopeä¸€æ¨£ï¼Œå¯ä»¥æ”¾å¿ƒçš„å»æ›´æ”¹instanceå…§éƒ¨ç‹€æ…‹ã€‚</li><li>global-sessionï¼šåƒ…åœ¨portletç‚ºåŸºç¤çš„Webæ‡‰ç”¨ä¸‹æœ‰ä½œç”¨ã€‚Porletçš„è¦ç¯„ä¸­å®šç¾©äº†global sessionçš„æ¦‚å¿µã€‚</li></ul><h5 id="åƒè€ƒè³‡æ–™-3"><a href="#åƒè€ƒè³‡æ–™-3" class="headerlink" title="åƒè€ƒè³‡æ–™:"></a>åƒè€ƒè³‡æ–™:</h5><p>Spring Bean Scope å­¸ç¿’<br><a href="https://kevingo75.blogspot.com/2012/03/spring-bean-scope.html" target="_blank" rel="noopener">https://kevingo75.blogspot.com/2012/03/spring-bean-scope.html</a></p><h4 id="è£œå……-ä»€éº¼æ˜¯Spring-IoC-Inversion-of-Control-container"><a href="#è£œå……-ä»€éº¼æ˜¯Spring-IoC-Inversion-of-Control-container" class="headerlink" title="è£œå……: ä»€éº¼æ˜¯Spring IoC (Inversion of Control) container."></a>è£œå……: ä»€éº¼æ˜¯Spring IoC (Inversion of Control) container.</h4><p> Inversion of Control, or IoC for short, is a process in which an object defines its dependencies without creating them. This object delegates the job of constructing such dependencies to an IoC container.</p><p>ç”¨ä¸€æŸ±è©±æè¿°IoCï¼š classä¸ç”¨è‡ªå·±ä¸»å‹•newæ¬²ä¾è³´classçš„instanceï¼Œè€Œæ˜¯é€éå¤–éƒ¨ã€€(main()æ–¹æ³•)ã€€ä»¥å»ºæ§‹å­ã€setteræˆ–æ˜¯ä»‹é¢æ³¨å…¥ä¾†ç”¢ç”Ÿä¾è³´classçš„instance</p><p>:::success<br>éœ€è¦çš„ éŠæˆ²ï¼Œä¸ç”¨è‡ªå·± ä¸‹è¼‰ï¼Œè€Œæ˜¯ ç¶²å’–æä¾› çµ¦ä½ ã€‚<br>â€”â€”â€”â€”â€”â€”â€”-||â€”â€”â€”â€”â€”â€”â€”</p><p>éœ€è¦çš„ ç‰©ä»¶ï¼Œä¸ç”¨è‡ªå·± å–å¾—ï¼Œè€Œæ˜¯ æœå‹™å®¹å™¨ æä¾› çµ¦ä½ ã€‚<br>â€”â€”â€”â€”â€”â€”â€”-||â€”â€”â€”â€”â€”â€”â€”<br>éœ€è¦çš„ ä¾è³´å¯¦ä¾‹ï¼Œä¸ç”¨ ä¸»å‹• (Active) å»ºç«‹ï¼Œè€Œæ˜¯ è¢«å‹• (Passive) æ¥æ”¶ã€‚<br>:::</p><h5 id="åƒè€ƒè³‡æ–™ï¼š-1"><a href="#åƒè€ƒè³‡æ–™ï¼š-1" class="headerlink" title="åƒè€ƒè³‡æ–™ï¼š"></a>åƒè€ƒè³‡æ–™ï¼š</h5><p>æ§åˆ¶åè½‰ (IoC) èˆ‡ ä¾è³´æ³¨å…¥ (DI)<br><a href="https://notfalse.net/3/ioc-di" target="_blank" rel="noopener">https://notfalse.net/3/ioc-di</a></p><h3 id="Repository"><a href="#Repository" class="headerlink" title="@Repository"></a>@Repository</h3><p>ç®€åŒ– Spring çš„å¼€å‘ã€‚@Repositoryæ³¨è§£ä¾¿å±äºæœ€å…ˆå¼•å…¥çš„ä¸€æ‰¹ï¼Œå®ƒç”¨äºå°†æ•°æ®è®¿é—®å±‚ (DAO å±‚ ) çš„ç±»æ ‡è¯†ä¸º Spring Beanã€‚å…·ä½“åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ DAOç±»ä¸Šå³å¯ã€‚</p><h3 id="Serviceã€-Controller-å’Œ-Component-å°‡classæ¨™ç¤ºä¸ºBean"><a href="#Serviceã€-Controller-å’Œ-Component-å°‡classæ¨™ç¤ºä¸ºBean" class="headerlink" title="@Serviceã€@Controller å’Œ @Component å°‡classæ¨™ç¤ºä¸ºBean"></a>@Serviceã€@Controller å’Œ @Component å°‡classæ¨™ç¤ºä¸ºBean</h3><ul><li>@Component æ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºä¸€ä¸ªç»„ä»¶ (Bean) ï¼Œå¯ä»¥ä½œç”¨åœ¨ä»»ä½•å±‚æ¬¡ã€‚</li><li>@Service é€šå¸¸ä½œç”¨åœ¨æ¥­å‹™é‚è¼¯å±¤ï¼Œä½†æ˜¯ç›®å‰è¯¥åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚</li><li>@Controller é€šå¸¸ä½œç”¨åœ¨æ§åˆ¶å±¤(Controller)ï¼Œä½†æ˜¯ç›®å‰è¯¥åŠŸèƒ½èˆ‡@Component ç›¸åŒã€‚</li></ul><h3 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h3><p>è¢«@PostConstructä¿®é£¾çš„æ–¹æ³•æœƒåœ¨æœå‹™å™¨åŠ è¼‰Servletçš„æ™‚å€™é‹è¡Œï¼Œä¸¦ä¸”åªæœƒè¢«æœå‹™å™¨åŸ·è¡Œä¸€æ¬¡ã€‚</p><h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>å‡è‹¥ä½ åœ¨classä¸­è¨­å®šäº†@Transactional, è©²classæ‰€æœ‰çš„methodæœ‰ä½¿ç”¨åˆ°JPAçš„éƒ½æœƒè¢«springçš„transactionæ‰€ç®¡ç†ã€‚</p><p>èˆ‰ä¾‹ï¼šç•¶æœ‰å€‹Transactionæœ‰ä¸‰å€‹å‹•ä½œï¼šentity1.save, entity2.save, entity3.save.</p><p>è‹¥entity3.saveå¤±æ•—ï¼Œé‚£Springå°±æœƒå°‡entity1.saveèˆ‡entity2.saveçš„åŸ·è¡Œçµæœçµ¦rollbackï¼Œé‚„åŸå…¶å‹•ä½œã€‚</p><h4 id="åƒè€ƒè³‡æ–™-4"><a href="#åƒè€ƒè³‡æ–™-4" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h4><p><a href="https://stackoverflow.com/questions/1099025/spring-transactional-what-happens-in-background" target="_blank" rel="noopener">https://stackoverflow.com/questions/1099025/spring-transactional-what-happens-in-background</a></p><h2 id="AOPç›¸é—œçš„Annotaion"><a href="#AOPç›¸é—œçš„Annotaion" class="headerlink" title="AOPç›¸é—œçš„Annotaion"></a>AOPç›¸é—œçš„Annotaion</h2><h3 id="Aspect"><a href="#Aspect" class="headerlink" title="@Aspect"></a>@Aspect</h3><p>@Aspect:å®šç¾©AOPï¼Œä½œç”¨åœ¨class</p><p>AOPç‚º Aspect Oritented Programming<br>AOPé€šéçµ¦ç¨‹åºå®šç¾©ä¸€å€‹åˆ‡å…¥é»ï¼Œç„¶å¾Œåœ¨å…¶å‰å¾Œåˆ‡å…¥ä¸åŒçš„åŸ·è¡Œå…§å®¹<br>AOPä¸æœƒç ´å£åŸä¾†çš„ç¨‹åºé‚è¼¯<br>AOPä½¿ç”¨å ´æ™¯ï¼š</p><ul><li>ç´€éŒ„æ—¥èªŒ</li><li>äº‹å‹™ç®¡ç†</li><li>å®‰å…¨æª¢æŸ¥</li><li>è³‡æºæ§åˆ¶</li></ul><h3 id="Pointcut-Before-After"><a href="#Pointcut-Before-After" class="headerlink" title="@Pointcut, @Before, @After"></a>@Pointcut, @Before, @After</h3><p>ç¯„ä¾‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="comment">// åˆ‡å…¥packageç‚ºcom.william.demo.apiçš„LogTestApié¡åˆ¥çš„logå‡½å¼</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.william.demo.api.LogTestApi.log(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¸Œæœ›åœ¨åˆ‡å…¥é»ã€€log()å‡½å¼å‰åŸ·è¡ŒæŸäº›å…§å®¹</span></span><br><span class="line">    <span class="comment">// æˆ–æ˜¯ç”¨ç›´æ¥ç”¨ã€€@Before("execution(* com.william.demo.api.LogTestApi.log(..))");</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"log()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"----------do before---------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"log()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"----------do after----------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å…¶ä»–Annotation"><a href="#å…¶ä»–Annotation" class="headerlink" title="å…¶ä»–Annotation"></a>å…¶ä»–Annotation</h2><h3 id="Cache"><a href="#Cache" class="headerlink" title="@Cache"></a>@Cache</h3><p>å®šç¾©cacheç­–ç•¥èˆ‡ç¯„åœï¼Œå¯ä»¥å®šç¾©ä»¥ä¸‹åƒæ•¸ï¼š</p><ul><li><p>usage: ç•¶å‰ç·©å­˜ç­–ç•¥(NONE, READ_ONLY, NONSTRICT_READ_WRITE, TRANSACTIONAL)</p><ul><li>read-only: åªè®€ç·©å­˜<ul><li>å¦‚æœä½ çš„æ‡‰ç”¨ç¨‹åºåªéœ€è®€å–ä¸€å€‹æŒä¹…åŒ–é¡çš„å¯¦ä¾‹ï¼Œè€Œç„¡éœ€å°å…¶ä¿®æ”¹ï¼Œ é‚£éº¼å°±å¯ä»¥å°å…¶é€²è¡Œåªè®€ç·©å­˜</li></ul></li><li>read-write: è®€å¯«ç·©å­˜<ul><li>å¦‚æœæ‡‰ç”¨ç¨‹åºéœ€è¦æ›´æ–°æ•¸æ“šï¼Œé‚£éº¼ä½¿ç”¨è®€/å¯«ç·©å­˜æ¯”è¼ƒåˆé©ã€‚å¦‚æœæ‡‰ç”¨ç¨‹åºè¦æ±‚â€œåºåˆ—åŒ–äº‹å‹™â€çš„éš”é›¢ç´šåˆ¥ï¼ˆserializable transaction isolation levelï¼‰ï¼Œé‚£éº¼å°±æ±ºä¸èƒ½ä½¿ç”¨é€™ç¨®ç·©å­˜ç­–ç•¥</li></ul></li><li>nonstrict-read-write: ä¸åš´æ ¼è®€å¯«ç·©å­˜<ul><li>å¦‚æœæ‡‰ç”¨ç¨‹åºåªå¶çˆ¾éœ€è¦æ›´æ–°æ•¸æ“šï¼ˆä¹Ÿå°±æ˜¯èªªï¼Œå…©å€‹äº‹å‹™åŒæ™‚æ›´æ–°åŒä¸€è¨˜éŒ„çš„æƒ…æ³å¾ˆä¸å¸¸è¦‹ï¼‰ï¼Œä¹Ÿä¸éœ€è¦ååˆ†åš´æ ¼çš„äº‹å‹™éš”é›¢ï¼Œé‚£éº¼æ¯”è¼ƒé©åˆä½¿ç”¨éåš´æ ¼è®€/å¯«ç·©å­˜ç­–ç•¥ã€‚</li></ul></li><li>transactional :äº‹å‹™æ€§ç·©å­˜<ul><li>Hibernate çš„äº‹å‹™ç·©å­˜ç­–ç•¥æä¾›äº†å…¨äº‹å‹™çš„ç·©å­˜æ”¯æŒï¼Œä¾‹å¦‚å° JBoss TreeCache çš„æ”¯æŒã€‚é€™æ¨£çš„ç·©å­˜åªèƒ½ç”¨æ–¼ JTA ç’°å¢ƒä¸­ï¼Œä½ å¿…é ˆæŒ‡å®šç‚ºå…¶hibernate.transaction.manager_lookup_classå±¬æ€§ã€‚</li></ul></li></ul></li><li><p>region: å¯é¸åƒæ•¸ï¼ŒæŒ‡å®šäºŒç´šç·©å­˜çš„å»åŸŸåï¼Œé»˜èªç‚ºé¡æˆ–è€…é›†åˆçš„åå­—ã€‚</p></li><li>include: å¯é¸åƒæ•¸(all, non-lazy)ã€‚ allåŒ…å«æ‰€æœ‰å±¬æ€§ï¼Œnon-lazyåƒ…åŒ…å«éå»¶é²åŠ è¼‰çš„å±¬æ€§ã€‚</li></ul><h4 id="ç¯„ä¾‹"><a href="#ç¯„ä¾‹" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Table(name = &quot;PROVICE&quot;)</span><br><span class="line">@Cache(usage =CacheConcurrencyStrategy.READ_ONLY)</span><br><span class="line">public class Province() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Table(name = &quot;PROVICE&quot;)</span><br><span class="line">@Cache(usage =CacheConcurrencyStrategy.READ_ONLY)</span><br><span class="line">public class Province() &#123; </span><br><span class="line">    @OneToMany(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;cityId&quot;)</span><br><span class="line">    @Cache(usage = CacheConcrrencyStrategy.READ_ONLY)</span><br><span class="line">    private Set&lt;City&gt; cities;</span><br></pre></td></tr></table></figure><h5 id="åƒè€ƒè³‡æ–™-5"><a href="#åƒè€ƒè³‡æ–™-5" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h5><p>Hibernate @Cacheæ³¨è§£-å¤©æ‰å°å°å¸ƒ<br><a href="https://blog.csdn.net/w410589502/article/details/54603265" target="_blank" rel="noopener">https://blog.csdn.net/w410589502/article/details/54603265</a></p><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>@Configurationçš„ä½œç”¨åŒä»¥å‰çš„xmlé…ç½®æª”ï¼ˆä¾‹å¦‚Springçš„applicationContext.xmlæˆ–dispatcher-servlet.xmlï¼‰ï¼Œç”¨ä¾†è¨­å®šSpringç’°å¢ƒé…ç½®ï¼Œä¾‹å¦‚å®£å‘ŠåŠè¨»å†Šbeanè‡³Springå®¹å™¨ä¸­ï¼Œæ³¨å…¥propertiesåƒæ•¸ç­‰ã€‚</p><h4 id="ç¯„ä¾‹-1"><a href="#ç¯„ä¾‹-1" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h4><p>ä¾‹å¦‚æˆ‘å€‘æœ‰ä¸€å€‹FooServiceé¡åˆ¥ï¼Œè‹¥æ­¤é¡åˆ¥è¦æˆç‚ºSpringå®¹å™¨ç®¡ç†çš„beanï¼Œæœ‰å…©ç¨®æ–¹æ³•ï¼š</p><ol><li>ä¸€èˆ¬åœ¨è©²é¡åˆ¥ä¸Šå®£å‘Š@Componentä¸¦æ­é…@ComponentScanæƒæçš„æ–¹å¼è¨»å†Šç‚ºbean</li><li>é€éåœ¨@Configurationé¡åˆ¥ä¸­æ­é…@Beançš„æ–¹å¼è¨»å†Šã€‚</li></ol><p>ä¾‹å¦‚å»ºç«‹ä¸€å€‹AppConfigä¸¦åœ¨é¡åˆ¥åç¨±å‰æ›ä¸Š@Configurationï¼Œå‰‡æ­¤é¡åˆ¥åŠæˆç‚ºSpringçš„é…ç½®é¡ã€‚åœ¨é…ç½®é¡çš„æ–¹æ³•å‰æ›ä¸Š@Beanå‰‡æ–¹æ³•å›å‚³çš„ç‰©ä»¶å°±æœƒè¢«è¨»å†Šç‚ºSpringå®¹å™¨ç®¡ç†çš„bean</p><p>fooService()æ–¹æ³•ä¾¿æœƒå°‡FooServiceè¨»å†Šç‚ºbeanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.will.advanced.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.will.advanced.demo.service.FooService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FooService <span class="title">fooService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FooService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚ºäº†ç¨‹å¼ç®¡ç†åŠç¶­è­·ä¸Šçš„æ–¹ä¾¿ï¼Œé€šå¸¸æˆ‘å€‘æœƒæŠŠæŸäº›ç›¸é—œçš„é…ç½®å¯«åœ¨å¦å¤–çš„é…ç½®æª”ï¼Œè€Œä¸æ˜¯å…¨éƒ¨å¡åœ¨åŒä¸€å€‹é¡åˆ¥ï¼Œæ­¤æ™‚å°±å¯ä»¥åˆ©ç”¨@Configurationå¦å¤–å®šç¾©ä¸€å€‹é…ç½®æª”ï¼Œä¾‹å¦‚ä¸Šé¢çš„AppConfigã€‚</p><h4 id="SpringBootApplication-æœ¬èº«ä¹ŸåŒ…å«-Configuration"><a href="#SpringBootApplication-æœ¬èº«ä¹ŸåŒ…å«-Configuration" class="headerlink" title="@SpringBootApplication: æœ¬èº«ä¹ŸåŒ…å«@Configuration"></a>@SpringBootApplication: æœ¬èº«ä¹ŸåŒ…å«@Configuration</h4><p>è€Œåœ¨Spring Bootä¸­ï¼Œ<span style="color:red">@SpringBootApplicationé¡æœ¬èº«å³åŒ…å«äº†@Configurationï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨è£¡é¢é€²è¡Œå¦‚ä¸ŠBeançš„é…ç½®</span>ï¼Œä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.will.advanced.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.will.advanced.demo.FooService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootBeanDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBootBeanDemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FooService <span class="title">fooService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FooService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åƒè€ƒè³‡æ–™-6"><a href="#åƒè€ƒè³‡æ–™-6" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h5><p>Spring @Configurationä½œç”¨<br><a href="https://matthung0807.blogspot.com/2019/04/spring-configuration_28.html" target="_blank" rel="noopener">https://matthung0807.blogspot.com/2019/04/spring-configuration_28.html</a></p><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>å®šç¾© @SpringBootApplicationçš„é è¨­æƒç„beançš„ç¯„åœ</p><p>Spring Bootçš„@SpringBootApplicationé è¨­åªæœƒæƒææ‰€å±¬packageä¸‹çš„é¡ï¼Œå› æ­¤è‹¥@Configurationé¡åˆ¥å®šç¾©åœ¨@SpringBootApplicationé¡ä»¥å¤–çš„packageï¼Œå‰‡è¦ç”¨scanBasePackageså±¬æ€§ä¾†è¨­å®šè¦é¡å¤–æƒæçš„packageï¼Œä¾‹å¦‚@SpringBootApplication(scanBasePackages=â€com.will.advanced.demo.configâ€)ã€€ï¼ˆ@ConfigurationåŒ…å«äº†@Componentï¼‰ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.will.advanced.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="comment">// æ³¨æ„åœ¨scanBasePackagesçš„packageåç¨±</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages=<span class="string">"com.will.advanced.demo.config"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootBeanDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBootBeanDemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h4><p>æˆ–æ˜¯é€é@Importä¾†å¼•å…¥ ï¼Œä¾‹å¦‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.will.advanced.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// æ³¨æ„pacakgeåç¨±</span></span><br><span class="line"><span class="meta">@Import</span>(value = &#123; com.will.advanced.demo.config.AnotherAppConfig.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootBeanDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBootBeanDemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>:::warning<br>æ³¨æ„ä½¿ç”¨@Importæœƒå¿½ç•¥@Configurationè¨­å®š<br>:::</p><h3 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h3><p>ä¾è³´æ³¨å…¥ç‰©ä»¶</p><p>Springçš„@Autowiredç”¨ä¾†ä¾è³´æ³¨å…¥ç‰©ä»¶ï¼Œå…¸å‹çš„ç”¨æ³•å°±æ˜¯æ›åœ¨é¡åˆ¥æˆå“¡è®Šæ•¸ä¸Šã€‚@Autowiredé è¨­æœƒä¾æ³¨å…¥å°è±¡çš„é¡åˆ¥å‹æ…‹ä¾†é¸æ“‡å®¹å™¨(é€é@Configurationå®šç¾©çš„classæœƒæˆç‚ºå®¹å™¨)ä¸­ç›¸ç¬¦çš„ç‰©ä»¶(è¨­ç½®æˆbean)ä¾†æ³¨å…¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure><p>Springæœƒè‡ªå‹•å»å®¹å™¨ä¸­æ‰¾åˆ°ã€€æœ‰å®¹å™¨å®šç¾©CarBeansçš„bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ....xxx.Car;</span><br><span class="line"><span class="meta">@Configuation</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarBeans</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Car <span class="title">car</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Car() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Autowireç‚ºSpring IoCçš„å¯¦ç¾ï¼Œä¸ç”¨è‡ªå·±å»newä¸€å€‹carå‡ºä¾†ï¼Œè€Œæ˜¯é€éå®¹å™¨(æœƒåšconstructor or setter or interface injection)ï¼Œä¾†å»å¯¦ç¾å¤–éƒ¨æ³¨å…¥ï¼Œé™ä½æ¨¡çµ„(class)ä¹‹é–“çš„è€¦åˆæ€§</p><h3 id="EnableScheduling"><a href="#EnableScheduling" class="headerlink" title="@EnableScheduling"></a>@EnableScheduling</h3><p>è‹¥é–‹ç™¼è€…åœ¨AppConfigé¡ä¸­ä½¿ç”¨äº†@EnableSchedulingï¼Œä¸¦åœ¨æŸå€‹task classä¸­ä½¿ç”¨äº†@Scheduleè¨»è§£ï¼Œé‚£éº¼è¢«@Scheduleæ¨™è¨»çš„æ–¹æ³•æ—¢å¯ä»¥åœ¨æŒ‡å®šæ™‚é–“å…§è‡ªå‹•åŸ·è¡Œ</p><p>æ³¨æ„ï¼š@EnableSchedulingè¦èˆ‡@Scheduleæ­é…ä½¿ç”¨æ‰æœ‰æ•ˆæœ</p><h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h3><p>è‹¥æƒ³è¦æŠŠé…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè®€å–å¥½ä¸¦è‡ªå‹•å°è£(getterè®€å–privateçš„configå€¼)æˆå¯¦é«”é¡ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘åœ¨ä»£ç¢¼è£¡é¢ä½¿ç”¨å°±è¼•é¬†è¨±å¤šï¼Œé€™æ™‚å°±å¯ä»¥ä½¿ç”¨@ConfiguationPropertiesï¼ŒæŠŠåŒé¡çš„é…ç½®è¨Šæ¯è‡ªå‹•å°è£æˆå¯¦é«”é¡ã€‚</p><p>å‡è¨­æœ‰è¨­å®šæ–‡ä»¶åœ¨ <code>application.properties</code>ä¹‹ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">connection.username=admin</span><br><span class="line">connection.password=kyjufskifas2jsfs</span><br><span class="line">connection.remoteAddress=192.168.1.1</span><br></pre></td></tr></table></figure></p><p>æˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹å¯¦é«”é¡åœ¨è£è¼‰é…ç½®æ–‡ä»¶ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"connection"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionSettings</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String remoteAddress;</span><br><span class="line">    <span class="keyword">private</span> String password ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remoteAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRemoteAddress</span><span class="params">(String remoteAddress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.remoteAddress = remoteAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº¦å¯ä»¥æŠŠ @ConfigurationProperties å®šç¾©åœ¨@Beanä¹‹ä¸‹ï¼Œèªªæ˜@Beanæ˜¯åƒè€ƒåˆ°æœ‰ç”¨configuationPropertiesè¨­å®šçš„class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"connection"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConnectionSettings <span class="title">connectionSettings</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConnectionSettings();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦ä½¿ç”¨æ™‚ç›´æ¥ç”¨@Autowireæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/task"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ã€€åœ¨é€™è£¡æ³¨å…¥ configï¼</span></span><br><span class="line">    <span class="meta">@Autowired</span> ConnectionSettings conn;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = &#123;<span class="string">"/"</span>,<span class="string">""</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hellTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String userName = conn.getUsername();     </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello task !!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åƒè€ƒè³‡æ–™ï¼š-2"><a href="#åƒè€ƒè³‡æ–™ï¼š-2" class="headerlink" title="åƒè€ƒè³‡æ–™ï¼š"></a>åƒè€ƒè³‡æ–™ï¼š</h5><p>spring boot ä½¿ç”¨@ConfigurationProperties<br><a href="https://blog.csdn.net/yingxiake/article/details/51263071" target="_blank" rel="noopener">https://blog.csdn.net/yingxiake/article/details/51263071</a></p><h3 id="ConditionalOnClass"><a href="#ConditionalOnClass" class="headerlink" title="@ConditionalOnClass"></a>@ConditionalOnClass</h3><p>æ˜¯Springbootå®ç°è‡ªåŠ¨é…ç½®çš„é‡è¦æ”¯æ’‘ä¹‹ä¸€ã€‚å…¶ç”¨é€”æ˜¯åˆ¤æ–­å½“å‰classpathä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šç±»ï¼Œè‹¥æ˜¯åˆ™å°†å½“å‰çš„é…ç½®è£…è½½å…¥springå®¹å™¨ã€‚</p><h5 id="åƒè€ƒè³‡æ–™ï¼š-3"><a href="#åƒè€ƒè³‡æ–™ï¼š-3" class="headerlink" title="åƒè€ƒè³‡æ–™ï¼š"></a>åƒè€ƒè³‡æ–™ï¼š</h5><p>@ConditionalOnClassçš„ä½¿ç”¨æ¢ç´¢ æ–°æ—¥æš®é‡Œæ ¼æ–—å¤§ä¼š<br><a href="https://blog.csdn.net/lucyTheSlayer/article/details/80430912" target="_blank" rel="noopener">https://blog.csdn.net/lucyTheSlayer/article/details/80430912</a></p><h3 id="ConditionalOnMissingBean"><a href="#ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnMissingBean"></a>@ConditionalOnMissingBean</h3><p>ç»“åˆä½¿ç”¨æ³¨è§£@ConditionalOnMissingBeanå’Œ@Bean,å¯ä»¥åšåˆ°åªæœ‰ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„Beanä¸å­˜åœ¨äºBeanFactoryä¸­æ—¶æ‰åˆ›å»ºæŸä¸ªBean </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionalOnMissingBeanConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">//ã€€ç„¡æ¢ä»¶å®šç¾©ä¸€å€‹bean</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> A <span class="title">beanA</span> <span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> A(); <span class="comment">//ã€€</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">ã€€<span class="meta">@ConditionalOnMissingBean</span>(name=<span class="string">"beanA"</span>)</span><br><span class="line">ã€€<span class="function"><span class="keyword">public</span> B <span class="title">beanB</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ beanFactory ä¸­å­˜åœ¨ä¸€ä¸ªåç§°ä¸º beanA çš„ beanï¼Œæ‰å®šä¹‰bean ï¼š beanBï¼›</span></span><br><span class="line">ã€€ã€€<span class="comment">// å› ä¸ºä¸Šé¢çš„æ–¹æ³•å·²ç»å®šä¹‰äº†ä¸€ä¸ª beanAï¼Œæ‰€ä»¥è¿™é‡Œ beanBå®šä¹‰å¹¶ä¸ä¼šå‘ç”Ÿã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> B(); </span><br><span class="line">ã€€&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ã€€<span class="meta">@Bean</span></span><br><span class="line">ã€€<span class="meta">@ConditionalOnMissingBean</span>(name=<span class="string">"beanD"</span>)</span><br><span class="line">ã€€<span class="function"><span class="keyword">public</span> C <span class="title">beanC</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ beanFactory ä¸­å­˜åœ¨ä¸€ä¸ªåç§°ä¸º beanDçš„ beanï¼Œæ‰å®šä¹‰bean ï¼š beanCï¼›    </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> C(); </span><br><span class="line">ã€€&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åƒè€ƒè³‡æ–™ï¼š-4"><a href="#åƒè€ƒè³‡æ–™ï¼š-4" class="headerlink" title="åƒè€ƒè³‡æ–™ï¼š"></a>åƒè€ƒè³‡æ–™ï¼š</h4><p>Spring BootåŸºäºç‰¹å®šæ¡ä»¶åˆ›å»ºBeanä¾‹å­ : ConditionalOnMissingBeanhttps:<br>//blog.csdn.net/andy_zhang2007/article/details/81285130</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èªè­˜èˆ‡å­¸ç¿’Bash [Linuxé³¥å“¥ Ch10]</title>
      <link href="/2020/01/28/linux-bash/"/>
      <url>/2020/01/28/linux-bash/</url>
      
        <content type="html"><![CDATA[<h2 id="Bash-shell-åŠŸèƒ½"><a href="#Bash-shell-åŠŸèƒ½" class="headerlink" title="Bash shell åŠŸèƒ½"></a>Bash shell åŠŸèƒ½</h2><p>æ‰“éçš„æŒ‡ä»¤éƒ½æ˜¯è¨˜éŒ„åœ¨ ./bash_history.</p><blockquote><p>æ³¨æ„é§­å®¢å¯ä»¥é€é <code>history</code> ä¾†æŸ¥çœ‹ä½ å…ˆå‰æ‰“éæŒ‡ä»¤ ex: MySQL ç™»å…¥å¸³æˆ¶å¯†ç¢¼è³‡è¨Š</p></blockquote><h3 id="alias-å–ä»£å¾ˆé•·çš„æŒ‡å®š"><a href="#alias-å–ä»£å¾ˆé•·çš„æŒ‡å®š" class="headerlink" title="alias å–ä»£å¾ˆé•·çš„æŒ‡å®š"></a>alias å–ä»£å¾ˆé•·çš„æŒ‡å®š</h3><p>è‹¥ä¸æƒ³è¦æ¯æ¬¡æ‰“é€™éº¼é•·æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨alias ä¾†å–ä»£<br>ä¾‹å¦‚ï¼š <code>ls -a</code> å¯ä»¥é€é <code>alias lm=&#39;ls -al&#39;</code> ä»¥<code>lm</code>ä¾†å–ä»£</p><h3 id="type-æŸ¥çœ‹æŒ‡ä»¤æ˜¯å…§éƒ¨æŒ‡ä»¤æˆ–å¤–éƒ¨æŒ‡ä»¤"><a href="#type-æŸ¥çœ‹æŒ‡ä»¤æ˜¯å…§éƒ¨æŒ‡ä»¤æˆ–å¤–éƒ¨æŒ‡ä»¤" class="headerlink" title="type æŸ¥çœ‹æŒ‡ä»¤æ˜¯å…§éƒ¨æŒ‡ä»¤æˆ–å¤–éƒ¨æŒ‡ä»¤"></a>type æŸ¥çœ‹æŒ‡ä»¤æ˜¯å…§éƒ¨æŒ‡ä»¤æˆ–å¤–éƒ¨æŒ‡ä»¤</h3><p>åƒä¸Šé¢ä¾‹å­ <code>lm=&#39;ls -al&#39;</code> çš„lm ç‚ºæˆ‘å€‘è‡ªè¡Œå®šç¾©çš„å¤–éƒ¨æŒ‡ä»¤<br>é‚£<code>cd</code>, <code>ls</code>é€™äº›å‰‡æ˜¯å…§éƒ¨æŒ‡ä»¤</p><p>é€é <code>type lm</code>, å¯ä»¥çœ‹åˆ°<code>lm</code> ç‚ºå¤–éƒ¨æŒ‡ä»¤</p><h3 id="è‹¥è¦ºå¾—ä¸‹çš„æŒ‡ä»¤å¤ªé•·-å¯ä»¥é€é"><a href="#è‹¥è¦ºå¾—ä¸‹çš„æŒ‡ä»¤å¤ªé•·-å¯ä»¥é€é" class="headerlink" title="è‹¥è¦ºå¾—ä¸‹çš„æŒ‡ä»¤å¤ªé•· å¯ä»¥é€é \"></a>è‹¥è¦ºå¾—ä¸‹çš„æŒ‡ä»¤å¤ªé•· å¯ä»¥é€é \</h3><p>å°‡ä¸‰å€‹æª”æ¡ˆcpåˆ° /rootå…§â€¦ä¸¦ç”¨ <code>\</code>ä¾†æ¥çºŒæŒ‡ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /var/spool/mail/root /etc/crontab \ </span><br><span class="line">&gt; /etc/fstab /root</span><br></pre></td></tr></table></figure></p><h3 id="å–å¾—ç‰ˆæœ¬è™Ÿ"><a href="#å–å¾—ç‰ˆæœ¬è™Ÿ" class="headerlink" title="å–å¾—ç‰ˆæœ¬è™Ÿ"></a>å–å¾—ç‰ˆæœ¬è™Ÿ</h3><p>uname -r</p><p>å¯ç”¨è®Šæ•¸å°‡ç‰ˆæœ¬è™Ÿå­˜èµ·ä¾†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version=$(uname -r) // å°‡ç‰ˆæœ¬è™Ÿæ”¾åˆ°versionè®Šæ•¸</span><br><span class="line"></span><br><span class="line">echo $version</span><br></pre></td></tr></table></figure></p><h3 id="è®Šæ•¸è¨­å®šè¦å‰‡"><a href="#è®Šæ•¸è¨­å®šè¦å‰‡" class="headerlink" title="è®Šæ•¸è¨­å®šè¦å‰‡"></a>è®Šæ•¸è¨­å®šè¦å‰‡</h3><p>ç­‰è™Ÿä¸èƒ½æœ‰ç©ºæ ¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myname=VBird</span><br></pre></td></tr></table></figure></p><p>è®Šæ•¸å…§å®¹æœ‰ç©ºç™½ï¼Œå¯ç”¨â€â€ æˆ– â€˜â€™åŒ…èµ·ä¾†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var=&quot;lang is $LANG&quot;</span><br></pre></td></tr></table></figure></p><p>å¯ç”¨è·³è„«å­—å…ƒ â€œ\â€ å°‡ç‰¹æ®Šç¬¦è™Ÿè®Šæˆä¸€èˆ¬å­—å…ƒ</p><p>è®Šæ•¸ç‚ºæ“´å¢è®Šæ•¸å…§å®¹æ™‚ï¼Œå¯ä»¥ç”¨$è®Šæ•¸åç¨± æˆ–${è®Šæ•¸} ç´¯åŠ å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:/home/bin</span><br></pre></td></tr></table></figure></p><p>è®Šæ•¸éœ€è¦åœ¨å…¶ä»–å­ç¨‹åºåŸ·è¡Œï¼Œéœ€è¦ä»¥ <code>export</code> ä¾†ä½¿è®Šæ•¸æˆç‚ºç’°å¢ƒè®Šæ•¸<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH</span><br></pre></td></tr></table></figure></p><blockquote><p>ä»€éº¼æ˜¯å­ç¨‹åºï¼Ÿ åœ¨ç›®å‰çš„shellæƒ…æ³ä¸‹ï¼Œé–‹å•Ÿå¦å¤–ä¸€å€‹shelläº¦å³ç‚ºå­ç¨‹åº</p></blockquote><p>å–æ¶ˆè®Šæ•¸çš„æ–¹æ³•ç‚º <code>unset</code></p><blockquote><p>$() è¢«å…©å€‹é€—è™ŸåŒ…èµ·ä¾†çš„æŒ‡ä»¤æœƒå„ªå…ˆåŸ·è¡Œ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /lib/modules/$(uname -r)/kernal</span><br><span class="line"></span><br><span class="line">å…ˆç”¨ uname -r å–å¾—ç•¶å‰linux kernalç‰ˆæœ¬è™Ÿï¼Œå†cdåˆ°è©²ç‰ˆæœ¬çš„ç›®éŒ„</span><br></pre></td></tr></table></figure><h3 id="é€é-env-å¯ä»¥çœ‹åˆ°ç›®å‰è¨­ç½®çš„ç’°å¢ƒè®Šæ•¸"><a href="#é€é-env-å¯ä»¥çœ‹åˆ°ç›®å‰è¨­ç½®çš„ç’°å¢ƒè®Šæ•¸" class="headerlink" title="é€é env å¯ä»¥çœ‹åˆ°ç›®å‰è¨­ç½®çš„ç’°å¢ƒè®Šæ•¸"></a>é€é env å¯ä»¥çœ‹åˆ°ç›®å‰è¨­ç½®çš„ç’°å¢ƒè®Šæ•¸</h3><ul><li>HOME: å®¶ç›®éŒ„</li><li>SHELL:ç›®å‰shellä½¿ç”¨çš„ç¨‹å¼ï¼Œé è¨­æ˜¯ /bin/bash</li><li>HISTSIZE: ç´€éŒ„æ­·å²æŒ‡ä»¤å¾—æ•¸ç›®</li><li>PATH: åŸ·è¡Œé»¨æœå°‹çš„è·¯å¾‘</li><li>LANG: èªç³»è³‡æ–™</li><li>RANDOM: éš¨æ©Ÿäº‚æ•¸</li></ul><blockquote><p>RANDOMæœƒç”¢å‡º 0~32767<br>è‹¥æƒ³è¦éš¨æ©Ÿå–å‡º0~9<br><code>declare -i number=$RANDOM*10/32768 ; echo $number</code></p></blockquote><h3 id="é€é-set-å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®Šæ•¸-ç’°å¢ƒè®Šæ•¸-è‡ªå®šç¾©è®Šæ•¸"><a href="#é€é-set-å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®Šæ•¸-ç’°å¢ƒè®Šæ•¸-è‡ªå®šç¾©è®Šæ•¸" class="headerlink" title="é€é set å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®Šæ•¸ (ç’°å¢ƒè®Šæ•¸+è‡ªå®šç¾©è®Šæ•¸)"></a>é€é set å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®Šæ•¸ (ç’°å¢ƒè®Šæ•¸+è‡ªå®šç¾©è®Šæ•¸)</h3><h3 id="é€é-PS1-è¨­å®š-æç¤ºå­—å…ƒ"><a href="#é€é-PS1-è¨­å®š-æç¤ºå­—å…ƒ" class="headerlink" title="é€é PS1 è¨­å®š æç¤ºå­—å…ƒ"></a>é€é PS1 è¨­å®š æç¤ºå­—å…ƒ</h3><p>ex: <code>PS1=&#39;[\u@\h \w \A #\#]\$ &#39;</code><br>è¨­å®šå‘½ä»¤æç¤ºå­—å…ƒé¡¯ç¤ºç›®å‰è¼¸å…¥å¹¾æ¬¡æŒ‡ä»¤ ï¼</p><h2 id="è®Šæ•¸éµç›¤çš„è®€å–ã€é™£åˆ—èˆ‡å®£å‘Š-read-array-declare"><a href="#è®Šæ•¸éµç›¤çš„è®€å–ã€é™£åˆ—èˆ‡å®£å‘Š-read-array-declare" class="headerlink" title="è®Šæ•¸éµç›¤çš„è®€å–ã€é™£åˆ—èˆ‡å®£å‘Š: read, array, declare"></a>è®Šæ•¸éµç›¤çš„è®€å–ã€é™£åˆ—èˆ‡å®£å‘Š: read, array, declare</h2><h3 id="read-è®€å–ä¾†è‡ªä½¿ç”¨è€…-éµç›¤çš„è¼¸å…¥"><a href="#read-è®€å–ä¾†è‡ªä½¿ç”¨è€…-éµç›¤çš„è¼¸å…¥" class="headerlink" title="read: è®€å–ä¾†è‡ªä½¿ç”¨è€… éµç›¤çš„è¼¸å…¥"></a>read: è®€å–ä¾†è‡ªä½¿ç”¨è€… éµç›¤çš„è¼¸å…¥</h3><p>ex: æç¤ºä½¿ç”¨è€…30ç§’å…§è¼¸å…¥è‡ªå·±çš„å¤§åï¼Œä¸¦å°‡å¤§åå¡å…¥ $named è®Šæ•¸å…§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">read -p &quot;Please keyin your name: &quot; -t 30 named</span><br><span class="line"></span><br><span class="line">echo $named</span><br></pre></td></tr></table></figure></p><h3 id="delcare-å®£å‘Šè®Šæ•¸çš„é¡å‹"><a href="#delcare-å®£å‘Šè®Šæ•¸çš„é¡å‹" class="headerlink" title="delcare: å®£å‘Šè®Šæ•¸çš„é¡å‹"></a>delcare: å®£å‘Šè®Šæ•¸çš„é¡å‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare [-aixr] variable</span><br><span class="line"></span><br><span class="line">-a : å°‡å¾Œé¢åç‚ºvariableå®šç¾©ç‚º arrayé¡å‹</span><br><span class="line">-i : integer</span><br><span class="line">-x : è®Šæˆç’°å¢ƒè®Šæ•¸</span><br><span class="line">-r : è¨­ç½®æˆread only</span><br></pre></td></tr></table></figure><p><span style="color:red">æ³¨æ„ï¼šè‹¥sum=100+300+200 echo $sum æœƒå¾—åˆ° â€œ100+300+200â€å­—ä¸²ï¼Œä¸¦éæ˜¯600çš„çµæœï¼Œéœ€è¦ç”¨ declare -i sum æ‰èƒ½å¾—åˆ°integer sum</span></p><h3 id="unlimit-æª”æ¡ˆç³»çµ±èˆ‡ç¨‹åºçš„é™åˆ¶é—œä¿‚"><a href="#unlimit-æª”æ¡ˆç³»çµ±èˆ‡ç¨‹åºçš„é™åˆ¶é—œä¿‚" class="headerlink" title="unlimit æª”æ¡ˆç³»çµ±èˆ‡ç¨‹åºçš„é™åˆ¶é—œä¿‚"></a>unlimit æª”æ¡ˆç³»çµ±èˆ‡ç¨‹åºçš„é™åˆ¶é—œä¿‚</h3><p>é™åˆ¶ä½¿ç”¨è€…æ‰€ä½¿ç”¨çš„ç³»çµ±è³‡æºï¼Œ<br>åŒ…æ‹¬CPUæ™‚é–“ï¼Œè¨˜æ†¶é«”æ•¸é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ulimit [-SHacdltu] [é…é¡]</span><br><span class="line"></span><br><span class="line">-H : hard limit åš´å¾·çš„é™åˆ¶ï¼Œè‹¥è¶…éå‰‡ä¸èƒ½å†ç”¨</span><br><span class="line">-S : Soft limit è­¦å‘Šçš„é™åˆ¶ï¼Œè¶…éåªæ˜¯æœƒè­¦å‘Š</span><br><span class="line">-a : åˆ—å‡ºç›®å‰é™åˆ¶çš„æ•¸é‡ï¼Œè‹¥ä¸æ¥åƒæ•¸å‰‡åˆ—å‡ºå…¨éƒ¨</span><br><span class="line">-c : ç•¶æŸäº›ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤ï¼Œç³»çµ±æœƒå°‡è©²ç¨‹å¼åœ¨è¨˜æ†¶é«”çš„è³‡è¨Šå¯«æˆæª”æ¡ˆ (å¯é™¤éŒ¯ç”¨)</span><br><span class="line">-f : æ­¤shell å¯ä»¥å»ºç«‹çš„æœ€å¤§æª”æ¡ˆå®¹é‡</span><br><span class="line">-u : å–®ä¸€ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨çš„æœ€å¤§processæ•¸é‡</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="è®Šæ•¸çš„åˆªé™¤ã€å–ä»£èˆ‡æ›¿æ›"><a href="#è®Šæ•¸çš„åˆªé™¤ã€å–ä»£èˆ‡æ›¿æ›" class="headerlink" title="è®Šæ•¸çš„åˆªé™¤ã€å–ä»£èˆ‡æ›¿æ›"></a>è®Šæ•¸çš„åˆªé™¤ã€å–ä»£èˆ‡æ›¿æ›</h3><p>ç›´æ¥çœ‹ç¯„ä¾‹ï¼š</p><h4 id="åˆªé™¤"><a href="#åˆªé™¤" class="headerlink" title="åˆªé™¤"></a>åˆªé™¤</h4><ul><li><code>\#</code>ï¼šå¾å‰é¢é–‹å§‹åˆªé™¤, åˆªé™¤ç¬¦åˆå–ä»£æ–‡å­—çš„ ã€æœ€çŸ­çš„ã€é‚£ä¸€å€‹</li><li><p><code>\##</code>ï¼š ï¼ï¼ï¼ï¼ã€æœ€é•·çš„ã€</p></li><li><p><code>\%</code>ï¼šå¾å¾Œé¢é–‹å§‹åˆªé™¤ï¼Œâ€¦..åˆªé™¤ã€æœ€çŸ­çš„ã€</p></li><li><code>\%%</code>ï¼š ã€æœ€é•·çš„ã€</li></ul><h4 id="æ›¿æ›"><a href="#æ›¿æ›" class="headerlink" title="æ›¿æ›"></a>æ›¿æ›</h4><p>username=${username-root}<br>è‹¥usernameç‚ºç©ºå€¼ï¼Œæ›¿æ›æˆroot</p><p>è‹¥åŠ ä¸Š<code>:</code> å¯ä»¥å¼·åˆ¶æ›¿æ›<br>username=${username:-root}</p><p>åŠ ä¸Š<code>?</code> å¯ä»¥åˆ¤æ–·æ˜¯å¦æœ‰ç„¡æ­¤è®Šæ•¸</p><h3 id="bashçš„é€²ç«™èˆ‡æ­¡è¿è¨Šæ¯-etc-issue-etc-motd"><a href="#bashçš„é€²ç«™èˆ‡æ­¡è¿è¨Šæ¯-etc-issue-etc-motd" class="headerlink" title="bashçš„é€²ç«™èˆ‡æ­¡è¿è¨Šæ¯ : /etc/issue, /etc/motd"></a>bashçš„é€²ç«™èˆ‡æ­¡è¿è¨Šæ¯ : /etc/issue, /etc/motd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br></pre></td></tr></table></figure><h3 id="bashçš„ç’°å¢ƒè¨­å®šæª”"><a href="#bashçš„ç’°å¢ƒè¨­å®šæª”" class="headerlink" title="bashçš„ç’°å¢ƒè¨­å®šæª”"></a>bashçš„ç’°å¢ƒè¨­å®šæª”</h3><h4 id="login-èˆ‡-non-login-shell"><a href="#login-èˆ‡-non-login-shell" class="headerlink" title="login èˆ‡ non-login shell"></a>login èˆ‡ non-login shell</h4><ul><li>login shell<br>å–å¾—bashæ™‚éœ€è¦å®Œæ•´è¼¸å…¥ç™»å…¥æµç¨‹(è¼¸å…¥å¸³è™Ÿå¯†ç¢¼)</li></ul><p><code>/etc/profile</code>: ç³»çµ±æ•´é«”çš„è¨­å®šï¼ˆæœ€å¥½åˆ¥ä¿®æ”¹)</p><p><code>~/.bash_profile ~/.bash_login ~/.profile</code>: å±¬æ–¼ä½¿ç”¨è€…å€‹äººè¨­å®š</p><p>ç³»çµ±ç™»å…¥shellæ™‚ï¼Œå„ªå…ˆè¼‰å…¥ <code>/etc/profile</code></p><p>å†ä¾†æ‰æœƒä¾åºè¼‰å…¥ä½¿ç”¨è€…è¨­å®šæª”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/.bash_profile</span><br><span class="line">~/.bash_login</span><br><span class="line">~/.profile</span><br></pre></td></tr></table></figure></p><p>åªæœƒè®€å–ä¸Šé¢çš„ä¸€å€‹ï¼Œç”±ä¸Šè€Œä¸‹<br>ç„¶è€Œä¸Šé¢ä¸‰å€‹æª”æ¡ˆå¯èƒ½æœƒæœ‰åŒ…å«åŸ·è¡Œ ~/.bashrc çš„å…§å®¹ã€‚ã€‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> if running bash</span><br><span class="line">  if [ -n "$BASH_VERSION" ]; then</span><br><span class="line">      # include .bashrc if it exists</span><br><span class="line">      if [ -f "$HOME/.bashrc" ]; then  # here is the .bashrc</span><br><span class="line">          . "$HOME/.bashrc"</span><br><span class="line">      fi</span><br><span class="line">  fi</span><br></pre></td></tr></table></figure><ul><li>non-login shell<br>ç›´æ¥æ‰“é–‹å¦å¤–ä¸€å€‹çµ‚ç«¯æ©Ÿ(shell)ï¼Œè©²shellç‚º non-login shell</li></ul><p>åœ¨non-login shellå…§è¦è¼‰å…¥ä½¿ç”¨è€…ï¼Œ å¾—æ‰‹å‹• ./bashrc</p><h3 id="gt-gt-gt"><a href="#gt-gt-gt" class="headerlink" title="&gt;, &gt;&gt;, |"></a>&gt;, &gt;&gt;, |</h3><p><code>&gt;</code> : å–ä»£<br><code>&gt;&gt;</code> : ç´¯åŠ </p><h3 id="å‘½ä»¤åŸ·è¡Œçš„åˆ¤æ–·ä¾æ“šï¼š-amp-amp"><a href="#å‘½ä»¤åŸ·è¡Œçš„åˆ¤æ–·ä¾æ“šï¼š-amp-amp" class="headerlink" title="å‘½ä»¤åŸ·è¡Œçš„åˆ¤æ–·ä¾æ“šï¼š ; , &amp;&amp; ||"></a>å‘½ä»¤åŸ·è¡Œçš„åˆ¤æ–·ä¾æ“šï¼š ; , &amp;&amp; ||</h3><h4 id="åˆ†è™Ÿ-ï¼š-å¯ä»¥åŸ·è¡Œé€£çºŒæŒ‡ä»¤"><a href="#åˆ†è™Ÿ-ï¼š-å¯ä»¥åŸ·è¡Œé€£çºŒæŒ‡ä»¤" class="headerlink" title="åˆ†è™Ÿ ; ï¼š å¯ä»¥åŸ·è¡Œé€£çºŒæŒ‡ä»¤"></a>åˆ†è™Ÿ <code>;</code> ï¼š å¯ä»¥åŸ·è¡Œé€£çºŒæŒ‡ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync; sync; shutdown -h now</span><br></pre></td></tr></table></figure><h4 id="ã€-amp-amp-ã€-å¯ä»¥åˆ¤æ–·æŒ‡ä»¤æ˜¯å¦æˆåŠŸåŸ·è¡Œ"><a href="#ã€-amp-amp-ã€-å¯ä»¥åˆ¤æ–·æŒ‡ä»¤æ˜¯å¦æˆåŠŸåŸ·è¡Œ" class="headerlink" title="$? ã€ &amp;&amp; ã€ || å¯ä»¥åˆ¤æ–·æŒ‡ä»¤æ˜¯å¦æˆåŠŸåŸ·è¡Œ"></a>$? ã€ &amp;&amp; ã€ || å¯ä»¥åˆ¤æ–·æŒ‡ä»¤æ˜¯å¦æˆåŠŸåŸ·è¡Œ</h4><p><code>$?</code>ï¼šè‹¥å‰ä¸€å€‹æŒ‡ä»¤åŸ·è¡Œçš„çµæœæ­£ç¢ºï¼Œåœ¨linuxåº•ä¸‹æœƒå›å‚³ä¸€å€‹ $?=0çš„å€¼</p><p><code>(cmd1 &amp;&amp; cmd2)</code>: </p><ul><li>è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”æ­£ç¢ºåŸ·è¡Œ($?=0)ï¼Œå‰‡é–‹å§‹åŸ·è¡Œ cmd2</li><li>è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”åŸ·è¡ŒéŒ¯èª¤($? != 0)ï¼Œå‰‡ä¸åŸ·è¡Œ cmd2</li></ul><p><code>(cmd1 || cmd2)</code>: </p><ul><li>è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”æ­£ç¢ºåŸ·è¡Œ($?=0)ï¼Œå‰‡cmd2ä¸åŸ·è¡Œ</li><li>è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”åŸ·è¡ŒéŒ¯èª¤($? != 0)ï¼Œå‰‡é–‹å§‹åŸ·è¡Œ cmd2</li></ul><h3 id="pipe-ç®¡ç·šå‘½ä»¤ï¼š-è³‡æ–™éœ€è¦ç¶“éå¤šå€‹è™•ç†æ‰‹çºŒ"><a href="#pipe-ç®¡ç·šå‘½ä»¤ï¼š-è³‡æ–™éœ€è¦ç¶“éå¤šå€‹è™•ç†æ‰‹çºŒ" class="headerlink" title="pipe ç®¡ç·šå‘½ä»¤ï¼š è³‡æ–™éœ€è¦ç¶“éå¤šå€‹è™•ç†æ‰‹çºŒ"></a>pipe ç®¡ç·šå‘½ä»¤ï¼š è³‡æ–™éœ€è¦ç¶“éå¤šå€‹è™•ç†æ‰‹çºŒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /etc | less</span><br></pre></td></tr></table></figure><p>é€é <code>|</code> å¯ä»¥å°‡ /etc æ’ˆå‡ºä¾†çš„è³‡è¨Šçµ¦ lessè§£è®€</p><h4 id="æ“·å–å‘½ä»¤ï¼š-cut-grep"><a href="#æ“·å–å‘½ä»¤ï¼š-cut-grep" class="headerlink" title="æ“·å–å‘½ä»¤ï¼š cut, grep"></a>æ“·å–å‘½ä»¤ï¼š cut, grep</h4><ul><li>cut: å°‡æŸä¸€æ®µè¨Šæ¯åˆ‡å‰²å‡ºä¾†</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH | cut -d &apos;:&apos; -f 3,5</span><br></pre></td></tr></table></figure><p>åˆ—å‡º PATHä¸­çš„ç¬¬3å’Œç¬¬5å€‹è·¯å¾‘</p><ul><li>grep: éæ¿¾å‡º</li></ul><p>æœ‰ç¬¦åˆå­—å…ƒçš„è¨Šæ¯</p><h4 id="æ’åºå‘½ä»¤ï¼š-sort-wc-uniq"><a href="#æ’åºå‘½ä»¤ï¼š-sort-wc-uniq" class="headerlink" title="æ’åºå‘½ä»¤ï¼š sort, wc, uniq"></a>æ’åºå‘½ä»¤ï¼š sort, wc, uniq</h4><p>sort å¯ä»¥ä½¿èªç³»çµ±ä¸€ LANG=C è®“è³‡æ–™æ’åºå¥½ä¸€äº›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd | sort</span><br></pre></td></tr></table></figure><p>uniq: æ’åºå®Œæˆ ä¸¦å°‡é‡è¤‡çš„è³‡æ–™åƒ…åˆ—å‡ºä¸€å€‹é¡¯ç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last | cut -d &apos; &apos; -f1 | sort | uniq -c</span><br><span class="line">çŸ¥é“æ¯ä½ä½¿ç”¨è€…çš„ç™»å…¥æ¬¡æ•¸</span><br></pre></td></tr></table></figure><p>wc: çŸ¥é“æŸå€‹æª”æ¡ˆçš„çµ„æˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/man.config | wc</span><br></pre></td></tr></table></figure><h3 id="tee-é›™å‘é‡æ–°å°å‘"><a href="#tee-é›™å‘é‡æ–°å°å‘" class="headerlink" title="tee: é›™å‘é‡æ–°å°å‘"></a>tee: é›™å‘é‡æ–°å°å‘</h3><p><code>last | tee last.list | cut -d &quot; &quot; -fi</code>:</p><p>é€™å€‹ç¯„ä¾‹å¯ä»¥è®“æˆ‘å€‘å°‡last çš„è¼¸å‡ºå­˜ä¸€ä»½åˆ°last.list æª”æ¡ˆä¸­</p><p><code>last | /home | tee ~/homefile | more</code>:</p><p>é€™å€‹ç¯„ä¾‹æ˜¯å°‡ ls çš„è³‡æ–™å­˜ä¸€ä»½åˆ° ~/homefile ï¼ŒåŒæ™‚è¢å¹•ä¹Ÿæœ‰è¼¸å‡ºè¨Šæ¯</p><h3 id="å­—å…ƒè½‰æ›å‘½ä»¤-tr-col-join-paste-expand"><a href="#å­—å…ƒè½‰æ›å‘½ä»¤-tr-col-join-paste-expand" class="headerlink" title="å­—å…ƒè½‰æ›å‘½ä»¤: tr, col, join, paste, expand"></a>å­—å…ƒè½‰æ›å‘½ä»¤: tr, col, join, paste, expand</h3><p><code>tr</code>: åˆªé™¤ä¸€æ®µè¨Šæ¯ä¸­çš„æ–‡å­—ã€æˆ–è€…æ˜¯é€²è¡Œæ–‡å­—çš„è½‰æ›</p><p><code>col</code>: ç¶“å¸¸è¢«ç”¨ä¾†å°‡ man page è½‰å­˜ç‚ºç´”æ–‡å­—æª”æ¡ˆä»¥æ–¹ä¾¿æŸ¥é–±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man col | col -b &gt; /root/col.man</span><br></pre></td></tr></table></figure><p><code>join</code>: å…©å€‹æª”æ¡ˆç•¶ä¸­ï¼Œæœ‰ç›¸åŒè³‡æ–™çš„é‚£ä¸€è¡Œï¼Œæ‰å°‡å®ƒåŠ åœ¨ä¸€èµ·</p><h3 id="åˆ†å‰²å‘½ä»¤-split"><a href="#åˆ†å‰²å‘½ä»¤-split" class="headerlink" title="åˆ†å‰²å‘½ä»¤: split"></a>åˆ†å‰²å‘½ä»¤: split</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat termcap* &gt;&gt; termcapback</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ls -al / è¼¸å‡ºçš„è³‡è¨Šä¸­ï¼Œæ¯åè¡Œç´€éŒ„è®Šæˆä¸€å€‹æª”æ¡ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al / | split -l 10 lsroot</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc -l lsroot*</span><br></pre></td></tr></table></figure><h3 id="åƒæ•¸ä»£æ›ï¼š-xargs-ç”¢ç”ŸæŸå€‹æŒ‡ä»¤çš„åƒæ•¸"><a href="#åƒæ•¸ä»£æ›ï¼š-xargs-ç”¢ç”ŸæŸå€‹æŒ‡ä»¤çš„åƒæ•¸" class="headerlink" title="åƒæ•¸ä»£æ›ï¼š xargs: ç”¢ç”ŸæŸå€‹æŒ‡ä»¤çš„åƒæ•¸"></a>åƒæ•¸ä»£æ›ï¼š xargs: ç”¢ç”ŸæŸå€‹æŒ‡ä»¤çš„åƒæ•¸</h3><p>æœ‰äº›æŒ‡ä»¤ä¸å…¶å¯¦ä¸¦ä¸æ”¯æ´ç®¡ç·šå‘½ä»¤ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€éxargè©²æŒ‡ä»¤å¼•ç”¨ standard inputä¹‹ç”¨ã€‚</p><h3 id="æ¸›è™Ÿ-çš„ç”¨é€”"><a href="#æ¸›è™Ÿ-çš„ç”¨é€”" class="headerlink" title="æ¸›è™Ÿ -çš„ç”¨é€”"></a>æ¸›è™Ÿ <code>-</code>çš„ç”¨é€”</h3><p><code>tar -cvf - /home | tar -xvf -</code></p><p>æˆ‘å°‡/homeè£¡é¢çš„æª”æ¡ˆçµ¦ä»–æ‰“åŒ…ï¼Œä½†æ‰“åŒ…çš„è³‡æ–™ä¸æ˜¯è¨˜éŒ„åˆ°æª”æ¡ˆï¼Œè€Œæ˜¯å‚³é€åˆ°stdout; ç¶“éç®¡ç·šå¾Œï¼Œå°‡tar <code>-cvf - /home</code> å‚³é€çµ¦å¾Œé¢çš„<code>tar -xvf -</code></p><p>å¾Œé¢ - å–ç”¨å‰ä¸€å€‹æŒ‡ä»¤çš„stdoutï¼Œ å› æ­¤ä¸éœ€è¦ä½¿ç”¨file</p>]]></content>
      
      
      <categories>
          
          <category> Devops </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ</title>
      <link href="/2020/01/01/2020%E5%B9%B4%E7%9A%84%E6%83%B3%E6%B3%95%E8%88%87%E8%87%AA%E4%BF%AE%E8%A6%8F%E5%8A%83/"/>
      <url>/2020/01/01/2020%E5%B9%B4%E7%9A%84%E6%83%B3%E6%B3%95%E8%88%87%E8%87%AA%E4%BF%AE%E8%A6%8F%E5%8A%83/</url>
      
        <content type="html"><![CDATA[<p>å›é¡§äº†ä¸€ä¸‹2019å¹´å°è‡ªå·±çš„æœŸè¨±ï¼Œ<br>è‡ªå·±èˆ‡æœŸè¨±çš„ä¼¼ä¹é‚„æœ‰æ‰€å·®è·ï¼Œ<br>å°±å†æ¥å†å²ã€‚<br><a id="more"></a></p><p>å¸Œæœ›ä»Šå¹´å¼·åŒ–è‡ªèº«çš„ç¶²ç«™é–‹ç™¼çš„å¯¦åŠ›(ä»¥å¾Œç«¯ç‚ºä¸»)<br>æ¥ä¸‹ä¾†2020å¹´æƒ³è¦è¶ä¸‹ç­é–’æš‡æ™‚é–“æ™‚ä¾†åšï¼š</p><ul><li>åˆ·åˆ·leetcode</li><li>æ‰¾ä¸€å€‹side projectä¾†ç¶“ç‡Ÿ (é è¨ˆç”¨Java Spring Bootå¾Œç«¯, Angularå‰ç«¯)</li><li>è¤‡ç¿’è³‡æ–™çµæ§‹ï¼Œè³‡æ–™åº«SQLèªæ³•ç­‰</li></ul><p>ä»¥ä¸Šç¹¼çºŒç²¾é€²ï¼Œè‡ªæˆ‘å‹‰å‹µ</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mindsets </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æŸ¥çœ‹é€éæ™ºèƒ½åˆç´„å­˜åœ¨ä»¥å¤ªåŠä¸Šçš„è³‡æ–™ï¼Ÿ</title>
      <link href="/2019/02/10/checksmartcontractdata/"/>
      <url>/2019/02/10/checksmartcontractdata/</url>
      
        <content type="html"><![CDATA[<p>åœ¨çœ‹é€™ç¯‡æ–‡ç« ä¹‹å‰å¿…é ˆè¦çŸ¥é“ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯é€éæ™ºèƒ½åˆç´„å­˜åœ¨å€å¡Šéˆä¸Šçš„è³‡è¨Šéƒ½æ˜¯<span style="color:red">å…¬é–‹çš„</span>ã€‚</p><a id="more"></a><p>ä¸ç®¡ä½ æ˜¯å¦æœ‰åœ¨æ™ºèƒ½åˆç´„ä¸Šé¢æœ‰ç”¨<code>requre(), revert(), assert()</code>ç­‰ç­‰ä¾†é™åˆ¶æŸåœ°å€çš„äººä¾†å­˜å–æ™ºèƒ½åˆç´„ä¸Šçš„è®Šæ•¸ï¼Œä½†é€™äº›è®Šæ•¸éƒ½æœƒå­˜ä»¥å¤ªåŠEVMçš„Storageä¸Šé¢ï¼Œæ¯å€‹ç¯€é»éƒ½å¯ä»¥é€éä»¥ä¸‹æ–¹å¼ä¾†å°EVMçš„Storageå…§çš„ç·¨ç¢¼é€²è¡Œè§£æï¼Œä¸¦é‚„åŸç•¶åˆé€éåˆç´„æ‰€å„²å­˜çš„è®Šæ•¸è³‡æ–™ï¼ï¼ï¼</p><p>ä»¥ä¸‹é€éä¸€å€‹ç¯„ä¾‹ä¾†ç­è§£å¦‚ä½•é€éweb3.js libraryä¸­çš„<code>eth.getStorage()</code>æ–¹æ³•ä¾†è§£æStorageå…§å„²å­˜çš„è³‡è¨Šã€‚</p><h4 id="æ™ºèƒ½åˆç´„ç¯„ä¾‹ï¼š"><a href="#æ™ºèƒ½åˆç´„ç¯„ä¾‹ï¼š" class="headerlink" title="æ™ºèƒ½åˆç´„ç¯„ä¾‹ï¼š"></a>æ™ºèƒ½åˆç´„ç¯„ä¾‹ï¼š</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">prama solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract testStorage &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint</span> storeduint1 = <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">uint</span> constant constuint = <span class="number">16</span>;</span><br><span class="line">    uint128 investmentsLimit = <span class="number">17055</span>;</span><br><span class="line">    <span class="keyword">uint32</span> investmentsDeadlinedTimeStamp = <span class="keyword">uint32</span>(now);</span><br><span class="line">    </span><br><span class="line">    bytes16 string1 = <span class="string">'test1'</span>;</span><br><span class="line">    bytes32 string2 = <span class="string">'test1236'</span>;</span><br><span class="line">    <span class="keyword">string</span> string3 = <span class="string">'lets string something'</span>;</span><br><span class="line">    </span><br><span class="line">    mapping (address =&gt; <span class="keyword">uint</span>) uints1;</span><br><span class="line">    mapping (address =&gt; DeviceData) structs1;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">uint</span>[] uintarray;</span><br><span class="line">    DeviceData[] deviceDataArray;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">struct</span> DeviceData &#123;</span><br><span class="line">        <span class="keyword">string</span> deviceBrand;</span><br><span class="line">        <span class="keyword">string</span> deviceYear;</span><br><span class="line">        <span class="keyword">string</span> batteryWearLevel;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function testStorage() &#123;</span><br><span class="line">        address address1 = <span class="number">0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df</span>6</span><br><span class="line">        address address2 = <span class="number">0xaee905fdd3ed851e48d22059575b9f</span>4245a82b04;</span><br><span class="line">        </span><br><span class="line">        uints1[address1] = <span class="number">88</span>;</span><br><span class="line">        uints1[address2] = <span class="number">99</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> dev1 = DeviceData(<span class="string">'deviceBrand'</span>, <span class="string">'deviceYear'</span>, <span class="string">'wearLevel'</span>);</span><br><span class="line">        <span class="keyword">var</span> dev2 = DeviceData(<span class="string">'deviceBrand2'</span>, <span class="string">'deviceYear2'</span>, <span class="string">'wearLevel2'</span>);</span><br><span class="line">        </span><br><span class="line">        structs1[addresss1] = dev1;</span><br><span class="line">        structs1[addresss2] = dev2;</span><br><span class="line">        </span><br><span class="line">        uintarray.push(<span class="number">8000</span>);</span><br><span class="line">        uintarray.push(<span class="number">9000</span>);</span><br><span class="line">        </span><br><span class="line">        deviceDataArray.push(dev1);</span><br><span class="line">        deviceDataArray.push(dev2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è¨­æˆ‘å€‘åˆç´„çš„åœ°å€æ˜¯åœ¨ï¼š<code>0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b</code></p><p>æ‰€æœ‰å„²å­˜åœ¨storageå…§çš„åƒæ•¸éƒ½å¯ä»¥ç”¨indexä¾†ç´¢å¼•ï¼Œindexçš„æ ¼å¼ç‚º256 bytesä»¥åŠå°æ‡‰64ç¢¼ã€‚<br>åœ¨ä»¥ä¸Šçš„ç¯„ä¾‹ä¸­æˆ‘å€‘æœ‰ 10å€‹åƒæ•¸ï¼Œæ‰€ä»¥å¯ä»¥é€éindexä¾†ä¸€ä¸€éæ­·ä»–å€‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let contractAddress = &apos;0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b&apos;</span><br><span class="line">for (index = 0; index &lt; 10; index++)&#123;</span><br><span class="line"> console.log(`[$&#123;index&#125;]` + </span><br><span class="line">   web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">&#125;</span><br><span class="line">result:</span><br><span class="line">[0] 0x000000000000000000000000000000000000000000000000000000000000000f</span><br><span class="line">[1] 0x00000000000000000000000059b92d9a0000000000000000000000000000429f</span><br><span class="line">[2] 0x0000000000000000000000000000000074657374310000000000000000000000</span><br><span class="line">[3] 0x7465737431323336000000000000000000000000000000000000000000000000</span><br><span class="line">[4] 0x6c65747320737472696e6720736f6d657468696e67000000000000000000002a</span><br><span class="line">[5] 0x0000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line">[6] 0x0000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line">[7] 0x0000000000000000000000000000000000000000000000000000000000000002</span><br><span class="line">[8] 0x0000000000000000000000000000000000000000000000000000000000000002</span><br><span class="line">[9] 0x0000000000000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure><p>é–‹å§‹é‡å°åˆç´„å…§çš„10å€‹è®Šæ•¸ä¸€ä¸€åšéæ­·å’Œè§£æ</p><h3 id="index-0-storeduint1"><a href="#index-0-storeduint1" class="headerlink" title="index 0 - storeduint1"></a>index 0 - storeduint1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let contractAddress = &apos;0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b&apos;</span><br><span class="line">let index = 0</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">console.log(&apos;DEC:&apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, index)))</span><br><span class="line">result:</span><br><span class="line">0x000000000000000000000000000000000000000000000000000000000000000f</span><br><span class="line">DEC:15</span><br></pre></td></tr></table></figure><h3 id="constuint"><a href="#constuint" class="headerlink" title="constuint"></a>constuint</h3><p>Constants(å¸¸æ•¸) ä¸æœƒè¢«å­˜åœ¨storageå…§ï¼Œåªèƒ½å¤ é€écodeä¾†å­˜å–</p><h3 id="index-1-investmentsLimit-investmentsDeadlineTimeStamp"><a href="#index-1-investmentsLimit-investmentsDeadlineTimeStamp" class="headerlink" title="index 1 - investmentsLimit, investmentsDeadlineTimeStamp"></a>index 1 - investmentsLimit, investmentsDeadlineTimeStamp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let index = 1</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">result:</span><br><span class="line"> 0x00000000000000000000000059b92d9a0000000000000000000000000000429f</span><br><span class="line">DEC:  1505308058   and  17055</span><br></pre></td></tr></table></figure><p>åœ¨index 1ä¸­ï¼Œæœƒå°‡2å€‹è®Šæ•¸(investmentsLimit, investmentsDeadlineTimeStamp)åšåˆä½µä¾†æœ€ä½³åŒ–storageçš„å­˜æ”¾</p><h3 id="index-2-string1"><a href="#index-2-string1" class="headerlink" title="index 2 - string1"></a>index 2 - string1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index = 2</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))</span><br><span class="line">result: </span><br><span class="line">0x0000000000000000000000000000000074657374310000000000000000000000</span><br><span class="line">ASCII: test1</span><br></pre></td></tr></table></figure><h3 id="index-3-string2"><a href="#index-3-string2" class="headerlink" title="index 3 - string2"></a>index 3 - string2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index = 3</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))</span><br><span class="line">result:</span><br><span class="line">0x7465737431323336000000000000000000000000000000000000000000000000</span><br><span class="line">ASCII: test1236</span><br></pre></td></tr></table></figure><h3 id="index-4-string3"><a href="#index-4-string3" class="headerlink" title="index 4 - string3"></a>index 4 - string3</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index = 4</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))</span><br><span class="line">result:</span><br><span class="line">0x6c65747320737472696e6720736f6d657468696e67000000000000000000002a</span><br><span class="line">ASCII: lets string something         * (42)</span><br></pre></td></tr></table></figure><p>åœ¨resultæœ€å¾Œæœ‰ 2a(dec42)ç‚º stringå„²å­˜çš„é•·åº¦<br>å¯åƒé–±solidityå®˜æ–¹æ–‡ä»¶æè¿°è®Šæ•¸åœ¨storageä¸­å‘ˆç¾çš„æ ¼å¼ï¼š<a href="https://solidity.readthedocs.io/en/latest/miscellaneous.html#layout-of-state-variables-in-storage" target="_blank" rel="noopener">https://solidity.readthedocs.io/en/latest/miscellaneous.html#layout-of-state-variables-in-storage</a></p><h3 id="index-5-â€”-uints1"><a href="#index-5-â€”-uints1" class="headerlink" title="index 5â€Šâ€”â€Šuints1"></a>index 5â€Šâ€”â€Šuints1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index = 5</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line">result:</span><br><span class="line">0x0000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line">PROBLEM!!!!</span><br></pre></td></tr></table></figure><p>è‹¥é‡åˆ° mapping structå®£å‘Šçš„è®Šæ•¸ï¼Œç„¡æ³•ç›´æ¥é€éä¸€èˆ¬çš„indexä¾†å–å¾—structå…§æ‰€å„²å­˜çš„å€¼ï¼Œå¿…é ˆå¾—æ›‰å¾—å°æ‡‰valueä¸­çš„ <code>key</code>å€¼ï¼Œå¦å‰‡æ˜¯ä¸å¯èƒ½å–å¾—çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* è¦å–å›åœ¨ uints1 structæ‰€å„²å­˜åœ¨addresss1çš„å€¼ :88</span><br><span class="line">// uints1[address1] = 88; </span><br><span class="line"></span><br><span class="line">address1 = 0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">index = &apos;0000000000000000000000000000000000000000000000000000000000000005&apos;</span><br><span class="line"></span><br><span class="line">// convert address1 to the 256 bytes...</span><br><span class="line">key =  &apos;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&apos;</span><br><span class="line"></span><br><span class="line">let newKey =  web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;DEC: &apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x0000000000000000000000000000000000000000000000000000000000000058</span><br><span class="line">DEC: 88</span><br></pre></td></tr></table></figure><h3 id="index6-structs1"><a href="#index6-structs1" class="headerlink" title="index6 - structs1"></a>index6 - structs1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000006&quot;</span><br><span class="line">key =  &quot;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&quot;</span><br><span class="line">let newKey =  web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x6465766963654272616e64000000000000000000000000000000000000000016</span><br><span class="line">ASCII: deviceBrand</span><br></pre></td></tr></table></figure><p>è‹¥è¦è®€å–ä¸‹ä¸€å€‹structçš„å€¼ï¼Œåªéœ€è¦å°‡newKeyçš„å€¼+1å³å¯å–åˆ°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function increaseHexByOne(hex) &#123;</span><br><span class="line"> let x = new BigNumber(hex)</span><br><span class="line"> let sum = x.add(1)</span><br><span class="line"> let result = &apos;0x&apos; + sum.toString(16)</span><br><span class="line"> return result</span><br><span class="line">&#125;</span><br><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000006&quot;</span><br><span class="line">key =  &quot;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&quot;</span><br><span class="line">let newKey =  increaseHexByOne(</span><br><span class="line">  web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress,newKey))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x6465766963655965617200000000000000000000000000000000000000000014</span><br><span class="line">ASCII: deviceYear</span><br></pre></td></tr></table></figure><p>è‹¥é‚„éœ€è¦ç¬¬ä¸‰å€‹ä¹‹å¾Œçš„å€¼ï¼Œç¹¼çºŒå°‡newKeyéå¢ï¼Œå°±èƒ½å¤ å–åˆ°ã€‚</p><h3 id="index-7-uintarray"><a href="#index-7-uintarray" class="headerlink" title="index 7 - uintarray"></a>index 7 - uintarray</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index = &quot;7&quot;</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, index))</span><br><span class="line"></span><br><span class="line">result:</span><br><span class="line">  0x0000000000000000000000000000000000000000000000000000000000000002</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„resultè¡¨ç¤º arrayç›®å‰æœ‰2å€‹å€¼ (8000, 9000)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000007&quot;</span><br><span class="line">let newKey = web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;DEC: &apos; +</span><br><span class="line">  web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x0000000000000000000000000000000000000000000000000000000000001f40</span><br><span class="line">DEC: 8000</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">newKey = increaseHexByOne(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;DEC: &apos; +</span><br><span class="line">  web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x0000000000000000000000000000000000000000000000000000000000002328</span><br><span class="line">DEC: 9000</span><br></pre></td></tr></table></figure><h3 id="index-8-deviceDataArray"><a href="#index-8-deviceDataArray" class="headerlink" title="index 8 - deviceDataArray"></a>index 8 - deviceDataArray</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;</span><br><span class="line">let newKey = web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line"> web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x6465766963654272616e64000000000000000000000000000000000000000016</span><br><span class="line">ASCII: deviceBrand</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;</span><br><span class="line">let newKey = increaseHexByOne(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line">web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x6465766963655965617200000000000000000000000000000000000000000014</span><br><span class="line">ASCII: deviceYear</span><br></pre></td></tr></table></figure><p>ç¹¼çºŒå¢åŠ indexçš„å€¼(+1), result:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;</span><br><span class="line">let newKey = increaseHexByTwo(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))</span><br><span class="line">console.log(web3.eth.getStorageAt(contractAddress, newKey))</span><br><span class="line">console.log(&apos;ASCII: &apos; +</span><br><span class="line">web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))</span><br><span class="line">result:</span><br><span class="line">0x776561724c6576656c0000000000000000000000000000000000000000000012</span><br><span class="line">ASCII: wearLevel</span><br></pre></td></tr></table></figure><p>è‹¥åŠ 3ä¹‹å¾Œï¼Œresultæœƒé¡¯ç¤ºç¬¬äºŒçµ„(dev2) å­˜é€²arrayçš„å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result:</span><br><span class="line">0x6465766963654272616e64320000000000000000000000000000000000000018</span><br><span class="line"></span><br><span class="line">ASCII: deviceBrand2</span><br></pre></td></tr></table></figure><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>How to read Ethereum contract storage - Darius</p><p><a href="https://medium.com/aigang-network/how-to-read-ethereum-contract-storage-44252c8af925" target="_blank" rel="noopener">https://medium.com/aigang-network/how-to-read-ethereum-contract-storage-44252c8af925</a></p>]]></content>
      
      
      <categories>
          
          <category> Solidity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Smart Contract </tag>
            
            <tag> Ethereum </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ</title>
      <link href="/2019/02/05/2019%E5%B9%B4%E7%9A%84%E6%83%B3%E6%B3%95%E8%88%87%E8%A6%8F%E5%8A%83/"/>
      <url>/2019/02/05/2019%E5%B9%B4%E7%9A%84%E6%83%B3%E6%B3%95%E8%88%87%E8%A6%8F%E5%8A%83/</url>
      
        <content type="html"><![CDATA[<p>å‰›å¥½åœ¨è¾²æ›†æ–°å¹´ç¬¬ä¸€å¤©ï¼Œç‚ºè‡ªå·±çš„Blogæ›çš„æ–°çš„Skinï¼Œ<br>åŒæ™‚ä¹Ÿæƒ³å‹‰å‹µè‡ªå·±é‡æ‹¾å¯«éƒ¨è½æ ¼çš„æ‰‹æ„Ÿã€‚</p><a id="more"></a><p>ç”±æ–¼è‡ªå·±æƒ³å¾€å€å¡Šéˆæˆ–æ˜¯é›²ç«¯å¾Œç«¯å·¥ç¨‹å¸«ç™¼å±•ï¼Œ<br>æ‰€ä»¥åœ¨2019å¹´å¸Œæœ›è‡ªå·±èƒ½å¤ å†æ¬¡è¤‡ç¿’ç¶²è·¯ä»¥åŠä½œæ¥­ç³»çµ±ç­‰çŸ¥è­˜ï¼Œ</p><p>ä»¥ä¸Šï¼Œå¸Œæœ›2019å¹´èƒ½å¤ é †åˆ©å®Œæˆè«–æ–‡ï¼Œ<br>ä¸”èƒ½å¤ æ‰¾åˆ°ä¸€ä»½å¥½å·¥ä½œï¼Œä¸¦ä¸”æŒçºŒç²¾é€²è‡ªå·±çš„æŠ€è¡“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mindsets </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go Interfaceä»‹ç´¹</title>
      <link href="/2018/07/05/go-interface/"/>
      <url>/2018/07/05/go-interface/</url>
      
        <content type="html"><![CDATA[<p>ç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­ä¾†èˆ‰ä¾‹ï¼š</p><p>Water-pipelineå°±åƒæ˜¯å€‹interface ä½ å°±åªèƒ½çŒæ¶²é«”é€²å»ï¼Œä¸èƒ½å¡éæ¶²é«”çš„æ±è¥¿åˆ° water-pipeline<br><a id="more"></a><br>å†ç”¨ç«è»Šéµè»Œç‚ºä¾‹ï¼š<br>Railroads æ˜¯train çš„ interfaces ä¸ç®¡trainä¸Šé¢è¼‰çš„ä»€éº¼ç‰©é«”ï¼Œçœ‹æ˜¯passengers é‚„æ˜¯cargos</p><p>ä½†trainçš„å¯¬åº¦ (width of the train) éƒ½å¿…é ˆè¦ç¬¦åˆéµè»Œå¯¬åº¦ã€‚</p><p><br>æ•… railroads çš„ interfacesæœƒæœ‰ä»¥ä¸‹çš„çµ„æˆè¦ç´ ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RailRoadWidthChecker <span class="keyword">interface</span> &#123;</span><br><span class="line">    CheckRailsWidth() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RailRoadWidthChecker è¦ç¯„äº† trainå¿…é ˆè¦å¯¦ä½œæª¢æŸ¥ç«è»Šè‡ªèº«çš„widthï¼Œç¢ºä¿trainçš„widthæ˜¯å‰›å¥½ç¬¦åˆ railroad çš„å¯¬åº¦</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RailRoad <span class="keyword">struct</span> &#123;</span><br><span class="line">    Width <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>// åªæœ‰å®£å‘Šç‚ºtype RailRoadæ‰èƒ½å‘¼å« IsCorrectSizeTrain<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(railroad *RailRoad)</span> <span class="title">IsCorrectSizeTrain</span> <span class="params">(trainInstance RailRoadWidthChecker)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> trainInstance.CheckRailsWidth() == railroad.Width</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">|| ç–‘å•ï¼šç‚ºä½•ä¸æ˜¯åœ¨inputä¸­typeç‚ºTrain ???</span></span><br><span class="line"><span class="string">|| Answer: å› ç‚ºç”±struct typeç‚º Trainå¯¦ä½œäº† struct type: RailRoadWidthCheckçš„CheckRailWidth()çš„æ–¹æ³•</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IsCorrectSizeTrain æœƒæ¥å—äº†ä¸€å€‹æœ‰å¯¦ä½œ interface instanceçš„ç«è»Šï¼Œä¸¦ä¸”å›å‚³è©²ç«è»Šå¯¬åº¦æ˜¯å¦èˆ‡éµè»Œç›¸åŒ</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line"><span class="keyword">type</span> Train <span class="keyword">struct</span> &#123;</span><br><span class="line">    TrainWidth <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®£å‘Šç‚ºTrainçš„struct instance å¯¦ä½œ checkRailsWidth()å‡½å¼ ä¸¦å›å‚³ intå‹æ…‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Train)</span> <span class="title">CheckRailsWidth</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    Return p.TrainWidth</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹ä¾†ç”¨ å…©å°train ä¸€å€‹æœ‰ç¬¦åˆrailroadå¯¬åº¦ ä¸€å€‹å‰‡æ²’ç¬¦åˆå¯¬åº¦ ä¾†ä½œç‚ºç¯„ä¾‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    railroad := RailRoad&#123;Width: <span class="number">10</span>&#125;</span><br><span class="line"></span><br><span class="line">    passengerTrain := Train &#123; TrainWidth: <span class="number">10</span> &#125;</span><br><span class="line">    cargoTrain := Train &#123; TrainWidth: <span class="number">15</span> &#125;</span><br><span class="line">    <span class="comment">// interfaceè¦æ±‚typeç‚ºTrainå¿…é ˆè¦å¯¦ä½œ CheckRailsWidth</span></span><br><span class="line">    canPassengerTrainPass := railroad.IsCorrectSizeTrain(passengerTrain)</span><br><span class="line">    canCargoTrainPass := railroad.IsCorrectSizeTrain(cargoTrain)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(â€œCan passengerTrain pass? :%t \nâ€, canPassengerTrainPass)</span><br><span class="line">    fmt.Printf(â€œCan cargoTrain pass? :%t \nâ€, canCargoTrainPass)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¼¸å‡ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Can passengerTrain pass? :true</span><br><span class="line">Can cargoTrain pass? :false</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠæ¸¬è©¦ç¶²é€£æ¥ï¼šConnect to the Rospen Network</title>
      <link href="/2018/05/13/rospen/"/>
      <url>/2018/05/13/rospen/</url>
      
        <content type="html"><![CDATA[<p>Enviroment: MacOS</p><p>Assume reader has basic understanding of geth and ethereum.</p><a id="more"></a><h2 id="Create-a-Ethereum-Wallet"><a href="#Create-a-Ethereum-Wallet" class="headerlink" title="Create a Ethereum Wallet"></a>Create a Ethereum Wallet</h2><p>We can via <code>myetherwallet</code> to create a wallet.<br><a href="https://www.myetherwallet.com/#generate-wallet" target="_blank" rel="noopener">https://www.myetherwallet.com/#generate-wallet</a></p><p>Record your privakey, pubkey:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private key: a406da76baa7c741ad28bfe87cef2133950d6bb6bcaaf0b1742d93c3bea56bab</span><br><span class="line">public key:  0x2C58e0338435FE91FD2209105EcADebE8aaFCebB</span><br></pre></td></tr></table></figure></p><p>Because we are going to connect the testnet <code>Rospen</code>, we should do some stuffâ€¦</p><ul><li>Get a ether from faucet: </li></ul><p>For simplicity, we just ask someone to send some ether on testnet to us. Please attach your account address to get some ether.</p><p><a href="https://l.facebook.com/l.php?u=http%3A%2F%2Ffaucet.ropsten.be%3A3001%2F&amp;h=ATPjPzMFxxXmP_Egwq9V35ye_LjGOM4A_vzMkbQOdLCN8FYVRgfurVVTwrcuUzqNCMUiXF2C8sUqt241q8nmTJO6hCnY7WhpkV6iUVWxsIqjlALAeEVFv_kH5Q" target="_blank" rel="noopener">https://l.facebook.com/l.php?u=http%3A%2F%2Ffaucet.ropsten.be%3A3001%2F&amp;h=ATPjPzMFxxXmP_Egwq9V35ye_LjGOM4A_vzMkbQOdLCN8FYVRgfurVVTwrcuUzqNCMUiXF2C8sUqt241q8nmTJO6hCnY7WhpkV6iUVWxsIqjlALAeEVFv_kH5Q</a></p><ul><li>Check Tx from <code>Rospen</code> network<br><a href="https://ropsten.etherscan.io/address/0x6508a973F080A9042a29d13925d9DB006f8c2989" target="_blank" rel="noopener">https://ropsten.etherscan.io/address/0x6508a973F080A9042a29d13925d9DB006f8c2989</a></li></ul><p>In serch bar, enter your account address to see whether if the ether is sending to your account or not.</p><h2 id="Start-to-build-a-node-and-synchronize-the-Rospen-network"><a href="#Start-to-build-a-node-and-synchronize-the-Rospen-network" class="headerlink" title="Start to build a node and synchronize the Rospen network."></a>Start to build a node and synchronize the <code>Rospen</code> network.</h2><p><warning> Notice that your geth version should be the latest so that you can sucessfully sync the network.</warning></p><p><code>Current version : Version: 1.8.7-stable</code></p><h3 id="Before-sync-the-node-Put-your-keystore-file-in-the-testnet-document"><a href="#Before-sync-the-node-Put-your-keystore-file-in-the-testnet-document" class="headerlink" title="Before sync the node , Put your keystore file in the testnet document."></a>Before sync the node , Put your keystore file in the testnet document.</h3><p>When you download your keystore file.<br>For example, the filename will be:<br><code>UTC--2018-05-13T04-05-37.569Z--2c58e0338435fe91fd2209105ecadebe8aafcebb</code><br>Copy this file into your testnet key store:<br><code>/User/Library/Ethereum/testnet/keystore</code></p><h3 id="Sync-to-the-Rospen-network"><a href="#Sync-to-the-Rospen-network" class="headerlink" title="Sync to the Rospen network"></a>Sync to the Rospen network</h3><p><a href="https://github.com/ethereum/ropsten" target="_blank" rel="noopener">https://github.com/ethereum/ropsten</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --unlock &lt;account&gt; --testnet --syncmode &quot;full&quot; &quot;enode://20c9ad97c081d63397d7b685a412227a40e23c8bdc6688c6f37e97cfbc22d2b4d1db1510d8f61e6a8866ad7f0e17c02b14182d37ea7c3c8b9c2683aeb6b733a1@52.169.14.227:30303,enode://6ce05930c72abc632c58e2e4324f7c7ea478cec0ed4fa2528982cf34483094e9cbc9216e7aa349691242576d552a2a56aaeae426c5303ded677ce455ba1acd9d@13.84.180.240:30303&quot;</span><br></pre></td></tr></table></figure><p>Threre are some flags:</p><ul><li>â€“unlock <account>: use password to unlock the account.</account></li><li>â€“testnet: connect to the rospen network.</li><li>â€“syncmode â€œfullâ€:  in order to get our balances, we should synchronize whole blocks.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --testnet --fast --bootnodes &quot;enode://20c9ad97c081d63397d7b685a412227a40e23c8bdc6688c6f37e97cfbc22d2b4d1db1510d8f61e6a8866ad7f0e17c02b14182d37ea7c3c8b9c2683aeb6b733a1@52.169.14.227:30303,enode://6ce05930c72abc632c58e2e4324f7c7ea478cec0ed4fa2528982cf34483094e9cbc9216e7aa349691242576d552a2a56aaeae426c5303ded677ce455ba1acd9d@13.84.180.240:30303&quot;</span><br></pre></td></tr></table></figure><p>If we already sync the entire network, we can just use<br><code>--fast --bootnodes</code> to connect testnetâ€¦</p><h3 id="Attach-your-geth"><a href="#Attach-your-geth" class="headerlink" title="Attach your geth"></a>Attach your geth</h3><p>On MacOS (for testnet):</p><p><code>geth attach ipc:/Users/&lt;username&gt;/Library/Ethereum/testnet/geth.ipc</code></p><p>Then, in the console do <code>eth.syncing</code></p><p>you will see those stuff:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; eth.syncing</span><br><span class="line">&#123;</span><br><span class="line">  currentBlock: 542220,</span><br><span class="line">  highestBlock: 3224277,</span><br><span class="line">  knownStates: 0,</span><br><span class="line">  pulledStates: 0,</span><br><span class="line">  startingBlock: 31397</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That means you are sucessfully connecting the testnet.<br>After finish syncing process, you can see there is some ether in your accounts </p><h3 id="Problem-for-connecting-the-ropsten-network"><a href="#Problem-for-connecting-the-ropsten-network" class="headerlink" title="Problem for connecting the ropsten network"></a>Problem for connecting the ropsten network</h3><p><a href="https://stackoverflow.com/questions/49195614/connection-failed-to-ethereum-ropsten-testnet-network" target="_blank" rel="noopener">https://stackoverflow.com/questions/49195614/connection-failed-to-ethereum-ropsten-testnet-network</a></p><h3 id="Deploy-to-rospen-network-toturial"><a href="#Deploy-to-rospen-network-toturial" class="headerlink" title="Deploy to rospen network toturial:"></a>Deploy to rospen network toturial:</h3><p><a href="https://michalzalecki.com/deploying-smart-contracts-with-truffle/" target="_blank" rel="noopener">https://michalzalecki.com/deploying-smart-contracts-with-truffle/</a></p>]]></content>
      
      
      <categories>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goçš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ä»‹ç´¹ Defer, Panicèˆ‡Recover</title>
      <link href="/2018/05/13/go-defer/"/>
      <url>/2018/05/13/go-defer/</url>
      
        <content type="html"><![CDATA[<p>Defer, Paic, Recoveræ˜¯Golang ç”¨ä¾†åšéŒ¯èª¤è™•ç†çš„å¸¸ç”¨å‡½å¼</p><a id="more"></a><h2 id="ä»‹ç´¹"><a href="#ä»‹ç´¹" class="headerlink" title="ä»‹ç´¹"></a>ä»‹ç´¹</h2><h3 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h3><p>ç”¨ä¾†ç™¼å‡ºéŒ¯èª¤è¨Šæ¯ï¼Œä¸¦ä¸­æ–·ä»¥ä¸‹åŸ·è¡Œæµç¨‹</p><h3 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h3><p>å¯å°‡æŸè¨Šæ¯æˆ–æŸåŸ·è¡Œæ–¹æ³•æ¨å»¶å¾Œè‡³ç¨‹å¼çµæŸï¼Œåœ¨åŸ·è¡Œã€‚</p><h3 id="Recover"><a href="#Recover" class="headerlink" title="Recover"></a>Recover</h3><p>åªèƒ½åœ¨Deferä¸­ä½¿ç”¨ï¼Œç”¨ä¾†æ¥æ”¶panicå‚³å…¥çš„åƒæ•¸ï¼Œä¸¦åšæ‰“å°æˆ–å…¶ä»–åŸ·è¡Œã€‚</p><h2 id="ç¯„ä¾‹"><a href="#ç¯„ä¾‹" class="headerlink" title="ç¯„ä¾‹"></a>ç¯„ä¾‹</h2><p>ç”¨ä»¥ä¸‹ä¾‹å­ä¾†çœ‹ Panicã€Recoverèˆ‡Deferçš„ç”¨æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f()</span><br><span class="line">fmt.Println(<span class="string">"Returned normally from f."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// è¢«æ¨å»¶è‡³çµæŸæ‰åŸ·è¡Œï¼Œä¸¦ä¸”recover() æœƒæ¥å—panicæ‰€å‚³éçš„åƒæ•¸</span></span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Recovered in f"</span>, r)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">fmt.Println(<span class="string">"Calling g."</span>)</span><br><span class="line">g(<span class="number">0</span>)</span><br><span class="line">fmt.Println(<span class="string">"Returned normally from g."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">g</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> i &gt; <span class="number">3</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"Panicking!"</span>)</span><br><span class="line"><span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"%v"</span>, i))</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// å°‡ å°å‡ºâ€œDefer in g"é€™æ®µè¨Šæ¯ å»¶å¾Œå°å‡ºï¼Œç›´åˆ°panicè§¸ç™¼æˆ–æ˜¯ç¨‹å¼çµæŸæ‰æœƒè¢«å°å‡ºä¾†</span></span><br><span class="line">        <span class="comment">// å…ˆè¢«deferçš„æœƒæœ€æ™šè¢«å°å‡ºä¾†ï¼Œç‚ºLast in first out !</span></span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">"Defer in g"</span>, i)</span><br><span class="line">fmt.Println(<span class="string">"Printing in g"</span>, i)</span><br><span class="line">g(i + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Calling g.</span><br><span class="line">Printing in g 0</span><br><span class="line">Printing in g 1</span><br><span class="line">Printing in g 2</span><br><span class="line">Printing in g 3</span><br><span class="line">Panicking!</span><br><span class="line">Defer in g 3</span><br><span class="line">Defer in g 2</span><br><span class="line">Defer in g 1</span><br><span class="line">Defer in g 0</span><br><span class="line">Recovered in f 4</span><br><span class="line">Returned normally from f.</span><br></pre></td></tr></table></figure><h2 id="è£œå……"><a href="#è£œå……" class="headerlink" title="è£œå……"></a>è£œå……</h2><p>é€šå¸¸ defer ä¹Ÿæœƒè¢«ç”¨åœ¨ è¦é—œé–‰ä¸€å€‹DBçš„instance</p><p>ä¾‹å¦‚ä»¥ä¸‹ä»¥mongoDBç‚ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"></span><br><span class="line">mongo, err := getMongoSession() <span class="comment">// å›å‚³ä¸€å€‹mongoçš„instance</span></span><br><span class="line">mongo.SetSocketTimeout(<span class="number">1</span> * time.Hour)</span><br><span class="line"><span class="comment">//session.SetSocketTimeout(1 * time.Hour)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">errors := common.Error&#123;</span><br><span class="line">ErrorType:        <span class="number">1</span>,</span><br><span class="line">ErrorDescription: err.Error(),</span><br><span class="line">&#125;</span><br><span class="line">logger.Console().Panic(errors)</span><br><span class="line">logger.File().Error(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°‡é—œé–‰mongoçš„å‹•ä½œæ¨å»¶è‡³ è©²functionåŸ·è¡Œç©returnå¾ŒåŸ·è¡Œ</span></span><br><span class="line"><span class="keyword">defer</span> mongo.Close()</span><br><span class="line"></span><br><span class="line">collection := mongo.DB(dbName).C(collectionName.BsBlocks)</span><br><span class="line">result := []blockStrcut.BlockWithOnlyTxHashesIntNum&#123;&#125;</span><br><span class="line">err = collection.Find(conditions).All(&amp;result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒ"><a href="#åƒè€ƒ" class="headerlink" title="åƒè€ƒ"></a>åƒè€ƒ</h2><p>The Go Blogï¼šDefer, Panic, and Recover<br><a href="https://blog.golang.org/defer-panic-and-recover" target="_blank" rel="noopener">https://blog.golang.org/defer-panic-and-recover</a></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangçš„ç‰¹è‰²ä»‹ç´¹</title>
      <link href="/2018/05/13/go-features/"/>
      <url>/2018/05/13/go-features/</url>
      
        <content type="html"><![CDATA[<p>The benefit of Golang is as follows:</p><a id="more"></a><h3 id="1-Quick-compile-time-than-the-C-C"><a href="#1-Quick-compile-time-than-the-C-C" class="headerlink" title="1. Quick compile time than the C , C++"></a>1. Quick compile time than the C , C++</h3><p> Golang provides lightning-quick compiler by using a smart compiler and simplified dependency resolution algorithm.<br> When build the golang program, the compiler only looks at the libraries that you directly include. (C,C++,JAVA. those programming language will traverse entire dependency chainâ€¦)</p><h3 id="2-Concurrency"><a href="#2-Concurrency" class="headerlink" title="2. Concurrency"></a>2. Concurrency</h3><h4 id="go-routine"><a href="#go-routine" class="headerlink" title="go-routine"></a>go-routine</h4><p>Golang can create <code>go-routine</code>, which is like thread but use far less memory and require less code to use.</p><p>Golang can create many <code>go-routine</code> on a single thread.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">log</span><span class="params">(msg <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    ... some logging code here</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Elsewhere in our code after we've discovered an error.</span></span><br><span class="line"><span class="keyword">go</span> log(<span class="string">"something dire happened"</span>)</span><br></pre></td></tr></table></figure><h4 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h4><p><code>channel</code> are data structure that let you send typed messages between goroutines with sychronization built in.</p><p>Channel can also avoid the share memory problem in concurrency modification problem.</p><p><code>Warning</code>: channel isnâ€™t provide data access protection.</p><h3 id="3-Go-type-system"><a href="#3-Go-type-system" class="headerlink" title="3. Go type system."></a>3. Go type system.</h3><p>Golang provides flexible hierachy-free type free system that enables code reuse with minimal refactoring overhead.</p><p>In tradictional OOD, like JAVA, need to implenment all the method declared in interface.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logout</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>But in golang type system, you only implement the method you would use.<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">   Read(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4-Memory-management"><a href="#4-Memory-management" class="headerlink" title="4. Memory management"></a>4. Memory management</h3><p>Golang has modern <code>garbage collector</code> that does hard work for you.</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ERC Tokenä»‹ç´¹ï¼šERC20 &amp; ERC721</title>
      <link href="/2018/03/25/erctoken/"/>
      <url>/2018/03/25/erctoken/</url>
      
        <content type="html"><![CDATA[<p>å³åˆ©ç”¨ç•¶ä»Šç«ç´…çš„ä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆç´„ï¼Œå¯¦ä½œå‡ºä»£å¹£åŠŸèƒ½ã€‚<br>å¯æ“æœ‰èˆ‡è™›æ“¬è²¨å¹£ä½œç‚ºåƒ¹å€¼å‚³éåŠŸèƒ½ã€‚</p><a id="more"></a><h3 id="å¥½è™•"><a href="#å¥½è™•" class="headerlink" title="å¥½è™•"></a>å¥½è™•</h3><ul><li>ä¸ç”¨è‡ªå·±æ¶è¨­å…¬æœ‰éˆï¼Œå°±å¯ä»¥æ“æœ‰è‡ªå·±ç™¼è¡Œçš„ä»£å¹£</li><li>ä»¥æ—¢å®šåŒ¯ç‡ï¼Œå¯ä»¥ç›´æ¥èˆ‡ä»¥å¤ªå¹£é€²è¡Œäº¤æ›ã€‚</li></ul><h3 id="ç‚ºä½•éœ€è¦ERCæ¨™æº–åˆç´„ï¼Ÿ"><a href="#ç‚ºä½•éœ€è¦ERCæ¨™æº–åˆç´„ï¼Ÿ" class="headerlink" title="ç‚ºä½•éœ€è¦ERCæ¨™æº–åˆç´„ï¼Ÿ"></a>ç‚ºä½•éœ€è¦ERCæ¨™æº–åˆç´„ï¼Ÿ</h3><p>ç”±æ–¼ä»£å¹£æ˜¯å»ºç«‹åœ¨ä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆç´„ï¼Œæ•…å…¶ä»£å¹£ä¹Ÿåªæ˜¯å­˜åœ¨æ™ºèƒ½åˆç´„ä¸Šçš„æŸç­†ç´€éŒ„ã€‚<br>æ•…é€éä¸€äº›ç‹€æ…‹æ”¹è®Šå’Œè½‰ç§»ï¼Œæ•…ERCåˆç´„å¯ä»¥æ˜ç¢ºå®šç¾©æŸå€‹ä»¥å¤ªåŠåœ°å€ä¸Šçš„æŸå€‹ä»£å¹£é¤˜é¡ï¼Œä¸¦å¯ä»¥å°å…¶é€²è¡Œæ“ä½œï¼Œè€Œæ“ä½œçš„è¦ç¯„å°±å®šç¾©åœ¨ERCä¸Šã€‚</p><p>æ•…ä¸€å€‹ä»£å¹£è¦æ“æœ‰åˆç†çš„ç™¼è¡Œæ©Ÿåˆ¶ï¼Œå°±å¾—ç¬¦åˆç¾åœ¨æ‰€æ“æœ‰çš„ERC20ä»¥åŠERC721ä¹‹é¡çš„æ¨™æº–ã€‚</p><h3 id="ERCä»£å¹£æœ‰è‡ªå·±çš„éŒ¢åŒ…å—ï¼Ÿï¼Ÿ"><a href="#ERCä»£å¹£æœ‰è‡ªå·±çš„éŒ¢åŒ…å—ï¼Ÿï¼Ÿ" class="headerlink" title="ERCä»£å¹£æœ‰è‡ªå·±çš„éŒ¢åŒ…å—ï¼Ÿï¼Ÿ"></a>ERCä»£å¹£æœ‰è‡ªå·±çš„éŒ¢åŒ…å—ï¼Ÿï¼Ÿ</h3><p>ç”±æ–¼æ˜¯é€éä»¥å¤ªåŠæ™ºèƒ½åˆç´„æ§åˆ¶çš„ï¼Œæ•…åªè¦é€éä»¥å¤ªåŠéŒ¢åŒ…(åœ°å€)å°±å¯ä»¥äº†ã€‚</p><h2 id="ERC20-ä»‹ç´¹"><a href="#ERC20-ä»‹ç´¹" class="headerlink" title="ERC20 ä»‹ç´¹"></a>ERC20 ä»‹ç´¹</h2><h3 id="è¨˜è¼‰ERC20è¦å‰‡-å®˜æ–¹æ–‡ä»¶"><a href="#è¨˜è¼‰ERC20è¦å‰‡-å®˜æ–¹æ–‡ä»¶" class="headerlink" title="è¨˜è¼‰ERC20è¦å‰‡ å®˜æ–¹æ–‡ä»¶"></a>è¨˜è¼‰ERC20è¦å‰‡ å®˜æ–¹æ–‡ä»¶</h3><p><a href="https://theethereum.wiki/w/index.php/ERC20_Token_Standard" target="_blank" rel="noopener">https://theethereum.wiki/w/index.php/ERC20_Token_Standard</a></p><h3 id="ERC20-Token-Standard-Interface"><a href="#ERC20-Token-Standard-Interface" class="headerlink" title="ERC20 Token Standard Interface"></a>ERC20 Token Standard Interface</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface ERC20 &#123; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">totalSupply</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>); </span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">balanceOf</span>(<span class="params">address tokenOwner</span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint balance</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">allowance</span>(<span class="params">address tokenOwner, address spender</span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint remaining</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">transfer</span>(<span class="params">address to, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">approve</span>(<span class="params">address spender, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">transferFrom</span>(<span class="params">address from, address to, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Transfer</span>(<span class="params">address indexed from, address indexed to, uint tokens</span>); |</span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Approval</span>(<span class="params">address indexed tokenOwner, address indexed spender, uint tokens</span>); </span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„Interfaceå®šç¾©äº†å…­å€‹Functionï¼Œæœ‰InputåŠOutputæ ¼å¼ã€‚<br>ä»¥åŠå…©å€‹Eventï¼Œåƒ…æœ‰Inputã€‚</p><p>å…¶ä¸­Functionç‚ºå¯ä»¥æ“ç¸±æ™ºèƒ½åˆç´„ç‹€æ…‹çš„å‹•ä½œï¼Œæœƒéœ€è¦æ¶ˆè€—Gasï¼Œè€Œå¯ä»¥çœ‹åˆ°æœ‰äº›Functionå¾Œé¢æœ‰ <code>constant</code>é—œéµå­—ï¼Œè¡¨ç¤ºåƒ…åšå”¯ç¨ï¼Œä¸æœƒæ›´æ”¹åˆ°æ™ºèƒ½åˆç´„ä¸Šçš„Stateï¼Œä¸»è¦æ˜¯å›å‚³çš„Stateè³‡è¨Šï¼Œä¸æœƒæ¶ˆè€—åˆ°Gasã€‚</p><p>è€ŒEventç‚ºç´€éŒ„é‡å¤§äº‹ä»¶çš„ç™¼ç”Ÿï¼Œä¾‹å¦‚åœ¨éˆä¸Šé€²è¡ŒTokençš„è½‰ç§»ã€‚</p><h3 id="è¨­å®šERC-Tokenè³‡è¨Š"><a href="#è¨­å®šERC-Tokenè³‡è¨Š" class="headerlink" title="è¨­å®šERC Tokenè³‡è¨Š"></a>è¨­å®šERC Tokenè³‡è¨Š</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string public constant name = <span class="string">"Token Name"</span>; </span><br><span class="line">string public constant symbol = <span class="string">"TKN"</span>; </span><br><span class="line">uint8 public constant decimals = <span class="number">18</span>; <span class="comment">// 18 is the most common number of decimal places</span></span><br></pre></td></tr></table></figure><p>ERC20 éœ€è¦è¨­å®šæ­¤ Token çš„ä¸‰å€‹è³‡è¨Š: nameã€symbolã€decimals</p><ul><li>name æ˜¯ Token çš„åå­—ã€‚</li><li>symbol å‰‡æ˜¯æ­¤ Token æœƒä½¿ç”¨çš„ä»£ç¨±ï¼Œåƒæ˜¯ Binance Token çš„ symbol å°±æ˜¯ BNBï¼Œè€Œæ­¤ symbol ä¹Ÿæœƒå‡ºç¾åœ¨ <a href="https://etherscan.io/" target="_blank" rel="noopener">Etherscan</a>ä¸Šé¢</li><li>decimals æ˜¯ç”¨ä¾†è¨­å®šæ­¤ Token æœ€å°æœƒæœ‰å¹¾å€‹ä½æ•¸ï¼Œé€šå¸¸æœƒè¨­å®šæˆ 18ï¼Œæ„å³æœ€å¤šåˆ°é”å°æ•¸é»å¾Œ 18 ä½æ•¸ï¼Œé€™æ¨£çš„è¨­å®šè·Ÿ Ether æœ¬èº«çš„è¨­å®šä¹Ÿæ˜¯ä¸€æ¨£çš„(1 ether: 10 ^ 18 wei)ã€‚</li></ul><blockquote><p>è£œå……èªªæ˜ï¼šåœ¨ Solidity ä¸­ä¸¦æ²’æœ‰æµ®é»æ•¸çš„å­˜åœ¨ï¼Œæ‰€æœ‰çš„é‹ç®—éƒ½æ˜¯æ•´æ•¸ï¼Œå› æ­¤å¹³å¸¸æˆ‘å€‘æ‰€èªªçš„ 1 Etherï¼Œäº‹å¯¦ä¸Šåœ¨ Solidity ç¨‹å¼ä¸­æ˜¯ä»¥weiçš„å–®ä½(1 ether = 10Â¹â¸)ä¾†æ’°å¯«ã€‚</p></blockquote><h3 id="ERC20-è©³è¿°"><a href="#ERC20-è©³è¿°" class="headerlink" title="ERC20 è©³è¿°"></a>ERC20 è©³è¿°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">contract TokenContractFragment &#123;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// Balances for each account</span></span><br><span class="line">     mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) balances;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">// Owner of account approves the transfer of an amount to another account</span></span><br><span class="line">     mapping(<span class="function"><span class="params">address</span> =&gt;</span> mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256)) allowed;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">// Get the token balance for account \`tokenOwner\`</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address tokenOwner</span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint balance</span>) </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> balances\[tokenOwner\];</span><br><span class="line">     &#125;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">// Transfer the balance from owner's account to another account</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address to, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">         balances\[msg.sender\] = balances\[msg.sender\].sub(tokens);</span><br><span class="line">         balances\[to\] = balances\[to\].add(tokens);</span><br><span class="line">         Transfer(msg.sender, to, tokens);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">// Send \`tokens\` amount of tokens from address \`from\` to address \`to\`</span></span><br><span class="line">     <span class="comment">// The transferFrom method is used for a withdraw workflow, allowing contracts to send</span></span><br><span class="line">     <span class="comment">// tokens on your behalf, for example to "deposit" to a contract address and/or to charge</span></span><br><span class="line">     <span class="comment">// fees in sub-currencies; the command should fail unless the _from account has</span></span><br><span class="line">     <span class="comment">// deliberately authorized the sender of the message via some mechanism; we propose</span></span><br><span class="line">     <span class="comment">// these standardized APIs for approval:</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">transferFrom</span>(<span class="params">address from, address to, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">         balances\[<span class="keyword">from</span>\] = balances\[<span class="keyword">from</span>\].sub(tokens);</span><br><span class="line">         allowed\[<span class="keyword">from</span>\]\[msg.sender\] = allowed\[<span class="keyword">from</span>\]\[msg.sender\].sub(tokens);</span><br><span class="line">         balances\[to\] = balances\[to\].add(tokens);</span><br><span class="line">         Transfer(<span class="keyword">from</span>, to, tokens);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  </span><br><span class="line">     <span class="comment">// Allow \`spender\` to withdraw from your account, multiple times, up to the \`tokens\` amount.</span></span><br><span class="line">     <span class="comment">// If this function is called again it overwrites the current allowance with _value.</span></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address spender, uint tokens</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">         allowed\[msg.sender\]\[spender\] = tokens;</span><br><span class="line">         Approval(msg.sender, spender, tokens);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä¾‹å­"><a href="#ä½¿ç”¨ä¾‹å­" class="headerlink" title="ä½¿ç”¨ä¾‹å­"></a>ä½¿ç”¨ä¾‹å­</h3><h4 id="Token-Balance"><a href="#Token-Balance" class="headerlink" title="Token Balance"></a>Token Balance</h4><p>æˆ‘å€‘å‡è¨­é€™å€‹æ™ºèƒ½åˆç´„ç›®å‰æœ‰å…©å€‹åœ°å€æ“æœ‰è©²Token<br>balances[â€˜0x123456â€™] = 100<br>balances[â€˜0x654321â€™] = 200</p><p>å‰‡ Function balanceOf å‰‡æœƒå›å‚³ä»¥ä¸‹è³‡è¨Š:<br>tokenContract.balanceOf(â€˜0x123456â€™) will return 100<br>tokenContract.balanceOf(â€˜0x654321â€™) will return 200</p><h4 id="Transfer-Token-Balance"><a href="#Transfer-Token-Balance" class="headerlink" title="Transfer Token Balance"></a>Transfer Token Balance</h4><p>å¦‚æœ 0x123456æƒ³è¦è½‰ç§» 10 tokens çµ¦ 0x654321ï¼Œå‰‡å‘¼å«<br>tokenContract.transfer(â€˜0x654321â€™, 10)</p><p>å°‡å¾—åˆ°ä¸‹åˆ—çµæœ<br>balances[â€˜0x123456â€™] = 90<br>balances[â€˜0x654321â€™] = 210</p><h4 id="Approve-And-TransferFrom-Token-Balance"><a href="#Approve-And-TransferFrom-Token-Balance" class="headerlink" title="Approve And TransferFrom Token Balance"></a>Approve And TransferFrom Token Balance</h4><p>å¦‚æœ 0x123456 å…è¨± 0x654321 æ“æœ‰è½‰ç§» 30 tokens çš„æ¬Šåˆ©ï¼Œå‰‡å‘¼å«<br>tokenContract.approve(â€˜0x654321â€™, 30)</p><p>å°‡å¾—åˆ°ä¸‹åˆ—çµæœ<br>tokenContract.allowed[â€˜0x123456â€™][â€˜0x654321â€™] = 30</p><p>å¦‚æœæ­¤æ™‚â€™0x654321â€™ æƒ³è¦è½‰ç§» â€˜0x123456â€™ çš„ 20 tokens çµ¦è‡ªå·±ï¼Œå‰‡å‘¼å«<br>â€˜tokenContract.transferFrom(â€˜0x123456â€™, â€˜0x654321â€™, 20)</p><p>å°‡å¾—åˆ°ä¸‹åˆ—çµæœ<br>tokenContract.balances[â€˜0x123456â€™] = 70<br>tokenContract.balances[â€˜0x654321â€™] = 230<br>tokenContract.allowed[â€˜0x123456â€™][â€˜0x654321â€™] = 10</p><h2 id="ERC721-ä»‹ç´¹"><a href="#ERC721-ä»‹ç´¹" class="headerlink" title="ERC721 ä»‹ç´¹"></a>ERC721 ä»‹ç´¹</h2><p>ERC-721 æ˜¯ç”¨æ¥å®šç¾© Non-fungible token (ä¸å¯æ›¿ä»£çš„ä»£å¹£)ã€‚<br>æ¯å€‹ä»£å¹£æ˜¯å”¯ä¸€çš„(unique)ï¼Œå…·ä¸å¯åˆ†å‰²æ€§ï¼Œä¸åƒERC20 æ¯å€‹tokenéƒ½ç›¸åŒã€‚</p><p>å…·é«”æ‡‰ç”¨: <a href="https://www.cryptokitties.co/" target="_blank" rel="noopener">ä»¥å¤ªè²“(cryptokitties)</a><br>æ¯å€‹ä»¥å¤ªè²“ï¼Œéƒ½æ˜¯ä¸€å€‹ERC721ä»£å¹£ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface ERC721 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">supportsInterface</span>(<span class="params">bytes4 _interfaceID</span>) <span class="title">external</span> <span class="title">pure</span> <span class="title">returns</span> (<span class="params">bool</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 \_deedId</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address \_owner</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">countOfDeeds</span>(<span class="params"></span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _count</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">countOfDeedsByOwner</span>(<span class="params">address \_owner</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 \_count</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">deedOfOwnerByIndex</span>(<span class="params">address \_owner, uint256 \_index</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _deedId</span>);</span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Transfer</span>(<span class="params">address indexed from, address indexed to, uint256 indexed deedId</span>);</span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Approval</span>(<span class="params">address indexed owner, address indexed approved, uint256 indexed deedId</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">approve</span>(<span class="params">address \_to, uint256 \_deedId</span>) <span class="title">external</span> <span class="title">payable</span>;</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _deedId</span>) <span class="title">external</span> <span class="title">payable</span>;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒè³‡æ–™"><a href="#åƒè€ƒè³‡æ–™" class="headerlink" title="åƒè€ƒè³‡æ–™"></a>åƒè€ƒè³‡æ–™</h2><ul><li><p>ERC20 Token Standard<br><a href="https://theethereum.wiki/w/index.php/ERC20_Token_Standard" target="_blank" rel="noopener">https://theethereum.wiki/w/index.php/ERC20_Token_Standard</a></p></li><li><p>è¯·é—®ä»¥å¤ªåŠé‡Œçš„ERC-721å’ŒERC-20æ˜¯ä»€ä¹ˆï¼Ÿ<br><a href="http://www.blockchainbrother.com/question/510" target="_blank" rel="noopener">http://www.blockchainbrother.com/question/510</a></p></li><li><p>What has ERC-721  better than ERC-20?<br><a href="https://medium.com/@PatrickGohBS/ethereum-erc-721-vs-erc-20-4bff8c147fdf" target="_blank" rel="noopener">https://medium.com/@PatrickGohBS/ethereum-erc-721-vs-erc-20-4bff8c147fdf</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Solidity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goä½¿ç”¨Arrayã€Sliceèˆ‡Mapçš„ä»‹ç´¹</title>
      <link href="/2018/03/18/go-array-slice-map/"/>
      <url>/2018/03/18/go-array-slice-map/</url>
      
        <content type="html"><![CDATA[<p>é€™ç¯‡ä¸»è¦ä»‹ç´¹å¦‚ä½•åœ¨Golangåº•ä¸‹ä½¿ç”¨Array, Slice, Mapç­‰æ“ä½œæŠ€å·§</p><a id="more"></a><h2 id="arrayç”¨æ³•"><a href="#arrayç”¨æ³•" class="headerlink" title="arrayç”¨æ³•"></a>arrayç”¨æ³•</h2><h3 id="å®£å‘Š"><a href="#å®£å‘Š" class="headerlink" title="å®£å‘Š"></a>å®£å‘Š</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line">fmt.Println(<span class="string">"array arr:"</span>, a)</span><br></pre></td></tr></table></figure><h3 id="æˆ–æ˜¯ç”¨-make"><a href="#æˆ–æ˜¯ç”¨-make" class="headerlink" title="æˆ–æ˜¯ç”¨ make"></a>æˆ–æ˜¯ç”¨ make</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr := <span class="built_in">make</span>([]<span class="keyword">int64</span>,<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="å‹•æ…‹åˆ†é…é™£åˆ—"><a href="#å‹•æ…‹åˆ†é…é™£åˆ—" class="headerlink" title="å‹•æ…‹åˆ†é…é™£åˆ—"></a>å‹•æ…‹åˆ†é…é™£åˆ—</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr=<span class="built_in">make</span>([][]<span class="keyword">int64</span>,<span class="number">10</span>) <span class="comment">//å¤–å±¤æœ‰10æ ¼</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">    arr[i]=<span class="built_in">make</span>([]<span class="keyword">int64</span>,i) <span class="comment">//å‹•æ…‹åˆ†è£¡é¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éæ­·array"><a href="#éæ­·array" class="headerlink" title="éæ­·array"></a>éæ­·array</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt;<span class="built_in">len</span>(a); i++ &#123; </span><br><span class="line">    fmt.Println(<span class="string">"arr["</span>, i, <span class="string">"] ="</span>, a[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”¨range, ç¬¬ä¸€å€‹å€¼ keyç‚ºç´¢å¼•ï¼Œvalueç‚ºç´¢å¼•çš„å€¼</span></span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> arr &#123; </span><br><span class="line">    fmt.Println(<span class="string">"arr["</span>, i, <span class="string">"] ="</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sliceç”¨æ³•"><a href="#sliceç”¨æ³•" class="headerlink" title="sliceç”¨æ³•"></a>sliceç”¨æ³•</h2><h3 id="é€éarrayå‰µé€ "><a href="#é€éarrayå‰µé€ " class="headerlink" title="é€éarrayå‰µé€ "></a>é€éarrayå‰µé€ </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray [<span class="number">10</span>]<span class="keyword">int</span> = [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;</span><br><span class="line"><span class="keyword">var</span> mySlice []<span class="keyword">int</span> = myArray[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure><h3 id="æˆ–æ˜¯åˆ©ç”¨-make"><a href="#æˆ–æ˜¯åˆ©ç”¨-make" class="headerlink" title="æˆ–æ˜¯åˆ©ç”¨ make"></a>æˆ–æ˜¯åˆ©ç”¨ <code>make</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make([]T, length, capacity)</span></span><br><span class="line"><span class="comment">// å‰µå»ºé•·åº¦ç‚º5ï¼Œå®¹é‡ç‚º10çš„åˆ‡ç‰‡</span></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// å‰µå»ºé•·åº¦ç‚º5ï¼Œä¸¦åˆå§‹åŒ–è©²åˆ‡ç‰‡</span></span><br><span class="line">slice2 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><p>è¨»ï¼š makeçš„capacityè‹¥æ²’æœ‰è¨­ç½®æœƒé è¨­è·Ÿlengthä¸€æ¨£ï¼Œç‚ºsliceæœ€å¤§é•·åº¦ä¹‹ä¸Šé™ã€‚</p><h3 id="åˆ‡ç‰‡é•·åº¦å¯é€éappendä¾†å¢åŠ "><a href="#åˆ‡ç‰‡é•·åº¦å¯é€éappendä¾†å¢åŠ " class="headerlink" title="åˆ‡ç‰‡é•·åº¦å¯é€éappendä¾†å¢åŠ "></a>åˆ‡ç‰‡é•·åº¦å¯é€éappendä¾†å¢åŠ </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨slice2 å¢åŠ 6</span></span><br><span class="line">slice2 = <span class="built_in">append</span>(slice2, <span class="number">6</span>)</span><br><span class="line">fmt.Println(<span class="string">"slice:"</span>, slice2)</span><br><span class="line"><span class="comment">// slice: 1 2 3 4 5 6</span></span><br></pre></td></tr></table></figure><h2 id="Array-å’Œ-Sliceå·®ç•°"><a href="#Array-å’Œ-Sliceå·®ç•°" class="headerlink" title="Array å’Œ Sliceå·®ç•°"></a>Array å’Œ Sliceå·®ç•°</h2><table><thead><tr><th>array</th><th>slice</th></tr></thead><tbody><tr><td>é•·åº¦å®£å‘Šå¾Œä¸å¯ä»¥è®Šå‹•</td><td>é•·åº¦å¯ä»¥é€éappend()æˆ–slice[:]åšè®Šå‹•</td></tr><tr><td>X</td><td>sliceç‚ºarrayçš„æŒ‡æ¨™ï¼Œè‹¥æ›´å‹•sliceï¼Œä¹Ÿæœƒæ›´å‹•åˆ°åŸæœ¬arrayçš„å…§å®¹</td></tr></tbody></table><h3 id="å¦‚ä½•é¿å…Sliceæ›´å‹•åˆ°åŸæœ¬Array"><a href="#å¦‚ä½•é¿å…Sliceæ›´å‹•åˆ°åŸæœ¬Array" class="headerlink" title="å¦‚ä½•é¿å…Sliceæ›´å‹•åˆ°åŸæœ¬Array?"></a>å¦‚ä½•é¿å…Sliceæ›´å‹•åˆ°åŸæœ¬Array?</h3><h4 id="Method1-make-and-Copy"><a href="#Method1-make-and-Copy" class="headerlink" title="Method1 - make and Copy"></a>Method1 - <code>make</code> and <code>Copy</code></h4><p>å…ˆé–‹ä¸€å€‹æ–°çš„ç©ºé–“ï¼Œç”¨makeé–‹å¥½ï¼Œç”¨copyæ‹·è²éå»<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr:=[]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">newSlice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(arr))</span><br><span class="line"><span class="built_in">copy</span>(newSlice, arr)</span><br></pre></td></tr></table></figure></p><h4 id="Method2-Append"><a href="#Method2-Append" class="headerlink" title="Method2 - Append"></a>Method2 - Append</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr:=[]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">newSlice = <span class="built_in">append</span>([]<span class="keyword">int64</span>(<span class="literal">nil</span>), arr[<span class="number">1</span>:<span class="number">3</span>]...) <span class="comment">//ä¸€å®šè¦ã€Œâ€¦ã€</span></span><br></pre></td></tr></table></figure><h2 id="Mapç”¨æ³•"><a href="#Mapç”¨æ³•" class="headerlink" title="Mapç”¨æ³•"></a>Mapç”¨æ³•</h2><p>å»ºç«‹ä¸€å€‹ map å…©ç¨®æ–¹å¼:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="comment">// m["age"] = 16</span></span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å›å‚³å€¼, å’Œ map æ˜¯å¦å­˜åœ¨<br>å¦‚æœæ˜¯ä¸å­˜åœ¨çš„ key , value = 0 , ok = false<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value , ok := m[<span class="string">"age"</span>]</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨ range å–å¾— map ä¸­æ‰€æœ‰çš„ key å’Œ value, ä¸¦åˆ—å°<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> m &#123;</span><br><span class="line">            fmt.Println(<span class="string">"Key:"</span>, key, <span class="string">"Value:"</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€æ¬¡å®£å‘Šå¤šå€¼<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">       <span class="string">"age"</span> : <span class="number">16</span>,</span><br><span class="line">       <span class="string">"height"</span> : <span class="number">180</span>,</span><br><span class="line">       <span class="string">"weight"</span> : <span class="number">6</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Golang å…©ä¸‰äº‹<br><a href="http://daniel0076.logdown.com/posts/280719-golang-slice-notes" target="_blank" rel="noopener">http://daniel0076.logdown.com/posts/280719-golang-slice-notes</a><br>Golang slice trick<br><a href="https://github.com/golang/go/wiki/SliceTricks" target="_blank" rel="noopener">https://github.com/golang/go/wiki/SliceTricks</a></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†æ•£å¼ç³»çµ±å…±è­˜ç®—æ³•ç­†è¨˜ï¼šPaxoså’ŒRaft</title>
      <link href="/2018/03/11/consensusAlgo/"/>
      <url>/2018/03/11/consensusAlgo/</url>
      
        <content type="html"><![CDATA[<h2 id="Paxosä»‹ç´¹"><a href="#Paxosä»‹ç´¹" class="headerlink" title="Paxosä»‹ç´¹"></a>Paxosä»‹ç´¹</h2><p>åˆ†å¸ƒå¼ç³»çµ±ä¸­ï¼Œåªæœ‰å‡ºç¾æ•…éšœç¯€é»(fault node),ä½†ä¸å­˜åœ¨æƒ¡æ„ç¯€é»(corrupt node)ä¸‹é”æˆå…±è­˜çš„å•é¡Œã€‚</p><a id="more"></a><h3 id="å•é¡Œèµ·æº"><a href="#å•é¡Œèµ·æº" class="headerlink" title="å•é¡Œèµ·æº"></a>å•é¡Œèµ·æº</h3><p>æ•…äº‹èƒŒæ™¯ç‚ºå¤å¸Œè‡˜çš„Paxonå³¶ä¸Šæœ‰è«¸ä½æ³•å®˜è¦å°æŸä¸€ä»¶æ³•æ¡ˆé€²è¡Œè£æ±ºä¸¦å¦‚ä½•é”æˆå…±è­˜çš„çµæœã€‚</p><p>éç¨‹ä¸­æ³•å®˜æœƒé€éå‚³è¨Šé—œå‚³éè¨Šæ¯ï¼Œä½†æ³•å®˜å¯èƒ½ä¸­é€”é›¢å¸­ï¼Œè€Œæœå‹™å“¡å¯èƒ½å·æ‡¶ç¡è¦ºã€‚</p><p>æ•…Paxosç®—æ³•åŸºæ–¼<span style="color:red">â€œå…©éšæ®µæäº¤â€</span>ä¾†ç¢ºä¿æ³•å®˜å€‘å¯ä»¥å¾—åˆ°å…±è­˜çµæœçš„ä¸€è‡´æ€§ã€‚</p><h3 id="Paxosç‰¹æ€§"><a href="#Paxosç‰¹æ€§" class="headerlink" title="Paxosç‰¹æ€§"></a>Paxosç‰¹æ€§</h3><p>Paxoså°‡åƒèˆ‡ç¯€é»ä¸­åˆ†ç‚ºä¸‰é¡ï¼š</p><ul><li>Proposer(å®¢æˆ¶ç«¯): æå‡ºä¸€å€‹æ¡ˆå­ï¼Œç­‰å¾…å¤§å®¶æ‰¹å‡†ä¸¦å¾—åˆ°ç­”æ¡ˆã€‚</li><li>Acceptor(æœå‹™ç«¯): æ¥å—ææ¡ˆï¼Œä¸¦é€²è¡ŒæŠ•ç¥¨ã€‚</li><li>Learner(å®¢æˆ¶ç«¯oræœå‹™ç«¯): è¢«å‘ŠçŸ¥ææ¡ˆçµæœï¼Œä¸¦å°‡è‡ªå·±çš„ç‹€æ…‹èˆ‡çµæœæ›´æ–°ã€‚</li></ul><p>éç¨‹ä¸­å¿…é ˆæ»¿è¶³åˆ†æ•£å¼ç³»çµ±å…±è­˜æ‰€å¿…é ˆçš„å…©ç‰¹æ€§ï¼š</p><ol><li>Saftyï¼šä¿è­‰æ±ºè­°çµæœæ˜¯å°çš„ï¼Œç„¡ç•°è­°ï¼Œä¸¦ä¸æœƒå‡ºç¾éŒ¯èª¤æƒ…æ³ã€‚</li><li>Livenessï¼šä¿è­‰åœ¨â€æœ‰é™â€æ™‚é–“å…§å®Œæˆå…±è­˜çµæœã€‚</li></ol><h3 id="Paxoséç¨‹"><a href="#Paxoséç¨‹" class="headerlink" title="Paxoséç¨‹"></a>Paxoséç¨‹</h3><ol><li>ç”±Proposeræå‡ºææ¡ˆï¼Œçˆ­å–Acceptorsçš„æ”¯æŒã€‚</li><li>è¶…éä¸€åŠçš„Acceptorsæ”¯æŒï¼Œå‰‡ç™¼é€è©²ææ¡ˆçµæœçµ¦æ‰€æœ‰äººé€²è¡Œç¢ºèªã€‚</li></ol><h3 id="å…©éšæ®µæç¹³"><a href="#å…©éšæ®µæç¹³" class="headerlink" title="å…©éšæ®µæç¹³"></a>å…©éšæ®µæç¹³</h3><h4 id="Step-1-Prepareéšæ®µ"><a href="#Step-1-Prepareéšæ®µ" class="headerlink" title="Step 1: Prepareéšæ®µ"></a>Step 1: Prepareéšæ®µ</h4><ul><li>Proposerç™¼é€è‡ªå·±çš„è¨ˆç•«çµ¦å¤šå€‹Acceptors.</li><li>Acceptoræ ¹æ“šè©²è¨ˆç•«çš„ç·¨è™Ÿï¼Œè‹¥æ˜¯æœ€æ–°çš„ç·¨è™Ÿå‰‡ä¿ç•™ï¼Œåä¹‹å‰‡é€€å›ã€‚</li></ul><h4 id="Step-2-Commitéšæ®µ"><a href="#Step-2-Commitéšæ®µ" class="headerlink" title="Step 2: Commitéšæ®µ"></a>Step 2: Commitéšæ®µ</h4><ul><li>Proposeræ”¶åˆ°Accpetorçš„ç¢ºèªå›è¦†ã€‚è‹¥æ”¶åˆ°çš„å›è¦†ä¸­ä¸å¸¶æœ‰æ–°çš„ææ¡ˆè«‹æ±‚ï¼Œè¡¨ç¤ºé–å®šæˆåŠŸã€‚</li><li>è‹¥æ²’æœ‰æ”¶åˆ°è¶…é1/2å€‹Accpetorçš„å›è¦†ã€‚</li></ul><h4 id="ç‰¹æ®Šæƒ…æ³"><a href="#ç‰¹æ®Šæƒ…æ³" class="headerlink" title="ç‰¹æ®Šæƒ…æ³"></a>ç‰¹æ®Šæƒ…æ³</h4><ul><li>è‹¥Proposeråœ¨ææ¡ˆéç¨‹ä¸­ç™¼ç”Ÿæ•…éšœï¼Œå¯ä»¥é€éè¶…æ™‚æ©Ÿåˆ¶ç¥¨é¸ä¸‹ä¸€ä½Proposerã€‚</li><li>Paxosç®—æ³•ä¿è­‰åœ¨æ­£å¸¸ç¯€é»æœ‰ 1/2å€‹ä»¥ä¸Šæ™‚ï¼Œå¯æ»¿è¶³å…±è­˜çš„Safetyå’ŒLiveness.</li></ul><h2 id="Raftä»‹ç´¹"><a href="#Raftä»‹ç´¹" class="headerlink" title="Raftä»‹ç´¹"></a>Raftä»‹ç´¹</h2><p>ç‚ºPaxosçš„ç°¡åŒ–ç‰ˆæœ¬ã€‚</p><h3 id="åƒèˆ‡è€…"><a href="#åƒèˆ‡è€…" class="headerlink" title="åƒèˆ‡è€…"></a>åƒèˆ‡è€…</h3><p>åŒ…æ‹¬ä¸‰ç¨®è§’è‰²ï¼š 1.Leader 2.Candidate 3.Follower</p><h3 id="å…±è­˜æµç¨‹"><a href="#å…±è­˜æµç¨‹" class="headerlink" title="å…±è­˜æµç¨‹"></a>å…±è­˜æµç¨‹</h3><ul><li>Leaderé¸èˆ‰ï¼šæ¯å€‹Candidateåœ¨ä¸€å®šæ™‚é–“å…§æœƒæå‡ºé¸èˆ‰æ–¹æ¡ˆï¼Œè€Œé¸èˆ‰çµæœçš„é‚£ä½æˆç‚ºLeader.</li><li>åŒæ­¥æ¯å€‹Replicationçš„Log: Leaderæœƒæ‰¾åˆ°ç³»çµ±ä¸­çš„Logæª”æ¡ˆä¸Šæœ€æ–°çš„ç´€éŒ„ï¼Œä¸¦è¦æ±‚æ‰€æœ‰Followeræ ¹æ“šè©²æœ€æ–°ç´€éŒ„åŒæ­¥åˆ°ä»–å€‘è‡ªå·±çš„Logæª”æ¡ˆä¸Šã€‚</li></ul><p>logæª”å¯èƒ½ç‚ºç³»çµ±ä¸Šç™¼ç”Ÿçš„å‹•ä½œç´€éŒ„ã€‚</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/26868753548/in/dateposted-public/" title="Raft_consense" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4774/26868753548_176bc63750_o.png" width="2240" alt="Raft_consense"></a></p><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>Paxoså’ŒRaftç‚ºç›®å‰åˆ†æ•£å¼ç³»çµ±çš„å¸¶ä¾†ä¸éŒ¯çš„å…±è­˜çµæœï¼Œå…¶ä»–å…±è­˜æ¼”ç®—æ³•åƒæ˜¯PBFT (practical byzantine fault tolerant protocal)ä»¥åŠç›®å‰ç”±Amisåœ˜éšŠæ‰€æ–¼etherumä¸Šæ‰€å¯¦ç¾çš„BFTç®—æ³•- Istanbul BFTï¼Œéƒ½ç®—æ˜¯æœ¬æ¬¡ç­†è¨˜æåˆ°çš„å†é€²éšçš„å…±è­˜ç®—æ³•ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åœ¨åˆ°ä»¥ä¸‹é€£çµå»æ·±å…¥ç­è§£ã€‚</p><p><a href="https://www.slideshare.net/YuTeLin1/istanbul-bft" target="_blank" rel="noopener">Istanbul BFT - AMIS</a></p><p><a href="https://www.slideshare.net/WilliamLin23/pbft-90300607" target="_blank" rel="noopener">PBFT Introduction</a></p>]]></content>
      
      
      <categories>
          
          <category> Consensus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Consensus </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascriptç­†è¨˜:Closure(é–‰åŒ…)æ¦‚å¿µ</title>
      <link href="/2017/09/13/javascript-closure/"/>
      <url>/2017/09/13/javascript-closure/</url>
      
        <content type="html"><![CDATA[<p>é–‰åŒ…ï¼ˆclosure): ç‚ºä¸€å€‹functionåŒ…åœ¨æŸä¸€å€‹å‡½å¼å…§ï¼Œç”¨returnä¾†å–å¾—å…§éƒ¨functionçš„å›å‚³å€¼</p><p>Closure are commonly used to give objects data privacy.</p><a id="more"></a><h2 id="ç‚ºä»€éº¼è¦æœ‰é–‰åŒ…ï¼Ÿï¼Ÿ"><a href="#ç‚ºä»€éº¼è¦æœ‰é–‰åŒ…ï¼Ÿï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼è¦æœ‰é–‰åŒ…ï¼Ÿï¼Ÿ"></a>ç‚ºä»€éº¼è¦æœ‰é–‰åŒ…ï¼Ÿï¼Ÿ</h2><p>å› ç‚ºæœ‰ä»¥ä¸‹å•é¡Œ<br>ã„§ã€Counter dilemma<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    counter += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add();</span><br><span class="line">add();</span><br><span class="line">add();</span><br><span class="line"></span><br><span class="line"><span class="comment">// the counter is now equal to 3</span></span><br></pre></td></tr></table></figure></p><p>counterè¢«æ”¹è®Šæˆ3ã€ä¸éä¹Ÿå¯ä»¥ä¸ç”¨é€éadd()ç›´æ¥æ›´æ”¹counterçš„å€¼ã€‚<br>é‚£é€™æ¨£æœƒé€ æˆè®Šæ•¸æ±¡æŸ“è¡çªã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">    counter += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add();</span><br><span class="line">add();</span><br><span class="line">add();</span><br></pre></td></tr></table></figure><p>counterè¢«å®£å‘Šåœ¨add()å…§ï¼Œç‚ºlocal variableï¼Œä¸æœƒè¢«å…¶ä»–functionæˆ–globalæ”¹å¯«ã€‚<br>ä½†æœƒæœ‰é‡è¤‡å‘¼å«add()å¾Œç„¡æ³•ä½¿counterå€¼åšç´¯åŠ çš„å‹•ä½œã€‚<br><span style="color:red">(å› ç‚ºvar counterä½¿è®Šæ•¸é‡è¤‡è¢«å®šç¾©)ã€‚</span></p><p>äºŒã€è§£æ±ºæ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params"></span>) </span>&#123;counter += <span class="number">1</span>;&#125;</span><br><span class="line">    plus();    </span><br><span class="line">    <span class="keyword">return</span> counter; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éå…§éƒ¨pluså‡½å¼æ‰èƒ½æ›´æ”¹counterå€¼ã€è§£æ±ºcounter dilemmaå•é¡Œï¼Œä¸éé‚„æœƒé‡åˆ°var counteré‡è¤‡å®£å‘Šçš„å•é¡Œï¼Œé€™æ™‚å€™å°±å¾—ç”¨é–‰åŒ…çš„æŠ€å·§ï¼å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> add = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="keyword">return</span> counter += <span class="number">1</span>;&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">add();</span><br><span class="line">add();</span><br><span class="line">add();</span><br><span class="line"></span><br><span class="line"><span class="comment">// the counter is now 3</span></span><br></pre></td></tr></table></figure><p>å°‡addè®Šæ•¸å®£å‘Šæˆ self-invoking function(åƒ…åŸ·è¡Œå…§éƒ¨ä¸€æ¬¡ var counterä¸æœƒåœ¨add()ç¬¬äºŒæ¬¡è¢«å‘¼å«æ™‚å†æ¬¡è¢«å®£å‘Š)ï¼Œç„¶å¾Œå›å‚³function expressionï¼Œå¦‚æ­¤ä¸€ä¾†addè®Šæ•¸å°±è®Šæˆ add() functionäº†ï¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) ***</span>&#123;<span class="keyword">return</span> counter += <span class="number">1</span>;***&#125;</span><br></pre></td></tr></table></figure><p>å°±è¢«åŒ…åœ¨add()å‡½å¼å…§ï¼Œç›´æ¥å‘¼å«add() å°±åªæœƒè·‘ä¸Šé¢*çš„éƒ¨åˆ†ã€‚</p><p>ä»¥ä¸Šåšæ³•å³ç‚ºclosureé–‰åŒ…ï¼Œä½¿å¾—è®Šæ•¸ä¸æœƒè¢«æ±¡æŸ“å’Œè¡çªã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascriptç­†è¨˜:ä½¿ç”¨prototype chain(åŸå‹éŠ)ä¾†é”æˆç¹¼æ‰¿æ•ˆæœ</title>
      <link href="/2017/09/13/javascript-prototypechain/"/>
      <url>/2017/09/13/javascript-prototypechain/</url>
      
        <content type="html"><![CDATA[<p>å…ˆçŸ¥é“å€‹keywordï¼š</p><ul><li><code>__proto__</code>ï¼š javascriptè‡ªå·±å®šç¾©çš„è®Šæ•¸ï¼Œç”¨ä¾†å¯¦ç¾inheritanceæ•ˆæœï¼Œæœ‰é»é¡ä¼¼åƒlink list <code>node</code>çš„æ¦‚å¿µï¼Œé€£çµå…¶ä»–çš„ prototype</li></ul><a id="more"></a><p>javascriptè¨˜æ†¶é«”ç®¡ç†çš„é…ç½®ï¼š</p><ul><li><code>class</code>å„²å­˜åœ¨ globalåº•ä¸‹</li><li>classçš„<code>prototype</code>æ”¾ç½®åœ¨heap ï¼ˆå³classåº•ä¸‹çš„å„ç¨®variableå’Œfunction)</li><li><code>instance</code>ï¼ˆex var b = new B()) çš„bå„²å­˜åœ¨ callstack(è¨˜æ†¶é«”RAMè£¡é¢)</li></ul><p><code>slogan</code>:åœ¨è‡ªå·±çš„scopeè£¡é¢æ‰¾ä¸åˆ°è¦çš„å‡½å¼æˆ–è®Šæ•¸å°±è·Ÿè‡ªå·±çš„<code>__proto__</code>è¦ï¼</p><p>ç¹¼æ‰¿ç¯„ä¾‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Car = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//constructor</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.brand = <span class="string">"default"</span>;</span><br><span class="line">  <span class="keyword">var</span> _wheels</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// private method</span></span><br><span class="line">  <span class="keyword">var</span> initialWheels = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    _wheels = <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.getNumberofWheel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.brand;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Benz = <span class="function"><span class="keyword">function</span>(<span class="params">brandName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//constructor</span></span><br><span class="line">  Car.apply(<span class="keyword">this</span>, argument)  <span class="comment">//ç­‰æ–¼å‘¼å« super(args);</span></span><br><span class="line">  <span class="comment">//argumentç‚º var Benz = function(args...); çš„ argså€‘ = [brandName, wheel]</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é€™ä¸€è¡Œå°±æ˜¯æŠŠ Benz.prototype.__proto__ = Car.prototypeæ¥èµ·ä¾†;</span></span><br><span class="line">  <span class="comment">// å³Benz class inheritance Car</span></span><br><span class="line">  <span class="comment">// ç–‘å•ï¼šä¸Šé¢æ•˜è¿°éœ€å’ŒBenç¢ºèªä¸€ä¸‹ é‚£é€™æ¨£ç‚ºä»€éº¼ä¸‹é¢åˆå¾—è‡ªå·±åšBenz.prototype = Object.create(Car.prototype) ??</span></span><br><span class="line">  <span class="comment">// è§£ç­”ï¼šè‹¥æ²’æœ‰åšCar.apply (å³super()) å‹•ä½œï¼Œé€™æ¨£å­é¡åˆ¥æœƒç„¡æ³•å°‡æ¥å—çš„argumentså‚³éçµ¦å¾parentè¤‡è£½éä¾†çš„å‡½å¼</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.brand = brandName; <span class="comment">//åˆå§‹åŒ–è»Šå“ç‰Œçš„åç¨±</span></span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// javascript ES5å¾—è‡ªå·±ç¶å®šç¹¼æ‰¿é—œä¿‚ï¼Œç”¨__proto__é€™å€‹keyword</span></span><br><span class="line"><span class="comment">// å»ºç«‹çˆ¶é¡åˆ¥å¯¦é«” è¨­å®šç¹¼æ‰¿é—œä¿‚:</span></span><br><span class="line"></span><br><span class="line">Benz.prototype = <span class="built_in">Object</span>.create(Car.prototype)  </span><br><span class="line"><span class="comment">//ä¸Šé¢å³æ˜¯åšäº†Benz.prototype.__proto__ = Car.prototype</span></span><br><span class="line"><span class="comment">//ä½¿Benz classç¹¼æ‰¿Car class(Benz extends Car)</span></span><br><span class="line"></span><br><span class="line">Benz.prototype.constructor = Benz</span><br><span class="line"><span class="comment">//Benzçš„constructoræŒ‡å‘Benz class</span></span><br><span class="line"><span class="comment">//å°‡Benzçš„constructorç¶å®šåˆ°è‡ªå·±èº«ä¸Šï¼Œ</span></span><br><span class="line"><span class="comment">//æ‰èƒ½åœ¨Benz newå‡ºä¸€å€‹ç‰©ä»¶æ™‚ä½œåˆå§‹åŒ–å‹•ä½œï¼ˆå³å‘¼å«Benz =functionå‡½å¼&#123;&#125;) </span></span><br><span class="line"><span class="comment">//var benz = new Benz("Benz") åˆå§‹åŒ–è©²è»Šå­åç¨±ï¼š"Benz"; </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> benz = <span class="keyword">new</span> Benz() </span><br><span class="line"><span class="comment">// benz.__proto__ = Benz.prototype</span></span><br><span class="line"><span class="comment">// å®£å‘Šä¸€å€‹ç‰©ä»¶å« benz</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(benz.numberOfWheels()) </span><br><span class="line"><span class="comment">// æœƒå…ˆæœå°‹benz.prototypeæœ‰æ²’æœ‰numberOfWheels()æ–¹æ³•</span></span><br><span class="line"><span class="comment">// æ²’æœ‰==&gt;é‚£å°±æ‰¾benz.__proto__ = Benz.prototype;</span></span><br><span class="line"><span class="comment">// Benz.prototypeå°±æœƒæ‰¾åˆ° numberOfWheels()çš„æ–¹æ³•ï¼</span></span><br></pre></td></tr></table></figure></p><p> benz.numberOfWheels() æœ‰æ­¤æ–¹æ³•<br> æ¯æ¬¡å‘¼å«Car.apply(this, arguments)æ™‚â€è¤‡è£½â€åˆ°å­é¡åˆ¥çš„ç‰©ä»¶ä¸Š<br>åˆå§‹åŒ–ç‰©ä»¶æ™‚è¼ƒæ…¢ï¼Œåœ¨run timeæƒ³è¦å‹•æ…‹æ”¹è®ŠnumberOfWheels()çš„å¯¦ä½œæ™‚<br> ç„¡æ³•å½±éŸ¿å·²ç¶“å‰µå»ºçš„å­é¡åˆ¥æˆ–çˆ¶é¡åˆ¥instances.</p><p> ä»¥ä¸‹ç‚ºåˆå§‹åŒ–è¼ƒæœ‰æ•ˆç‡çš„å¯«æ³•ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Car = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// constructor</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// public property</span></span><br><span class="line">  <span class="keyword">this</span>.wheels = <span class="number">4</span></span><br><span class="line">  <span class="comment">// pulic property</span></span><br><span class="line">  <span class="keyword">this</span>.brand = <span class="string">'default'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€™ç¨®å¯«æ³•ä¸æ”¯æ´å­˜å–private property</span></span><br><span class="line"><span class="comment">// å› ç‚ºæ¯å€‹ç‰©ä»¶éƒ½å¯ä»¥ç›´æ¥å­˜å–æ›åœ¨parent.prototypeä¸Šçš„property</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½†å¯ä»¥åœ¨run timeä¿®æ”¹æ­¤Car.prototype.numberOfWheels()çš„å¯¦ä½œ</span></span><br><span class="line"><span class="comment">// å°±å¯ä»¥é€éprototype chainæ›´æ”¹æ‰€æœ‰ç›¸é—œçš„instanceåŠŸèƒ½ å› ç‚ºinstanceå…±ç”¨prototype chainä¸Šçš„æ–¹æ³•</span></span><br><span class="line">Car.prototype.numberOfWheels = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.wheels</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Benz = <span class="function"><span class="keyword">function</span> (<span class="params">brandName</span>) </span>&#123;</span><br><span class="line">  Car.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) <span class="comment">// è¤‡è£½ç¹¼æ‰¿çˆ¶é¡åˆ¥public property</span></span><br><span class="line">  <span class="keyword">this</span>.brand = <span class="string">'brandName'</span>;</span><br><span class="line">  <span class="keyword">this</span>.getBrand = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.brand</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>numberOfWheelsè©²æ–¹æ³•å·²ç¶“è¢«æ›åœ¨ Car.prototypeä¸Šï¼Œ<br>æ‰€ä»¥ä¸¦ä¸åƒCar.applyä¸Šç›´æ¥è¤‡è£½ä¸€ä»½çµ¦å­classå€‘ï¼Œè€Œæ˜¯å­classå»å…±ç”¨Car.prototype.numberOfWheels é€™å€‹æ–¹æ³•ã€‚</p><ul><li>å„ªé»ï¼šç¯€çœåˆå§‹åŒ–çš„æ™‚é–“å’Œæå‡æ•ˆç‡</li><li>ç¼ºé»ï¼šé€™ç¨®å¯«æ³•ä¸æ”¯æ´å­˜å–private property</li></ul><h2 id="javascript-é¡åˆ¥ã€prototypeä»¥åŠreferenceä¸­çš„protoæ‰€æŒ‡å‘çš„é—œä¿‚ç¤ºæ„åœ–ï¼š"><a href="#javascript-é¡åˆ¥ã€prototypeä»¥åŠreferenceä¸­çš„protoæ‰€æŒ‡å‘çš„é—œä¿‚ç¤ºæ„åœ–ï¼š" class="headerlink" title="javascript é¡åˆ¥ã€prototypeä»¥åŠreferenceä¸­çš„protoæ‰€æŒ‡å‘çš„é—œä¿‚ç¤ºæ„åœ–ï¼š"></a>javascript é¡åˆ¥ã€prototypeä»¥åŠreferenceä¸­çš„<strong>proto</strong>æ‰€æŒ‡å‘çš„é—œä¿‚ç¤ºæ„åœ–ï¼š</h2><p>åœ–ç‰‡ä½œè€…ï¼š Benå¤§å¤§<br><img src="https://farm5.staticflickr.com/4426/36361682884_afa196bbd2_o.jpg" width="4208" alt="javascript_prototype_chain"></p><p>å‡è¨­ B class extend A;<br>let b = new B(); // <code>b.__proto__ = B.prototype</code><br>let a = new A(); // <code>a.__proto__ = A.prototype</code><br>let o = new Object(); <code>o.__proto__ = Object.prototype</code><br>//å°æ‡‰åˆ°åœ–ç‰‡å·¦é‚Šçš„bã€aã€o.</p><p>(å…ˆå¾åœ–ç‰‡æœ€å·¦ä¸Šè§’é–‹å§‹çœ‹<br>é‚£ var b = new B();<br>bæƒ³è¦ä½¿ç”¨ç¹¼æ‰¿Açš„ getValue() å‡½å¼ï¼Œ<br>é‚£éº¼å°±å¾—å…ˆæ‰¾è‡ªå·±çš„ b.prototype æ²’æœ‰çš„è©± æ‰¾ <code>b.__proto__</code> = <code>B.prototype</code></p><p>è‹¥<code>b.__proto__</code>ä¹Ÿæ²’æœ‰çš„è©±(å³B.prototype)ä¹Ÿæ²’æœ‰ï¼Œ<br>é‚£éº¼æ‰¾ <code>B.prototype.__proto__</code> == <code>A.prototype</code><br>åœ¨<code>A.prototype</code>å°±æœƒæ‰¾åˆ°getValue()çš„å‡½å¼ï¼</p><p>å¦‚æœåˆæ²’æ‰¾åˆ°ï¼Œé‚£å°±æœ€å¾Œæ‰¾<code>A.prototype.__proto__</code> == <code>Object.prototype</code><br>è‹¥æ²’æœ‰é‚£å°±æ‰¾ <code>Object.prototype.__proto__</code> == null å³æ‰¾ç„¡è©²å‡½å¼ï¼Œcompileå‘ŠçŸ¥ç™¼ç”ŸéŒ¯èª¤);</p><h2 id="Prototype-inheritance-çš„å¥½è™•"><a href="#Prototype-inheritance-çš„å¥½è™•" class="headerlink" title="Prototype inheritance çš„å¥½è™•"></a>Prototype inheritance çš„å¥½è™•</h2><ul><li>Suitable in loosely typed environments, no need to define explicit types.</li><li>Makes it incredibly easy to implement <code>singleton pattern</code> (compare JavaScript and Java in this regard, and youâ€™ll know what I am talking about).</li></ul><p>(why? å› ç‚ºprototype inheritanceæä¾›???? è«‹çœ‹è£œå……äºŒï¼‰</p><ul><li>Provides ways of applying a method of an object in the context of a different object, adding and replacing methods dynamically from an object etc. (things which are not possible in a strongly typed languages).</li></ul><h2 id="Prototype-inheritanceçš„å£è™•"><a href="#Prototype-inheritanceçš„å£è™•" class="headerlink" title="Prototype inheritanceçš„å£è™•"></a>Prototype inheritanceçš„å£è™•</h2><ul><li>No easy way of implementing private variables. Its possible to implement private vars using Crockfordâ€™s wizardry using <code>closures</code>, but its definitely not as trivial as using private variables in say Java or C#.<br>(å› ç‚º<code>__prpto__</code>æœƒæŒ‡å‘prototypeçš„æ‰€æœ‰æˆå“¡ï¼æ•…ç„¡æ³•åƒclass inheritanceé‚£æ¨£é¿å…ç¹¼æ‰¿åˆ°æœ‰<code>private</code>é—œéµå­—çš„è®Šæ•¸ï¼Œæ•…å¾—ç”¨closureæ‰‹æ³•ä¾†é¿å…ç¹¼æ‰¿åˆ°_privateè®Šæ•¸)</li></ul><p>Reference:<br><a href="https://stackoverflow.com/questions/816071/prototype-based-vs-class-based-inheritance" target="_blank" rel="noopener">prototype based vs. class based inheritance</a></p><h3 id="è£œå……ã„§ï¼šFunction-prototype-apply"><a href="#è£œå……ã„§ï¼šFunction-prototype-apply" class="headerlink" title="è£œå……ã„§ï¼šFunction.prototype.apply"></a>è£œå……ã„§ï¼šFunction.prototype.apply</h3><p><code>fun.apply(thisArg, [argsArray])</code><br>// å°‡ä¸€é€£ä¸²åƒæ•¸ç”¨arrayåŒ…èµ·ä¾†ï¼š[argsArray]ï¼Œä¸Ÿçµ¦funå‡½å¼è™•ç†</p><p>ç¯„ä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function theFunction(name, profession) &#123;</span><br><span class="line">    console.log(&quot;My name is &quot; + name + &quot; and I am a &quot; + profession + &quot;.&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// call function</span><br><span class="line"></span><br><span class="line">function callFn(name, profession) &#123;</span><br><span class="line">  theFunction.apply(this, [name, profession]);</span><br><span class="line">&#125;</span><br><span class="line">theFunction(&apos;å°will&apos;, &apos;å·¥ç¨‹å¸«&apos;);</span><br><span class="line">callFn(&apos;å¤§Will&apos;, &apos;å°å»¢å»¢&apos;);</span><br><span class="line"></span><br><span class="line">// è¼¸å‡º:</span><br><span class="line">// My name is å°will and I am a å·¥ç¨‹å¸«.</span><br><span class="line">// My name is å¤§Will and I am a å°å»¢å»¢.</span><br></pre></td></tr></table></figure></p><h3 id="è£œå……äºŒï¼šç”¨Closureå¯¦ä½œSingletonæ¨¡å¼"><a href="#è£œå……äºŒï¼šç”¨Closureå¯¦ä½œSingletonæ¨¡å¼" class="headerlink" title="è£œå……äºŒï¼šç”¨Closureå¯¦ä½œSingletonæ¨¡å¼"></a>è£œå……äºŒï¼šç”¨Closureå¯¦ä½œSingletonæ¨¡å¼</h3><p>é–‰åŒ…è§€å¿µé€£çµï¼š==&gt; <a href="https://a10000005588.github.io/2017/09/13/javascript-closure/">é–‰åŒ…æ˜¯ä»€éº¼ï¼Ÿï¼Ÿ</a></p><p>å…ˆçœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> UniverseN;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> instance;</span><br><span class="line">    UniverseN = <span class="function"><span class="keyword">function</span> <span class="title">UniverseN</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance)&#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.start_time = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.bang = <span class="string">'Big'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> uni9 = <span class="keyword">new</span> UniverseN();</span><br><span class="line"><span class="keyword">var</span> uni10 = <span class="keyword">new</span> UniverseN();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(uni9 === uni10); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">UniverseN.prototype.inEverything = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹å‡ºè‹¥åˆ©ç”¨äº†Prototype inheritanceçš„ç‰¹æ€§ï¼Œï¼Œå°‡IIFEå‡½å¼æ›åœ¨UniverseN.prototype.IIFEä¸Šï¼Œä½¿å¾—ä¹‹å¾Œå®£å‘Šçš„ç‰©ä»¶ä¸æœƒåœ¨è¤‡è£½ä¸€ä»½IIFEå‡ºä¾†å‡ºä¾†ï¼Œè®“IIFEåªè·‘ä¸€æ¬¡ï¼<br>é€™æ¨£å°±å¯ä»¥é”æˆä¸€å€‹class (UniverseN) åªèƒ½å®£å‘Šä¸€æ¬¡çš„ç‰©ä»¶ (uni9)ã€‚ å¦‚æœåœ¨å®£å‘Šå‡º uni10ï¼Œä»–å€‘éƒ½é‚„æ˜¯æŒ‡å‘åŒä¸€æ¨£çš„instance(<code>uni9.__proto__</code> == <code>uni10__proto__</code>)</p><p>Reference:<br><a href="http://cythilya.blogspot.tw/2015/06/javascript-design-pattern-singleton.html" target="_blank" rel="noopener">JavaScript Design Pattern - Singleton å–®é«”æ¨¡å¼</a></p>]]></content>
      
      
      <categories>
          
          <category> Javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨OpenZeppelinæ­é…Truffleä¾†æ‰“é€ æ™ºèƒ½åˆç´„</title>
      <link href="/2017/09/13/openzepplin/"/>
      <url>/2017/09/13/openzepplin/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡æ˜¯åƒè€ƒtruffleå®˜ç¶²æ‰€åšçš„ç­†è¨˜ï¼š<a href="http://truffleframework.com/tutorials/robust-smart-contracts-with-openzeppelin" target="_blank" rel="noopener">ROBUST SMART CONTRACTS WITH OPENZEPPELIN</a></p><a id="more"></a><h2 id="OpenZeppelinä»‹ç´¹"><a href="#OpenZeppelinä»‹ç´¹" class="headerlink" title="OpenZeppelinä»‹ç´¹"></a>OpenZeppelinä»‹ç´¹</h2><p>å¯ä»¥æŠŠOpenZeppelinç•¶æˆå¼·åŒ–Solidityè³‡è¨Šå®‰å…¨çš„Frameworkï¼Œç‚ºæ™ºèƒ½åˆç´„é™„ä¸ŠEthereumæ‰€èªå¯çš„ERC-20æ¨™æº–ï¼Œç•¢ç«Ÿåˆç´„è¦è™•ç†çš„å¯æ˜¯çœŸæ­£çš„éŒ¢ï¼</p><p>ERC-20æ¨™æº–ä»‹ç´¹ï¼š<a href="http://www.investopedia.com/news/what-erc20-and-what-does-it-mean-ethereum/" target="_blank" rel="noopener">What is ERC-20 and What Does it Mean for Ethereum?</a></p><blockquote><p>ç°¡å–®ä¾†èªªERC-20æ¨™æº–<br>å…è¨±éŒ¢åŒ…ã€äº¤æ˜“æ‰€å’Œå…¶ä»–æ™ºèƒ½åˆç´„ä»¥ä¸€ç¨®å¸¸è¦‹çš„æ–¹å¼å°æ¥å„ç¨®ä»£å¹£ã€‚</p></blockquote><h2 id="ä½¿ç”¨OpenZeppeliné å‚™çŸ¥è­˜"><a href="#ä½¿ç”¨OpenZeppeliné å‚™çŸ¥è­˜" class="headerlink" title="ä½¿ç”¨OpenZeppeliné å‚™çŸ¥è­˜"></a>ä½¿ç”¨OpenZeppeliné å‚™çŸ¥è­˜</h2><p>å»ºè­°å…ˆç­è§£ethereumä»¥åŠSmart Contractèªè¨€Solidity<br>ä»¥åŠé–‹ç™¼Smart Contractçš„æ¡†æ¶ Truffle</p><p>å¯ä»¥åƒè€ƒå®˜ç¶²æˆ–æ˜¯æˆ‘ä¹‹å‰æ‰€åšçš„ç­†è¨˜</p><ul><li><a href="https://ethereum.org/" target="_blank" rel="noopener">Ethereumå®˜æ–¹ç¶²ç«™</a>ï¼š</li><li><a href="https://a10000005588.github.io/2017/09/12/solidity/">èœé³¥Williamçš„Solidityå­¸ç¿’ç´€éŒ„</a></li><li><a href="https://a10000005588.github.io/2017/09/07/truffle-petshop/">ä½¿ç”¨Truffleä¾†ç·´ç¿’æ’°å¯«èªé¤Šå¯µç‰©çš„æ™ºèƒ½åˆç´„</a></li></ul><h2 id="ç’°å¢ƒè¨­å®š"><a href="#ç’°å¢ƒè¨­å®š" class="headerlink" title="ç’°å¢ƒè¨­å®š"></a>ç’°å¢ƒè¨­å®š</h2><p>å‰µç«‹ä¸€å€‹è³‡æ–™å¤¾ open_z<br>ä½¿ç”¨truffle unboxæŠŠç·´ç¿’å°ˆæ¡ˆçµ¦ä¸‹è¼‰åˆ°æœ¬æ©Ÿä¸Š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd open_z</span><br><span class="line">truffle ubbox tutorialtoken</span><br></pre></td></tr></table></figure></p><p>å®‰è£ zeppelin-solidity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install zeppelin-solidity</span><br></pre></td></tr></table></figure><h2 id="ç‚ºtutorialtokenå°ˆæ¡ˆæ’°å¯«-TutorialTokenåˆç´„"><a href="#ç‚ºtutorialtokenå°ˆæ¡ˆæ’°å¯«-TutorialTokenåˆç´„" class="headerlink" title="ç‚ºtutorialtokenå°ˆæ¡ˆæ’°å¯« TutorialTokenåˆç´„"></a>ç‚ºtutorialtokenå°ˆæ¡ˆæ’°å¯« TutorialTokenåˆç´„</h2><p>åœ¨ /contracts ç›®éŒ„åº•ä¸‹å‰µå»º <code>TutorialToken.sol</code></p><h3 id="TutorialToken-sol"><a href="#TutorialToken-sol" class="headerlink" title="TutorialToken.sol"></a>TutorialToken.sol</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"><span class="comment">// å¼•å…¥zepplin-solidityçš„StandardToken.sol åˆç´„</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'zeppelin-solidity/contracts/token/StandardToken.sol'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨is ä¾†ç¹¼æ‰¿StandardTokenåˆç´„</span></span><br><span class="line">contract TutorialToken is StandardToken &#123;</span><br><span class="line"></span><br><span class="line">    string public name = <span class="string">'TutorialToken'</span>;</span><br><span class="line">    <span class="comment">// token name</span></span><br><span class="line">    string public symbol = <span class="string">'TT'</span>;</span><br><span class="line">    uint public decimals = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// åˆç´„è¢«å‰µå»ºæ™‚æ‰€ç”¢ç”Ÿçš„é‡‘é¡ç¸½æ•¸</span></span><br><span class="line">    uint public INITIAL_SUPPLY = <span class="number">12000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">TutorialToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      totalSupply = INITIAL_SUPPLY;</span><br><span class="line">      balances[msg.sender] = INITIAL_SUPPLY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éä»¥ä¸Šç°¡çŸ­çš„ç¨‹å¼ç¢¼å°±å·²ç¶“å‰µé€ å‡ºç¬¦åˆEthereumçš„ ERC-20æ¨™æº–çš„Tokenå›‰ï¼</p><h2 id="ç·¨è­¯-Compile-ä»¥åŠéƒ¨ç½²-Deploy"><a href="#ç·¨è­¯-Compile-ä»¥åŠéƒ¨ç½²-Deploy" class="headerlink" title="ç·¨è­¯(Compile)ä»¥åŠéƒ¨ç½²(Deploy)"></a>ç·¨è­¯(Compile)ä»¥åŠéƒ¨ç½²(Deploy)</h2><p>åœ¨<code>/migrations</code>å…§ï¼Œå‰µå»º<code>2_deploy_contracts.js</code>æª”æ¡ˆ</p><h3 id="2-deploy-contracts-js"><a href="#2-deploy-contracts-js" class="headerlink" title="2_deploy_contracts.js"></a>2_deploy_contracts.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> TutorialToken = artifacts.require(<span class="string">"./TutorialToken.sol"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(TutorialToken);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨terminalï¼Œå…ˆç”¨testrpcå•Ÿå¥½è‡ªå·±çš„æ¸¬è©¦éŠ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testrpc</span><br></pre></td></tr></table></figure><p>then åŸ·è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">truffle comile</span><br><span class="line">truffle migrate</span><br></pre></td></tr></table></figure></p><h2 id="å’ŒTutorialToken-Dappäº’å‹•"><a href="#å’ŒTutorialToken-Dappäº’å‹•" class="headerlink" title="å’ŒTutorialToken Dappäº’å‹•"></a>å’ŒTutorialToken Dappäº’å‹•</h2><p>æˆ‘å€‘ä½¿ç”¨<a href="https://metamask.io/#how-it-works" target="_blank" rel="noopener">metamask</a>å’Œæˆ‘å€‘çš„Dappäº’å‹•</p><p>ä¸¦ä¸”è©²å°ˆæ¡ˆå·²ç¶“å…§å»º <code>lite-server</code>å¯é‹è¡ŒDapp</p><p>åŸ·è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°ä»¥ä¸‹ç•«é¢å‰‡è¡¨ç¤ºæˆåŠŸé‹è¡Œï¼<br>(åˆ¥å¿˜äº†è¦å…ˆç™»å…¥metamaskï¼Œä»¥ä¾¿å‰ç«¯èƒ½å¤ æ“·å–åˆ°testrpcæ‰€é–‹å•Ÿçš„éŒ¢åŒ…è³‡è¨Š)</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37056160091/in/dateposted-public/" title="è¢å¹•å¿«ç…§ 2017-09-13 ä¸Šåˆ10.20.59" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4416/37056160091_c5c1ff268c_o.png" width="600" alt="è¢å¹•å¿«ç…§ 2017-09-13 ä¸Šåˆ10.20.59"></a></p><p>ä»¥åŠå¯ä»¥çœ‹åˆ°åœ¨metamaskä¸ŠéŒ¢åŒ…çš„è³‡è¨Š</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37198399085/in/dateposted-public/" title="è¢å¹•å¿«ç…§ 2017-09-13 ä¸Šåˆ10.27.00" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4350/37198399085_78990fa582_o.png" width="900" alt="è¢å¹•å¿«ç…§ 2017-09-13 ä¸Šåˆ10.27.00"></a></p><h2 id="ç¸½çµ-Truffle-OpenZeppelin-A-Superb-Development-Experience"><a href="#ç¸½çµ-Truffle-OpenZeppelin-A-Superb-Development-Experience" class="headerlink" title="ç¸½çµ: Truffle+OpenZeppelin = A Superb Development Experience"></a>ç¸½çµ: Truffle+OpenZeppelin = A Superb Development Experience</h2><p>é€éï¼š</p><ul><li>Truffleï¼šé–‹ç™¼æ™ºèƒ½åˆç´„çš„æ¡†æ¶</li><li>OpenZeppelinï¼šå¯ç‚ºæ™ºèƒ½åˆç´„æä¾›ERC-20æ¨™æº–çš„å·¥å…·</li></ul><p>å°±å¯ä»¥æ‰“é€ å‡ºå¯ä¸Šå¸‚çš„æ™ºèƒ½åˆç´„çš„é–‹ç™¼ç’°å¢ƒï¼ </p><hr><p>å°OpenZeppelinå…§çš„åˆç´„æ¶æ§‹æœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥è§€çœ‹æˆ‘é€™ç¯‡ç­†è¨˜ï¼š</p><p><a href="https://" target="_blank" rel="noopener">OpenZeppelinåˆç´„æ¶æ§‹é€æ</a></p>]]></content>
      
      
      <categories>
          
          <category> Solidity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Solidity </tag>
            
            <tag> Truffle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solidityå­¸ç¿’ç´€éŒ„</title>
      <link href="/2017/09/12/solidity/"/>
      <url>/2017/09/12/solidity/</url>
      
        <content type="html"><![CDATA[<p>é€™ç¯‡ä¸»è¦è¨˜éŒ„è‘—æˆ‘å°Solidityå®˜ç¶²æ–‡æª”çš„å­¸ç¿’ç´€éŒ„</p><a id="more"></a><h2 id="ç°¡å–®çš„åˆç´„é–‹å§‹ä»‹ç´¹èµ·"><a href="#ç°¡å–®çš„åˆç´„é–‹å§‹ä»‹ç´¹èµ·" class="headerlink" title="ç°¡å–®çš„åˆç´„é–‹å§‹ä»‹ç´¹èµ·"></a>ç°¡å–®çš„åˆç´„é–‹å§‹ä»‹ç´¹èµ·</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>; <span class="comment">// å‘Šè¨´compilerè¦å¦‚ä½•å°å¾…é€™ä»½code</span></span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">    uint storedData; <span class="comment">// å®£å‘Šuintå‹æ…‹çš„è®Šæ•¸ uintç‚º 256 bits.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹æ§åˆ¶stored variable.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">uint x</span>) </span>&#123;</span><br><span class="line">        storedData = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> storedData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€å€‹æ¯”è¼ƒè¤‡é›œçš„åˆç´„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Coin &#123;</span><br><span class="line">    <span class="comment">// The keyword "public" makes those variables</span></span><br><span class="line">    <span class="comment">// readable from outside.</span></span><br><span class="line">    address public minter;</span><br><span class="line">    </span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint) public balances;</span><br><span class="line">    <span class="comment">// å¯æŠŠmapping ç•¶æˆæ˜¯hash tables</span></span><br><span class="line">    <span class="comment">// å°‡addressç•¶åƒæ•¸ æ˜ å°„åˆ°balancesä¸­æœƒå¾—åˆ°uintå‹æ…‹çš„å›å‚³å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Events allow light clients to react on</span></span><br><span class="line">    <span class="comment">// changes efficiently.</span></span><br><span class="line">    event Sent(address <span class="keyword">from</span>, address to, uint amount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å’ŒcontractåŒåçš„å‡½å¼åç¨±å³ç‚ºconstructorï¼Œåœ¨åˆç´„è¢«å‰µé€ å‡ºä¾†æ™‚å‘¼å«</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Coin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        minter = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">mint</span>(<span class="params">address receiver, uint amount</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.sender != minter) <span class="keyword">return</span>;</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params">address receiver, uint amount</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (balances[msg.sender] &lt; amount) <span class="keyword">return</span>;</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">        Sent(msg.sender, receiver, amount);</span><br><span class="line">        <span class="comment">// msg.sender åˆç´„çš„æŒæœ‰è€…</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>address</code>ï¼š160-bit value that does not allow any arithmetic operations.</li><li><p><code>public</code>ï¼šä½¿å…¶ä»–åˆç´„å¯ä»¥å­˜å–è‡ªå·±çš„scope function,variable.</p></li><li><p><code>address public minter</code> å¯çœ‹æˆå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function minter() returns (address) &#123; return minter; &#125;</span><br></pre></td></tr></table></figure></li><li><p><code>mapping (address =&gt; uint) public balances;</code>å¯çœ‹æˆå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function balances(address _account) returns (uint) &#123;</span><br><span class="line">    return balances[_account];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>event Sent(address from, address to, uint amount);</p></li></ul><p>é€éè©²Sent functionæ–¹ä¾¿è¿½è¹¤éŒ¢çš„æµå‡ºå’Œæµå…¥åœ°å€æ˜¯å“ª</p><ul><li>Coin()ï¼šç‚ºå»ºæ§‹å­ï¼Œåˆç´„å‰µé€ å‡ºä¾†å°±æœƒå‘¼å«ä¸”å»ºæ§‹å­æœƒå„²å­˜ï¼š</li></ul><ol><li>msgï¼šå„²å­˜å‰µé€ åˆç´„çš„äººçš„addressä»¥åŠå…¶ä»–properties (tx,blockâ€¦)ï¼Œæ“æœ‰ç›´æ¥å’Œblockchainæºé€šçš„æ¬Šåˆ©</li><li>msg.senderï¼šå‘¼å«åˆç´„çš„äººï¼Œè‹¥contract Aå‘¼å«contract Bï¼Œé‚£msg.senderåœ¨contract A Béƒ½æ˜¯ç›¸åŒçš„ã€‚</li></ol><h2 id="Ethereum-Virtual-Machine"><a href="#Ethereum-Virtual-Machine" class="headerlink" title="Ethereum Virtual Machine"></a>Ethereum Virtual Machine</h2><p>The Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum. </p><h2 id="Features"><a href="#Features" class="headerlink" title="Features:"></a>Features:</h2><ul><li>Overview<br>The Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum</li><li>Accounts<br><code>External accounts</code> that are controlled by public-private key pairs (i.e. humans)<br><code>Contract accounts</code> which are controlled by the code stored together with the account.<br>â€”-Every account has a persistent key-value store mapping 256-bit words to 256-bit words called storage.</li><li>Transactions</li><li>Gas<br>The gas price is a value set by the creator of the transaction<br>åˆç´„çš„æ‰‹çºŒè²»ï¼Œç”¨ä¾†åŸ·è¡Œåˆç´„çš„ç‡ƒæ–™ï¼Œé¿å…Contractæœ‰bugæœƒæŠŠéŒ¢ä¸€ç›´è½‰èµ°</li><li>Storage, Memory and the Stack</li></ul><p><code>Storage</code>:<br>æ¯å€‹Contractéƒ½æœƒæŒæœ‰è‡ªå·±çš„storage,storageç‚ºä¸€å€‹key-value store that maps 256-bit words to 256-bit words.</p><p><code>Memory</code>ï¼š<br>of which a contract obtains a freshly cleared instance for each message call</p><ul><li>Delegatecall / Callcode and Libraries</li></ul><h2 id="Solidity-Examples"><a href="#Solidity-Examples" class="headerlink" title="Solidity Examples"></a>Solidity Examples</h2><h3 id="Solidity-Example-1ï¼šVoting-Contract"><a href="#Solidity-Example-1ï¼šVoting-Contract" class="headerlink" title="Solidity Example 1ï¼šVoting Contract."></a>Solidity Example 1ï¼šVoting Contract.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @title Voting with delegation.</span></span><br><span class="line">contract Ballot &#123;</span><br><span class="line">    <span class="comment">// This declares a new complex type which will</span></span><br><span class="line">    <span class="comment">// be used for variables later.</span></span><br><span class="line">    <span class="comment">// It will represent a single voter.</span></span><br><span class="line">    struct Voter &#123;</span><br><span class="line">        uint weight; <span class="comment">// weight is accumulated by delegation</span></span><br><span class="line">        bool voted;  <span class="comment">// if true, that person already voted</span></span><br><span class="line">        address delegate; <span class="comment">// person delegated to</span></span><br><span class="line">        uint vote;   <span class="comment">// index of the voted proposal</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is a type for a single proposal.</span></span><br><span class="line">    struct Proposal &#123;</span><br><span class="line">        bytes32 name;   <span class="comment">// short name (up to 32 bytes)</span></span><br><span class="line">        uint voteCount; <span class="comment">// number of accumulated votes</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    address public chairperson;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This declares a state variable that</span></span><br><span class="line">    <span class="comment">// stores a `Voter` struct for each possible address.</span></span><br><span class="line">    <span class="comment">// å°‡æ¯ä¸€å€‹åœ°å€æ˜ å°„åˆ°å°æ‡‰çš„ Voter struct.</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> Voter) public voters;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A dynamically-sized array of `Proposal` structs.</span></span><br><span class="line">    Proposal[] public proposals;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Create a new ballot to choose one of `proposalNames`.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Ballot</span>(<span class="params">bytes32[] proposalNames</span>) </span>&#123;</span><br><span class="line">        chairperson = msg.sender;</span><br><span class="line">        voters[chairperson].weight = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// For each of the provided proposal names,</span></span><br><span class="line">        <span class="comment">// create a new proposal object and add it</span></span><br><span class="line">        <span class="comment">// to the end of the array.</span></span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; proposalNames.length; i++) &#123;</span><br><span class="line">            <span class="comment">// `Proposal(&#123;...&#125;)` creates a temporary</span></span><br><span class="line">            <span class="comment">// Proposal object and `proposals.push(...)`</span></span><br><span class="line">            <span class="comment">// appends it to the end of `proposals`.</span></span><br><span class="line">            proposals.push(Proposal(&#123;</span><br><span class="line">                name: proposalNames[i],</span><br><span class="line">                voteCount: <span class="number">0</span></span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Give `voter` the right to vote on this ballot.</span></span><br><span class="line">    <span class="comment">// May only be called by `chairperson`.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveRightToVote</span>(<span class="params">address voter</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// If the argument of `require` evaluates to `false`,</span></span><br><span class="line">        <span class="comment">// it terminates and reverts all changes to</span></span><br><span class="line">        <span class="comment">// the state and to Ether balances. It is often</span></span><br><span class="line">        <span class="comment">// a good idea to use this if functions are</span></span><br><span class="line">        <span class="comment">// called incorrectly. But watch out, this</span></span><br><span class="line">        <span class="comment">// will currently also consume all provided gas</span></span><br><span class="line">        <span class="comment">// (this is planned to change in the future).</span></span><br><span class="line">        <span class="built_in">require</span>((msg.sender == chairperson) &amp;&amp; !voters[voter].voted &amp;&amp; (voters[voter].weight == <span class="number">0</span>));</span><br><span class="line">        voters[voter].weight = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Delegate your vote to the voter `to`.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delegate</span>(<span class="params">address to</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// assigns reference</span></span><br><span class="line">        Voter storage sender = voters[msg.sender];</span><br><span class="line">        <span class="built_in">require</span>(!sender.voted);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Self-delegation is not allowed.</span></span><br><span class="line">        <span class="built_in">require</span>(to != msg.sender);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Forward the delegation as long as</span></span><br><span class="line">        <span class="comment">// `to` also delegated.</span></span><br><span class="line">        <span class="comment">// In general, such loops are very dangerous,</span></span><br><span class="line">        <span class="comment">// because if they run too long, they might</span></span><br><span class="line">        <span class="comment">// need more gas than is available in a block.</span></span><br><span class="line">        <span class="comment">// In this case, the delegation will not be executed,</span></span><br><span class="line">        <span class="comment">// but in other situations, such loops might</span></span><br><span class="line">        <span class="comment">// cause a contract to get "stuck" completely.</span></span><br><span class="line">        <span class="keyword">while</span> (voters[to].delegate != address(<span class="number">0</span>)) &#123;</span><br><span class="line">            to = voters[to].delegate;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// We found a loop in the delegation, not allowed.</span></span><br><span class="line">            <span class="built_in">require</span>(to != msg.sender);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Since `sender` is a reference, this</span></span><br><span class="line">        <span class="comment">// modifies `voters[msg.sender].voted`</span></span><br><span class="line">        sender.voted = <span class="literal">true</span>;</span><br><span class="line">        sender.delegate = to;</span><br><span class="line">        Voter delegate = voters[to];</span><br><span class="line">        <span class="keyword">if</span> (delegate.voted) &#123;</span><br><span class="line">            <span class="comment">// If the delegate already voted,</span></span><br><span class="line">            <span class="comment">// directly add to the number of votes</span></span><br><span class="line">            proposals[delegate.vote].voteCount += sender.weight;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// If the delegate did not vote yet,</span></span><br><span class="line">            <span class="comment">// add to her weight.</span></span><br><span class="line">            delegate.weight += sender.weight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Give your vote (including votes delegated to you)</span></span><br><span class="line">    <span class="comment">/// to proposal `proposals[proposal].name`.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vote</span>(<span class="params">uint proposal</span>) </span>&#123;</span><br><span class="line">        Voter storage sender = voters[msg.sender];</span><br><span class="line">        <span class="built_in">require</span>(!sender.voted);</span><br><span class="line">        sender.voted = <span class="literal">true</span>;</span><br><span class="line">        sender.vote = proposal;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If `proposal` is out of the range of the array,</span></span><br><span class="line">        <span class="comment">// this will throw automatically and revert all</span></span><br><span class="line">        <span class="comment">// changes.</span></span><br><span class="line">        proposals[proposal].voteCount += sender.weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @dev Computes the winning proposal taking all</span></span><br><span class="line">    <span class="comment">/// previous votes into account.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">winningProposal</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint winningProposal</span>) </span>&#123;</span><br><span class="line">        uint winningVoteCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (uint p = <span class="number">0</span>; p &lt; proposals.length; p++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (proposals[p].voteCount &gt; winningVoteCount) &#123;</span><br><span class="line">                winningVoteCount = proposals[p].voteCount;</span><br><span class="line">                winningProposal = p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calls winningProposal() function to get the index</span></span><br><span class="line">    <span class="comment">// of the winner contained in the proposals array and then</span></span><br><span class="line">    <span class="comment">// returns the name of the winner</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">winnerName</span>(<span class="params"></span>) <span class="title">constant</span></span></span><br><span class="line"><span class="function">            <span class="title">returns</span> (<span class="params">bytes32 winnerName</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        winnerName = proposals[winningProposal()].name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Solidity-Example-2ï¼šSimple-Open-Auction"><a href="#Solidity-Example-2ï¼šSimple-Open-Auction" class="headerlink" title="Solidity Example 2ï¼šSimple Open Auction"></a>Solidity Example 2ï¼šSimple Open Auction</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleAuction &#123;</span><br><span class="line">    <span class="comment">// Parameters of the auction. Times are either</span></span><br><span class="line">    <span class="comment">// absolute unix timestamps (seconds since 1970-01-01)</span></span><br><span class="line">    <span class="comment">// or time periods in seconds.</span></span><br><span class="line">    address public beneficiary;</span><br><span class="line">    uint public auctionStart;</span><br><span class="line">    uint public biddingTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Current state of the auction.</span></span><br><span class="line">    address public highestBidder;</span><br><span class="line">    uint public highestBid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allowed withdrawals of previous bids</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) pendingReturns;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set to true at the end, disallows any change</span></span><br><span class="line">    bool ended;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Events that will be fired on changes.</span></span><br><span class="line">    event HighestBidIncreased(address bidder, uint amount);</span><br><span class="line">    event AuctionEnded(address winner, uint amount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The following is a so-called natspec comment,</span></span><br><span class="line">    <span class="comment">// recognizable by the three slashes.</span></span><br><span class="line">    <span class="comment">// It will be shown when the user is asked to</span></span><br><span class="line">    <span class="comment">// confirm a transaction.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Create a simple auction with `_biddingTime`</span></span><br><span class="line">    <span class="comment">/// seconds bidding time on behalf of the</span></span><br><span class="line">    <span class="comment">/// beneficiary address `_beneficiary`.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">SimpleAuction</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint _biddingTime,</span></span></span><br><span class="line"><span class="function"><span class="params">        address _beneficiary</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">        beneficiary = _beneficiary;</span><br><span class="line">        auctionStart = now;</span><br><span class="line">        biddingTime = _biddingTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Bid on the auction with the value sent</span></span><br><span class="line">    <span class="comment">/// together with this transaction.</span></span><br><span class="line">    <span class="comment">/// The value will only be refunded if the</span></span><br><span class="line">    <span class="comment">/// auction is not won.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// No arguments are necessary, all</span></span><br><span class="line">        <span class="comment">// information is already part of</span></span><br><span class="line">        <span class="comment">// the transaction. The keyword payable</span></span><br><span class="line">        <span class="comment">// is required for the function to</span></span><br><span class="line">        <span class="comment">// be able to receive Ether.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Revert the call if the bidding</span></span><br><span class="line">        <span class="comment">// period is over.</span></span><br><span class="line">        <span class="built_in">require</span>(now &lt;= (auctionStart + biddingTime));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the bid is not higher, send the</span></span><br><span class="line">        <span class="comment">// money back.</span></span><br><span class="line">        <span class="built_in">require</span>(msg.value &gt; highestBid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (highestBidder != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Sending back the money by simply using</span></span><br><span class="line">            <span class="comment">// highestBidder.send(highestBid) is a security risk</span></span><br><span class="line">            <span class="comment">// because it could execute an untrusted contract.</span></span><br><span class="line">            <span class="comment">// It is always safer to let the recipients</span></span><br><span class="line">            <span class="comment">// withdraw their money themselves.</span></span><br><span class="line">            pendingReturns[highestBidder] += highestBid;</span><br><span class="line">        &#125;</span><br><span class="line">        highestBidder = msg.sender;</span><br><span class="line">        highestBid = msg.value;</span><br><span class="line">        HighestBidIncreased(msg.sender, msg.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Withdraw a bid that was overbid.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        uint amount = pendingReturns[msg.sender];</span><br><span class="line">        <span class="keyword">if</span> (amount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// It is important to set this to zero because the recipient</span></span><br><span class="line">            <span class="comment">// can call this function again as part of the receiving call</span></span><br><span class="line">            <span class="comment">// before `send` returns.</span></span><br><span class="line">            pendingReturns[msg.sender] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!msg.sender.send(amount)) &#123;</span><br><span class="line">                <span class="comment">// No need to call throw here, just reset the amount owing</span></span><br><span class="line">                pendingReturns[msg.sender] = amount;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// End the auction and send the highest bid</span></span><br><span class="line">    <span class="comment">/// to the beneficiary.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">auctionEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// It is a good guideline to structure functions that interact</span></span><br><span class="line">        <span class="comment">// with other contracts (i.e. they call functions or send Ether)</span></span><br><span class="line">        <span class="comment">// into three phases:</span></span><br><span class="line">        <span class="comment">// 1. checking conditions</span></span><br><span class="line">        <span class="comment">// 2. performing actions (potentially changing conditions)</span></span><br><span class="line">        <span class="comment">// 3. interacting with other contracts</span></span><br><span class="line">        <span class="comment">// If these phases are mixed up, the other contract could call</span></span><br><span class="line">        <span class="comment">// back into the current contract and modify the state or cause</span></span><br><span class="line">        <span class="comment">// effects (ether payout) to be performed multiple times.</span></span><br><span class="line">        <span class="comment">// If functions called internally include interaction with external</span></span><br><span class="line">        <span class="comment">// contracts, they also have to be considered interaction with</span></span><br><span class="line">        <span class="comment">// external contracts.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. Conditions</span></span><br><span class="line">        <span class="built_in">require</span>(now &gt;= (auctionStart + biddingTime)); <span class="comment">// auction did not yet end</span></span><br><span class="line">        <span class="built_in">require</span>(!ended); <span class="comment">// this function has already been called</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. Effects</span></span><br><span class="line">        ended = <span class="literal">true</span>;</span><br><span class="line">        AuctionEnded(highestBidder, highestBid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. Interaction</span></span><br><span class="line">        beneficiary.transfer(highestBid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Solidity-Example-3ï¼šBlink-Auction"><a href="#Solidity-Example-3ï¼šBlink-Auction" class="headerlink" title="Solidity Example 3ï¼šBlink Auction"></a>Solidity Example 3ï¼šBlink Auction</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract BlindAuction &#123;</span><br><span class="line">    struct Bid &#123;</span><br><span class="line">        bytes32 blindedBid;</span><br><span class="line">        uint deposit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    address public beneficiary;</span><br><span class="line">    uint public auctionStart;</span><br><span class="line">    uint public biddingEnd;</span><br><span class="line">    uint public revealEnd;</span><br><span class="line">    bool public ended;</span><br><span class="line"></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> Bid[]) public bids;</span><br><span class="line"></span><br><span class="line">    address public highestBidder;</span><br><span class="line">    uint public highestBid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allowed withdrawals of previous bids</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) pendingReturns;</span><br><span class="line"></span><br><span class="line">    event AuctionEnded(address winner, uint highestBid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Modifiers are a convenient way to validate inputs to</span></span><br><span class="line">    <span class="comment">/// functions. `onlyBefore` is applied to `bid` below:</span></span><br><span class="line">    <span class="comment">/// The new function body is the modifier's body where</span></span><br><span class="line">    <span class="comment">/// `_` is replaced by the old function body.</span></span><br><span class="line">    modifier onlyBefore(uint _time) &#123; <span class="built_in">require</span>(now &lt; _time); _; &#125;</span><br><span class="line">    modifier onlyAfter(uint _time) &#123; <span class="built_in">require</span>(now &gt; _time); _; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">BlindAuction</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint _biddingTime,</span></span></span><br><span class="line"><span class="function"><span class="params">        uint _revealTime,</span></span></span><br><span class="line"><span class="function"><span class="params">        address _beneficiary</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">        beneficiary = _beneficiary;</span><br><span class="line">        auctionStart = now;</span><br><span class="line">        biddingEnd = now + _biddingTime;</span><br><span class="line">        revealEnd = biddingEnd + _revealTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Place a blinded bid with `_blindedBid` = keccak256(value,</span></span><br><span class="line">    <span class="comment">/// fake, secret).</span></span><br><span class="line">    <span class="comment">/// The sent ether is only refunded if the bid is correctly</span></span><br><span class="line">    <span class="comment">/// revealed in the revealing phase. The bid is valid if the</span></span><br><span class="line">    <span class="comment">/// ether sent together with the bid is at least "value" and</span></span><br><span class="line">    <span class="comment">/// "fake" is not true. Setting "fake" to true and sending</span></span><br><span class="line">    <span class="comment">/// not the exact amount are ways to hide the real bid but</span></span><br><span class="line">    <span class="comment">/// still make the required deposit. The same address can</span></span><br><span class="line">    <span class="comment">/// place multiple bids.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params">bytes32 _blindedBid</span>)</span></span><br><span class="line"><span class="function">        <span class="title">payable</span></span></span><br><span class="line"><span class="function">        <span class="title">onlyBefore</span>(<span class="params">biddingEnd</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        bids[msg.sender].push(Bid(&#123;</span><br><span class="line">            blindedBid: _blindedBid,</span><br><span class="line">            deposit: msg.value</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Reveal your blinded bids. You will get a refund for all</span></span><br><span class="line">    <span class="comment">/// correctly blinded invalid bids and for all bids except for</span></span><br><span class="line">    <span class="comment">/// the totally highest.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reveal</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint[] _values,</span></span></span><br><span class="line"><span class="function"><span class="params">        bool[] _fake,</span></span></span><br><span class="line"><span class="function"><span class="params">        bytes32[] _secret</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlyAfter</span>(<span class="params">biddingEnd</span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlyBefore</span>(<span class="params">revealEnd</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        uint length = bids[msg.sender].length;</span><br><span class="line">        <span class="built_in">require</span>(_values.length == length);</span><br><span class="line">        <span class="built_in">require</span>(_fake.length == length);</span><br><span class="line">        <span class="built_in">require</span>(_secret.length == length);</span><br><span class="line"></span><br><span class="line">        uint refund;</span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> bid = bids[msg.sender][i];</span><br><span class="line">            <span class="keyword">var</span> (value, fake, secret) =</span><br><span class="line">                    (_values[i], _fake[i], _secret[i]);</span><br><span class="line">            <span class="keyword">if</span> (bid.blindedBid != keccak256(value, fake, secret)) &#123;</span><br><span class="line">                <span class="comment">// Bid was not actually revealed.</span></span><br><span class="line">                <span class="comment">// Do not refund deposit.</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            refund += bid.deposit;</span><br><span class="line">            <span class="keyword">if</span> (!fake &amp;&amp; bid.deposit &gt;= value) &#123;</span><br><span class="line">                <span class="keyword">if</span> (placeBid(msg.sender, value))</span><br><span class="line">                    refund -= value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Make it impossible for the sender to re-claim</span></span><br><span class="line">            <span class="comment">// the same deposit.</span></span><br><span class="line">            bid.blindedBid = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        msg.sender.transfer(refund);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is an "internal" function which means that it</span></span><br><span class="line">    <span class="comment">// can only be called from the contract itself (or from</span></span><br><span class="line">    <span class="comment">// derived contracts).</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">placeBid</span>(<span class="params">address bidder, uint value</span>) <span class="title">internal</span></span></span><br><span class="line"><span class="function">            <span class="title">returns</span> (<span class="params">bool success</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value &lt;= highestBid) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (highestBidder != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Refund the previously highest bidder.</span></span><br><span class="line">            pendingReturns[highestBidder] += highestBid;</span><br><span class="line">        &#125;</span><br><span class="line">        highestBid = value;</span><br><span class="line">        highestBidder = bidder;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Withdraw a bid that was overbid.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        uint amount = pendingReturns[msg.sender];</span><br><span class="line">        <span class="keyword">if</span> (amount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// It is important to set this to zero because the recipient</span></span><br><span class="line">            <span class="comment">// can call this function again as part of the receiving call</span></span><br><span class="line">            <span class="comment">// before `send` returns (see the remark above about</span></span><br><span class="line">            <span class="comment">// conditions -&gt; effects -&gt; interaction).</span></span><br><span class="line">            pendingReturns[msg.sender] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            msg.sender.transfer(amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// End the auction and send the highest bid</span></span><br><span class="line">    <span class="comment">/// to the beneficiary.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">auctionEnd</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlyAfter</span>(<span class="params">revealEnd</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(!ended);</span><br><span class="line">        AuctionEnded(highestBidder, highestBid);</span><br><span class="line">        ended = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// We send all the money we have, because some</span></span><br><span class="line">        <span class="comment">// of the refunds might have failed.</span></span><br><span class="line">        beneficiary.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Solidity-Example-4ï¼š-Remote-Purchase"><a href="#Solidity-Example-4ï¼š-Remote-Purchase" class="headerlink" title="Solidity Example 4ï¼š Remote Purchase"></a>Solidity Example 4ï¼š Remote Purchase</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Purchase &#123;</span><br><span class="line">    uint public value;</span><br><span class="line">    address public seller;</span><br><span class="line">    address public buyer;</span><br><span class="line">    enum State &#123; Created, Locked, Inactive &#125;</span><br><span class="line">    State public state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Purchase</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        seller = msg.sender;</span><br><span class="line">        value = msg.value / <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">require</span>((<span class="number">2</span> * value) == msg.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier condition(bool _condition) &#123;</span><br><span class="line">        <span class="built_in">require</span>(_condition);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyBuyer() &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == buyer);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlySeller() &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == seller);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier inState(State _state) &#123;</span><br><span class="line">        <span class="built_in">require</span>(state == _state);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    event Aborted();</span><br><span class="line">    event PurchaseConfirmed();</span><br><span class="line">    event ItemReceived();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Abort the purchase and reclaim the ether.</span></span><br><span class="line">    <span class="comment">/// Can only be called by the seller before</span></span><br><span class="line">    <span class="comment">/// the contract is locked.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abort</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlySeller</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Aborted();</span><br><span class="line">        state = State.Inactive;</span><br><span class="line">        seller.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Confirm the purchase as buyer.</span></span><br><span class="line">    <span class="comment">/// Transaction has to include `2 * value` ether.</span></span><br><span class="line">    <span class="comment">/// The ether will be locked until confirmReceived</span></span><br><span class="line">    <span class="comment">/// is called.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">confirmPurchase</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Created</span>)</span></span><br><span class="line"><span class="function">        <span class="title">condition</span>(<span class="params">msg.value == (<span class="number">2</span> * value</span>))</span></span><br><span class="line"><span class="function">        <span class="title">payable</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        PurchaseConfirmed();</span><br><span class="line">        buyer = msg.sender;</span><br><span class="line">        state = State.Locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Confirm that you (the buyer) received the item.</span></span><br><span class="line">    <span class="comment">/// This will release the locked ether.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">confirmReceived</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">onlyBuyer</span></span></span><br><span class="line"><span class="function">        <span class="title">inState</span>(<span class="params">State.Locked</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ItemReceived();</span><br><span class="line">        <span class="comment">// It is important to change the state first because</span></span><br><span class="line">        <span class="comment">// otherwise, the contracts called using `send` below</span></span><br><span class="line">        <span class="comment">// can call in again here.</span></span><br><span class="line">        state = State.Inactive;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> This actually allows both the buyer and the seller to</span></span><br><span class="line">        <span class="comment">// block the refund - the withdraw pattern should be used.</span></span><br><span class="line"></span><br><span class="line">        buyer.transfer(value);</span><br><span class="line">        seller.transfer(<span class="keyword">this</span>.balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solidity-èªæ³•"><a href="#Solidity-èªæ³•" class="headerlink" title="Solidity èªæ³•"></a>Solidity èªæ³•</h2><h3 id="Address"><a href="#Address" class="headerlink" title="Address"></a>Address</h3><p>Holds a 20 byte value (size of an Ethereum address)</p><h4 id="Members-of-Addresses"><a href="#Members-of-Addresses" class="headerlink" title="Members of Addresses"></a>Members of Addresses</h4><p>addressåŒ…å«è‘—æœ‰ä»¥ä¸‹çš„propertiesï¼š</p><ul><li>balanceï¼šåœ°å€çš„é¤˜é¡</li><li>transferï¼šè½‰éŒ¢åˆ°è©²åœ°å€  è‹¥æœ‰éŒ¯èª¤æœƒç™¼é€exception</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">address x = 0x123;</span><br><span class="line">address myAddress = this;</span><br><span class="line">if (x.balance &lt; 10 &amp;&amp; myAddress.balance &gt;= 10) </span><br><span class="line">x.transfer(10); // é€çµ¦xé€™å€‹åœ°å€ 10å¡Šether</span><br></pre></td></tr></table></figure><ul><li><p>send ï¼šä¹Ÿæ˜¯è½‰éŒ¢åˆ°è©²åœ°å€ è‹¥æœ‰éŒ¯èª¤åªæœƒreturn falseï¼Œä½¿ç”¨è¦æ¯”è¼ƒå°å¿ƒ</p></li><li><p>call ï¼šå‚³é€åƒæ•¸ï¼ˆ.value()ï¼‰æˆ–å‡½å¼å›å‚³å€¼çµ¦åˆç´„ï¼Œ </p></li><li>delegatecall</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">address nameReg = 0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2;</span><br><span class="line">nameReg.call(&quot;register&quot;, &quot;MyName&quot;);</span><br><span class="line">nameReg.call(bytes4(keccak256(&quot;fun(uint256)&quot;)), a);</span><br><span class="line">nameReg.call.value(10);</span><br></pre></td></tr></table></figure><h3 id="Enumsï¼šé¡ä¼¼å¯¦ä½œinterface"><a href="#Enumsï¼šé¡ä¼¼å¯¦ä½œinterface" class="headerlink" title="Enumsï¼šé¡ä¼¼å¯¦ä½œinterface"></a>Enumsï¼šé¡ä¼¼å¯¦ä½œinterface</h3><p>Enums needs at least one member.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">    enum ActionChoices &#123; GoLeft, GoRight, GoStraight, SitStill &#125;</span><br><span class="line">    ActionChoices choice;</span><br><span class="line">    ActionChoices constant defaultChoice = ActionChoices.GoStraight;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setGoStraight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        choice = ActionChoices.GoStraight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Since enum types are not part of the ABI, the signature of "getChoice"</span></span><br><span class="line">    <span class="comment">// will automatically be changed to "getChoice() returns (uint8)"</span></span><br><span class="line">    <span class="comment">// for all matters external to Solidity. The integer type used is just</span></span><br><span class="line">    <span class="comment">// large enough to hold all enum values, i.e. if you have more values,</span></span><br><span class="line">    <span class="comment">// `uint16` will be used and so on.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">ActionChoices</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> choice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getDefaultChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uint(defaultChoice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Functionalçš„ç¨®é¡ä»¥åŠåƒæ•¸-constnat-payble"><a href="#Functionalçš„ç¨®é¡ä»¥åŠåƒæ•¸-constnat-payble" class="headerlink" title="Functionalçš„ç¨®é¡ä»¥åŠåƒæ•¸(constnat,payble)"></a>Functionalçš„ç¨®é¡ä»¥åŠåƒæ•¸(constnat,payble)</h3><ul><li><code>Internal function</code>ï¼š can only be called inside the current contract.</li><li><code>External function</code>ï¼š consist of an address and a function signature and they can be passed via and returned from external function calls.</li></ul><p>functionå®£å‘Šçš„æ ¼å¼ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function (&lt;parameter types&gt;) &#123;internal|external&#125; [constant] [payable] [returns (&lt;return types&gt;)]</span><br><span class="line"></span><br><span class="line">parameter typesï¼šåƒæ•¸çš„å½¢å¼</span><br><span class="line">constantï¼šæ¨™è¨»è©²functionç‚ºread-onlyï¼Œä¸æœƒæ”¹è®Šcontractçš„state.</span><br><span class="line">payableï¼š è¨­å®šæœƒéœ€è¦æ”¶etherçš„å‡½å¼éƒ½è¦åŠ ä¸€å€‹payableå±¬æ€§ï¼Œå¦‚æœæ²’åŠ è€Œæœ‰äººå‘¼å«è©²å‡½å¼é †ä¾¿å¸¶etherçš„è©±å°±æœƒé€ æˆerror</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ex:</span><br><span class="line">function (address chairman) &#123;&#125; constant payble returns (uint) &#123;&#125;;</span><br></pre></td></tr></table></figure></p><h4 id="å…©ç¨®æ–¹æ³•å­˜å–è©²function"><a href="#å…©ç¨®æ–¹æ³•å­˜å–è©²function" class="headerlink" title="å…©ç¨®æ–¹æ³•å­˜å–è©²function:"></a>å…©ç¨®æ–¹æ³•å­˜å–è©²function:</h4><ul><li><code>f</code>ï¼š will result in an internal function, </li><li><code>this.f</code>ï¼š an external function.</li></ul><p>Internal Example: é¡ä¼¼OODçš„Protectedã€ä¸èƒ½è¢«å…¶ä»–åˆç´„å‘¼å«<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.5</span>;</span><br><span class="line"></span><br><span class="line">library ArrayUtils &#123;</span><br><span class="line">  <span class="comment">// internal functions can be used in internal library functions because</span></span><br><span class="line">  <span class="comment">// they will be part of the same code context</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">uint[] memory self, function (uint</span>) <span class="title">returns</span> (<span class="params">uint</span>) <span class="title">f</span>)</span></span><br><span class="line"><span class="function">    <span class="title">internal</span></span></span><br><span class="line"><span class="function">    <span class="title">returns</span> (<span class="params">uint[] memory r</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    r = <span class="keyword">new</span> uint[](self.length);</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; self.length; i++) &#123;</span><br><span class="line">      r[i] = f(self[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    uint[] memory self,</span></span></span><br><span class="line"><span class="function"><span class="params">    function (uint, uint</span>) <span class="title">returns</span> (<span class="params">uint</span>) <span class="title">f</span></span></span><br><span class="line"><span class="function">  )</span></span><br><span class="line"><span class="function">    <span class="title">internal</span></span></span><br><span class="line"><span class="function">    <span class="title">returns</span> (<span class="params">uint r</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    r = self[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">1</span>; i &lt; self.length; i++) &#123;</span><br><span class="line">      r = f(r, self[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">range</span>(<span class="params">uint length</span>) <span class="title">internal</span> <span class="title">returns</span> (<span class="params">uint[] memory r</span>) </span>&#123;</span><br><span class="line">    r = <span class="keyword">new</span> uint[](length);</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">      r[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Pyramid &#123;</span><br><span class="line">  using ArrayUtils <span class="keyword">for</span> *;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pyramid</span>(<span class="params">uint l</span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ArrayUtils.range(l).map(square).reduce(sum);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">uint x</span>) <span class="title">internal</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">uint x, uint y</span>) <span class="title">internal</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Externalï¼š å…¶ä»–åˆç´„å¯ä»¥å‘¼å«è©²åˆç´„çš„function<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Oracle &#123;</span><br><span class="line">  struct Request &#123;</span><br><span class="line">    bytes data;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">bytes memory</span>) <span class="title">external</span> <span class="title">callback</span>;</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line">  Request[] requests;</span><br><span class="line">  event NewRequest(uint);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params">bytes data, function(bytes memory</span>) <span class="title">external</span> <span class="title">callback</span>) </span>&#123;</span><br><span class="line">    requests.push(Request(data, callback));</span><br><span class="line">    NewRequest(requests.length - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reply</span>(<span class="params">uint requestID, bytes response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Here goes the check that the reply comes from a trusted source</span></span><br><span class="line">    requests[requestID].callback(response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract OracleUser &#123;</span><br><span class="line">  Oracle constant oracle = Oracle(<span class="number">0x1234567</span>); <span class="comment">// known contract</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">buySomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    oracle.query(<span class="string">"USD"</span>, <span class="keyword">this</span>.oracleResponse);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">oracleResponse</span>(<span class="params">bytes response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(msg.sender == address(oracle));</span><br><span class="line">    <span class="comment">// Use the data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å®£å‘ŠArray"><a href="#å®£å‘ŠArray" class="headerlink" title="å®£å‘ŠArray"></a>å®£å‘ŠArray</h3><p>ex:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint[] memory a = new uint[](7);</span><br></pre></td></tr></table></figure></p><h3 id="å®£å‘Š-Structï¼š-é¡ä¼¼å®£å‘Šä¸€å€‹ç‰©ä»¶æ¨¡æ¿"><a href="#å®£å‘Š-Structï¼š-é¡ä¼¼å®£å‘Šä¸€å€‹ç‰©ä»¶æ¨¡æ¿" class="headerlink" title="å®£å‘Š Structï¼š é¡ä¼¼å®£å‘Šä¸€å€‹ç‰©ä»¶æ¨¡æ¿"></a>å®£å‘Š Structï¼š é¡ä¼¼å®£å‘Šä¸€å€‹ç‰©ä»¶æ¨¡æ¿</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Funder &#123;</span><br><span class="line">     address addr;</span><br><span class="line">     uint amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a>Mappings</h3><p>å®£å‘Šæˆï¼š mapping(_KeyType =&gt; _ValueType) çš„å½¢å¼ï¼Œå¯ä»¥çœ‹æˆæ˜¯hash tableçš„å½¢å¼ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract MappingExample &#123;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) public balances;</span><br><span class="line">    <span class="comment">//è¨­å®šbalancesçš„indexç‚ºaddreesså½¢æ…‹çš„ï¼Œæ˜ å°„å‡ºå¾Œæœƒå¾—åˆ°uintå‹æ…‹çš„å›å‚³å€¼ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">uint newBalance</span>) </span>&#123;</span><br><span class="line">        balances[msg.sender] = newBalance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract MappingUser &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        MappingExample m = <span class="keyword">new</span> MappingExample();</span><br><span class="line">        m.update(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> m.balances(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–-Operators-Involving-LValuesï¼ˆå¯è¢«assignçš„value"><a href="#å…¶ä»–-Operators-Involving-LValuesï¼ˆå¯è¢«assignçš„value" class="headerlink" title="å…¶ä»– Operators Involving LValuesï¼ˆå¯è¢«assignçš„value)"></a>å…¶ä»– Operators Involving LValuesï¼ˆå¯è¢«assignçš„value)</h3><p>delete aï¼š æŠŠaåˆå§‹åŒ–æˆ 0<br>ï¼ˆä¹Ÿå¯ä»¥ç”¨åœ¨array éƒ½è¨­æˆ0, struct éƒ½è¨­æˆåˆå§‹å€¼)</p><h2 id="Etherå–®ä½"><a href="#Etherå–®ä½" class="headerlink" title="Etherå–®ä½"></a>Etherå–®ä½</h2><h3 id="Ether-Uintï¼š"><a href="#Ether-Uintï¼š" class="headerlink" title="Ether Uintï¼š"></a>Ether Uintï¼š</h3><p>1 ether =<br>1000000000000000000 wei, (10^18)<br>1000 finney, (10^3)<br>1000000 szabo (10^6)</p><h2 id="å…¨åŸŸå¯ç”¨è®Šæ•¸åŠå‡½å¼"><a href="#å…¨åŸŸå¯ç”¨è®Šæ•¸åŠå‡½å¼" class="headerlink" title="å…¨åŸŸå¯ç”¨è®Šæ•¸åŠå‡½å¼"></a>å…¨åŸŸå¯ç”¨è®Šæ•¸åŠå‡½å¼</h2><h3 id="Special-Variables-and-Functions"><a href="#Special-Variables-and-Functions" class="headerlink" title="Special Variables and Functions"></a>Special Variables and Functions</h3><ul><li><p><code>suicide.(Aåˆç´„)</code>: å°‡ç›®å‰åˆç´„çš„æ‰€æœ‰etheréƒ½è½‰å…¥åˆ°æŒ‡å®šçš„ï¼¡åˆç´„(contract)</p></li><li><p><code>delete</code>ï¼šå›æ”¶å®£å‘Šçš„æˆå“¡ï¼Œä¸¦ä¸”è¿”å›ä¸€äº›gasç•¶ä½œå›æ”¶çš„çå‹µã€‚</p></li></ul><p>å›æ”¶å„å‹æ…‹çš„åƒè€ƒè³‡æ–™ï¼š<a href="http://me.tryblockchain.org/solidity-delete.html" target="_blank" rel="noopener">http://me.tryblockchain.org/solidity-delete.html</a></p><h4 id="Block-and-Transaction-Properties"><a href="#Block-and-Transaction-Properties" class="headerlink" title="Block and Transaction Properties"></a>Block and Transaction Properties</h4><ul><li>block.blockhash(uint blockNumber) returns (bytes32): hash of the given block - only works for 256 most recent blocks excluding current</li><li>block.coinbase (address): current block minerâ€™s address</li><li>block.difficulty (uint): current block difficulty</li><li>block.gaslimit (uint): current block gaslimit</li><li>block.number (uint): current block number</li><li>block.timestamp (uint): current block timestamp as seconds since unix epoch</li><li>msg.data (bytes): complete calldata</li><li>msg.gas (uint): remaining gas</li><li><code>msg.sender</code> (address): sender of the message (current call)</li><li>msg.sig (bytes4): first four bytes of the calldata (i.e. function identifier)</li><li>msg.value (uint): number of wei sent with the message</li><li>now (uint): current block timestamp (alias for block.timestamp)</li><li>tx.gasprice (uint): gas price of the transaction</li><li>tx.origin (address): sender of the transaction (full call chain)(ä¸å»ºè­°ç”¨)</li></ul><h4 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h4><ul><li>assert(bool condition):<br>throws if the condition is not met - to be used for internal errors.</li><li>require(bool condition):<br>throws if the condition is not met - to be used for errors in inputs or external components.</li><li>revert():<br>abort execution and revert state changes</li></ul><h4 id="Mathematical-and-Cryptographic-Functions"><a href="#Mathematical-and-Cryptographic-Functions" class="headerlink" title="Mathematical and Cryptographic Functions"></a>Mathematical and Cryptographic Functions</h4><ul><li>addmod(uint x, uint y, uint k) returns (uint):<br>compute (x + y) % k where the addition is performed with arbitrary precision and does not wrap around at 2**256.</li><li>mulmod(uint x, uint y, uint k) returns (uint):<br>compute (x * y) % k where the multiplication is performed with arbitrary precision and does not wrap around at 2**256.</li><li>keccak256(â€¦) returns (bytes32):<br>compute the Ethereum-SHA-3 (Keccak-256) hash of the (tightly packed) arguments</li><li>sha256(â€¦) returns (bytes32):<br>compute the SHA-256 hash of the (tightly packed) arguments<br>sha3(â€¦) returns (bytes32):<br>alias to keccak256</li><li>ripemd160(â€¦) returns (bytes20):<br>compute RIPEMD-160 hash of the (tightly packed) arguments</li><li>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address):<br>recover the address associated with the public key from elliptic curve signature or return zero on error (example usage)</li></ul><h2 id="Solidityçš„è¡¨é”å’Œæ§åˆ¶çš„çµæ§‹ï¼ˆExpressions-and-Control-Structuresï¼‰"><a href="#Solidityçš„è¡¨é”å’Œæ§åˆ¶çš„çµæ§‹ï¼ˆExpressions-and-Control-Structuresï¼‰" class="headerlink" title="Solidityçš„è¡¨é”å’Œæ§åˆ¶çš„çµæ§‹ï¼ˆExpressions and Control Structuresï¼‰"></a>Solidityçš„è¡¨é”å’Œæ§åˆ¶çš„çµæ§‹ï¼ˆExpressions and Control Structuresï¼‰</h2><h3 id="Input-Parameters-and-Output-Parameters-æ¥æ”¶åƒæ•¸å’Œå›å‚³çš„å½¢å¼"><a href="#Input-Parameters-and-Output-Parameters-æ¥æ”¶åƒæ•¸å’Œå›å‚³çš„å½¢å¼" class="headerlink" title="Input Parameters and Output Parameters æ¥æ”¶åƒæ•¸å’Œå›å‚³çš„å½¢å¼"></a>Input Parameters and Output Parameters æ¥æ”¶åƒæ•¸å’Œå›å‚³çš„å½¢å¼</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Simple &#123;</span><br><span class="line">    <span class="comment">// æ¥æ”¶ uint _a , uint _bè®Šæ•¸</span></span><br><span class="line">    <span class="comment">// å›å‚³uint -_sum uint o_product</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">arithmetics</span>(<span class="params">uint _a, uint _b</span>) <span class="title">returns</span> (<span class="params">uint o_sum, uint o_product</span>) </span>&#123;</span><br><span class="line">        o_sum = _a + _b;</span><br><span class="line">        o_product = _a * _b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="External-Function-Calls"><a href="#External-Function-Calls" class="headerlink" title="External Function Calls"></a>External Function Calls</h4><p>å¦‚æœè¦å¾—çŸ¥å‘¼å«æŸåˆç´„çš„functionæœƒæœ‰å¤šå°‘Weiå’ŒèŠ±è²»å¤šå°‘gasï¼Œå¯ç”¨<br><code>.value()</code> <code>.gas()</code></p><p>ç¯„ä¾‹ä¸­çš„function info() å¦‚æœæ²’æœ‰åŠ ä¸Š <span style="color:red">payable</span>é€™å€‹keywordï¼Œå°±ç„¡æ³•ä½¿ç”¨ <code>.value()</code> </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract InfoFeed &#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">info</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">uint ret</span>) </span>&#123; <span class="keyword">return</span> <span class="number">42</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Consumer &#123;</span><br><span class="line">    InfoFeed feed;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setFeed</span>(<span class="params">address addr</span>) </span>&#123; feed = InfoFeed(addr); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callFeed</span>(<span class="params"></span>) </span>&#123; feed.info.value(<span class="number">10</span>).gas(<span class="number">800</span>)(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Creating-Contracts-via-new"><a href="#Creating-Contracts-via-new" class="headerlink" title="Creating Contracts via new"></a>Creating Contracts via <code>new</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract D &#123;</span><br><span class="line">    uint x;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">D</span>(<span class="params">uint a</span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        x = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    D d = <span class="keyword">new</span> D(<span class="number">4</span>); <span class="comment">// will be executed as part of C's constructor</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createD</span>(<span class="params">uint arg</span>) </span>&#123;</span><br><span class="line">        D newD = <span class="keyword">new</span> D(arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createAndEndowD</span>(<span class="params">uint arg, uint amount</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Send ether along with the creation</span></span><br><span class="line">        D newD = (<span class="keyword">new</span> D).value(amount)(arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Error-handling-Assert-Require-Revertand-Exceptions"><a href="#Error-handling-Assert-Require-Revertand-Exceptions" class="headerlink" title="Error handling: Assert, Require, Revertand Exceptions"></a>Error handling: <code>Assert</code>, <code>Require</code>, <code>Revert</code>and <code>Exceptions</code></h3><ul><li><code>require</code> can be used to easily check conditions on inputs.</li><li><code>assert</code> can be used for internal error checking.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Sharer &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sendHalf</span>(<span class="params">address addr</span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">uint balance</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">// Only allow even numbers</span></span><br><span class="line">        uint balanceBeforeTransfer = <span class="keyword">this</span>.balance;</span><br><span class="line">        addr.transfer(msg.value / <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// Since transfer throws an exception on failure and</span></span><br><span class="line">        <span class="comment">// cannot call back here, there should be no way for us to</span></span><br><span class="line">        <span class="comment">// still have half of the money.</span></span><br><span class="line">        assert(<span class="keyword">this</span>.balance == balanceBeforeTransfer - msg.value / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="assert-ç™¼ç”Ÿçš„ç‹€æ³ï¼š"><a href="#assert-ç™¼ç”Ÿçš„ç‹€æ³ï¼š" class="headerlink" title="assert ç™¼ç”Ÿçš„ç‹€æ³ï¼š"></a><code>assert</code> ç™¼ç”Ÿçš„ç‹€æ³ï¼š</h4><ul><li>If you access an array at a too large or negative index (i.e. x[i] where i &gt;= x.length or i &lt; 0).</li><li>If you access a fixed-length bytesN at a too large or negative index.</li><li>If you divide or modulo by zero (e.g. 5 / 0 or 23 % 0).</li><li>If you shift by a negative amount.</li><li>If you convert a value too big or negative into an enum type.</li><li>If you call a zero-initialized variable of internal function type.</li><li>If you call assert with an argument that evaluates to false.</li></ul><h4 id="require-ç™¼ç”Ÿçš„ç‹€æ³ï¼š"><a href="#require-ç™¼ç”Ÿçš„ç‹€æ³ï¼š" class="headerlink" title="require ç™¼ç”Ÿçš„ç‹€æ³ï¼š"></a><code>require</code> ç™¼ç”Ÿçš„ç‹€æ³ï¼š</h4><ul><li>Calling throw.</li><li>Calling require with an argument that evaluates to false.</li><li>If you call a function via a message call but it does not finish properly (i.e. it runs out of gas, has no matching function, or throws an exception itself), except when a low level operation call, send, delegatecall or callcode is used. The low level operations never throw exceptions but indicate failures by returning false.</li><li>If you create a contract using the new keyword but the contract creation does not finish properly (see above for the definition of â€œnot finish properlyâ€).</li><li>If you perform an external function call targeting a contract that contains no code.</li><li>If your contract receives Ether via a public function without payable modifier (including the constructor and the fallback function).</li><li>If your contract receives Ether via a public getter function.</li><li>If a .transfer() fails.</li></ul><h2 id="Solidity-Contract-å³Class"><a href="#Solidity-Contract-å³Class" class="headerlink" title="Solidity Contract(å³Class)"></a>Solidity Contract(å³Class)</h2><p>å‰µå»ºcontractçš„æ™‚å€™ï¼Œconstructoråªæœƒè¢«å‘¼å«ä¸€æ¬¡</p><h3 id="åˆç´„çš„Visibility-and-Getters"><a href="#åˆç´„çš„Visibility-and-Getters" class="headerlink" title="åˆç´„çš„Visibility and Getters"></a>åˆç´„çš„Visibility and Getters</h3><h4 id="Visibilityï¼š"><a href="#Visibilityï¼š" class="headerlink" title="Visibilityï¼š"></a>Visibilityï¼š</h4><ul><li><code>external</code>:<br>External functions are part of the contract interface, which means they can be called from other contracts and via transactions. An external function f cannot be called internally (i.e. f() does not work, but this.f() works). External functions are sometimes more efficient when they receive large arrays of data.</li><li><code>public</code>:<br>Public functions are part of the contract interface and can be either called internally or via messages. For public state variables, an automatic getter function (see below) is generated.</li><li><code>internal</code>:<br>Those functions and state variables can only be accessed internally (i.e. from within the current contract or contracts deriving from it), without using this.</li><li><code>private</code>:<br>Private functions and state variables are only visible for the contract they are defined in and not in derived contracts.</li></ul><h4 id="Getter-Functions"><a href="#Getter-Functions" class="headerlink" title="Getter Functions"></a>Getter Functions</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    uint public data;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        data = <span class="number">3</span>; <span class="comment">// internal access ç•¶æˆstateè®Šæ•¸</span></span><br><span class="line">        uint val = <span class="keyword">this</span>.data(); <span class="comment">// external access ç•¶æˆæ˜¯function</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Function-Modifier-é¡ä¼¼ï¼šå‡½å¼æ’æ§½"><a href="#Function-Modifier-é¡ä¼¼ï¼šå‡½å¼æ’æ§½" class="headerlink" title="Function Modifier (é¡ä¼¼ï¼šå‡½å¼æ’æ§½)"></a>Function Modifier (é¡ä¼¼ï¼šå‡½å¼æ’æ§½)</h3><p>Modifierå¯ç”¨ç”¨ä¾†æ“´å……å…¶ä»–functionçš„å…§å®¹ï¼Œéœ€è¦è¢«inheritæ‰èƒ½ä½¿ç”¨ã€‚<br>é€šå¸¸modifierç”¨ä¾†è¨­å®šä¸€äº›æ¢ä»¶ï¼Œå¹«åŠ©å‡½å¼è¢«åŸ·è¡Œæ™‚èƒ½å¤ å…ˆæ»¿è¶³è©²æ¢ä»¶å†è¢«åŸ·è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract owned &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">owned</span>(<span class="params"></span>) </span>&#123; owner = msg.sender; &#125;</span><br><span class="line">    address owner;</span><br><span class="line">    <span class="comment">// è©²ownedåˆç´„åªæœ‰å®£å‘Šä¸€å€‹modifier onlyOwnerï¼Œä¸¦ä¸”æ²’æœ‰ä½¿ç”¨å®ƒ</span></span><br><span class="line">    <span class="comment">// è©²modifieråªæœƒè¢«å…¶ä»–æœ‰ç¹¼æ‰¿owned contractçš„åˆç´„æ‰€ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// "_;" è¦ç¹¼æ‰¿onlyOwner å‡½å¼çš„å…§å®¹</span></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract mortal is owned &#123;</span><br><span class="line">    <span class="comment">// ç¹¼æ‰¿ ownedåˆç´„ </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// closeå‡½å¼ ä½¿ç”¨modifier "onlyOwner" </span></span><br><span class="line">    <span class="comment">// ä¸”closeçš„å…§å®¹æœƒæ’å…¥åœ¨ modifierä¸­çš„ "_;"ä¸­</span></span><br><span class="line">    <span class="comment">// å¯ä»¥æŠŠmodifieræƒ³åƒæˆ slotï¼ˆæ’æ§½)</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">        selfdestruct(owner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract priced &#123;</span><br><span class="line">    <span class="comment">// Modifier ä¹Ÿå¯ä»¥æ¥æ”¶åƒæ•¸</span></span><br><span class="line">    modifier costs(uint price) &#123;</span><br><span class="line">    <span class="comment">// è‹¥æ»¿è¶³msg.value &gt;= price é‚£å°±åŸ·è¡Œ ä½¿ç”¨è©²modifierå‡½å¼çš„å…§å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (msg.value &gt;= price) &#123;</span><br><span class="line">            _;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Register is priced, owned &#123;</span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> bool) registeredAddresses;</span><br><span class="line">    uint price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Register</span>(<span class="params">uint initialPrice</span>) </span>&#123; price = initialPrice; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éœ€è¦æä¾› payableï¼Œregisteræ‰æœƒæ¥å—ether</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ costs çš„modifier .</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">costs</span>(<span class="params">price</span>) </span>&#123;</span><br><span class="line">        registeredAddresses[msg.sender] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changePrice</span>(<span class="params">uint _price</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">        price = _price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Mutex &#123;</span><br><span class="line">    bool locked;</span><br><span class="line">    modifier noReentrancy() &#123;</span><br><span class="line">        <span class="built_in">require</span>(!locked);</span><br><span class="line">        locked = <span class="literal">true</span>;</span><br><span class="line">        _;</span><br><span class="line">        locked = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// noReentrancy è¢«ä¸€å€‹mutexæ‰€ä¿è­·ï¼Œå¿…é ˆè¦åˆ¤æ–·lockedæ˜¯å¦æ˜¯falseæ‰èƒ½åŸ·è¡Œ noReentrancyæ‰èƒ½åŸ·è¡Œ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// reentrant calls from within </span></span><br><span class="line">    <span class="comment">// msg.sender.call cannot call f again.å› çˆ²lockä½äº†</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ noReentrancy(modifier),</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) <span class="title">noReentrancy</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender.call());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Constant-State-Variables"><a href="#Constant-State-Variables" class="headerlink" title="Constant State Variables"></a>Constant State Variables</h3><p>ç›®å‰åƒ…æ”¯æ´ uint, stringä½¿ç”¨</p><p>å®£å‘Šä¸€æ¬¡å¾Œå°±ä¸èƒ½å†è¢«æ”¹è®Š</p><h3 id="Constant-Functions"><a href="#Constant-Functions" class="headerlink" title="Constant Functions"></a>Constant Functions</h3><p>ä¸æœƒæ”¹è®Šcontract stateçš„å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">uint a, uint b</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * (b + <span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Fallback-Function"><a href="#Fallback-Function" class="headerlink" title="Fallback Function"></a>Fallback Function</h3><p>æ²’æœ‰åç¨±çš„function,ä¸¦ä¸”æ²’æœ‰æ¥æ”¶åƒæ•¸ä»¥åŠä¸æœƒå‚³ä»»ä½•å€¼ã€‚<br>ç•¶å‘¼å«æŸåˆç´„çš„æ–¹æ³•æ™‚ï¼Œæ²’æœ‰è¾¦æ³•æˆåŠŸ</p><p>å¦‚æœæœ‰åˆç´„ç›´æ¥æ”¶åˆ°etherçš„è©±ï¼ˆäº¦å³ä¸æ˜¯é€ésend() or transfer() é‚£å°±å¾—å®šç¾©ä¸€å€‹fallback functionï¼Œä¸ç„¶æœƒthrow an exception.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; x = <span class="number">1</span>; &#125;</span><br><span class="line">  uint x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This contract keeps all Ether sent to it with no way</span></span><br><span class="line"><span class="comment">// to get it back.</span></span><br><span class="line">contract Sink &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Caller &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callTest</span>(<span class="params">Test test</span>) </span>&#123;</span><br><span class="line">        test.call(<span class="number">0xabcdef01</span>); </span><br><span class="line">        <span class="comment">// hash: 0xabcdef01 ä¸å­˜åœ¨ </span></span><br><span class="line">        <span class="comment">// æ•… test.xçš„çµæœæœƒè®Šæˆ test.x = 1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// The following will not compile, but even</span></span><br><span class="line">        <span class="comment">// if someone sends ether to that contract,</span></span><br><span class="line">        <span class="comment">// the transaction will fail and reject the</span></span><br><span class="line">        <span class="comment">// Ether.</span></span><br><span class="line">        <span class="comment">//test.send(2 ether);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><p>Eventæ‰€å¯«å…¥çš„è³‡æ–™æœƒè¢«è¨˜éŒ„åœ¨ä¸€å€‹Receiptï¼ˆtransaction logs)è³‡æ–™è£¡ï¼Œä¸¦ç­‰å¾…è¢«æ‰“åŒ…é€²å€å¡Šéˆã€‚</p><p>ç™½è©±ä¸€é»å°±æ˜¯ï¼šé€šçŸ¥å…¨ç¶²æœ‰ä¸€ä»¶äº‹æƒ…ç™¼ç”Ÿã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract ClientReceipt &#123;</span><br><span class="line">    event Deposit(</span><br><span class="line">        address indexed _from,</span><br><span class="line">        bytes32 indexed _id,</span><br><span class="line">        uint _value</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deposit</span>(<span class="params">bytes32 _id</span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Any call to this function (even deeply nested) can</span></span><br><span class="line">        <span class="comment">// be detected from the JavaScript API by filtering</span></span><br><span class="line">        <span class="comment">// for `Deposit` to be called.</span></span><br><span class="line">        Deposit(msg.sender, _id, msg.value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨javascript APIçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> abi = <span class="comment">/* abi as generated by the compiler */</span>;</span><br><span class="line"><span class="keyword">var</span> ClientReceipt = web3.eth.contract(abi);</span><br><span class="line"><span class="keyword">var</span> clientReceipt = ClientReceipt.at(<span class="number">0x123</span> <span class="comment">/* address */</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> event = clientReceipt.Deposit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// watch for changes</span></span><br><span class="line">event.watch(<span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// result will contain various information</span></span><br><span class="line">    <span class="comment">// including the argumets given to the Deposit</span></span><br><span class="line">    <span class="comment">// call.</span></span><br><span class="line">    <span class="keyword">if</span> (!error)</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or pass a callback to start watching immediately</span></span><br><span class="line"><span class="keyword">var</span> event = clientReceipt.Deposit(<span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!error)</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>ä½¿ç”¨ <code>is</code> ä¾†ç¹¼æ‰¿å…¶ä»–contract.</p><p>æä¾›å¤šé‡ç¹¼æ‰¿åŒæ™‚ä¹ŸåŒ…å«å¤šå‹<br>ç•¶ä¸€å€‹åˆç´„Rç¹¼æ‰¿å…¶ä»–A,B,Cçš„åˆç´„æ™‚ï¼Œåªæœ‰Rçš„åˆç´„è¢«æ‰“åŒ…é€²å»blockchainï¼Œå…¶ä»–ABCä¸æœƒã€‚ï¼ˆå› ç‚ºæ˜¯å°‡A,B,Cçš„å…§å®¹è¤‡è£½åˆ°Rçš„åˆç´„å…§)</p><p>åƒæ˜¯Pythonçš„ç¹¼æ‰¿ç‰¹æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract owned &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">owned</span>(<span class="params"></span>) </span>&#123; owner = msg.sender; &#125;</span><br><span class="line">    address owner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ "is" ä¾†ç¹¼æ‰¿ï¼Œå¯ä»¥å­˜å–ç¹¼æ‰¿åˆç´„çš„ non-private members (åŒ…å« internal function and state variables)ï¼Œç„¡æ³•é€é this ä¾†åšexternally access.</span></span><br><span class="line"></span><br><span class="line">contract mortal is owned &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.sender == owner) selfdestruct(owner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç•¶æˆæ˜¯ interfaceï¼Œç­‰å¾…è¢«ç¹¼æ‰¿å¯¦ä½œ</span></span><br><span class="line">contract Config &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">lookup</span>(<span class="params">uint id</span>) <span class="title">returns</span> (<span class="params">address adr</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">contract</span> <span class="title">NameReg</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">bytes32 name</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">unregister</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function">// å¯ä»¥å¯¦ç¾å¤šé‡ç¹¼æ‰¿</span></span><br><span class="line"><span class="function">// æ³¨æ„çš„æ˜¯"<span class="title">owned</span>" ä¸€æ¨£ä¹Ÿè¢«<span class="title">mortal</span>ç¹¼æ‰¿ï¼Œæ•…åªæœ‰ä¸€å€‹"<span class="title">owned</span>"çš„<span class="title">instance</span> (<span class="params">å’ŒC++çš„vritual inheritanceä¸€æ¨£</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">contract</span> <span class="title">named</span> <span class="title">is</span> <span class="title">owned</span>, <span class="title">mortal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">named</span>(<span class="params">bytes32 name</span>) </span>&#123;</span><br><span class="line">        Config config = Config(<span class="number">0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970</span>);</span><br><span class="line">        NameReg(config.lookup(<span class="number">1</span>)).register(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥override ç¹¼æ‰¿çš„function.æ³¨æ„è¦èˆ‡åŸæœ¬çš„å‹æ…‹è¦ä¸€è‡´</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.sender == owner) &#123;</span><br><span class="line">            Config config = Config(<span class="number">0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970</span>);</span><br><span class="line">            NameReg(config.lookup(<span class="number">1</span>)).unregister();</span><br><span class="line">            <span class="comment">// ä¾ç„¶å¯ä»¥å‘¼å«ç¹¼æ‰¿åˆç´„å…§çš„å‡½å¼</span></span><br><span class="line">            mortal.kill();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç¹¼æ‰¿çš„contractä¸­æœ‰çš„äººçš„contractoréœ€è¦parameter,</span></span><br><span class="line"><span class="comment">// é‚£å°±å¾—åœ¨ is å¾Œé¢çš„åœ°æ–¹è¼¸å…¥åƒæ•¸ï¼Œ</span></span><br><span class="line"><span class="comment">// å¦‚ä¸‹ "named("GoldFeed");</span></span><br><span class="line">contract PriceFeed is owned, mortal, named(<span class="string">"GoldFeed"</span>) &#123;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">updateInfo</span>(<span class="params">uint newInfo</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (msg.sender == owner) info = newInfo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span>(<span class="params">uint r</span>) </span>&#123; <span class="keyword">return</span> info; &#125;</span><br><span class="line"></span><br><span class="line">   uint info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šé‡ç¹¼æ‰¿è¦æ³¨æ„çš„é»ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract owned &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">owned</span>(<span class="params"></span>) </span>&#123; owner = msg.sender; &#125;</span><br><span class="line">    address owner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract mortal is owned &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.sender == owner) selfdestruct(owner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Base1 is mortal &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* do cleanup 1 */</span> mortal.kill(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Base2 is mortal &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* do cleanup 2 */</span> mortal.kill(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Final is Base1, Base2 &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å‘¼å« Final.kill åƒ…æœƒå‘¼å«åˆ° Base2çš„ kill function.<br>è€Œå¿½ç•¥æ‰ Base1 çš„.</p><h3 id="Abstract-Contracts"><a href="#Abstract-Contracts" class="headerlink" title="Abstract Contracts"></a>Abstract Contracts</h3><p><span style="color:red">ä¸å¯¦ä½œ</span>åˆç´„å…§çš„functionå…§å®¹ï¼Œè¢«ç¹¼æ‰¿æ™‚åœ¨å¯¦ä½œã€‚<br>ä½†å¯ä»¥å®šç¾©è®Šæ•¸ï¼Œå»ºæ§‹å­ç­‰ç­‰ã€‚</p><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Feline &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">utterance</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">bytes32</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h3><p>å’ŒAbstractå¾ˆåƒï¼Œä¸éä¸èƒ½æœ‰ä»»ä½•çš„functionè¢«å¯¦ä½œ<br>ä»¥ä¸‹ç‚ºé™åˆ¶æ¢ä»¶</p><ul><li>Cannot inherit other contracts or interfaces.</li><li>Cannot define constructor.</li><li>Cannot define variables.</li><li>Cannot define structs.</li><li>Cannot define enums.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">interface Token &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address recipient, uint amount</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h3><p>å’Œcontract(class)å¾ˆåƒï¼Œä¸éåƒ…æœƒåœ¨ç‰¹åœ°çš„addresséƒ¨ç½²ä¸€æ¬¡è€Œå·²ã€‚</p><p>å› ç‚ºä½ˆä¸€å€‹contractéœ€è¦gasï¼Œ<br>ä¸éå¦‚æœè¦é‡è¤‡ä½¿ç”¨Setçš„è©±ï¼Œåˆä¸æƒ³é‡è¤‡å®£å‘Šcontractï¼Œé‚£å°±å¯ä»¥ç”¨<br>Librariesä¾†å¯¦ä½œå‡ºä¸€å€‹Setï¼Œä¸¦ä¸”ä½ˆå‡ºå»å°±æœƒç”¢ç”Ÿä¸€å€‹åœ°å€ (linker)ï¼Œ<br>å…¶ä»–åˆç´„å°±å¯ä»¥é€élinkerä¾†ä½¿ç”¨Set.</p><p>ç›´æ¥çœ‹ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">library <span class="built_in">Set</span> &#123;</span><br><span class="line">  <span class="comment">// We define a new struct datatype that will be used to</span></span><br><span class="line">  <span class="comment">// hold its data in the calling contract.</span></span><br><span class="line">  struct Data &#123; mapping(<span class="function"><span class="params">uint</span> =&gt;</span> bool) flags; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Note that the first parameter is of type "storage</span></span><br><span class="line">  <span class="comment">// reference" and thus only its storage address and not</span></span><br><span class="line">  <span class="comment">// its contents is passed as part of the call.  This is a</span></span><br><span class="line">  <span class="comment">// special feature of library functions.  It is idiomatic</span></span><br><span class="line">  <span class="comment">// to call the first parameter 'self', if the function can</span></span><br><span class="line">  <span class="comment">// be seen as a method of that object.</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params">Data storage self, uint value</span>)</span></span><br><span class="line"><span class="function">      <span class="title">returns</span> (<span class="params">bool</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (self.flags[value])</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// already there</span></span><br><span class="line">      self.flags[value] = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">Data storage self, uint value</span>)</span></span><br><span class="line"><span class="function">      <span class="title">returns</span> (<span class="params">bool</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!self.flags[value])</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// not there</span></span><br><span class="line">      self.flags[value] = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">contains</span>(<span class="params">Data storage self, uint value</span>)</span></span><br><span class="line"><span class="function">      <span class="title">returns</span> (<span class="params">bool</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> self.flags[value];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    <span class="built_in">Set</span>.Data knownValues;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">uint value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// The library functions can be called without a</span></span><br><span class="line">        <span class="comment">// specific instance of the library, since the</span></span><br><span class="line">        <span class="comment">// "instance" will be the current contract.</span></span><br><span class="line">        <span class="built_in">require</span>(<span class="built_in">Set</span>.insert(knownValues, value));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// In this contract, we can also directly access knownValues.flags, if we want.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Style-Guide-ï¼ˆå¥—ç”¨eslint-for-solidity"><a href="#Style-Guide-ï¼ˆå¥—ç”¨eslint-for-solidity" class="headerlink" title="Style Guide ï¼ˆå¥—ç”¨eslint for solidity)"></a>Style Guide ï¼ˆå¥—ç”¨eslint for solidity)</h2><ul><li>Indentation: 4 spaces  (avoid using tabs.)</li><li>Order of Functions: (functionçš„å¯«æ³•çš„å„ªå…ˆé †åº)</li></ul><ol><li>constructor</li><li>fallback function (if exists)</li><li>external</li><li>public</li><li>internal</li><li>private</li></ol><hr><h2 id="Web3-js-å­¸ç¿’ç›®æ¨™"><a href="#Web3-js-å­¸ç¿’ç›®æ¨™" class="headerlink" title="Web3.js å­¸ç¿’ç›®æ¨™"></a>Web3.js å­¸ç¿’ç›®æ¨™</h2><p>ç­è§£ï¼š<br>1.å¦‚ä½•æŠŠkey pairæŠ“å‡ºä¾†<br>2.å¦‚ä½•ç°½é©—ç« <br>3.å¦‚ä½•é€²è¡ŒåŠ è§£å¯†<br>4.å¦‚ä½•ç™¼events</p><ul><li>ç’°ç°½ç« </li><li>åŒæ…‹åŠ å¯†<br>Confidential transactionï¼ˆ<br><a href="https://www.elementsproject.org/elements/confidential-transactions/" target="_blank" rel="noopener">https://www.elementsproject.org/elements/confidential-transactions/</a></li><li>ZKsnark(åŒ…å«é›¶çŸ¥è­˜è­‰æ˜)<br>åƒè€ƒï¼šï¼ˆæ‡‰ç”¨ä¾‹å­ï¼šä¸å…¬é–‹UTXOï¼Œä¹Ÿèƒ½è®“ç¤¦å·¥é©—è­‰ï¼Œä¸éç¤¦å·¥ä¸èƒ½è§£å¯†ï¼Œä¸ç„¶æœƒå¤±å»confidentialçš„ç‰¹æ€§ï¼Œä¸è®“receiverçŸ¥é“UTXOï¼‰<br><a href="https://z.cash/technology/zksnarks.html" target="_blank" rel="noopener">https://z.cash/technology/zksnarks.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Solidity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Ethereum </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨truffleä¾†ç·´ç¿’æ’°å¯«èªé¤Šå¯µç‰©çš„æ™ºèƒ½åˆç´„</title>
      <link href="/2017/09/07/truffle-petshop/"/>
      <url>/2017/09/07/truffle-petshop/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡æ˜¯ç¿»è­¯è‡ªTruffleå®˜æ–¹æ‰€é‡‹å‡ºçš„Dappæ•™å­¸æ–‡æª”Pet-Shop<br><a href="http://truffleframework.com/tutorials/pet-shop" target="_blank" rel="noopener">http://truffleframework.com/tutorials/pet-shop</a></p><h2 id="åŸ·è¡Œç’°å¢ƒ"><a href="#åŸ·è¡Œç’°å¢ƒ" class="headerlink" title="åŸ·è¡Œç’°å¢ƒ"></a>åŸ·è¡Œç’°å¢ƒ</h2><h3 id="é–‹ç™¼å‰æº–å‚™"><a href="#é–‹ç™¼å‰æº–å‚™" class="headerlink" title="é–‹ç™¼å‰æº–å‚™"></a>é–‹ç™¼å‰æº–å‚™</h3><p>é¦–å…ˆè¦å®‰è£testrpcã€truffle :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ethereumjs-testrpc</span><br><span class="line">// å®‰è£æ¸¬è©¦ç”¨ethereumç§æœ‰éŠ</span><br><span class="line"></span><br><span class="line">npm install -g truffle</span><br><span class="line">// é–‹ç™¼æ™ºèƒ½åˆç´„çš„ä¸€å¥—æ¡†æ¶</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>å®‰è£truffleä¸Šå·²ç¶“é å…ˆåŒ…å¥½çš„ç·´ç¿’å°ˆæ¡ˆ(Truffle box: ETHEREUM PET SHOP)ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir pet-shop-tutorial </span><br><span class="line">// å‰µå»ºä¸€å€‹ç›®éŒ„</span><br><span class="line"></span><br><span class="line">cd pet-shop-tutorial </span><br><span class="line">// åˆ‡æ›åˆ°è©²ç›®éŒ„</span><br><span class="line"></span><br><span class="line">truffle unbox pet-shop</span><br><span class="line">// å®‰è£truffleæ‰“åŒ…å¥½çš„pet-shopç·´ç¿’å°ˆæ¡ˆæª”</span><br></pre></td></tr></table></figure></p><h3 id="ç›®éŒ„æ¶æ§‹"><a href="#ç›®éŒ„æ¶æ§‹" class="headerlink" title="ç›®éŒ„æ¶æ§‹"></a>ç›®éŒ„æ¶æ§‹</h3><ul><li><p>/contracts: å­˜æ”¾åˆç´„çš„åœ°æ–¹ï¼Œæª”åç‚º.solï¼Œè€ŒMigrate.solæ˜¯è² è²¬ç´€éŒ„å…¶ä»–åˆç´„å¦‚ä½•deployåˆ°å€å¡Šéˆï¼Œä¸èƒ½åˆªé™¤ï¼</p></li><li><p>/migrations: è² è²¬å°‡åˆç´„æ›åˆ°å€å¡Šéˆä¸Šï¼Œä¸¦ä¸”è¿½è¹¤åˆç´„çš„æ›´å‹•ç‹€æ³ã€‚ </p></li><li><p>/test: åŒ…å«Javascript and solidityæª”æ¡ˆï¼Œè² è²¬æ¸¬è©¦åˆç´„å…§å®¹ã€‚</p></li><li><p><code>truffle.js</code> : truffleçš„è¨­å®šæª”</p></li></ul><h2 id="åˆç´„å…§å®¹"><a href="#åˆç´„å…§å®¹" class="headerlink" title="åˆç´„å…§å®¹"></a>åˆç´„å…§å®¹</h2><h3 id="åœ¨-contract-å»ºç«‹-Adoption-sol"><a href="#åœ¨-contract-å»ºç«‹-Adoption-sol" class="headerlink" title="åœ¨/contract å»ºç«‹ Adoption.sol"></a>åœ¨/contract å»ºç«‹ Adoption.sol</h3><p>å®£å‘Šä¸€å€‹contract:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"><span class="comment">// å‘Šè¨´compiler ç¾åœ¨è¦ç”¨å“ªå€‹ç‰ˆæœ¬ç·¨è­¯</span></span><br><span class="line"></span><br><span class="line">contract Adoption &#123; <span class="comment">//å®£å‘Šä¸€å€‹ contractçš„class å« Adoption</span></span><br><span class="line">  <span class="comment">// å­˜æ”¾é ˜é¤Šé£¼ä¸»çš„åœ°å€ï¼ˆé è¨­æ˜¯æœ‰16éš»ç‹—ç­‰å¾…è¢«èªé¤Šï¼‰</span></span><br><span class="line">  address[<span class="number">16</span>] public adopters; </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// æœ‰äººè¦èªé¤ŠæŸéš»å¯µç‰©(petId)ï¼Œåˆ¤æ–·æ˜¯å¦å¯ä»¥èªé¤Šï¼Œ</span></span><br><span class="line">  <span class="comment">// å›å‚³è©²èªé¤Šçš„å¯µç‰©IDä»¥è­‰æ˜è©²å¯µç‰©æˆåŠŸè¢«æŸç”¨æˆ¶èªé¤Š</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">adopt</span>(<span class="params">uint petId</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">     </span><br><span class="line">      <span class="built_in">require</span>(petId &gt;= <span class="number">0</span> &amp;&amp; petId &lt;= <span class="number">15</span>);</span><br><span class="line">      <span class="comment">// åˆ¤æ–·petIdï¼Œè‹¥ä¸ç¬¦åˆçµæŸè©²å‡½å¼ï¼Œä¸å†å¾€ä¸‹åŸ·è¡Œ</span></span><br><span class="line">       </span><br><span class="line">      adopters[petId] = msg.sender;</span><br><span class="line">      <span class="comment">// é€émsg.senderå–å¾—å‘¼å«è©²å‡½å¼çš„ä½¿ç”¨è€…</span></span><br><span class="line">      <span class="comment">// ä¹Ÿå°±æ˜¯èªé¤Šè©²å¯µç‰©çš„ç”¨æˆ¶ID</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> petId;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å›å‚³æ‰€æœ‰çš„èªé¤Šè€…ï¼Œå›å‚³å€¼çš„å‹æ…‹ç‚ºaddress[16]</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAdopters</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">address[<span class="number">16</span>]</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> adopters;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç·¨è­¯-Compiling-å’Œéƒ¨ç½²-Migrating-åˆç´„"><a href="#ç·¨è­¯-Compiling-å’Œéƒ¨ç½²-Migrating-åˆç´„" class="headerlink" title="ç·¨è­¯(Compiling)å’Œéƒ¨ç½²(Migrating)åˆç´„"></a>ç·¨è­¯(Compiling)å’Œéƒ¨ç½²(Migrating)åˆç´„</h2><p>å¯«å¥½åˆç´„å¾Œï¼Œéœ€è¦å°‡.solæª”é€²è¡Œç·¨è­¯æˆ.bytecodeï¼Œæ‰èƒ½åœ¨EVM (ethereum virtual machineä¸ŠåŸ·è¡Œ).</p><p>ç„¶å¾Œåœ¨terminalä¸ŠåŸ·è¡Œ <code>testrpc</code> å•Ÿå‹•</p><p>å•Ÿå‹•å¾Œæœƒå‡ºç¾ï¼š</p><ul><li>æ•¸çµ„å¸³æˆ¶çš„addressä»¥åŠç§é‘°</li><li>HD walletçš„è³‡è¨Šï¼ˆç¨å¾Œæœƒæåˆ°metataskï¼Œæœƒä½¿ç”¨åˆ°Mnemonic sectionçš„è³‡è¨Š)</li></ul><blockquote><p>Mnemonicç‚ºæ•¸å€‹è®Šæ•¸çš„è³‡è¨Šï¼Œå¦‚ä¸‹<br>Mnemonic:  spider level team helmet shaft clarify abuse recipe stem ankle angry fee</p></blockquote><p>åŸ·è¡Œ <code>truffle compile</code> æœƒçœ‹åˆ° .solæª”è¢«ç·¨è­¯</p><h3 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h3><p>migrate.solæè¿°å¦‚ä½•å°‡åˆç´„çš„å…§å®¹éƒ¨ç½²åˆ°éˆä¸Šï¼Œä¸¦ä¸”è™•ç†åˆç´„ä¸Šstateçš„æ›´å‹•ã€‚</p><p>åœ¨ <code>/migration</code> æª”æ¡ˆå…§ï¼š</p><ul><li>1_initial_migration.jsï¼š</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ç·¨è­¯åˆç´„çš„å…§å®¹</span></span><br><span class="line"><span class="keyword">var</span> Migrations = artifacts.require(<span class="string">"./Migrations.sol"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(Migrations);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€éè©²æª”æ¡ˆå¯ä»¥è¿½è¹¤å¾ŒçºŒcontractçš„è®ŠåŒ–ï¼Œå·²éƒ¨ç½²éçš„åˆç´„ä¸”æ²’æœ‰è¢«ä¿®æ”¹å°±ä¸ç”¨å†è¢«éƒ¨ç½²ï¼ˆä¸ç„¶åˆæœƒæ¶ˆè€—gas).</p><ul><li>2_deploy_contracts.js<br><span style="color:red">æ³¨æ„ï¼Œé€™é‚Šçš„å‘½åé–‹é ­è¦ç·¨è™Ÿï¼Œå› ç‚ºtruffleé€²è¡Œmigrateæ™‚æœƒä¾æ“šè©²ç·¨è™Ÿè€Œé€²è¡Œã€‚</span></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Adoption = artifacts.require(<span class="string">"./Adoption.sol"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(Adoption);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨terminalåŸ·è¡Œ <code>truffle migrate</code> </p><p>æœƒçœ‹åˆ°å¦‚ä¸‹çµæœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Using network &apos;development&apos;.</span><br><span class="line"></span><br><span class="line">Running migration: 1_initial_migration.js</span><br><span class="line">  Deploying Migrations...</span><br><span class="line">  Migrations: 0x75175eb116b36ff5fef15ebd15cbab01b50b50d1</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br><span class="line">Running migration: 2_deploy_contracts.js</span><br><span class="line">  Deploying Adoption...</span><br><span class="line">  Adoption: 0xb9f485451a945e65e48d9dd7fc5d759af0a89e21</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">Saving artifacts...</span><br></pre></td></tr></table></figure></p><p>è‹¥çœ‹åˆ°ä¸Šè¿°è¡¨é¢è¡¨ç¤ºæˆ‘å€‘å¯«çš„ç¬¬ä¸€éš» Adoption.solçš„åˆç´„å·²ç¶“æˆåŠŸè¢«éƒ¨ç½²åˆ°éˆä¸Šï¼</p><h2 id="ç‚ºSmart-Contractå¯«æ¸¬è©¦"><a href="#ç‚ºSmart-Contractå¯«æ¸¬è©¦" class="headerlink" title="ç‚ºSmart Contractå¯«æ¸¬è©¦"></a>ç‚ºSmart Contractå¯«æ¸¬è©¦</h2><p>æˆ‘å€‘å¯ä»¥ç”¨javascriptæˆ–solidityå¯«æ¸¬è©¦ï¼Œ<br>ä¸éæœ¬ç¯„ä¾‹ç”¨solidityä¾†å¯«ã€‚</p><hr><p>åœ¨ /test ç›®éŒ„ä¸‹å‰µå»º <code>TestAdoption.sol</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•ç”¨truffleå…§å»ºçš„æª”æ¡ˆ </span></span><br><span class="line"><span class="comment">// Assert.solç”¨ä¾†åšUnit test (åˆ¤æ–·function input ?= output)</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"truffle/Assert.sol"</span>;</span><br><span class="line"><span class="comment">// ç•¶æ¸¬è©¦åŸ·è¡Œï¼Œtruffleæœƒåœ¨testrpcä¸­æ¸¬è©¦è©²åˆç´„ï¼Œ</span></span><br><span class="line"><span class="comment">// è©²DeployedAddressesç”¨ä¾†å–å¾—è¢«éƒ¨ç½²åˆç´„çš„address</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"truffle/DeployedAddresses.sol"</span>;</span><br><span class="line"><span class="comment">// è¦è¢«æ¸¬è©¦çš„åˆç´„</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"../contracts/Adoption.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract TestAdoption &#123;</span><br><span class="line">    Adoption adoption = Adoption(DeployedAddresses.Adoption());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Testing The adopt() Function</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">testUserCanAdoptPet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å‘¼å«Adoptionä¸­çš„adoptæ–¹æ³•</span></span><br><span class="line">      uint returnedId = adoption.adopt(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">      uint expected = <span class="number">8</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åˆ¤æ–·returnID æ˜¯å¦ç­‰æ–¼ expectedçš„å€¼</span></span><br><span class="line">      Assert.equal(returnedId, expected, <span class="string">"Adoption of pet ID 8 should be recorded."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Testing Retrieval of a Single Pet's Owner</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetId</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// é€éthiså–å¾—ç›®å‰åˆç´„çš„åœ°å€</span></span><br><span class="line">      address expected = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      address adopter = adoption.adopters(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">      Assert.equal(adopter, expected, <span class="string">"Owner of pet ID 8 should be recorded."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Testing Retrieval of All Pet Owners</span></span><br><span class="line">    </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetIdInArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      address expected = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      address[<span class="number">16</span>] memory adopters = adoption.getAdopters();</span><br><span class="line"></span><br><span class="line">      Assert.equal(adopters[<span class="number">8</span>], expected, <span class="string">"Owner of pet ID 8 should be recorded."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸ·è¡Œ <code>truffle test</code>  è‹¥çœ‹åˆ°ä»¥ä¸‹ç•«é¢è¡¨ç¤ºtesté€šé<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Using network &apos;development&apos;.</span><br><span class="line"></span><br><span class="line">Compiling ./contracts/Adoption.sol...</span><br><span class="line">Compiling ./test/TestAdoption.sol...</span><br><span class="line">Compiling truffle/Assert.sol...</span><br><span class="line">Compiling truffle/DeployedAddresses.sol...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  TestAdoption</span><br><span class="line">    âœ“ testUserCanAdoptPet (91ms)</span><br><span class="line">    âœ“ testGetAdopterAddressByPetId (70ms)</span><br><span class="line">    âœ“ testGetAdopterAddressByPetIdInArray (89ms)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  3 passing (670ms)</span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨UIå’ŒSmart-Contractäº’å‹•"><a href="#ä½¿ç”¨UIå’ŒSmart-Contractäº’å‹•" class="headerlink" title="ä½¿ç”¨UIå’ŒSmart Contractäº’å‹•"></a>ä½¿ç”¨UIå’ŒSmart Contractäº’å‹•</h2><p>ç•¶è§£é–‹truffle boxçš„pet-shopï¼Œå¯ä»¥çœ‹åˆ°åœ¨ <code>/src</code>ç›®éŒ„åº•ä¸‹<br>æœƒæœ‰å·²ç¶“é è¨­å¥½çš„UIæª”ä¾›ç·´ç¿’ç”¨ã€‚</p><h3 id="ä½¿ç”¨Web3-jsåˆå§‹åŒ–å‰ç«¯ç’°å¢ƒ"><a href="#ä½¿ç”¨Web3-jsåˆå§‹åŒ–å‰ç«¯ç’°å¢ƒ" class="headerlink" title="ä½¿ç”¨Web3.jsåˆå§‹åŒ–å‰ç«¯ç’°å¢ƒ"></a>ä½¿ç”¨Web3.jsåˆå§‹åŒ–å‰ç«¯ç’°å¢ƒ</h3><p>Web3.jsç‚ºç”¨ä¾†å’Œethereumæºé€šçš„javascript library.<br>ï¼ˆè€Œç·´ç¿’å°ˆæ¡ˆå‰ç«¯æ˜¯ä½¿ç”¨jQuery)</p><p>åœ¨ <code>/src/js/app.js</code>æª”æ¡ˆçš„å…§å®¹æ”¹ç‚ºä»¥ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">App = &#123;</span><br><span class="line">  web3Provider: <span class="literal">null</span>,</span><br><span class="line">  contracts: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">  init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¼‰å…¥å¯µç‰©çš„è³‡æ–™</span></span><br><span class="line">    $.getJSON(<span class="string">'../pets.json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> petsRow = $(<span class="string">'#petsRow'</span>);</span><br><span class="line">      <span class="keyword">var</span> petTemplate = $(<span class="string">'#petTemplate'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; data.length; i ++) &#123;</span><br><span class="line">        petTemplate.find(<span class="string">'.panel-title'</span>).text(data[i].name);</span><br><span class="line">        petTemplate.find(<span class="string">'img'</span>).attr(<span class="string">'src'</span>, data[i].picture);</span><br><span class="line">        petTemplate.find(<span class="string">'.pet-breed'</span>).text(data[i].breed);</span><br><span class="line">        petTemplate.find(<span class="string">'.pet-age'</span>).text(data[i].age);</span><br><span class="line">        petTemplate.find(<span class="string">'.pet-location'</span>).text(data[i].location);</span><br><span class="line">        petTemplate.find(<span class="string">'.btn-adopt'</span>).attr(<span class="string">'data-id'</span>, data[i].id);</span><br><span class="line"></span><br><span class="line">        petsRow.append(petTemplate.html());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> App.initWeb3();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  initWeb3: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–web3.jsä¸¦ä¸”è¨­ç½®provideré€£æ¥testrpc</span></span><br><span class="line">   </span><br><span class="line">     <span class="comment">// å¦‚æœåµæ¸¬åˆ°æœ‰metamaskæ³¨å…¥åœ¨ç€è¦½å™¨çš„web3 instance</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      App.web3Provider = web3.currentProvider;</span><br><span class="line">       <span class="comment">// å°‡currentProvider = metamask</span></span><br><span class="line">       <span class="comment">// </span></span><br><span class="line">      web3 = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è‹¥æ²’æœ‰metamask or mistç­‰ç­‰ä¹‹é¡çš„ï¼Œ</span></span><br><span class="line">      <span class="comment">// é‚£å°±ç”¨è‡ªå·±é–‹å•Ÿtestrpcç•¶æˆæ˜¯provider</span></span><br><span class="line">      App.web3Provider = <span class="keyword">new</span> web3.providers.HttpProvider(<span class="string">'http://localhost:8545'</span>);</span><br><span class="line">      web3 = <span class="keyword">new</span> Web3(App.web3Provider);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> App.initContract();</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  initContract: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">   $.getJSON(<span class="string">'Adoption.json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">   </span><br><span class="line">      <span class="comment">// å–å¾—contractçš„artifact(Adoption.json) </span></span><br><span class="line">      <span class="comment">// ä¾‹å¦‚contract address, ABI (Application Binary Interface)ï¼š</span></span><br><span class="line">      <span class="comment">// å³å¦‚ä½•ä½¿ç”¨contractçš„è®Šæ•¸ã€å‡½å¼ç­‰ç­‰</span></span><br><span class="line">      <span class="keyword">var</span> AdoptionArtifact = data;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// truffleæä¾›`truffle-contract`ä¾†å¹«åŠ©æˆ‘å€‘ç›£è½å·²ç¶“è¢«migrateçš„contract</span></span><br><span class="line">      <span class="comment">// ä¸¦æŠŠcontractçš„artifactå‚³çµ¦truffle-contract'ï¼Œå¥½è®“æˆ‘å€‘å¯ä»¥è·Ÿåˆç´„æºé€š</span></span><br><span class="line">      App.contracts.Adoption = TruffleContract(AdoptionArtifact);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç‚ºcontractè¨­ç½®Provider(æˆ‘å€‘æ˜¯ç”¨metamask)</span></span><br><span class="line">      App.contracts.Adoption.setProvider(App.web3Provider);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¾Adpotion.jsonçš„åˆç´„è³‡æ–™ä¸­ï¼Œåˆ¤æ–·å¯µç‰©çš„æ˜¯å¦å·²è¢«èªé¤Šä¸¦åšæ¨™ç¤º</span></span><br><span class="line">      <span class="keyword">return</span> App.markAdopted();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> App.bindEvents();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  bindEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="built_in">document</span>).on(<span class="string">'click'</span>, <span class="string">'.btn-adopt'</span>, App.handleAdopt);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  handleAdopt: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> petId = <span class="built_in">parseInt</span>($(event.target).data(<span class="string">'id'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> adoptionInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨web3ä¾†å–å¾—user's accounts</span></span><br><span class="line">    <span class="comment">// é€™æ™‚metamaskæœƒè·³å‡ºäº¤æ˜“è¨Šæ¯å‡ºä¾†</span></span><br><span class="line">    web3.eth.getAccounts(<span class="function"><span class="keyword">function</span>(<span class="params">error, accounts</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// é¸æ“‡ç¬¬ä¸€å€‹accountsä½œç‚ºæˆ‘å€‘çš„ç”¨æˆ¶</span></span><br><span class="line">      <span class="keyword">var</span> account = accounts[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      App.contracts.Adoption.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">        adoptionInstance = instance;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨é€™è£¡è¦åŸ·è¡ŒæœƒèŠ±è²»gasçš„transaction</span></span><br><span class="line">        <span class="comment">// å–å¾—èªé¤Šç”¨æˆ¶çš„accountï¼Œä»¥åŠé»é¸æ¬²èªé¤Šçš„petId</span></span><br><span class="line">        <span class="keyword">return</span> adoptionInstance.adopt(petId, &#123;<span class="attr">from</span>: account&#125;);</span><br><span class="line">      &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è‹¥å›å‚³çµæœæ­£å¸¸åŸ·è¡ŒmarkAdoptedåˆ·æ–°UIä¸Šå¯µç‰©èªé¤Šä¸­çš„ç‹€æ…‹</span></span><br><span class="line">        <span class="keyword">return</span> App.markAdopted();</span><br><span class="line">      &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err.message);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  markAdopted: <span class="function"><span class="keyword">function</span>(<span class="params">adopters, account</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> adoptionInstance;</span><br><span class="line"></span><br><span class="line">    App.contracts.Adoption.deployed().then(<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å–å¾—Adpotionåˆç´„çš„å…§å®¹</span></span><br><span class="line">      adoptionInstance = instance;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‘¼å«åˆç´„ä¸­çš„getAdoptersæ–¹æ³•</span></span><br><span class="line">      <span class="comment">// åˆ©ç”¨`call`å¯ä»¥ç›´æ¥è®€å–Blockchainä¸Šçš„è³‡æ–™ï¼Œä¸ç”¨èŠ±è²»ether(gas)</span></span><br><span class="line">      <span class="keyword">return</span> adoptionInstance.getAdopters.call();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">adopters</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; adopters.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (adopters[i] !== <span class="string">'0x0000000000000000000000000000000000000000'</span>) &#123;</span><br><span class="line">          $(<span class="string">'.panel-pet'</span>).eq(i).find(<span class="string">'button'</span>).text(<span class="string">'Pending...'</span>).attr(<span class="string">'disabled'</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err.message);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="built_in">window</span>).load(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    App.init();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="åœ¨Chromeä¸Šå’ŒDappäº’å‹•"><a href="#åœ¨Chromeä¸Šå’ŒDappäº’å‹•" class="headerlink" title="åœ¨Chromeä¸Šå’ŒDappäº’å‹•"></a>åœ¨Chromeä¸Šå’ŒDappäº’å‹•</h2><p>å®‰è£ <code>metamask</code>çš„æ“´å……å¥—ä»¶</p><p>é•·é€™æ¨£ï¼š<br><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37198612385/in/dateposted-public/" title="petshop_1" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4356/37198612385_95741b233a_o.png" width="300" style=" display: block;    margin: 0 auto;" alt="petshop_1"></a></p><p>ç”±æ–¼æˆ‘å€‘è¦æ¸¬è©¦è‡ªå·±çš„Dappï¼Œé»é¸è©²åœ–å·¦ä¸Šè§’åˆ‡æ›åˆ°è‡ªå·±é–‹å•Ÿtestrpc:8545çš„ç§æœ‰éˆ</p><p>å› ç‚ºæ˜¯åˆæ¬¡ç™»å…¥ï¼Œé»é¸<code>I forgot my password</code></p><p>å°‡ä¸€é–‹å§‹é–‹å•Ÿtestrpc ç”¢ç”Ÿçš„ Mnemonicï¼ˆæ•¸çµ„è®Šæ•¸åç¨±ï¼‰è²¼åˆ°wallet seed.<br>Mnemonic:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spider level team helmet shaft clarify abuse recipe stem ankle angry fee</span><br></pre></td></tr></table></figure></p><p>(Warningï¼šä½ çš„testrpcç”¢ç”Ÿçš„Mnemonicè®Šæ•¸çµ„æœƒè·Ÿä¸Šé¢çš„ä¸ä¸€æ¨£)</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37026566092/in/dateposted-public/" title="petshop_2" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4440/37026566092_e498643295_o.png" width="300" alt="petshop_2" style="display:block; margin: 0px auto"></a></p><p>è¨­ç½®è‡ªå·±çš„æ–°å¯†ç¢¼ï¼Œç¢ºèªå¾Œé»é¸<code>OK</code></p><p>é€²å…¥å¾Œå°±æœƒçœ‹åˆ°è‡ªå·±çš„ç¬¬ä¸€ç­†accountè³‡è¨Šäº†</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37198612325/in/dateposted-public/" title="petshop_3" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4334/37198612325_b204dcfecd_o.png" width="300" alt="petshop_3" style="display:block; margin: 0px auto"></a></p><p>è‹¥æœ‰é¡¯ç¤ºå¸³æˆ¶è¡¨ç¤ºæˆåŠŸèˆ‡testrpcé€£æ¥<br>(åŸæœ¬testrpcæ˜¯é è¨­100 etherï¼Œé¡¯ç¤ºå‡ºä¾†ä¸æ˜¯100 etherçš„åŸå› æ˜¯å› ç‚º<br>éƒ¨ç½²åˆç´„åˆ°è‡ªå·±çš„private blockchainä¹Ÿéœ€è¦è²»ç”¨)</p><h2 id="å®‰è£å’Œè¨­ç½®lite-serverå•Ÿå‹•Dapp"><a href="#å®‰è£å’Œè¨­ç½®lite-serverå•Ÿå‹•Dapp" class="headerlink" title="å®‰è£å’Œè¨­ç½®lite-serverå•Ÿå‹•Dapp"></a>å®‰è£å’Œè¨­ç½®<code>lite-server</code>å•Ÿå‹•Dapp</h2><p><code>lite-server</code>å·²ç¶“åŒ…å«åœ¨pet-shopçš„boxå…§</p><p>åœ¨ <code>bs-config.json</code>æª”æ¡ˆä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;server&quot;: &#123;</span><br><span class="line">    &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è©²è¨­ç½®å‘Šè¨´serverè¦åŸ·è¡Œçš„åŸºåº•ç›®éŒ„åœ¨å“ªã€‚</p><p><code>./src</code>ï¼šå‰ç«¯çš„å…§å®¹<br><code>./build/contracts</code>ï¼šæ”¾ç½®åˆç´„çš„å…§å®¹</p><p>åœ¨scriptæª”ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;lite-server&quot;,</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>è¨­ç½® <code>&quot;dev&quot; : lite-server&quot;</code><br>æ–¹ä¾¿æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨terminalä¸‹åŸ·è¡Œ <code>npm run dev</code> ä¾†é‹è¡ŒDapp</p><p>é‹è¡ŒæˆåŠŸå¾Œçš„æ¨£å­</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37026566282/in/dateposted-public/" title="petshop_4" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4442/37026566282_eee8a73f05_o.png" width="2468" alt="petshop_4"></a></p><hr><p>è‹¥è¦é€²è¡Œèªé¤Šï¼šé»é¸ <code>Adopt</code>æŒ‰éˆ•</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/36800845780/in/dateposted-public/" title="petshop_5" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4348/36800845780_f0c66f0cdc_o.png" width="2020" alt="petshop_5"></a></p><p>é»é¸<code>Sumit</code>å¾Œå³å®Œæˆèªé¤Šçš„å‹•ä½œï¼Œä¸¦ä¸”æŠŠè©²èªé¤Šçš„è³‡è¨Šé€éåˆç´„æ›åˆ°testrpcçš„éˆä¸Šï¼Œä¸¦åœ¨è©²å¯µç‰©ä¸Šç‹€æ…‹æ”¹æˆ <code>Pending...</code> ï¼ˆå·²èªé¤Šï¼‰</p><p><a data-flickr-embed="true" href="https://www.flickr.com/photos/151390350@N07/37198612255/in/dateposted-public/" title="petshop_6" target="_blank" rel="noopener"><img src="https://farm5.staticflickr.com/4404/37198612255_5f2e75a536_o.png" width="200" alt="petshop_6" style="display:block; margin: 0px auto"></a></p><h2 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h2><ul><li>å°‡å‰ç«¯æ”¹æˆç”¨Vue.js<br>å¯ä»¥è€ƒæ…®ç”¨ä»¥ä¸‹packageï¼š Vue-Truffle-Webpack<br><a href="https://github.com/wilfreddenton/vue-truffle-webpack" target="_blank" rel="noopener">https://github.com/wilfreddenton/vue-truffle-webpack</a></li><li>é¡¯ç¤ºè©²éš»ç‹—è¢«å“ªä½ç”¨æˆ¶èªé¤Šèµ°</li><li>æ”¹æˆè¦ä»˜è¶³å¤ çš„éŒ¢æ‰èƒ½èªé¤Šè©²éš»ç‹—</li></ul>]]></content>
      
      
      <categories>
          
          <category> Solidity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Solidity </tag>
            
            <tag> Truffle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Hexoä¾†è¨˜éŒ„è‡ªå·±çš„å­¸ç¿’ä¸¦ä½¿ç”¨Material-flowä¸»é¡Œ</title>
      <link href="/2017/09/05/How_To_Use_Hexo/"/>
      <url>/2017/09/05/How_To_Use_Hexo/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœè¦æ‰“é€ è‡ªå·±é¢¨æ ¼çš„Blogï¼Œé‚£å°±ä¸èƒ½éŒ¯éHexo<br>Hexoæ˜¯ä¸€å¥—é–‹æºçš„æ¶å€‹äººéƒ¨è½æ ¼çš„æ¡†æ¶ï¼Œ</p><a id="more"></a><p>å…¶å„ªé»å¦‚ä¸‹ï¼š</p><ul><li>æ–‡ç« ä»¥markdownæ ¼å¼ç‚ºä¸»ã€‚</li><li>ä¸¦ä¸”èƒ½ä¸€éµéƒ¨ç½²åœ¨Githubï¼Œå…¬é–‹çµ¦å¤§å®¶çœ‹ã€‚</li><li>æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„template themeä¾†è£é£¾è‡ªå·±çš„Blog</li></ul><p>æˆ‘ç›®å‰é€™å€‹Blogçš„ä¸»é¡Œæ˜¯ä½¿ç”¨NextTå›‰</p><p>ä»¥ä¸‹æœƒè©³ç´°ä»‹ç´¹æ€éº¼ç”¨Hexoå¿«é€Ÿæ¶ç«™</p><h2 id="Hexoæ¶è¨­æµç¨‹"><a href="#Hexoæ¶è¨­æµç¨‹" class="headerlink" title="Hexoæ¶è¨­æµç¨‹"></a>Hexoæ¶è¨­æµç¨‹</h2><h3 id="å®‰è£Hexo"><a href="#å®‰è£Hexo" class="headerlink" title="å®‰è£Hexo"></a>å®‰è£Hexo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–ä¸€å€‹Hexoå°ˆæ¡ˆï¼Œä¸¦ä¸”é‹è¡Œä¹‹"><a href="#åˆå§‹åŒ–ä¸€å€‹Hexoå°ˆæ¡ˆï¼Œä¸¦ä¸”é‹è¡Œä¹‹" class="headerlink" title="åˆå§‹åŒ–ä¸€å€‹Hexoå°ˆæ¡ˆï¼Œä¸¦ä¸”é‹è¡Œä¹‹"></a>åˆå§‹åŒ–ä¸€å€‹Hexoå°ˆæ¡ˆï¼Œä¸¦ä¸”é‹è¡Œä¹‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm install</span><br><span class="line">hexo server</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç”¨ hexo s -p 8080 </span></span><br><span class="line"><span class="comment">// æŒ‡å®šæ¬²é–‹å•Ÿçš„port numberç‚ºå¤šå°‘</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ–°å»ºç«‹å¥½çš„Blogé•·é€™æ¨£</p><p>(X)</p><h3 id="æ–°å¢ä¸€ç¯‡æ–‡ç« "><a href="#æ–°å¢ä¸€ç¯‡æ–‡ç« " class="headerlink" title="æ–°å¢ä¸€ç¯‡æ–‡ç« "></a>æ–°å¢ä¸€ç¯‡æ–‡ç« </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure><p>[layout]æœ‰ä»¥ä¸‹å¹¾ç¨®(defaultç‚º <code>post</code>)ï¼š</p><ul><li>postï¼šå°±poä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« éƒ½æ”¾ç½®åœ¨ <code>source/_posts</code>ä¸­</li><li>pageï¼šå»ºç«‹ç¨ç«‹çš„é é¢ï¼Œä¾‹å¦‚å»ºç«‹<code>about</code>é é¢</li><li>draftï¼šç™¼ä½ˆä¸€ç¯‡è‰ç¨¿ï¼Œå¦‚æœè¦å…¬é–‹å‰‡ä¸‹ <code>hexo publish [layout] &lt;title&gt;</code>ï¼Œå°‡è‰ç¨¿ç§»å‹•åˆ° <code>source/_posts</code></li></ul><h3 id="ä½ˆç½²åˆ°è‡ªå·±çš„github"><a href="#ä½ˆç½²åˆ°è‡ªå·±çš„github" class="headerlink" title="ä½ˆç½²åˆ°è‡ªå·±çš„github"></a>ä½ˆç½²åˆ°è‡ªå·±çš„github</h3><p>å®‰è£ hexo-deployer-git<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹ <code>_config.yml</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git   </span><br><span class="line">  repo: &lt;repository url&gt; // å„²å­˜åº«ï¼ˆRepositoryï¼‰ç¶²å€</span><br><span class="line">  branch: [branch] // åˆ†æ”¯åç¨±</span><br><span class="line">  message: [message] // è‡ªå®šæäº¤è¨Šæ¯</span><br></pre></td></tr></table></figure></p><p>æ–°å¢å¥½æ–‡ç« å¾Œéœ€è¦ç”¢ç”Ÿéƒ¨ç½²ç”¨éœæ…‹æª”æ¡ˆ<br>åŸ·è¡Œï¼š<code>hexo generate</code></p><p>æœƒç”¢ç”Ÿ<code>public</code>ç›®éŒ„</p><p>åŸ·è¡Œ <code>hexo deploy</code> å³å¯ä¸€éµéƒ¨ç½²<code>public</code>ç›®éŒ„å…§å®¹åˆ°github.ioç¶²ç«™ä¸Š</p><p><span style="color:red">æ³¨æ„ï¼šgithubä¸Šçš„repoå‘½åè¦èˆ‡ä½ çš„å¸³è™Ÿä¸€æ¨£ï¼Œå¦å‰‡é‚„å¾—è™•ç†è·¯å¾‘å•é¡Œ</span></p><p>è‹¥è¦ç›´æ¥æ–°å¢å¥½æ–‡ç« å¾Œéƒ¨ç½²ï¼š<code>hexo generate --deploy</code></p><p>ä¹‹å¾Œè‹¥è¦é‡æ–°åŸ·è¡Œ<code>hexo deploy</code>ï¼Œè«‹å…ˆç”¨ <code>hexo clean</code>æ¸…é™¤éœæ…‹é é¢ï¼Œç„¶å¾Œåœ¨åŸ·è¡Œdeploy.</p><hr><h2 id="ä½¿ç”¨Material-flow-ä¾†æ”¹é€ è‡ªå·±çš„Blog"><a href="#ä½¿ç”¨Material-flow-ä¾†æ”¹é€ è‡ªå·±çš„Blog" class="headerlink" title="ä½¿ç”¨Material-flow ä¾†æ”¹é€ è‡ªå·±çš„Blog"></a>ä½¿ç”¨Material-flow ä¾†æ”¹é€ è‡ªå·±çš„Blog</h2><p>è©³æƒ…è«‹çœ‹Material-flow çš„Githubä¸Šæ–‡ä»¶</p><p><a href="https://github.com/stkevintan/hexo-theme-material-flow" target="_blank" rel="noopener">https://github.com/stkevintan/hexo-theme-material-flow</a></p><h3 id="ä¿®æ”¹è‡ªå·±çš„Description"><a href="#ä¿®æ”¹è‡ªå·±çš„Description" class="headerlink" title="ä¿®æ”¹è‡ªå·±çš„Description"></a>ä¿®æ”¹è‡ªå·±çš„Description</h3><p>åœ¨å¤§é ­è²¼ä¸‹æ–¹çš„æè¿°ï¼Œ<br>è‹¥è¦ä¿®æ”¹çš„è©±å¾—åˆ°ï¼š <code>./theme/material-flow/layout/_widget/about.ejs</code>ä¸­ä¿®æ”¹ï¼</p><h2 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h2><p>è‹¥è¦å°è‡ªå·±Blogåšæ“´å……éƒ½å¯ä»¥å†åƒè€ƒHexoä»¥åŠNextTçš„å®˜æ–¹æ–‡æª”</p><p>Hexoå®˜æ–¹é€£çµï¼š<a href="https://hexo.io/zh-tw/" target="_blank" rel="noopener">https://hexo.io/zh-tw/</a></p><p>å¦‚æœå°å…¶ä»–themeæœ‰èˆˆè¶£ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¶²ç«™</p><p>Hexoå®˜æ–¹ä¸»é¡Œï¼š<a href="https://hexo.io/zh-tw/docs/writing.html" target="_blank" rel="noopener">https://hexo.io/zh-tw/docs/writing.html</a><br>Hexoä¸»é¡Œæ’åï¼š<a href="https://www.zhihu.com/question/24422335" target="_blank" rel="noopener">https://www.zhihu.com/question/24422335</a></p>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Note </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
