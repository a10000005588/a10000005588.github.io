{"meta":{"title":"William's éš¨æ‰‹æœ­è¨˜","subtitle":"Blog of William","description":"Just record it.","author":"William L.K.","url":"http://a10000005588.github.io"},"pages":[{"title":"Stay Hungry, Stay Foolish.","date":"2019-02-05T11:53:34.000Z","updated":"2021-02-12T14:42:56.810Z","comments":true,"path":"about/index.html","permalink":"http://a10000005588.github.io/about/index.html","excerpt":"","text":"Hi æˆ‘å«William L.K. ä¹Ÿå¯ä»¥ç›´æ¥å«æˆ‘LK. å¹³å¸¸æˆ‘æœƒå…ˆåœ¨Githubç”¢å‡ºç­†è¨˜ï¼Œè¦ºå¾—æœ‰ä¸éŒ¯çš„æœƒæ¬ç§»åˆ°é€™é‚Šä¾†.è‹¥æœ‰çœ‹åˆ°ä¸å°å‹çš„åœ°æ–¹, è«‹åœ¨é‚£ç¯‡è²¼æ–‡ç•™è¨€, LKéå¸¸æ„Ÿè¬å„è·¯å¤§å¤§å€‘çš„æ‹”åˆ€ç›¸åŠ©. ä¸‹é¢å‰‡æ˜¯ä¸€äº›è·Ÿå€‹äººæ„Ÿæƒ³è·Ÿä¸€äº›æƒ³æ³•ç´€éŒ„ã€‚ 2020 ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº« 2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ 2019 2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ"},{"title":"å¾Œç«¯å·¥ç¨‹ç­†è¨˜å€","date":"2021-01-20T11:53:34.000Z","updated":"2021-01-28T12:21:40.917Z","comments":true,"path":"backend/index.html","permalink":"http://a10000005588.github.io/backend/index.html","excerpt":"","text":"Spring FrameworkSpring ç‚ºé–‹ç™¼Javaæ™‚ï¼Œæœ€ä¸»æµçš„å¾Œç«¯æ¡†æ¶ï¼Œç›®å‰å…±ç´€éŒ„ä»¥ä¸‹ç­†è¨˜ã€‚ Spring Security åŠŸèƒ½ä»‹ç´¹ Spring Annotationç­†è¨˜æ•´ç† Computer Scienceè·Ÿè¨ˆç®—æ©Ÿæ¦‚è«–æˆ–æ˜¯è¼ƒåº•å±¤çš„å…§å®¹å°±æ”¾é€™é‚Š éœæ…‹èˆ‡å‹•æ…‹å‡½å¼åº«çš„ä»‹ç´¹èˆ‡å·®ç•°(Static èˆ‡ Shared Libraries)"},{"title":"å€å¡Šéˆç­†è¨˜å€","date":"2021-01-28T11:44:44.000Z","updated":"2021-02-12T23:00:33.795Z","comments":true,"path":"blockchain/index.html","permalink":"http://a10000005588.github.io/blockchain/index.html","excerpt":"","text":"ç›®å‰å…±æ”¶éŒ„äº†é—œæ–¼ä»¥å¤ªåŠ(Etherum)ç›¸é—œçš„å­¸ç¿’ç´€éŒ„ ä»¥å¤ªåŠ ä»¥å¤ªåŠæ¸¬è©¦ç¶²é€£æ¥ï¼šConnect to the Rospen Network å¦‚ä½•æŸ¥çœ‹é€éæ™ºèƒ½åˆç´„å­˜åœ¨ä»¥å¤ªåŠä¸Šçš„è³‡æ–™ ERC Tokenä»‹ç´¹ï¼šERC20 &amp; ERC721 ä½¿ç”¨OpenZeppelinæ­é…Truffleä¾†æ‰“é€ æ™ºèƒ½åˆç´„ Solidityå­¸ç¿’ç´€éŒ„ ä½¿ç”¨truffleä¾†ç·´ç¿’æ’°å¯«èªé¤Šå¯µç‰©çš„æ™ºèƒ½åˆç´„ å…±è­˜æ¼”ç®—æ³• åˆ†æ•£å¼ç³»çµ±å…±è­˜ç®—æ³•ç­†è¨˜ï¼šPaxoså’ŒRaft"},{"title":"categories","date":"2021-01-27T14:55:20.000Z","updated":"2021-01-27T14:58:58.337Z","comments":true,"path":"categories/index.html","permalink":"http://a10000005588.github.io/categories/index.html","excerpt":"","text":"Testing"},{"title":"é›²ç«¯å·¥ç¨‹ç­†è¨˜å€","date":"2019-02-05T11:53:34.000Z","updated":"2021-01-27T23:51:29.255Z","comments":true,"path":"cloud/index.html","permalink":"http://a10000005588.github.io/cloud/index.html","excerpt":"","text":""},{"title":"å‰ç«¯å·¥ç¨‹ç­†è¨˜å€","date":"2021-01-20T11:53:34.000Z","updated":"2021-01-27T23:52:06.994Z","comments":true,"path":"frontend/index.html","permalink":"http://a10000005588.github.io/frontend/index.html","excerpt":"","text":""},{"title":"ç¨‹å¼èªè¨€çš„ç­†è¨˜å€","date":"2021-01-05T11:53:34.000Z","updated":"2021-01-28T12:28:09.874Z","comments":true,"path":"programming/index.html","permalink":"http://a10000005588.github.io/programming/index.html","excerpt":"","text":"ç›®å‰æˆ‘çœ‹äº†æœ‰Java, Golang, Cppï¼Œå¯«æœ€å¤šçš„é‚„æ˜¯Javaï¼ Golang ç­†è¨˜ Go Interfaceä»‹ç´¹ Goçš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ä»‹ç´¹ Defer, Panicèˆ‡Recover Golangçš„ç‰¹è‰²ä»‹ç´¹ Goä½¿ç”¨Arrayã€Sliceèˆ‡Mapçš„ä»‹ç´¹ Go Module å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹ Javascript ç­†è¨˜ Javascriptç­†è¨˜:Closure(é–‰åŒ…)æ¦‚å¿µ Javascriptç­†è¨˜:ä½¿ç”¨prototype chain(åŸå‹éŠ)ä¾†é”æˆç¹¼æ‰¿æ•ˆæœ Design Pattern ç­†è¨˜ Command Pattern å‘½ä»¤æ¨¡å¼ [Design Pattern in Java] Adaptor Pattern è½‰æ¥å™¨æ¨¡å¼ [Design Pattern in Java] Composite Pattern åˆæˆæ¨¡å¼ [Design Pattern in Java] Facade Pattern è¡¨è±¡æ¨¡å¼ [Design Pattern in Java] Factory Pattern å·¥å» æ¨¡å¼ [Design Pattern in Java] Iterator Pattern åè¦†å™¨æ¨¡å¼ [Design Pattern in Java] Observer Pattern è§€å¯Ÿè€…æ¨¡å¼ [Design Pattern in Java] Singleton Pattern ç¨é«”æ¨¡å¼ [Design Pattern in Java] State Pattern ç‹€æ…‹æ¨¡å¼ [Design Pattern in Java] Strategy Pattern ç­–ç•¥æ¨¡å¼ [Design Pattern in Java] Template Pattern æ¨£æ¿æ¨¡å¼ [Design Pattern in Java]"},{"title":"å·¥å…·ä½¿ç”¨ç­†è¨˜å€","date":"2021-01-28T11:44:59.000Z","updated":"2021-01-28T11:55:47.120Z","comments":true,"path":"tools/index.html","permalink":"http://a10000005588.github.io/tools/index.html","excerpt":"","text":"éƒ¨è½æ ¼å»ºç½® åˆ©ç”¨Hexoä¾†è¨˜éŒ„è‡ªå·±çš„å­¸ç¿’ä¸¦ä½¿ç”¨Material-flowä¸»é¡Œ"}],"posts":[{"title":"Goä½¿ç”¨Arrayã€Sliceèˆ‡Mapçš„ä»‹ç´¹","slug":"go-array-slice-map","date":"2021-02-16T02:41:51.000Z","updated":"2021-02-16T03:12:44.014Z","comments":true,"path":"2021/02/16/go-array-slice-map/","link":"","permalink":"http://a10000005588.github.io/2021/02/16/go-array-slice-map/","excerpt":"é€™ç¯‡ä¸»è¦ä»‹ç´¹å¦‚ä½•åœ¨Golangåº•ä¸‹ä½¿ç”¨Array, Slice, Mapç­‰æ“ä½œæŠ€å·§","text":"é€™ç¯‡ä¸»è¦ä»‹ç´¹å¦‚ä½•åœ¨Golangåº•ä¸‹ä½¿ç”¨Array, Slice, Mapç­‰æ“ä½œæŠ€å·§ arrayç”¨æ³•æ–°å¢arrayæ–¹å¼1. é€é []12var arr [5]intfmt.Println(\"array arr:\", a) 2. é€é make1arr := make([]int64,5) 3. å‹•æ…‹åˆ†é…array1234arr=make([][]int64,10) //å¤–å±¤æœ‰10æ ¼for i:=0;i&lt;10;i++&#123; arr[i]=make([]int64,i) //å‹•æ…‹åˆ†è£¡é¢&#125; arrayéæ­·æ–¹æ³•1234567for i := 0; i &lt;len(a); i++ &#123; fmt.Println(\"arr[\", i, \"] =\", a[i])&#125;// ç”¨range, ç¬¬ä¸€å€‹å€¼ keyç‚ºç´¢å¼•ï¼Œvalueç‚ºç´¢å¼•çš„å€¼for key, value := range arr &#123; fmt.Println(\"arr[\", i, \"] =\", value)&#125; sliceç”¨æ³•æ–°å¢sliceæ–¹å¼1. ä½¿ç”¨array12var myArray [10]int = [10]int&#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;var mySlice []int = myArray[:5] 2. ä½¿ç”¨ make12345// make([]T, length, capacity)// å‰µå»ºé•·åº¦ç‚º5ï¼Œå®¹é‡ç‚º10çš„åˆ‡ç‰‡slice1 := make([]int, 5, 10)// å‰µå»ºé•·åº¦ç‚º5ï¼Œä¸¦åˆå§‹åŒ–è©²åˆ‡ç‰‡slice2 := []int&#123;1, 2, 3, 4, 5&#125; è¨»ï¼š makeçš„capacityè‹¥æ²’æœ‰è¨­ç½®æœƒé è¨­è·Ÿlengthä¸€æ¨£ï¼Œç‚ºsliceæœ€å¤§é•·åº¦ä¹‹ä¸Šé™ã€‚ å‹•æ…‹æ–°å¢sliceé•·åº¦: ä½¿ç”¨append1234// åœ¨slice2 å¢åŠ 6slice2 = append(slice2, 6)fmt.Println(\"slice:\", slice2)// slice: 1 2 3 4 5 6 å‹•æ…‹æ¸›å°‘sliceé•·åº¦: slice[:]ä¾‹å¦‚ï¼šå»é™¤æœ€å‰é¢ä¸€å€‹å…ƒç´  12queue := []int&#123;1,2,3&#125;queue = queue[1:] // queue = &#123;2,3&#125; ä½¿ç”¨slcieå¯¦ä½œä¸€å€‹ç°¡å–®çš„queueçµæ§‹ å®£å‘Šä¸€å€‹queueçµæ§‹ 1queue := []int&#123;&#125; æ–°å¢ä¸€å€‹å…ƒç´ åˆ°queue 1queue = append(queue, 6) å¾queueçš„é–‹é ­popä¸€å€‹å…ƒç´  12element := queue[0]queue = queue[1:] æª¢æŸ¥sliceæ˜¯å¦ç‚ºç©º len()12345slice := []int&#123;&#125;if (len(slice) == 0) &#123; ...&#125; slice æ­é… structçš„å‚³å€¼èˆ‡å›å‚³ä»¥æˆ‘åš Leetcode 111. Minimum Depth of Binary Tree çš„ç¯„ä¾‹ä¾†çœ‹ï¼Œæ€éº¼ä½¿ç”¨sliceæ­é…structé€²è¡Œå‚³å€¼èˆ‡å›å‚³ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546type pair struct &#123; node *TreeNode height int&#125;func minDepth(root *TreeNode) int &#123; // è‹¥ç›®å‰rootç‚ºnil é«˜åº¦ç‚º0 if root == nil &#123; return 0 &#125; // ä½¿ç”¨queueå­˜æ”¾ç•¶å‰çš„root, é€égolangçš„sliceä¾†å¯¦ä½œ queue := []pair&#123;&#125; // make a new pair for root rootPair := pair&#123;node: root, height: 1&#125; queue = append(queue, rootPair) for len(queue) != 0 &#123; element := queue[0] elementNode := element.node // å°‡å–å‡ºä¾†çš„elemenetå»æ‰ queue = queue[1:] // å¦‚æœå·¦å³å­æ¨¹éƒ½é‚„æœ‰å€¼ï¼Œé‚£å°±ç¹¼çºŒæ‰¾ï¼Œå°‡left, rightå¡é€²queue if elementNode.Left == nil &amp;&amp; elementNode.Right == nil &#123; return element.height &#125; if elementNode.Left != nil &#123; queue = push(queue, elementNode.Left, element.height) &#125; if elementNode.Right != nil &#123; queue = push(queue, elementNode.Right, element.height) &#125; &#125; return 0&#125;func push(queue []pair, root *TreeNode, currHeight int) []pair &#123; newElement := pair&#123;node: root, height: currHeight + 1&#125; newQueue := append(queue, newElement) return newQueue&#125; line 14: å®£å‘Šä¸€å€‹å‹æ…‹ç‚ºpairçš„struct slice line 42: å°‡struct sliceå‚³å…¥push()ï¼Œä¸¦å›å‚³ä¹‹ Array å’Œ Sliceå·®ç•° array slice é•·åº¦å®£å‘Šå¾Œä¸å¯ä»¥è®Šå‹• é•·åº¦å¯ä»¥é€éappend()æˆ–slice[:]åšè®Šå‹• X sliceç‚ºarrayçš„æŒ‡æ¨™ï¼Œè‹¥æ›´å‹•sliceï¼Œä¹Ÿæœƒæ›´å‹•åˆ°åŸæœ¬arrayçš„å…§å®¹ å¦‚ä½•é¿å…Sliceæ›´å‹•åˆ°åŸæœ¬Array?æ–¹æ³• 1 : make and Copyå…ˆé–‹ä¸€å€‹æ–°çš„ç©ºé–“ï¼Œç”¨makeé–‹å¥½ï¼Œç”¨copyæ‹·è²éå»123arr:=[]int&#123;1,2,3,4&#125;newSlice := make([]int, len(arr))copy(newSlice, arr) æ–¹æ³• 2 : append12arr:=[]int&#123;1,2,3,4&#125;newSlice = append([]int64(nil), arr[1:3]...) //ä¸€å®šè¦ã€Œâ€¦ã€ Mapç”¨æ³•å»ºç«‹ä¸€å€‹ map å…©ç¨®æ–¹å¼ ä½¿ç”¨make123m := make(map[string]int)// m[\"age\"] = 16m := map[string]int&#123;&#125; å›å‚³å€¼, å’Œ map æ˜¯å¦å­˜åœ¨å¦‚æœæ˜¯ä¸å­˜åœ¨çš„ key , value = 0 , ok = false1value , ok := m[\"age\"] åˆ©ç”¨ range å–å¾— map ä¸­æ‰€æœ‰çš„ key å’Œ value, ä¸¦åˆ—å°123for key, value := range m &#123; fmt.Println(\"Key:\", key, \"Value:\", value)&#125; ä¸€æ¬¡å®£å‘Šå¤šå€¼12345person := map[string]int&#123; \"age\" : 16, \"height\" : 180, \"weight\" : 6,&#125; Reference Golang å…©ä¸‰äº‹ http://daniel0076.logdown.com/posts/280719-golang-slice-notes Golang slice trick https://github.com/golang/go/wiki/SliceTricks How to implement a queue in Go? https://stackoverflow.com/questions/3042329/how-to-implement-a-queue-in-go","categories":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"Go CLI Playbook å­¸ç¿’ç­†è¨˜","slug":"go-cli","date":"2021-02-15T10:38:03.000Z","updated":"2021-02-15T10:40:21.313Z","comments":true,"path":"2021/02/15/go-cli/","link":"","permalink":"http://a10000005588.github.io/2021/02/15/go-cli/","excerpt":"","text":"ä»¥ä¸‹ç‚ºå­¸ç¿’æœ¬èª²ç¨‹ Pluralshight: The Go CLI Playbook æ‰€è¨˜éŒ„çš„ç­†è¨˜ï¼Œäº†è§£Golangæœ¬èº«æ‰€æä¾›çš„æŒ‡ä»¤é›†å·¥å…·è¦å¦‚ä½•ä½¿ç”¨ https://app.pluralsight.com/course-player?clipId=38b3a654-cbfd-436c-acb1-df088dfb5a48 Go Command åŠŸèƒ½Go çš„åŸºæœ¬Commandå¯ä»¥æä¾›ä»¥ä¸‹åŠŸèƒ½ Building Application: æŠŠ.goæª”æ¡ˆç·¨è­¯æˆåŸ·è¡Œæª” Testing Application: æ¸¬è©¦.goç¨‹å¼ Profiling Application: æ•ˆèƒ½æ¸¬è©¦ Managing Workspaces: ç®¡ç†é–‹ç™¼ç’°å¢ƒ Interacting with Environment: èˆ‡ç’°å¢ƒäº’å‹• Go Commandçš„åˆ—è¡¨åœ¨çµ‚ç«¯æ©Ÿä¸‹ go æŒ‡ä»¤ï¼Œå°±æœƒé¡¯ç¤ºgo commandçš„è©³ç´°è³‡è¨Š123456789101112131415161718192021222324252627282930313233343536373839404142âœ goGo is a tool for managing Go source code.Usage: go command [arguments]The commands are: build compile packages and dependencies clean remove object files and cached files doc show documentation for package or symbol env print Go environment information bug start a bug report fix update packages to use new APIs fmt gofmt (reformat) package sources generate generate Go files by processing source get download and install packages and dependencies install compile and install packages and dependencies list list packages run compile and run Go program test test packages tool run specified go tool version print Go version vet report likely mistakes in packagesUse &quot;go help [command]&quot; for more information about a command.Additional help topics: c calling between Go and C buildmode build modes cache build and test caching filetype file types gopath GOPATH environment variable environment environment variables importpath import path syntax packages package lists testflag testing flags testfunc testing functionsUse &quot;go help [topic]&quot; for more information about that topic. å¯é€é go help å¯çœ‹åˆ°ç‰¹å®šcommandçš„æŒ‡ä»¤å‡å¦‚è¦çœ‹go testçš„ä»‹ç´¹ï¼Œé‚£å°±ä¸‹é€™è¡ŒæŒ‡ä»¤ go help test 1234567891011121314151617181920212223242526âœ go help testusage: go test [build/test flags] [packages] [build/test flags &amp; test binary flags]&apos;Go test&apos; automates testing the packages named by the import paths.It prints a summary of the test results in the format: ok archive/tar 0.011s FAIL archive/zip 0.022s ok compress/gzip 0.033s ...followed by detailed output for each failed package.&apos;Go test&apos; recompiles each package along with any files with names matchingthe file pattern &quot;*_test.go&quot;.These additional files can contain test functions, benchmark functions, andexample functions. See &apos;go help testfunc&apos; for more..........The test binary also accepts flags that control execution of the test; theseflags are also accessible by &apos;go test&apos;. See &apos;go help testflag&apos; for details.For more about build flags, see &apos;go help build&apos;.For more about specifying packages, see &apos;go help packages&apos;. go env æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸12345678910111213141516171819202122232425&gt; go envGOARCH=&quot;amd64&quot;GOBIN=&quot;/Users/username/go/bin&quot;GOCACHE=&quot;/Users/username/Library/Caches/go-build&quot;GOEXE=&quot;&quot;GOHOSTARCH=&quot;amd64&quot;GOHOSTOS=&quot;darwin&quot;GOOS=&quot;darwin&quot;GOPATH=&quot;/Users/username/go&quot;GORACE=&quot;&quot;GOROOT=&quot;/usr/local/Cellar/go/1.10.2/libexec&quot;GOTMPDIR=&quot;&quot;GOTOOLDIR=&quot;/usr/local/Cellar/go/1.10.2/libexec/pkg/tool/darwin_amd64&quot;GCCGO=&quot;gccgo&quot;CC=&quot;clang&quot;CXX=&quot;clang++&quot;CGO_ENABLED=&quot;1&quot;CGO_CFLAGS=&quot;-g -O2&quot;CGO_CPPFLAGS=&quot;&quot;CGO_CXXFLAGS=&quot;-g -O2&quot;CGO_FFLAGS=&quot;-g -O2&quot;CGO_LDFLAGS=&quot;-g -O2&quot;PKG_CONFIG=&quot;pkg-config&quot;GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build760606218=/tmp/go-build -gno-record-gcc-switches -fno-common&quot; go run åŸ·è¡Œç¨‹å¼ æ³¨æ„ï¼Œè‹¥è¦é‹ç¨‹go runï¼Œéœ€è¦åœ¨$GOPATHåº•ä¸‹çš„srcç›®éŒ„é€²è¡Œ é‹è¡Œä¸€å€‹åŒ…å«main()æ–¹æ³•çš„ç¨‹å¼ 1&gt; go run main.go é€é go run --raceä¾†åµæ¸¬æ˜¯å¦æœƒæœ‰race conditionçš„ç‹€æ³ç™¼ç”Ÿè‹¥ç›®å‰æœ‰å€‹ä½¿ç”¨goroutingçš„ç¨‹å¼ï¼Œè‹¥è¦åµæ¸¬æ˜¯å¦æœƒç™¼ç”Ÿrace conditionç‹€æ³ï¼Œå¯ä»¥åŠ ä¸Š-raceé€™å€‹flag 1234567891011121314151617package mainimport ( \"fmt\" \"sync\")func main() &#123; var wg sync.WaitGroup for i := 0; i &lt; 10; i++ &#123; wg.Add(1) go func() &#123; fmt.Println(i) wg.Done() &#125;() &#125;&#125; è‹¥æœ‰race conditionï¼Œgo toolæœƒç”¢å‡ºå ±å‘Šä¾†è§£é‡‹1234567891011121314151617181920212223242526272829303132333435363738394041âœ go run -race race_condition/main.go ==================WARNING: DATA RACERead at 0x00c00013e010 by goroutine 8: main.main.func1() /Users/a10000005588/go/src/race_condition/main.go:13 +0x3cPrevious write at 0x00c00013e010 by main goroutine: main.main() /Users/a10000005588/go/src/race_condition/main.go:10 +0x108Goroutine 8 (running) created at: main.main() /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4====================================WARNING: DATA RACERead at 0x00c00013e010 by goroutine 7: main.main.func1() /Users/a10000005588/go/src/race_condition/main.go:13 +0x3cPrevious write at 0x00c00013e010 by main goroutine: main.main() /Users/a10000005588/go/src/race_condition/main.go:10 +0x108Goroutine 7 (running) created at: main.main() /Users/a10000005588/go/src/race_condition/main.go:12 +0xe4==================22246678810Found 2 data race(s)exit status 66 1ä¸€èˆ¬ä¾†èªªåœ¨devæ¨¡å¼æ™‚ï¼Œæœƒå»ºè­°æ¯æ¬¡é‹è¡Œå°ˆæ¡ˆæ™‚ï¼Œéƒ½åŠ ä¸Š-race go build ç·¨è­¯ç¨‹å¼èˆ‡å…¶ä¾è³´go buildæœƒæŠŠå°ˆæ¡ˆç·¨è­¯æˆåŸ·è¡Œæª” è‹¥ç›®å‰æœ‰å€‹åœ¨cmdsè³‡æ–™å¤¾å…§çš„å°ˆæ¡ˆå«åš hello ä¸¦å¼•ç”¨äº†helloServiceé€™å€‹ä¾è³´å…§çš„æ–¹æ³• cmds/hello.go1234567package mainimport \"helloService\"func main() &#123; helloService.SayHello()&#125; helloService/msg.go12345678package helloimport \"fmt\"// SayHello represents a greeting to developer.func SayHello() &#123; fmt.Println(\"Hello gofer! I came from `cmds/hello` package.\")&#125; é‚£åœ¨ /cmds/helloå°ˆæ¡ˆä¸­åŸ·è¡Œ go buildï¼Œæœƒåœ¨ç•¶å‰ç›®éŒ„ç”¢ç”ŸhelloåŸ·è¡Œæª” å¯ç›´æ¥åŸ·è¡Œè©²åŸ·è¡Œæª” ä½¿ç”¨ go build -oå®šç¾©ç·¨è­¯å¾Œæª”æ¡ˆåç¨±å‡å¦‚è¦æŠŠç·¨è­¯æª”æ¡ˆå«åšhello_exe.a 1âœ go build -o hello_exe.a ä½¿ç”¨ go build -i ç·¨è­¯å°ˆæ¡ˆçš„ä¾è³´è‹¥å°å°ˆæ¡ˆé€²è¡Œç·¨è­¯æ™‚ï¼ŒåŠ ä¸Š-iåƒæ•¸ï¼ŒæœƒåŒæ™‚å°‡importçš„ä¾è³´ (ex:helloService)ä¹Ÿæœƒç·¨è­¯è©²ä¾è³´å€‘ä¸¦å®‰è£åœ¨ $GOPATH/pkgåº•ä¸‹ åƒè€ƒGo Official Docs: Command gohttps://golang.org/cmd/go/#Compile%20packages%20and%20dependencies go install ç·¨è­¯å°ˆæ¡ˆæˆç‚ºpackageæœƒå°‡å°ˆæ¡ˆ (main) é€²è¡Œç·¨è­¯æˆbinæª”æ¡ˆä¸¦æ”¾ç½®åœ¨$GOPATH/binåº•ä¸‹ æœƒå°‡ä¾è³´ (package) é€²è¡Œç·¨è­¯ä¸¦å®‰è£åœ¨$GOPATH/pkgåº•ä¸‹ 1å¦‚æœå·²ç¶“æœ‰å­˜åœ¨çš„ä¾è³´æˆ–æ˜¯binaryæª”æ¡ˆã€é‚£go installå°±ä¸æœƒæœ‰ä½œç”¨ go install -nï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†ä¸æœƒçœŸæ­£åŸ·è¡Œå‡å¦‚æˆ‘å€‘åœ¨å°å‰›å‰›çš„helloServiceé€™å€‹ä¾è³´ï¼Œé€²è¡Œgo install -n æœƒçœ‹åˆ°ä¸æœƒåšä»€éº¼å‹•ä½œï¼Œå› ç‚ºå·²ç¶“æœ‰å®‰è£è©²ä¾è³´åœ¨pkgåº•ä¸‹ å°‡è©²ä¾è³´ç§»é™¤ï¼Œå†æ¬¡åŸ·è¡Œä¸€éï¼Œæœƒçœ‹åˆ°go toolåŸ·è¡Œäº†ä»€éº¼å‹•ä½œ go install -xï¼šé¡¯ç¤ºæœƒé€²è¡Œçš„å‹•ä½œï¼Œä½†æœƒçœŸæ­£åŸ·è¡Œå…¶ä»–flag -p n: æŒ‡å®šç”¨å¤šå°‘å€‹cpuä¾†é€²è¡Œinstall, é è¨­æ˜¯å¯å–å¾—çš„æ•¸é‡ ç”¢ç”ŸShared Librariesï¼Œä½¿ç”¨-buildmode flagé€é go build -buildmode æˆ–æ˜¯ go install -buildmodeå¯ä»¥åƒCæˆ–C++é‚£æ¨£ç”¢ç”ŸShared Librariesï¼Œä¾›å‹•æ…‹è¼‰å…¥ é€égo help buildmodeå¯æŸ¥çœ‹æœ‰æä¾›å“ªäº›æ¨¡å¼ 123é è¨­-buildmodeæœƒä½¿ç”¨ archiveï¼šå°‡æª”æ¡ˆç·¨è­¯æˆ .aä½¿ç”¨ -buildmode=sharedï¼šå°‡æª”æ¡ˆç·¨è­¯æˆå¯å‹•æ…‹è¼‰å…¥çš„shared libï¼Œæˆ–æ˜¯åœ¨runtimeæ™‚å¯é€£çµ å‡å¦‚å†ç”¨å‰›å‰›çš„ç¯„ä¾‹ï¼Œä¸€å€‹cmds/hello.goä¸­å¼•ç”¨äº† helloServiceé€™å€‹package ä½¿ç”¨ -buildmode=shared ç”¢ç”Ÿä¾›goå‹•æ…‹é€£çµçš„Shared Librariesè‹¥è¦å°‡æŸå€‹packageç·¨è­¯æˆshared libraryï¼Œ èˆ‰å€‹ä¾‹å­ï¼ŒæŠŠhelloService ç·¨è­¯æˆshared libraryä¸¦å®‰è£åœ¨pkgè³‡æ–™å¤¾ä¸­ 1âœ go install -buildmode=shared helloService æ³¨æ„: Macosä¸æ”¯æ´ -buildmode=shared-buildmode=shared not supported on darwin/amd64 æ¥è‘—ç·¨è­¯ä¸»ç¨‹å¼ï¼Œä¸¦æŒ‡å®šå…¶åŸ·è¡Œæª”å¯ä»¥å‹•æ…‹è¼‰å…¥(-linkshared) shared library 1âœ go build -linkshared cmds/hello åŸ·è¡Œç·¨è­¯å¾Œçš„åŸ·è¡Œæª” ./hello ï¼Œå¯çœ‹åˆ°å…¶çµæœ ä¸éè‹¥å°‡pkgä¸­ï¼Œå‰›å‰›go installçš„helloServiceçš„shared libraryçµ¦åˆªé™¤çš„è©±ï¼Œå†æ¬¡åŸ·è¡Œ /.hello é‚£å°±æœƒç™¼ç”Ÿç„¡æ³•åŸ·è¡Œç‹€æ³ã€‚ ä½¿ç”¨ -buildmode=c-archive ç”¢ç”Ÿä¾›C language â€œéœæ…‹â€é€£çµçš„Shared Librarieså¦‚æœæƒ³è¦å°‡pakcageç·¨è­¯æˆCå¯ä»¥è¼‰å…¥çš„shared libraryçš„è©±ï¼Œéœ€è¦å°pakcageçš„methodï¼ŒåŠ ä¸Š //export functionName 123456789package helloServiceimport \"fmt\"import \"C\"//export SayHellofunc SayHello() &#123; fmt.Println(\"Hello gofer! I came from `cmds/hello` package.\")&#125; è‹¥ä½¿ç”¨ -buildmode=c-archiveçš„è©±ï¼Œå‰‡æœƒç”¢ç”Ÿå‡º .hèˆ‡.açš„shared library æ³¨æ„: Macosé‹è¡Œ-buildmode=c-archive æœƒç„¡æ³•ç”¢ç”Ÿ .hæª”æ¡ˆ goç‰ˆæœ¬: go1.15 darwin/amd64 æ¥è‘—å°±å¯ä»¥åœ¨Cèªè¨€å…§å¼•å…¥ç”¨Go buildå¥½çš„share library 123456#include \"hello.a\"int main(void) &#123; SayHello(); return 0;&#125; åŸ·è¡Œä¹‹ 1cc hello.c ./hello ä½¿ç”¨ -buildmode=c-shared ç”¢ç”Ÿä¾›C language â€œå‹•æ…‹â€é€£çµçš„Shared LibrariesåŒç”¨goç”¢ç”Ÿå‡ºshared library ä½¿ç”¨ -buildmode=plugin å°‡æ‰€æœ‰importçš„packagesï¼Œæ‰“åŒ…æˆgo pluginå¯ä»¥æŠŠå°ˆæ¡ˆéœ€è¦importçš„packageï¼Œæ‰“åŒ…æˆplugin èˆ‰å€‹ä¾‹å­ï¼Œè‹¥ç¾åœ¨æˆ‘å€‘è¦å°‡pluginé€™ä¸€å€‹pakcageæ‰“åŒ…æˆplugin 1234567package mainimport \"fmt\"func ThingToDo() &#123; fmt.Println(\"Executing action\")&#125; é€éä»¥ä¸‹æŒ‡ä»¤ï¼Œåšå‡ºä¸€å€‹pluginï¼Œæª”åå«åš plugin å‰¯æª”åç‚º.so1âœ go build -buildmode=plugin -o=plugin.so plugin/plugin.go æ¥è‘—æˆ‘å€‘å®šç¾©äº†ä¸€å€‹å°å°ˆæ¡ˆï¼Œä¾†ä½¿ç”¨plugin 123456789101112131415161718192021222324252627282930313233343536package mainimport ( \"flag\" \"log\" \"plugin\")func main() &#123; path := flag.String(\"plugin\", \"\", \"Plugin to execute\") flag.Parse() // å¦‚æœåŸ·è¡Œgoæ™‚æ²’æœ‰å¸¶ -pluginæŒ‡ä»¤ if *path == \"\" &#123; log.Fatal(\"Path to plugin must be provided\") &#125; // è®€å–plugin p, err := plugin.Open(*path) if err != nil &#123; log.Fatal(err) &#125; // å°‹æ‰¾pluginæ˜¯å¦æœ‰ThingToDoé€™å€‹æ–¹æ³• f, err := p.Lookup(\"ThingToDo\") if err != nil &#123; log.Fatal(err) &#125; thingToDo, ok := f.(func()) if !ok &#123; log.Fatal(\"Could not find function 'ThingToDo' in plugin\") &#125; thingToDo() log.Println(\"Did the thing\")&#125; æ¥è‘—é‹è¡Œä¸‹é¢æŒ‡ä»¤ä½¿ç”¨plugin 1âœ go run action/action.go -plugin=./plugin.so å¦‚æœpluginå­˜åœ¨çš„è©±ï¼Œå°±å¯ä»¥åŸ·è¡Œ plugin.soå…§çš„ThingToDoæ–¹æ³• åŸ·è¡Œçµæœ åƒè€ƒGolangçš„æ„å»ºæ¨¡å¼ - Chen Jiehuahttps://chenjiehua.me/golang/golang-buildmode.html go test æ’°å¯«å–®å…ƒæ¸¬è©¦Unit Testing Programsé€é go test å¯æ¸¬è©¦golangæ’°å¯«çš„ç¨‹å¼çš„Inputèˆ‡Outputæ˜¯å¦æ­£ç¢º æ¸¬è©¦éœ€æ³¨æ„çš„è¦å‰‡ç”±æ–¼goæœ¬èº«å°æ¸¬è©¦æœ‰è‘—åš´è¬¹çš„è¦å‰‡ï¼Œæ•…å¯ä»¥é¿å…åƒå…¶ä»–èªè¨€é‚£æ¨£æœ‰å„ç¨®ä¸åŒæ¸¬è©¦çš„æ¡†æ¶ï¼Œä»¥çµ±ä¸€æ¸¬è©¦çš„æ¨£å¼ å…¶è¦å‰‡å¦‚ä¸‹ï¼š è‹¥æœ‰å®šç¾©æ¸¬è©¦çš„æª”æ¡ˆåç¨±ï¼Œéœ€è¦ä»¥ _test.goæœ€çµå°¾å‘½å 1mylib_test.go è‹¥éœ€è¦è¢«æ¸¬è©¦çš„æ–¹æ³•ï¼Œè«‹ä»¥ Test_ ç‚ºé–‹é ­ 1func Test_MyFunction() &#123;&#125; åŸ·è¡Œæ¸¬è©¦è‹¥æœ‰å€‹å°ˆæ¡ˆå«åš testing_exampleï¼Œå…¶ç›®éŒ„æ¶æ§‹å¦‚ä¸‹ testing_example/mylib_test.go123456789101112131415161718package mylibimport ( \"testing\")func Test_BasicChecks(t *testing.T) &#123; t.Run(\"Go can add\", func(t *testing.T) &#123; if 1+1 != 2 &#123; t.Fail() &#125; &#125;) t.Run(\"Go can concatenate strings\", func(t *testing.T) &#123; if \"Hello, \"+\"Go\" != \"Hello, Go\" &#123; t.Fail() &#125; &#125;)&#125; å…¶å­packageä¹Ÿæœ‰å®šç¾©testing file testing_example/childlib/childlib_test.go`1234567891011package childlibimport ( \"testing\")func Test_MoreBasics(t *testing.T) &#123; if 10-5 != 5 &#123; t.Error(\"Failed to subtract correctly\") &#125;&#125; åŸ·è¡Œæ¸¬è©¦çš„ç¯„ç–‡è‹¥è¦å°å°ˆæ¡ˆåŸ·è¡ŒUnit Testï¼š 123~/go/src via v1.15 âœ go test testing_example ok testing_example 0.014s ä½†æœƒç™¼ç¾child packageçš„æ¸¬è©¦æ²’æœ‰åŸ·è¡Œåˆ°ï¼Œæ‰€ä»¥è‹¥è¦å°packageå…§æ‰€æœ‰å­packageéƒ½é€²è¡Œæ¸¬è©¦ï¼Œé‚£éœ€è¦åŠ ä¸Š /... åšéè¿´å°‹æ‰¾çš„å‹•ä½œ 1234~/go/src via ğŸ¹ v1.15 âœ go test testing_example/...ok testing_example (cached)ok testing_example/childlib 0.015s æ¸¬è©¦å¯ä»¥å¤¾å¸¶çš„åƒæ•¸ flagsé€é go help testflag å¯ä»¥æŸ¥çœ‹åŸ·è¡Œæ¸¬è©¦æ™‚å¯ä»¥å®¢è£½åŒ–çš„é¸æ“‡ åˆ—èˆ‰ä¸€äº›å¸¸ä½¿ç”¨çš„ï¼š -cpu: æŒ‡å®šæ¸¬è©¦æ™‚ä½¿ç”¨çš„CPUæ•¸é‡ï¼Œé è¨­æ˜¯æœƒä½¿ç”¨ GOMAXPROCSåƒæ•¸çš„å€¼ -parallel: æ¸¬è©¦æ™‚å¯ä»¥ä¸¦è¡Œè™•ç†ï¼Œä½†åªæœ‰æŒ‡å®šFunctionæ‰æœƒè¢«ä¸¦è¡Œè™•ç† 12345678func Test_BasicChecks(t *testing.T) &#123; t.Parallel() // é€²è¡Œä¸¦è¡Œæ¸¬è©¦ t.Run(\"Go can add\", func(t *testing.T) &#123; if 1+1 != 2 &#123; t.Fail() &#125; &#125;)&#125; -list: å¯é€éæ­£å‰‡è¡¨é”å¼éæ¿¾å‡ºæ¸¬è©¦æ–¹æ³•åç¨±ï¼Œå†æ¸¬è©¦æ™‚æœƒåˆ—å‡ºç¬¦åˆçš„æ¸¬è©¦æ–¹æ³•çµ¦ å‡å¦‚è¦åˆ—å‡ºæœ‰åŒ…å« Basicsçš„æ¸¬è©¦æ–¹æ³•åç¨±ï¼š12345~/go/src via v1.15 âœ go test -list Basics testing_example/...ok testing_example 0.022sTest_MoreBasics // åˆ—å‡ºok testing_example/childlib 0.023s -run: è·ŸListå¾ˆåƒï¼Œä½†åªæœƒåŸ·è¡Œç¬¦åˆæ­£å‰‡è¡¨é”å¼çš„æ¸¬è©¦æ–¹æ³• ä½¿ç”¨æ™‚æ©Ÿï¼šè‹¥é–‹ç™¼å‡ºå­å°ˆæ¡ˆçš„æ¸¬è©¦æ–¹æ³•ï¼Œé€é-runæŒ‡å®šè©²å­å°ˆæ¡ˆçš„scopeåŸ·è¡Œæ¸¬è©¦å°±å¥½ï¼Œå°±å¯ä»¥çœå»ä¸å°‘æ™‚é–“ 1234~/go/src via v1.15 âœ go test -run Basics testing_example/...ok testing_example 0.024s [no tests to run]ok testing_example/childlib 0.022s -timeout d: è¶…éå¤šä¹…å°±åœæ­¢æ¸¬è©¦ï¼Œé è¨­ç‚º10åˆ†é˜ -v: æ¸¬è©¦æ™‚å°‡è©³ç´°çµæœåˆ—å‡ºä¾† 123456789101112131415161718~/go/src via v1.15 âœ go test -v testing_example/...=== RUN Test_BasicChecks=== PAUSE Test_BasicChecks=== CONT Test_BasicChecks=== RUN Test_BasicChecks/Go_can_add=== RUN Test_BasicChecks/Go_can_concatenate_strings--- PASS: Test_BasicChecks (0.00s) --- PASS: Test_BasicChecks/Go_can_add (0.00s) --- PASS: Test_BasicChecks/Go_can_concatenate_strings (0.00s)PASSok testing_example 0.017s=== RUN Test_MoreBasics=== PAUSE Test_MoreBasics=== CONT Test_MoreBasics--- PASS: Test_MoreBasics (0.00s)PASSok testing_example/childlib 0.025s -count: æŒ‡å®šåŸ·è¡Œæ¸¬è©¦çš„æ¬¡æ•¸ -cover: é¡¯ç¤ºæ¸¬è©¦çš„æ¶µè“‹ç¯„åœè³‡è¨Š æ¸¬è©¦çš„æ¶µè“‹ Code Coverageå¯ä»¥é€é go test -cover ä¾†æŸ¥çœ‹ç›®å‰æ¸¬è©¦é …ç›®æ¶µè“‹äº†å¤šå°‘é–‹ç™¼çš„å…§å®¹ ä»¥ä¸‹ç‚ºæ¸¬è©¦çš„é …ç›®å…§å®¹ï¼š mylib.go123456789package mylibfunc adder(l, r int) int &#123; return l + r&#125;func subractor(l, r int) int &#123; return l - r&#125; mylib_test.go123456789101112package mylibimport ( \"testing\")// åœ¨é€™é‚Šåªæœ‰æ¸¬è©¦adderæ–¹æ³•ï¼Œæ²’æœ‰subractoræ–¹æ³•func TestAdder(t *testing.T) &#123; if adder(2, 5) != 7 &#123; t.Fail() &#125;&#125; å¯ä»¥çœ‹åˆ°ä¸Šè¿°çš„ç¯„ä¾‹åªæ¸¬è©¦ä¸€å€‹æ–¹æ³•123~/go/src via v1.15 âœ go test -cover testing_example_1 ok testing_example_1 0.013s coverage: 50.0% of statements é€égo test -coverpkg æŒ‡å®šæ¸¬è©¦ç¨‹å¼å¼•ç”¨çš„packageå†ç”¨ä¸Šè¿°çš„ç¯„ä¾‹ï¼Œæˆ‘å€‘æ‰“ç®—æ¸¬è©¦å°ˆæ¡ˆ testing_example_1ä¸­çš„ fmt èˆ‡ testing_example_1æœ¬èº«è‡ªå·±é€™å…©å€‹pacakgeï¼š 12345~/go/src via v1.15 âœ go test -coverpkg testing_example_1, fmt testing_example_1 warning: no packages being tested depend on matches for pattern ok fmt 0.089s coverage: 0.0% of statements in testing_example_1, ok testing_example_1 0.019s coverage: 50.0% of statements in testing_example_1, é€égo test -coverprofile ç”¢å‡ºæ¸¬è©¦çš„å ±å‘Š123~/go/src via v1.15 âœ go test -coverprofile cover.out testing_example_1 ok testing_example_1 0.012s coverage: 50.0% of statements åŒæ™‚æœƒç”¢ç”Ÿ cover.outé€™å€‹æ¸¬è©¦å ±å‘Šæª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹123mode: settesting_example_1/mylib.go:3.26,5.2 1 1testing_example_1/mylib.go:7.30,9.2 1 0 é€é go tool æŸ¥çœ‹æ¸¬è©¦å ±å‘Šå¯ä»¥é€é go tool cover -html= æ¸¬è©¦å ±å‘Šæª”æ¡ˆåç¨± ä¾†ç”¢ç”Ÿå‡ºä»¥ç¶²é æ–¹å¼ç€è¦½çš„å ±å‘Š è‹¥è¦è§£æç”¢ç”Ÿå‡ºä¾†çš„å ±å‘Š cover.out go tool cover -html=cover.out å¯ä»¥ç”¢å‡ºWebå‘ˆç¾ï¼Œæ¸¬è©¦çš„å ±å‘Š å¦‚æœè¦çœ‹å‡ºæ›´è©³ç´°çš„æ¸¬è©¦å ±å‘Šçš„è©±ï¼Œä¾‹å¦‚æƒ³çœ‹åˆ°æ¸¬è©¦æ–¹æ³•è¢«åŸ·è¡Œå¹¾æ¬¡ 123~/go/src via v1.15âœ go test -covermode count -coverprofile cover.out testing_example_1 ok testing_example_1 0.018s coverage: 50.0% of statements ä¸€æ¨£æœƒç”¢ç”Ÿå‡º cover.outæª”æ¡ˆï¼Œé€™æ™‚å†é€é go tool cover -html é€²è¡Œå£“åŠ›æ¸¬è©¦ Benchmark Testinggolangçš„testå·¥å…·äº¦æä¾›benchmarkçš„æ¸¬è©¦ï¼Œå¯ä»¥çœ‹å‡ºè©²æ–¹æ³•éœ€è¦è€—è²»å¤šå°‘CPUè³‡æº è¦å‰‡éœ€è¦å®šç¾©æ–¹æ³•åç¨±å‰ç¶´ç‚º Benchmark ä¾‹å¦‚: 12345func BenchmarkAdder(b *testing.B) &#123; for i := 0; i &lt; b.N; i++ &#123; adder(5, 7) &#125;&#125; æŒ‡ä»¤: go test -benchè‹¥è¦å°testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆï¼š mylib.go12345package mylibfunc adder(l, r int) int &#123; return l + r&#125; mylib_test.go1234567891011121314151617package mylibimport ( \"testing\")func TestAdder(t *testing.T) &#123; if adder(2, 5) != 7 &#123; t.Fail() &#125;&#125;func BenchmarkAdder(b *testing.B) &#123; for i := 0; i &lt; b.N; i++ &#123; adder(5, 7) &#125;&#125; é€™æ™‚é€é go test -bench Adder testing_example_2ï¼Œå°testing_example_2é€™å°ˆæ¡ˆå…§æœ‰åŒ…å« Adderçš„å£“æ¸¬æ–¹æ³•é€²è¡Œå£“åŠ›æ¸¬è©¦ 12345678~/go/src via v1.15âœ go test -bench Adder testing_example_2goos: darwingoarch: amd64pkg: testing_example_2BenchmarkAdder-4 1000000000 0.374 ns/opPASSok testing_example_2 0.433s BenchmarkAdder é€™éš»æ–¹æ³•åŸ·è¡Œäº†1000000000æ¬¡, æ¯æ¬¡èŠ±äº† 0.374 ns æˆ–æ˜¯ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ–¹æ³•Benchmarkåç¨± go test -bench . testing_example_2 æŒ‡å®šè¦èŠ±å¤šå°‘æ™‚é–“åšbenchmarkæ¸¬è©¦ï¼š go test -benchtimeå¯æŒ‡å®šå£“æ¸¬æ¸¬å¤šå°‘æ™‚é–“ï¼Œå¯ä»¥æ“´å±•å£“æ¸¬çš„æ¬¡æ•¸ èˆ‰ä¾‹ï¼Œåªå£“æ¸¬0.001ç§’ï¼Œé‚£å¯çœ‹åˆ°åªæœƒæ¸¬å‡º 2864049æ¬¡12345678~/go/src via v1.15 âœ go test -benchtime 0.001s -bench . testing_example_2goos: darwingoarch: amd64pkg: testing_example_2BenchmarkAdder-4 2864049 0.485 ns/opPASSok testing_example_2 0.024s 1234#### æª¢è¦–å£“åŠ›æ¸¬è©¦èŠ±å¤šå°‘è¨˜æ†¶é«”ï¼š `go test -bench . -benchmem`é€é `-bemchmem`é€™å€‹flagï¼Œå£“æ¸¬è³‡è¨Šæœƒå¤šäº† `B/op` èˆ‡ `allocs/op` ä¾†æª¢è¦–è©²æ–¹æ³•å£“æ¸¬æ™‚èŠ±äº†å¤šå°‘è¨˜æ†¶é«”è³‡æº ~/go/src via v1.15âœ go test -bench . -benchmem testing_example_2goos: darwingoarch: amd64pkg: testing_example_2BenchmarkAdder-4 1000000000 0.501 ns/op 0 B/op 0 allocs/opPASSok testing_example_2 0.586s1234567### ä½¿ç”¨go tool pprof (performance profiling tool) ç”¢ç”Ÿæ¸¬è©¦å ±å‘Šç”¢å‡ºå ±å‘Šä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£ `graphviz`é€™å€‹å¥—ä»¶ï¼Œé€™æ¨£go toolæ‰èƒ½å¤ ç¹ªè£½æµç¨‹åœ–ä¾›æˆ‘å€‘æŸ¥çœ‹Linux/Macos sudo apt-get install graphyiz12345678910111213141516171819&gt; æ›´å¤šæœ‰é—œgraphyizè³‡è¨Šè«‹åˆ°ï¼š http://graphviz.org&gt; #### ç”¢ç”Ÿç¨‹å¼è¨˜æ†¶é«”èŠ±è²»å ±å‘Š `go test -memprofile`ä¸€æ¨£ç”¨testing_example_2é€™å€‹å°ˆæ¡ˆä¸‹çš„æª”æ¡ˆåšæ¸¬è©¦![](pics/14.png)![](https://i.imgur.com/FPmr2HU.png)`mylib.go````go=package mylibfunc adder(l, r int) int &#123; return l + r&#125; mylib_test.go1234567891011121314151617package mylibimport ( \"testing\")func TestAdder(t *testing.T) &#123; if adder(2, 5) != 7 &#123; t.Fail() &#125;&#125;func BenchmarkAdder(b *testing.B) &#123; for i := 0; i &lt; b.N; i++ &#123; adder(5, 7) &#125;&#125; é€é go test -memprofile mem.out testing_example_2 ä¾†ç”¢å‡ºå«åš mem.outçš„æ¸¬è©¦å ±å‘Š æ¸¬è©¦çµæœ123~/go/src via v1.15 âœ go test -memprofile mem.out testing_example_2ok testing_example_2 0.018s ä»¥åŠæœƒç”¢ç”Ÿå…©å€‹æª”æ¡ˆ mem.out èˆ‡ testing_example_2.testï¼Œå¾Œè€…ä¸»è¦æä¾›çµ¦ go tool pprofæª¢è¦– æ¥è‘—é€é go tool pprofæª¢è¦–å…¶å ±å‘Š testing_example_2.testï¼Œä¸¦æŒ‡å®šç”¨-web ç¶²é çš„æ–¹å¼ç€è¦½ 1sudo go tool pprof -web testing_example_2.test mem.out ä¸éç”±æ–¼ç¯„ä¾‹æª”æ¡ˆè¦æ¨¡å¤ªå°ï¼Œgo toolç„¡æ³•æ•æ‰åˆ°æœ‰ç”¨çš„è³‡è¨Šï¼Œæ‰€ä»¥æŠ“ä¸åˆ° é€™æ™‚å¯ä»¥é€é go test -mmprofilerate nä¾†æ”¹è®Šè®€å–å ±å‘Šçš„é »ç‡ï¼Œç•¶åŸ·è¡Œnå€‹æŒ‡ä»¤æ™‚ï¼Œå°±ç”¢å‡ºå ±å‘Š æ¥è‘—å†æŸ¥çœ‹ä¸€æ¬¡ç”¢å‡ºçš„å ±å‘Š1sudo go tool pprof -web testing_example_2.test mem.out å¯ä»¥çœ‹åˆ°æ¯å€‹æ–¹æ³•è©³ç´°çš„è¨˜æ†¶é«”æ¶ˆè€—è³‡è¨Šåœ– ç”¢ç”ŸCPUæ¶ˆè²»å ±å‘Š go test -cpuprofileä¸€æ¨£å¯ä»¥ç”¢ç”Ÿæ¯å€‹æ–¹æ³•æˆ–packageä½¿ç”¨å¤šå°‘çš„CPUé—œè¯åœ–123~/go/src via v1.15 âœ go test -cpuprofile cpu.out testing_example_2 ok testing_example_2 0.224s ç”¢ç”Ÿå‡ºcpu.outèˆ‡testing_example_2.testï¼Œç„¶å¾Œå¾Œè€…ä¹Ÿæ˜¯é€é pprofæª¢è¦– ä¸éä¹Ÿæ˜¯ä¸€æ¨£æ²’çœ‹åˆ°è±å¯Œçš„æ¸¬è©¦è³‡è¨Šï¼Œå› ç‚ºæ•´å€‹æ¸¬è©¦åªæœ‰åŸ·è¡Œä¸€éï¼Œå°è‡´pprofç„¡æ³•æŠ“åˆ°æœ‰ç”¨çš„è³‡è¨Š é€™æ™‚å¯ä»¥é€é -count å¯ä»¥æ¸¬è©¦å¤šæ¬¡ä»¥å–å¾—è¶³å¤ çš„CPUä½¿ç”¨é‡å ±å‘Š go test -cpuprofile cpu.out -count 1000000 testing_example_2 åœ¨æŸ¥çœ‹ä¸€éå°±æœƒæœ‰æ–¹æ³•å‘¼å«çš„CPUæ¶ˆè€—æµç¨‹åœ–å¯ä»¥æª¢è¦–äº† ç”¢ç”Ÿç¨‹å¼è¶³è·¡å ±å‘Š go test -traceé€é-traceé€™å€‹flag, å¯ä»¥ç”¢å‡ºè¨±å¤šæª¢è¦–ç¨‹å¼çš„åŸ·è¡Œå ±å‘Š ä¸€æ¨£é€é go test -trace trace.out testing_example_2ä¾†ç”¢ç”Ÿå«åš trace.outçš„å ±å‘Š ä»¥ go tool trace trace.out æª¢è¦–å…§å®¹ é»é–‹View traceå¯çœ‹åˆ°å¦‚ä¸‹ åƒè€ƒè³‡æº Go-Command trace Using Go 1.10 new trace features to debug an integration test","categories":[],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"ç”¨Golangæ’°å¯«Packageçš„Best Practice","slug":"go-package-best-practice","date":"2021-02-15T08:33:51.000Z","updated":"2021-02-15T08:51:31.740Z","comments":true,"path":"2021/02/15/go-package-best-practice/","link":"","permalink":"http://a10000005588.github.io/2021/02/15/go-package-best-practice/","excerpt":"","text":"ä»¥ä¸‹æ”¶éŒ„æ’°å¯«golang packageå¯ä»¥éµå¾ªçš„å…§å®¹ Package æ¦‚è¦½ä¸€å€‹Go Pakcageçš„åŸºæœ¬å…ƒç´ åŒ…å«äº†å¦‚ä¸‹ï¼š Package declaration: åŸºæœ¬å®šç¾©ï¼Œå‘Šè¨´developer packageçš„åŠŸèƒ½æ˜¯ä»€éº¼ Documentation: æä¾›Packageå…§æ‰€åŒ…å«çš„functionæ˜¯ä»€éº¼ï¼Œè¦å¦‚ä½•ä½¿ç”¨ Imports: å¦‚ä½•å¼•å…¥pakcageå…§çš„function var &amp; const blocks: ä½¿ç”¨çš„è®Šæ•¸å®£å‘Š Types &amp; interfaces: å®šç¾©packageå…§æœƒä½¿ç”¨çš„å‹æ…‹ä»¥åŠä»‹é¢ Functions: functionsçš„å¯¦ä½œPackageçš„ç¯„åœï¼šä¸€å€‹è³‡æ–™å¤¾å…§çš„æ‰€æœ‰.goæª”æ¡ˆï¼Œå…¶ä»–é™¤å¤–åŸºæœ¬ä¸Šä¸€å€‹Go PackageåªæœƒåŒ…å«å–®ä¸€ç›®éŒ„å…§æ‰€æœ‰çš„Go Source. èˆ‰å€‹ä¾‹å­ 12345---services |--- events (Package) |-- data (è³‡æ–™å¤¾) |-- handlers.go |-- serve.go ä¸Šé¢eventsé€™å€‹packageï¼ŒåªæœƒåŒ…å« handlers.go ä»¥åŠ serve.go é€™å…©éš»æª”æ¡ˆçš„å…§å®¹ï¼Œdataè³‡æ–™å¤¾æœƒè¢«æ’é™¤ Packageç¨®é¡Library Packageså®šç¾©Golang Packageçš„å…§å®¹ï¼Œæä¾›ç›¸åŒåŠŸèƒ½æ€§çš„functionã€‚ 1234// .../servicespackage services... Library Pakcageé€šå¸¸è¢«å…¶ä»–çš„packageæ‰€å¼•å…¥é€²ä¾† Library Packageçš„åç¨±å¿…é ˆè¦è·Ÿè‡ªå·±çš„è³‡æ–™å¤¾åç¨±ä¸€æ¨£ pakcageå…§çš„æœ€å¥½æ˜¯æä¾›ç›¸ä¼¼çš„åŠŸèƒ½Main Package å®šç¾©äº†Applicationçš„é€²å…¥é»ï¼Œç¨‹å¼è¦å•Ÿå‹•å°±æœƒæ˜¯å¾main packageé–‹å§‹ï¼Œæ³¨é‡åœ¨appçš„è¨­ç½®ä»¥åŠåˆå§‹åŒ–çš„é‚è¼¯ã€‚ 123package mainfunc main() &#123;&#125; åŒ…å« main() function å¯ä»¥åœ¨ä»»ä½•çš„è³‡æ–™å¤¾ ç¯„ä¾‹http package: https://golang.org/pkg/net/http/ Constants: å®šç¾©å¸¸æ•¸å…§å®¹ 123456789101112const ( StatusContinue = 100 // RFC 7231, 6.2.1 StatusSwitchingProtocols = 101 // RFC 7231, 6.2.2 StatusProcessing = 102 // RFC 2518, 10.1 StatusEarlyHints = 103 // RFC 8297 StatusOK = 200 // RFC 7231, 6.3.1 StatusCreated = 201 // RFC 7231, 6.3.2 StatusAccepted = 202 // RFC 7231, 6.3.3 StatusNonAuthoritativeInfo = 203 // RFC 7231, 6.3.4 ...) Variables: å®šç¾©è®Šæ•¸å…§å®¹ï¼Œä¸”çµ¦äºˆèªªæ˜ 123456789101112var ( // ErrNotSupported is returned by the Push method of Pusher // implementations to indicate that HTTP/2 Push support is not // available. ErrNotSupported = &amp;ProtocolError&#123;\"feature not supported\"&#125; // Deprecated: ErrUnexpectedTrailer is no longer returned by // anything in the net/http package. Callers should not // compare errors against this variable. ErrUnexpectedTrailer = &amp;ProtocolError&#123;\"trailer header without chunked transfer encoding\"&#125; ...) Types: å®šç¾©å®¢è£½åŒ–å‹æ…‹ï¼Œä¸¦çµ¦äºˆèªªæ˜ 1234567// A Client is an HTTP client. Its zero value (DefaultClient) is a usable client that uses DefaultTransport. ...type Client struct &#123; // Transport specifies the mechanism by which individual // HTTP requests are made. // If nil, DefaultTransport is used. Transport RoundTripper ... ä¹Ÿæä¾›äº†Clinetå½¢æ…‹çš„åˆå§‹åŒ–è®Šæ•¸è¨­ç½®ï¼Œä¸ç”¨ä¸€ç›´è‡ªè¡Œåˆå§‹åŒ–12// DefaultClient is the default Client and is used by Get, Head, and Post.var DefaultClient = &amp;Client&#123;&#125; Function: å®šç¾©functionå…§å®¹ï¼Œä¸¦æ·»åŠ èªªæ˜ 123// CanonicalHeaderKey returns the canonical format of the header key s. The canonicalization converts the first letter and any letter following a hyphen to upper case; the rest are converted to lowercase. For example, the canonical key for \"accept-encoding\" is \"Accept-Encoding\". If s contains a space or invalid header field bytes, it is returned without modifications.func CanonicalHeaderKey &#123;...&#125; Pakcage çš„ç”Ÿå‘½é€±æœŸ Import æ‰€éœ€è¦çš„package å°‡initial valueè¨­ç½®åœ¨variables å‘¼å« init() æ–¹æ³•ï¼ŒåŸ·è¡Œåˆå§‹åŒ–è©²packageçš„å‹•ä½œ æ³¨æ„ï¼Œç„¡æ³•ç›´æ¥å‘¼å« init() ï¼Œè©²æ–¹æ³•åªèƒ½åœ¨golangçš„compileræ™‚æœŸè¢«golangå‘¼å«åŸ·è¡Œã€‚ ç¯„ä¾‹å‡å¦‚æœ‰å€‹ç›®éŒ„å¦‚ä¸‹123456789--- cmd |--- startAll | |- main.go |--- services |- handlers.go |- serve.go |--- internal |--- ports |--- ports.go è‹¥ main.go import services é€™å€‹package 123456789101112131415161718192021222324252627282930313233/* Package events provides a webservice that manages the libary's special events.*/package eventsimport ( \"fmt\" \"net/http\" \"strconv\" \"github.com/pluralsight/libmanager/services/internal/ports\")var port = 42// StartServer registers the handlers and initiates the web service.// The service is started on the local machine with the port specified by// .../lm/services/internal/ports#EventServicefunc StartServer() error &#123; sm := http.NewServeMux() sm.Handle(\"/\", new(eventHandler)) return http.ListenAndServe(\":\"+strconv.Itoa(port), sm)&#125;func init() &#123; fmt.Println(\"serve.go 1\", port) port = ports.EventService fmt.Println(\"serve.go 2\", port)&#125;func init() &#123; fmt.Println(\"second init in serve.go\")&#125; å¯ä»¥çœ‹åˆ°init() å¯ä»¥å¤šæ¬¡å®£å‘Š æ­¤æ™‚main.goå‘¼å«services pakcageå…§çš„startServer function 1234567891011121314151617181920212223242526272829303132333435363738394041// Package main is typically used to define a single, executable command and its associated logic.//// Functions in the main package should normally avoid containing business logic; they// should focus on initializing the application and handling any errors that are returned by// any library calls.package mainimport ( \"fmt\" \"log\" \"sync\" \"github.com/pluralsight/libmanager/services/events\")func init() &#123; fmt.Println(\"init in main.go\")&#125;// The main function, when defined in a main package, defines// the entry and exit point for an executable command.func main() &#123; log.Println(\"Starting all services\") // start the services wg := new(sync.WaitGroup) wg.Add(1) // åŸ·è¡Œ events packageå…§çš„StartServeræ–¹æ³• go startServer(wg, events.StartServer) wg.Wait() log.Println(\"All services stopped\")&#125;// startServer is a function in the main package that supports the command.func startServer(wg *sync.WaitGroup, startFunc func() error) &#123; err := startFunc() wg.Done() if err != nil &#123; log.Fatal(err) &#125;&#125; è¦æ³¨æ„ï¼Œservices importäº†internalå…§ports packageçš„è®Šæ•¸ï¼Œæ•…è‹¥å‘¼å«äº†main.go ä¸­çš„startServerï¼Œæœƒå…ˆå°å‡ºåˆå§‹åŒ–çš„port = 42, å†ä¾†æ˜¯é€éinit()æ¥æ”¶åˆ°ports packageçš„ port = 3000 12345func init() &#123; fmt.Println(&quot;serve.go 1&quot;, port) port = ports.EventService fmt.Println(&quot;serve.go 2&quot;, port)&#125; å°å‡ºå¦‚ä¸‹123serve.go 1 42serve.go 2 3000second init in serve.go Pakcage å­˜å–ç¯„ç–‡ Public Scope ä»¥å¤§å¯«å®£å‘Š å¯è¢«å°ˆæ¡ˆå…§æ‰€æœ‰æˆå“¡å­˜å– Package Scope ä»¥å°å¯«å®£å‘Š åªèƒ½è¢«åŒä¸€å€‹packageå…§å­˜å– Internal Package å¯åŒæ™‚ä½¿ç”¨public-level, package-level çš„æˆå“¡ åªé™æ–¼çˆ¶å±¤èˆ‡å­å±¤çš„æˆå“¡å­˜å– Pakcageè¨­è¨ˆçš„Best PracticePakcage åç¨± å„˜é‡ç°¡çŸ­ï¼Œä½¿ç”¨åè© å°å¯«é–‹é ­ï¼Œä¸ä½¿ç”¨ _, ç­‰ç‰¹æ®Šå­—å…ƒ åˆ¥ä½¿ç”¨ä¸€èˆ¬ä½¿ç”¨è€…æœƒç”¨åˆ°çš„è®Šæ•¸åç¨± event, temp ç­‰åè©ä¾†å‘½å. Package èªªæ˜ä¸€å€‹å…¬é–‹çš„pakcageé€šå¸¸æœƒåŒ…å«å…©å€‹ä¸»è¦èªªæ˜å…§å®¹ licensing: ä½¿ç”¨çš„é–‹æ”¾å”è­° package comment: packageçš„åŠŸèƒ½èªªæ˜ èªªæ˜é–‹é ­æ‡‰åŒ…å« packageåç¨±ï¼Œæ–¹æ³•çš„è©±é–‹é ­æœƒfunctionçš„åç¨± helloworld/doc.go1234567// Copyright 2009 The Go Authors. All rights reserved.// Use of this source code is governed by sa BSD-style// license that can be found in the LICENSE file// Package helloworld implements ....package helloworld é€™æ™‚ä½¿ç”¨ go doc helloworldï¼Œå°±æœƒé¡¯ç¤º helloworld packageå…§doc.goçš„èªªæ˜ ä½¿ç”¨ doc.go åšæ›´è¤‡é›œçš„èªªæ˜è‹¥æœ‰å¤ªå¤šçš„packageæ•˜è¿°è¦å‘ˆç¾ï¼Œé€šå¸¸æœƒåœ¨doc.go èªªæ˜ Pakcageå…§å®¹çš„æè¿°æ’°å¯«æŒ‡å¼• é¿å…å†—ä½™ ä¾‹å¦‚ï¼Œä¸‹é¢çš„packageåç¨±èˆ‡functionåç¨±éƒ½é‡è¤‡äº†ï¼Œæ‰€ä»¥å¯ä»¥å°‡functionåç¨±èˆ‡packageé‡è¤‡çš„éƒ¨åˆ†çµ¦å»æ‰12http.HTTPServer -&gt; http.serverjson.JSONEncoder -&gt; json.encoder ç›¡é‡ç°¡åŒ– ä¾‹å¦‚ï¼Œä¸‹é¢å¯ä»¥ç°¡åŒ–æˆå¦‚ä¸‹12time.NewTime -&gt; time.Timedb.ConnectToDatabase -&gt; db.Connect Packageå…§å®¹æº–å‰‡ æä¾›ç›´è¦ºçš„åŠŸèƒ½ single reponsibility: å–®ä¸€åŠŸèƒ½ cohesive API: åŠŸèƒ½ç›¸ä¾çš„Application Programming Interface æä¾›å‹å–„çš„ä½¿ç”¨æ–¹æ³• simple to use minimize API: å°‡åŠŸèƒ½é‡é»åŒ– encapsulate changes: å°‡è®Šå‹•å°è£èµ·ä¾†ï¼Œä¸å½±éŸ¿åŸæœ¬ä½¿ç”¨è€…çš„input, outputçš„ä½¿ç”¨æ–¹å¼ æœ€å¤§åŒ–å¯é‡è¤‡åˆ©ç”¨æ€§ reduce dependencies: æ¸›å°‘ä¾è³´å…¶ä»–dependenciesçš„ç‹€æ³ minimize scope: ç¸®å°ç¯„ç–‡ï¼Œé¿å…åˆ°è™•éƒ½æ˜¯publicï¼Œé€ æˆpackageå…§éƒ¨çš„è®Šæ•¸è¢«å…¶ä»–åœ°æ–¹æ‰€å½±éŸ¿ã€‚ çµæ§‹è¨­è¨ˆ Package Input Package Output å°æ–¼configurationä½¿ç”¨ concrete types å°æ–¼configuration &amp; behavior éƒ½ä½¿ç”¨concrete types å°æ–¼behavior ä½¿ç”¨ interface å°æ–¼errors è«‹é¿å…ä¸ç™¼ç”Ÿ panics: å› ç‚ºéŒ¯èª¤å³ä½¿ç™¼ç”Ÿäº†ï¼Œä½¿ç”¨è€…ä¹Ÿç„¡æ³•å°å…¶åšè™•ç† é€é http packageä¾†çœ‹çœ‹å…¶çµæ§‹è¨­è¨ˆ Package Input Package Output net/http.Request å°æ–¼http.Reqeustæ‰€è¦ä½¿ç”¨çš„configurationï¼Œä¾‹å¦‚http bodyè¦ç”¨çš„åƒæ•¸æ ¼å¼æ˜¯ä»€éº¼ï¼Œä½¿ç”¨ concrete typesï¼Œæ˜ç¢ºè¦ç¯„ä½¿ç”¨è€…è¦æ”¾ç½®ä»€éº¼çµ¦package net/http.Response å°æ–¼å…¶å›å‚³çµæœï¼Œå°‡configuration &amp; behavior éƒ½ä½¿ç”¨concrete typeså®šç¾©å¥½ï¼Œé¿å…ä½¿ç”¨è€…æ··æ·† net/http.Handler å°æ–¼http.Handler, é€™å€‹è™•ç†httpçš„behavior ä½¿ç”¨ interfaceï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¯ä»¥é‡å°ä»–å€‘è‡ªå·±çš„http Requesté€²ä¾†çš„è¡Œç‚ºå®šç¾©è‡ªå·±çš„å‹æ…‹ net/http.Get æ­£å¸¸ç‹€æ³ä¸‹ (ç”¨æˆ¶æ­£ç¢ºä½¿ç”¨ä¸‹)ï¼Œç”¨æˆ¶ä½¿ç”¨å…¶æ–¹æ³•æ˜¯ä¸æœƒç™¼ç”Ÿpanicçš„ Import Packageæ–¹æ³•1. Typical Importsä½¿ç”¨fmt pakcageçš„ Println function1234567package mainimport \"fmt\"func main() &#123; fmt.Println(\"hello, gophers!\")&#125; 2. Alternative Imports Aliases å°‡pakcege åˆ¥å 123456789101112package main// é€™æ™‚æœƒå¼•å…¥äº†å…©å€‹å«åšjsonçš„pakcage, compileræœƒå‡ºç¾æ··æ·†import ( \"encoding/json\" \"pluralsight.com/libmanager/json\")func main() &#123; ... data, err := json.Marshal(...)&#125; å¯é€é alias ï¼Œå°‡å…¶ä¸­ä¸€å€‹packageåç¨±é€²è¡Œåˆ¥å 1234import ( \"encode/json\" lmjson \"pluralsight.com/libmanager/json\") 3. Import for side effect: ç‚ºå¼•å…¥çš„packageï¼Œåœ¨å¼•å…¥å…¶ä»–çš„packageä½¿å…¶ä½œç”¨é€™æœ‰é»é›£ç†è§£ï¼Œç›´æ¥çœ‹ç¯„ä¾‹ ä¾‹å¦‚ä»¥ä¸‹æœ‰å¼•å…¥å…©å€‹packages, ä¸€å€‹æ˜¯sql package, å¦å¤–ä¸€å€‹æ˜¯ pq postgresé€™å€‹è³‡æ–™åº«çš„package. 1234import ( \"database/sql\" _ \"github.com/lib/pq\") å¯ä»¥çœ‹åˆ° pq æ˜¯ç”¨ _ ä»£è¡¨ä»–æ˜¯ä¸€å€‹write onlyçš„package, æœ¬èº«ä½¿ç”¨è€…ä¸æœƒå»ä½¿ç”¨åˆ°å®ƒï¼Œè€Œæ˜¯æä¾›çµ¦ sql åšåˆå§‹åŒ–sqlå…§è¦æ¡ç”¨å“ªå€‹databaseåšä½¿ç”¨ å¯ä»¥çœ‹åˆ° pg packageå…§ æœ‰é€™ä¸€æ®µç¨‹å¼ç¢¼ï¼Œæä¾›init()çµ¦sqlåšæ³¨å…¥ä½¿ç”¨å…¶postgres dirveråšä½¿ç”¨ 123func init() &#123; sql.Register(\"postgres\", &amp;Driver&#123;&#125;)&#125; 4. Internal packagesä¸»è¦æä¾›çˆ¶å±¤èˆ‡å­å±¤çš„pakcageåšå­˜å–ï¼Œç›®çš„æ˜¯è¦æä¾›è·³è„«è‡ªå·±ä¹‹å¤–çš„å­˜å–é™åˆ¶ï¼Œåˆä¸æœƒæ´©æ¼è‡ªå·±å…§éƒ¨è¨Šæ¯çµ¦å¤–éƒ¨ä½¿ç”¨è€…ã€‚ åªè¦æ˜¯å®£å‘Šç‚º internal çš„packageï¼Œå°±å¯ä»¥è¢«çˆ¶å±¤æˆ–å­å±¤å­˜å– ä»¥ä¸‹ç¯„ä¾‹ç‚ºï¼Œservices ä¸‹æœ‰å®£å‘Š internal package, å¯æä¾›å…¶ä»–package services/events/serve.go åšå­˜å–ä½¿ç”¨ è‹¥åœ¨è¶…å‡ºinternalå®šç¾©çš„ç¯„ç–‡ (ä¸Šä¸€å€‹å±¤ç´šèˆ‡ä¸‹ä¸€å€‹å±¤ç´š)ï¼Œå‰‡æœƒcompilerç·¨è­¯æ™‚æœƒç™¼ç”ŸéŒ¯èª¤è¨Šæ¯ 4. Relative Importé€é ../../package çš„æ–¹å¼importï¼Œä¸éåœ¨Productionç’°å¢ƒä¸‹ä¸å»ºè­°ä½¿ç”¨; æˆ–è€…å¾—é€égolangæœ€æ–°çš„ go mod ç®¡ç†æ–¹å¼ã€‚ åƒè€ƒè³‡æº Pluralsight: Deep Dive into Go Packages by Mike Van Sickle lib/pq/conn.go Stackoverflow: Relative imports in Go","categories":[],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"Go newèˆ‡makeçš„ä»‹ç´¹èˆ‡å·®ç•° [Golang]","slug":"Go-newèˆ‡makeçš„ä»‹ç´¹èˆ‡å·®ç•°","date":"2020-11-08T03:19:59.000Z","updated":"2020-11-08T05:01:19.326Z","comments":true,"path":"2020/11/08/Go-newèˆ‡makeçš„ä»‹ç´¹èˆ‡å·®ç•°/","link":"","permalink":"http://a10000005588.github.io/2020/11/08/Go-newèˆ‡makeçš„ä»‹ç´¹èˆ‡å·®ç•°/","excerpt":"Golangä¸­ï¼Œmakeèˆ‡newéƒ½æ˜¯å»ºæ§‹è®Šæ•¸ä¾†ä½¿ç”¨","text":"Golangä¸­ï¼Œmakeèˆ‡newéƒ½æ˜¯å»ºæ§‹è®Šæ•¸ä¾†ä½¿ç”¨ newçš„ä»‹ç´¹new(T)æœƒå»ºæ§‹ä¸€å€‹Tå‹åˆ¥çš„ â€œæ²’æœ‰åå­—â€ çš„è®Šæ•¸ï¼Œä»¥Tçš„zeroed valueä¾†åˆå§‹åŒ–Tï¼Œä¸”new(T) å›å‚³ â€œæŒ‡å‘Tçš„æŒ‡æ¨™â€ è‹¥Tæ˜¯ stringï¼Œé‚£zeroedå€¼ç‚º &quot;&quot; è‹¥Tæ˜¯ intï¼Œé‚£zeroedå€¼ç‚º 0 è‹¥Tæ˜¯ channel, func, map, sliceï¼Œé‚£zeroedå€¼ç‚º nil ç¯„ä¾‹1234567p := new(int) // å®£å‘Šä¸€å€‹æŒ‡å‘intä¸å…·åè®Šæ•¸çš„`æŒ‡æ¨™p`ï¼Œ`æŒ‡æ¨™p`æŒ‡å‘ä¸€å€‹åˆå§‹åŒ–çš„zeroed valueç‚º0fmt.Print(*p) // å°å‡º 0*p = 2 // å°‡ä¸å…·åè®Šæ•¸çš„å€¼è¨­ç½®ç‚º2fmt.Print(*p) // å°å‡º 2 å…¶ä¸­newç®—æ˜¯golangèªæ³•çš„ç°¡å¯«ï¼Œå…¶ä¸­123func newInt() *int &#123; return new(int)&#125; å°±ç­‰æ–¼ä¸‹åˆ—å¯«æ³•1234func newInt() *int &#123; var dummy int return &amp;dummy // å›å‚³dummyçš„æŒ‡æ¨™&#125; æ³¨æ„: è¬¹æ…æ“ä½œnewå‡ºä¾†çš„mapå› ç‚ºç”¨newåˆå§‹åŒ–çš„mapæœƒæ˜¯ nil mapï¼Œæ•…ä»¥ä¸‹æ“ä½œæœƒå‡ºç¾panic 12345678func main() &#123; book := new(map[string]string) // å®£å‘Šä¸€å€‹æŒ‡æ¨™å«åšbook, æŒ‡å‘ä¸€å€‹mapç‚ºindexæ˜¯string // æ˜ å°„åˆ°stringå‹æ…‹çš„bookåç¨± b := *book // å–å¾—bookæŒ‡æ¨™æ‰€æŒ‡å‘çš„map b[\"ISBN-001\"] = \"go programming language\" // panic: assignment to entry in nil map&#125; ä¸Šè¿°ç¯„ä¾‹æœƒå‡ºéŒ¯çš„åŸå› æ˜¯å› ç‚ºï¼Œ bæ˜¯ä¸€å€‹nil mapï¼Œæ²’æœ‰æŒ‡å‘ä»»ä½•çš„è¨˜æ†¶é«”ä½ç½®ï¼Œæ‰€ä»¥å°ä¸€å€‹nilå€¼æ“ä½œç•¶ç„¶æœƒå†’å‡ºerror è§£æ³•å°±å¾—é€é make æ–¹æ³•ç‚ºnil mapåˆ†é…ç¢ºå®šçš„å…§å­˜åœ°å€äº† new ä¸æ˜¯ Keywordè¦æ³¨æ„ä¸€é»æ˜¯ new ä¸¦éæ˜¯golangçš„é—œéµå­—ï¼Œæ•…å¯ä»¥åœ¨funcå…§é‡æ–°å®£å‘Š123func delta(old, new int) int &#123; return new - old&#125; makeçš„ä»‹ç´¹ make(T, args)ç”¨ä¾†ç‚º slices, maps, ä»¥åŠ channelåˆ†é…å…¶è¨˜æ†¶é«”ä½å€çš„ç©ºé–“èˆ‡åˆå§‹åŒ–å€¼ï¼Œä¸¦å›å‚³ä¸€å€‹å‹æ…‹Tçš„åƒè€ƒï¼ makeä¸æœƒå›å‚³æŒ‡æ¨™ï¼ ç¯„ä¾‹123456func main() &#123; books := make([]string, 100) // åˆå§‹åŒ–é•·åº¦ç‚º100çš„bookå­—ä¸²é™£åˆ—ï¼Œæ¯å€‹arrayå…§çš„å€¼éƒ½æ˜¯ \"\" receiver := make(chan string) // åˆå§‹åŒ–channelï¼Œä½†ä¸æœƒå›å‚³æŒ‡æ¨™ booksMapper := make(map[string]string)&#125; ç”±æ–¼makeå›å‚³çš„æ˜¯åƒè€ƒï¼Œæ‰€ä»¥è‹¥å°‡makeå®£å‘Šçš„s2 å‚³çµ¦func modifySliceå°s2åšä¿®æ”¹æ™‚ï¼Œä¹Ÿæœƒå½±éŸ¿s2çš„å…§å®¹ 12345678func modifySlice(s []int) &#123; s[0] = 1&#125;s2 := make([]int, 3)fmt.Printf(\"%#v\", s2) // s2ç‚º []int&#123;0, 0, 0&#125;modifySlice(s2)fmt.Printf(\"%#v\", s2) // s2è¢«modifySlice()æ–¹æ³•çµ¦è®Šæˆ []int&#123;1, 0, 0&#125; newèˆ‡makeçš„å·®ç•° newæœƒå›å‚³æŒ‡æ¨™ï¼Œä½†æ˜¯åˆå§‹åŒ–çš„å€¼ç‚ºzeroed valueï¼Œç‰¹åˆ¥æ˜¯åœ¨å°mapåšåˆå§‹åŒ–æ™‚ï¼Œå…¶zeroed valuedç‚º nilï¼Œæ„æ€å°±æ˜¯ä¸æœƒåˆ†é…å…¶è¨˜æ†¶é«”ä½ç½® makeåªèƒ½ç”¨ä¾†å°ç‰¹åˆ¥å‹æ…‹(å¦‚map, slice, func, channle)åˆ†é…å…¶è¨˜æ†¶é«”å…§å­˜åœ°å€ï¼Œä»¥åŠç‚ºé€™äº›ç‰¹æ®Šå‹æ…‹è¨­å®šè©²åˆå§‹å€¼ (stringå°±æ˜¯â€â€, intç‚º0) æ‰€ä»¥è‹¥è¦å‚³æŒ‡æ¨™æ™‚ï¼Œå°±éœ€è¦è€ƒæ…®ç”¨newï¼Œè€Œéæ˜¯makeäº† åƒè€ƒ golang ç­†è¨˜ï¼šmake èˆ‡ new çš„å·®åˆ¥ by æ„·é–‹ https://medium.com/d-d-mag/golang-%E7%AD%86%E8%A8%98-make-%E8%88%87-new-%E7%9A%84%E5%B7%AE%E5%88%A5-68b05c7ce016 Allocation with make https://golang.org/doc/effective_go.html#allocation_make Allocation with new https://golang.org/doc/effective_go.html#allocation_new The Go Programming Language, Author: Alan A. A. Donovan, Brian W. Kernighan ä¸è¦å‘nil mapå†™å…¥(panic: assignment to entry in nil map) #7 https://github.com/kevinyan815/gocookbook/issues/7 ç†è§£ Go make å’Œ new çš„åŒºåˆ« by ä¸‰æœˆæ²™ https://sanyuesha.com/2017/07/26/go-make-and-new/","categories":[],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"Go Module å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹","slug":"Go-Module-å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹ä»‹ç´¹","date":"2020-11-07T14:46:02.000Z","updated":"2021-01-28T12:18:22.322Z","comments":true,"path":"2020/11/07/Go-Module-å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹ä»‹ç´¹/","link":"","permalink":"http://a10000005588.github.io/2020/11/07/Go-Module-å…¥é–€èˆ‡ä½¿ç”¨ä»‹ç´¹ä»‹ç´¹/","excerpt":"Go Module ç‚ºç›®å‰æœ€ä¸»æµçš„ä¾è³´è§£æ±ºçš„æ–¹æ¡ˆ ç™¼ä½ˆæ–¼ Go 11.1ç‰ˆï¼Œæ–¼Go 1.14æ¨è–¦åœ¨Productionç’°å¢ƒä¸Šä½¿ç”¨","text":"Go Module ç‚ºç›®å‰æœ€ä¸»æµçš„ä¾è³´è§£æ±ºçš„æ–¹æ¡ˆ ç™¼ä½ˆæ–¼ Go 11.1ç‰ˆï¼Œæ–¼Go 1.14æ¨è–¦åœ¨Productionç’°å¢ƒä¸Šä½¿ç”¨ Go Modulesçš„å‡ºç¾è§£æ±ºäº†ä»¥ä¸‹å¹¾é»çˆ­è­°ï¼š ä¾è³´å•é¡Œ æ·˜æ±°GOPATHçš„æ©Ÿåˆ¶ çµ±ä¸€ç¤¾ç¾¤ä¸­å…¶ä»–ä¾è³´ç®¡ç†å·¥å…· ç‚ºä½• GOPATH ä¸åœ¨è¢«æ¨è–¦ä½¿ç”¨ç°¡å–®ä»‹ç´¹GOPATHåŸå…ˆæ˜¯é€éå®šç¾©å¥½çš„ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š 1234567go|--bin|--pkg|--src |--github.com |--golang.org ... å„ç›®éŒ„åˆ†åˆ¥ç‚ºï¼š bin: å„²å­˜æ‰€ç·¨è­¯ç”¢ç”Ÿçš„äºŒé€²ä½æª”æ¡ˆ pkg: å„²å­˜é å…ˆç·¨è­¯çš„ç›®çš„æª”æ¡ˆï¼Œä»¥åŠ å¿«ç¨‹å¼çš„å¾ŒçºŒç·¨è­¯é€Ÿåº¦ src: å„²å­˜æ‰€æœ‰ .go æª”æ¡ˆæˆ–åŸå§‹ç¨‹å¼ç¢¼ ä¸€èˆ¬æœƒä»¥ $GOPATH/src/github.com/ å„²å­˜ Goçš„æ‡‰ç”¨ç¨‹å¼å’Œå‡½å¼åº« æ£„ç”¨åŸå› : ç„¡æ³•æ˜ç¢ºå®šç¾©èˆ‡åƒç…§ä¾è³´(Dependency)çš„ç‰ˆæœ¬å› ç‚º.go å°ˆæ¡ˆéƒ½å¿…é ˆè¦å„²å­˜åœ¨ $GOPATH/src åº•ä¸‹ï¼Œä½†è©²ä¾è³´ç®¡ç†æ–¹å¼ä¸¦æ²’æœ‰æä¾›ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µï¼Œæœƒé€ æˆä»¥ä¸‹å•é¡Œï¼š åŸ·è¡Œgo get å–å¾—é ç«¯çš„ä¾è³´åŒ…æ™‚ï¼Œæœƒç„¡æ³•å¾—çŸ¥ç›®å‰æ‰€è¼‰çš„ç‰ˆæœ¬ ç„¡æ³•è™•ç† v1,v2,v3ç­‰ä¸åŒç‰ˆæœ¬çš„åƒè€ƒå•é¡Œï¼Œå‡è¨­æœ‰çš„Libraryå«åš /foo/bar ä½†ä¸ç®¡å¹¾ç‰ˆï¼Œéƒ½æœƒåœ¨GOPATHåº•ä¸‹ï¼Œå…¶è·¯å¾‘éƒ½æœƒæ˜¯ä¸€æ¨£çš„ (éƒ½åœ¨github.com/foo/bar) Go modulesçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼æŒ‡ä»¤ go mod init: ç”¢ç”Ÿ go.mod æª”æ¡ˆ go mod download: ä¸‹è¼‰go.modæª”æ¡ˆä¸­æŒ‡æ˜çš„æ‰€æœ‰ä¾è³´ go mod tidy: æ•´ç†æ‰€æœ‰ä¾è³´ go mod graph: æª¢è¦–ç¾æœ‰çš„ä¾è³´çµæ§‹ go mod edit: ç·¨è¼¯ go.mod æª”æ¡ˆ go mod vendor: æœƒå‡ºå°ˆæ¡ˆæ‰€æœ‰çš„ä¾è³´åˆ°vendorç›®éŒ„ go mod verify: é©—è­‰ä¸€å€‹æ¨¡çµ„æ˜¯å¦è¢«ç«„æ”¹é go mod why: æª¢è¦–ç‚ºä½•éœ€è¦ä¾è³´è©²æ¨¡çµ„ ç’°å¢ƒè®Šæ•¸å¯é€é go env ä¾†æª¢è¦–å¸¸ç”¨çš„ç’°å¢ƒè®Šæ•¸ï¼Œä»¥ä¸‹ç‚ºèˆ‡Go Moduleç›¸é—œçš„ç’°å¢ƒè®Šæ•¸ 12345678910111213141516171819202122232425262728293031323334353637# GOMODULESæ–°å¢çš„ç’°å¢ƒè®Šæ•¸GO111MODULE=\"on\"GOPROXY=\"https://proxy.golang.org,direct\"GONOPROXY=\"\"GOSUMDB=\"sum.golang.org\"GONOSUMDB=\"\"GOPRIVATE=\"\"# ä»¥ä¸‹ç‚ºåŸæœ¬GOPATHå°±æœ‰çš„ç’°å¢ƒè®Šæ•¸GOARCH=\"amd64\"GOBIN=\"/Users/user/go/bin\"GOCACHE=\"/Users/user/Library/Caches/go-build\"GOENV=\"/Users/user/Library/Application Support/go/env\"GOEXE=\"\"GOFLAGS=\"\"GOHOSTARCH=\"amd64\"GOHOSTOS=\"darwin\"GOINSECURE=\"\"GOMODCACHE=\"/Users/user/go/pkg/mod\"GOOS=\"darwin\"GOPATH=\"/Users/user/go\"GOROOT=\"/usr/local/Cellar/go/1.15/libexec\"GOTMPDIR=\"\"GOTOOLDIR=\"/usr/local/Cellar/go/1.15/libexec/pkg/tool/darwin_amd64\"GCCGO=\"gccgo\"AR=\"ar\"CC=\"clang\"CXX=\"clang++\"CGO_ENABLED=\"1\"GOMOD=\"/dev/null\"CGO_CFLAGS=\"-g -O2\"CGO_CPPFLAGS=\"\"CGO_CXXFLAGS=\"-g -O2\"CGO_FFLAGS=\"-g -O2\"CGO_LDFLAGS=\"-g -O2\"PKG_CONFIG=\"pkg-config\"GOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3t/8jsg2cz52yn2glq8rk_9y7x40000gn/T/go-build233814295=/tmp/go-build -gno-record-gcc-switches -fno-common\" GO111MODULEé€éGO111MODULEä½œç‚ºè©²å°ˆæ¡ˆæ˜¯å¦ä½¿ç”¨ Go modulesçš„é–‹é—œï¼Œå¯è¨­å®šä»¥ä¸‹å…§å®¹ auto: åªè¦å°ˆæ¡ˆåŒ…å« go.mod æª”æ¡ˆï¼Œå°±ä½¿ç”¨Go modules (åœ¨Go 1.11~1.14ï¼Œç‚ºé è¨­) on: å•Ÿç”¨Go modules (æ¨è–¦ä½¿ç”¨) off: ç¦ç”¨Go modules ç‚ºä½•å«åš GO111MODULE?å› ç‚ºgo modulesæ˜¯åœ¨ go1.11ç‰ˆæœ¬æ‰€æå‡ºçš„ GOPROXYè¨­å®šGOæ¨¡çµ„çš„proxy, ä½¿Goåœ¨å¾ŒçºŒæ‹‰å–æ¨¡çµ„çš„ç‰ˆæœ¬æ™‚ï¼Œç›´æ¥é€éæ˜ åƒæª”ç¶²ç«™å¿«é€Ÿæ‹‰å–ï¼Œè€Œéåˆ°Githubé€™ç¨®Version control serviceå¹³å° GOPROXYé è¨­å€¼ç‚º https://proxy.golang.org,directï¼Œé€éé€—è™Ÿå°‡ä»£ç†çš„åœ°æ–¹çµ¦éš”é–‹ è‹¥ä¸æƒ³ä½¿ç”¨GOPROXY, å¯è¨­ç½®ç‚º GOPROXY=â€offâ€ å…¶ä¸­æœ€å¾Œæœ‰ direct ä¸€è©çš„ç”¨æ„æ˜¯ï¼Œè‹¥å‰é¢çš„proxyå€¼éƒ½æ²’è¾¦æ³•è¼‰åˆ°æ¨¡çµ„ï¼Œä¾‹å¦‚åœ¨ https://proxy.golang.orgæŠ“ä¸åˆ°ï¼Œé‚£éº¼å°±æœƒå›åˆ°åŸä½ç½®(ä¾‹å¦‚Github)å»ä¸‹è¼‰ GOSUMDBGOSUMDBç‚ºGo checksum databaseï¼Œé©—è­‰æ‹‰å–çš„æ¨¡çµ„ç‰ˆæœ¬è³‡æ–™æœªç¶“éç«„æ”¹ é è¨­å€¼ç‚º sum.golang.orgï¼Œä¹Ÿå¯è¨­ç½®æˆ offï¼Œç¦æ­¢Goåœ¨å¾ŒçºŒæ“ä½œä¸­åšé©—è­‰ç‰ˆæœ¬çš„å‹•ä½œ GONOPROXY/GONOSUMDB/GOPRIVATEè¨­å®šç§æœ‰æ¨¡çµ„çš„ç’°å¢ƒè®Šæ•¸ï¼Œä¸€èˆ¬ä¾†èªªå»ºè­°ç›´æ¥è¨­å®š GONOPROXYï¼Œæœƒä½œç‚º GONOPROXYèˆ‡GONOSUMDBçš„é è¨­å€¼ å€¼å¯è¨­å®šå¤šçµ„ï¼Œä¾‹å¦‚1$ go env -w GOPRIVATE=\"git.xxx.com,github.com/eddycjy/mquote\" è¨­å®šä¹‹å¾Œå­—é¦–ç‚º git.xxx.com ä»¥åŠ github.com/eddycjy/mquote çš„æ¨¡çµ„æœƒè¢«èªç‚ºæ˜¯ç§æœ‰æ¨¡çµ„ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¨­å®š *ï¼Œä»¥ä¸‹è¡¨ç¤ºä¾†è‡ª.example.com çš„å­åŸŸåçš„éƒ½è¡¨ç¤ºä¾†è‡ªç§æœ‰å€‰åº« 1$ go env -w GOPRIVATE=\"*.example.com\" å•Ÿç”¨æ–¹å¼Go modulesé è¨­ä¸æ˜¯é–‹å•Ÿçš„ï¼Œé€éGO111MODULEä¾†åšè¨­å®šï¼Œå¯ç”¨auto, on, offåšè¨­å®š é€éenvé€²è¡Œè¨­å®š go env -w1$ go env -w GO111MODULE=on åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆåœ¨ä¸€å€‹è³‡æ–™å¤¾å…§ï¼Œé€é go mod init åˆå§‹åŒ–ä¸€å€‹å°ˆæ¡ˆ 12$ go mod init github.com/jellyhola/module-repogo: creating new go.mod: module github.com/jellyhola/module-repo é€™æ™‚æœƒç”¢ç”Ÿä¸€å€‹ go.mod æª”æ¡ˆï¼Œæœƒç´€éŒ„ç›®å‰å°ˆæ¡ˆæ¨¡çµ„ç‚º github.com/jellyhola/module-repoï¼Œgoç‰ˆæœ¬ç‚º1.15123module github.com/jellyhola/module-repogo 1.15 é€™æ™‚å®šç¾©ä¸€ä»½ main.go æª”æ¡ˆï¼Œimport github.com/example/hello123456789101112package mainimport \"rsc.io/quote\"func main() &#123; Hello()&#125;//Hello :print quote.Hello()func Hello() string &#123; return quote.Hello()&#125; é€™æ™‚å°ˆæ¡ˆç›®éŒ„æœƒè‡ªå‹•ç”¢ç”Ÿ go.sumæª”æ¡ˆ, ä»¥åŠgo.modæœƒå¤šç´€éŒ„ä½¿ç”¨äº† rsc.io/quoteæ¨¡çµ„ä»¥åŠä½¿ç”¨çš„ç‰ˆæœ¬ç‚º 1.5.2 go.sum123456golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8=golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=rsc.io/quote v1.5.2 h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=rsc.io/quote v1.5.2/go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPXsUe+TKr0=rsc.io/sampler v1.3.0 h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh/QiW4=rsc.io/sampler v1.3.0/go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9JXDnKaTXpA= go.mod12345module github.com/jellyhola/module-repogo 1.15require rsc.io/quote v1.5.2 å»ºè­°å°‡ go.sumèˆ‡go.modé€™å…©å€‹æª”æ¡ˆæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ ç”±æ–¼æœ¬èº«rsc.io/quoteé€™å€‹æ¨¡çµ„ï¼Œä¸‹è¼‰goæ™‚å°±å·²ç¶“å®‰è£å®Œç•¢ï¼Œæ•…ä¸ç”¨é€é go getä¾†é¡å¤–ä¸‹è¼‰ æ¥è‘—å¯ç”¨go list -m all æª¢è¦–ç›®å‰å°ˆæ¡ˆæ‰€ä½¿ç”¨çš„ä¾è³´ 12345$ go list -m allgithub.com/jellyhola/module-repogolang.org/x/text v0.0.0-20170915032832-14c0d48ead0crsc.io/quote v1.5.2rsc.io/sampler v1.3.0 å¯çœ‹åˆ°ç›®å‰ golang.org/x/texté€™é …æ¨¡çµ„ï¼Œç‚ºuntaggedçš„ç‹€æ³ï¼Œæ¥è‘—å¯ä»¥é€é go getä¾†æ›´æ–°æ­¤æ¨¡çµ„åˆ°æœ€æ–°çš„tag 123$ go get golang.org/x/textgo: golang.org/x/text upgrade =&gt; v0.3.4go: downloading golang.org/x/text v0.3.4 å¯çœ‹åˆ° go.modå…§å®¹æ”¹è®Šäº†12345678module github.com/jellyhola/module-repogo 1.15require ( golang.org/x/text v0.3.4 // indirect rsc.io/quote v1.5.2) å…¶ä¸­ // indirect è¡¨ç¤ºè©²æ¨¡çµ„ç‚ºé–“æ¥ä¾è³´ï¼Œè¡¨ç¤ºç›®å‰æ‡‰ç”¨ç¨‹å¼çš„importæ•˜è¿°ä¸­ï¼Œä¸¦æ²’æœ‰ç™¼ç¾é€™æ¨¡çµ„çš„æ˜ç¢ºåƒè€ƒï¼Œæœ‰å¯èƒ½æ˜¯ äº‹å…ˆæ‰‹å‹•go getæ‹‰å–ä¸‹ä¾†çš„æ¨¡çµ„ è©²å°ˆæ¡ˆæ‰€ä¾è³´æ¨¡çµ„ä¹‹æ‰€ä¾è³´çš„ è©¦è‘—è·‘ä¸€ä¸‹å°ˆæ¡ˆï¼Œé©—è­‰æ¨¡çµ„æ˜¯å¦èƒ½æ­£å¸¸é‹ä½œ script12$ go run main.goä½ å¥½ï¼Œä¸–ç•Œã€‚% æ‹‰å–çš„æ¨¡çµ„æœƒå­˜åœ¨å“ªï¼Ÿgo modæœƒå°‡æ‹‰å–çš„æ¨¡çµ„æ”¾ç½®åœ¨ $GOPATH/pkg/mod èˆ‡ $GOPATH/pkg/sumdb ç›®éŒ„ä¸‹ï¼ 12$ ls $GOPATH/pkgcache github.com golang.org rsc.io è‹¥æƒ³è¦æ¸…é™¤å·²ç¶“å¿«å–çš„æ¨¡çµ„ç‰ˆæœ¬ï¼Œä½¿ç”¨ go clean -modcache æŒ‡ä»¤ Go module é€²éšæ¢è¨Go modulesçš„go getæ¢è¨ä½¿ç”¨go getå–å¾—æ¨¡çµ„æ™‚ï¼Œæœƒåˆ†åˆ¥é€²è¡Œ3å€‹æ­¥é©Ÿ finding: æŸ¥æ‰¾æ¨¡çµ„æ˜¯å¦å­˜åœ¨ downloading: é€²è¡Œä¸‹è¼‰ extracting: åˆ†æä¸‹è¼‰çš„æ¨¡çµ„çš„é›œæ¹Šå€¼æ˜¯å¦æ­£ç¢º åƒä¸Šä¸€ç¯€æ‰€æ‹‰å–çš„æ¨¡çµ„ golang.org/x/text å…¶æ‹‰å–çš„è³‡è¨Šå¦‚ä¸‹ script12ç‰ˆæœ¬è³‡è¨Š-commitçš„æ™‚é–“-é›œæ¹Šå€¼v0.0.0-20170915032832-14c0d48ead0c commitçš„æ™‚é–“æœƒæ˜¯ä»¥UTCæ™‚å€ç‚ºæº– go getæ‹‰å–çš„æŒ‡ä»¤è‹¥æ²’æœ‰æŒ‡å®šç‰ˆæœ¬ï¼Œæœƒç›´æ¥æ‹‰å–åˆ° v0.0.0ç‰ˆ go getè¡Œç‚º go get: ç›´æ¥æ‹‰å–dependencyï¼Œåªæœƒæ›´æ–°æŒ‡å®šçš„ä»–è‡ªå·± go get -u: æ›´æ–°ç¾æœ‰çš„dependencyï¼Œæœƒå¼·åˆ¶æ›´æ–°è©²denpendencyæ‰€ä¾è³´çš„å…¶ä»–æ¨¡çµ„ go get -u -t: æ›´æ–°æ‰€æœ‰denpendencyï¼Œä»¥åŠåŒ…å«å–®å…ƒæ¸¬è©¦ä½¿ç”¨åˆ°çš„ go getç‰ˆæœ¬æŒ‡å®š go get golang.org/x/text@latest : æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè‹¥å­˜åœ¨tagï¼Œå„ªå…ˆä½¿ç”¨ä¹‹ go get golang.org/x/text@master : æ‹‰å–masteråˆ†æ”¯çš„æœ€æ–°commit go get golang.org/x/text@v0.3.2 : æ‹‰å–tagç‚ºv0.3.2çš„commit go get golang.org/x/text@342b2e : æ‹‰å–hashç‚º342b2eçš„commitï¼Œæœ€å¾Œè½‰ç‚º v0.3.2 Go modulesçš„go runèˆ‡go buildåŸ·è¡Œgo buildæ™‚ï¼Œæœƒæ ¹æ“šgo.modè‡ªå‹•ä¸‹è¼‰è©²å°ˆæ¡ˆæ‰€éœ€çš„æ¨¡çµ„ï¼Œæ‰é€²è¡Œç·¨è­¯ è‹¥æ˜¯è¦ä½¿ç”¨ vendorç›®éŒ„ä½œç‚ºdenpendency, åœ¨åŸ·è¡Œ go mod vendorç”¢ç”Ÿvendorç›®éŒ„å¾Œï¼Œéœ€è¦åŸ·è¡Œ go build -mod=vendoræ‰å¯ä½¿ç”¨ go build -mod=vendor ä½¿ç”¨vendorç›®éŒ„ä½œç‚ºdenpendencyä¾†ç·¨è­¯ Go modulesåŒ¯å…¥è·¯å¾‘èªªæ˜Go modulesåœ¨ä¸»ç‰ˆæœ¬ç·¨è™Ÿç‚º v0èˆ‡v1çš„æƒ…æ³æœƒçœç•¥å…¶ç·¨è™Ÿï¼Œåœ¨v2ä»¥ä¸Šå‰‡éœ€è¦æ˜ç¢ºæŒ‡å®šï¼ å‡å¦‚è¦åŒ¯å…¥ v2ä»¥ä¸Šçš„golang.org/example@v2.0.0ï¼Œå‰‡å¿…é ˆè¦åœ¨importåº•ä¸‹æ˜ç¢ºæŒ‡å®šv2 123import ( \"github.com/example/v2\") ç‚ºä½•çœç•¥v0èˆ‡v1??å› ç‚ºå®˜æ–¹é¼“å‹µé–‹ç™¼äººå“¡å°‡æ¨¡çµ„å»ºç«‹åˆ°v1ç‰ˆæœ¬å°±ä¸åœ¨è®Šå‹•ã€‚ æ‰€ä»¥è‹¥é–‹ç™¼äººå“¡åœ¨ç™¼ä½ˆv2ç‰ˆæœ¬æ™‚ï¼Œæœƒè¢«æ“æœ‰æ˜ç¢ºçš„v1ç‰ˆæœ¬å°¾ç¶´ï¼Œè¿‘ä¸€æ­¥å°è‡´v1ç‰ˆæœ¬è®Šæˆé›œè¨Šä¸”æ²’æœ‰ä»€éº¼æ„ç¾© åœ¨åŒ¯å…¥è·¯å¾‘å¿½ç•¥v0ç‰ˆæœ¬ï¼Œå› ç‚ºæ ¹æ“šèªæ„åŒ–ç‰ˆæœ¬æ¨™æº–ï¼Œv0çš„é€™äº›ç‰ˆæœ¬å¤§å¤šæ²’æœ‰ç›¸å®¹æ€§ä¿è­‰ Go modules èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶ä¸€å€‹go modulesçš„ç‰ˆæœ¬è³‡è¨Šå¦‚ä¸‹12//ä¸»ç‰ˆæœ¬è™Ÿ.æ¬¡ç‰ˆæœ¬è™Ÿ.ä¿®è¨‚è™Ÿv1.2.3 ä¸»ç‰ˆæœ¬ç·¨è™Ÿï¼šåšäº†ä¸ç›¸å®¹çš„APIä¿®æ”¹ä¹‹é¡çš„ æ¬¡ç‰ˆæœ¬ç·¨è™Ÿ: åšäº†å‘ä¸‹ç›¸å®¹çš„åŠŸèƒ½æ€§æ–°å¢ ä¿®è¨‚å¥½: å‘ä¸‹ç›¸å®¹çš„åŠŸèƒ½é™¤éŒ¯ è‹¥æ˜¯å…ˆè¡Œç‰ˆæœ¬çš„è©±ï¼Œé‚£åŠ ä¸Š pre å¾Œç¶´1v1.2.3-pre ç™¼ä½ˆæ–°ç‰ˆæœ¬æ™‚æ‡‰éµå¾ªèªæ„åŒ–ç‰ˆæœ¬è¦å‰‡ï¼Œå¦å‰‡ç„¡æ³•è¢«go getæ‰€æ‹‰å– go listçš„åŠŸèƒ½æä¾›è©²å°ˆæ¡ˆæ‰€æœ‰denpendencyçš„è³‡è¨Š é€é go list -m -u all å¯ä»¥æª¢è¦–æ‰€æœ‰çš„dependencyè³‡è¨Š 123456$ go list -m -u allgithub.com/jellyhola/module-repogolang.org/x/text v0.3.4golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6ersc.io/quote v1.5.2rsc.io/sampler v1.3.0 -m: é¡¯ç¤ºæ‰€æœ‰ä¾è³´çš„æ¨¡çµ„ -u: é¡¯ç¤ºèƒ½å¤ å‡ç´šçš„ç‰ˆæœ¬","categories":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"Gitbookçš„ä½¿ç”¨ç´€éŒ„","slug":"gitbook-tutorial","date":"2020-10-03T22:47:21.000Z","updated":"2021-01-28T12:12:54.817Z","comments":true,"path":"2020/10/04/gitbook-tutorial/","link":"","permalink":"http://a10000005588.github.io/2020/10/04/gitbook-tutorial/","excerpt":"Gitbookæä¾›äº†èƒ½å¤ å°‡markdownæ ¼å¼è½‰å¯«æˆä¸€æœ¬é›»å­æ›¸çš„æ¨£å­","text":"Gitbookæä¾›äº†èƒ½å¤ å°‡markdownæ ¼å¼è½‰å¯«æˆä¸€æœ¬é›»å­æ›¸çš„æ¨£å­ æœ¬åœ°ç«¯åŸ·è¡Œå®‰è£æ–¹å¼ï¼Œç”¨ npm å®‰è£ 1npm install -g gitbook-cli ä½¿ç”¨æ–¹å¼æ‰¾ä¸€å€‹è³‡æ–™å¤¾ï¼ŒåŸ·è¡Œ1gitbook init æœƒç”¢ç”Ÿ reamdme.md ä»‹ç´¹æœ¬æ›¸å…§å®¹ summary.md ç”¨ä¾†å®šç¾©gitbookç›®éŒ„ summary.md çµæ§‹123* ch1 * ch1-1 * ch1-2 æª”æ¡ˆçµæ§‹çš„è©±å°±é•·é€™æ¨£12345- ch1|- ch1-1|- ch1-2-readme.md-summary.md é‹è¡Œgitbook1gitbook serve é è¨­æœƒé‹è¡Œåœ¨ localhost:4000 å®‰è£Pluginäº‹å…ˆå®‰è£gitbook-pluginå¥—ä»¶1npm install gitbook-plugin è‹¥è¦å®‰è£ç•™è¨€æ¿ç­‰å¥—ä»¶ï¼Œéœ€è¦å…ˆå®šç¾© book.json ï¼Œå¯ä»¥å®šç¾©ä½¿ç”¨çš„plugin book.json12345678&#123; &quot;plugins&quot;: [&quot;disqus&quot;], &quot;pluginsConfig&quot;: &#123; &quot;disqus&quot;: &#123; &quot;shortName&quot;: &quot;ä½ çš„ç•™è¨€æ¿åç¨±&quot; &#125; &#125;&#125; ä¾‹å¦‚å¯ä½¿ç”¨ Google Analytics ( Google åˆ†æ )ã€Disqus ( ç¤¾ç¾¤&amp;ç•™è¨€æ¿ ) å’Œ youtube â€¦ç­‰å¤–æ›ï¼Œä¹Ÿå¯ä»¥åœ¨Gitbook npmç¶²ç«™ä¸­æ‰¾åˆ°è‡ªå·±è¦çš„plugin å®šç¾©ç©ä½¿ç”¨çš„plunginå¤–æ›ï¼Œè«‹åŸ·è¡Œ1gitbook install Disqusç•™è¨€æ¿1npm i gitbook-plugin-disqus 12345678&#123; &quot;plugins&quot;: [&quot;disqus&quot;], &quot;pluginsConfig&quot;: &#123; &quot;disqus&quot;: &#123; &quot;shortName&quot;: &quot;ä½ çš„ç•™è¨€æ¿åç¨±&quot; &#125; &#125;&#125; å…§å®¹ç¶±è¦ InTopic TOCå¦‚æœè¦å¯¦ç¾å³é‚Šå´é‚Šæ¬„æœ¬é mdæª”æ¡ˆçš„éšå±¤å¼ï¼Œå¯å®‰è£ InTopic TOC GitBook plugin: InTopic TOC æ–¼book.jsonä¸­å®šç¾©12345678910&#123; &quot;plugins&quot;: [ &quot;intopic-toc&quot; ], &quot;pluginsConfig&quot;: &#123; &quot;intopic-toc&quot;: &#123; &quot;label&quot;: &quot;In this article&quot; &#125; &#125;&#125; æ¥è‘—åŸ·è¡Œ1gitbook install åƒè€ƒGitbook Github Docs Gitbook Online Platform Docs ç”¨ GitBook ä¾†å¯«æœ¬æ›¸å§","categories":[{"name":"Tools","slug":"Tools","permalink":"http://a10000005588.github.io/categories/Tools/"}],"tags":[{"name":"Note","slug":"Note","permalink":"http://a10000005588.github.io/tags/Note/"}]},{"title":"éœæ…‹èˆ‡å‹•æ…‹å‡½å¼åº«çš„ä»‹ç´¹èˆ‡å·®ç•°(Static èˆ‡ Shared Libraries)","slug":"Static_vs_Shared_Lib","date":"2020-08-17T13:38:37.000Z","updated":"2021-01-28T12:10:16.323Z","comments":true,"path":"2020/08/17/Static_vs_Shared_Lib/","link":"","permalink":"http://a10000005588.github.io/2020/08/17/Static_vs_Shared_Lib/","excerpt":"å‰›å¥½åœ¨è¤‡ç¿’Golangçš„æ™‚å€™çœ‹åˆ°Goæœ‰æ”¯æ´è¼‰å…¥C Languageçš„Static Libraryèˆ‡Shared Librariesï¼Œæ–¼æ˜¯ä¾†è¤‡ç¿’ä¸€ä¸‹ä»–å€‘ä¹‹é–“çš„å·®ç•°","text":"å‰›å¥½åœ¨è¤‡ç¿’Golangçš„æ™‚å€™çœ‹åˆ°Goæœ‰æ”¯æ´è¼‰å…¥C Languageçš„Static Libraryèˆ‡Shared Librariesï¼Œæ–¼æ˜¯ä¾†è¤‡ç¿’ä¸€ä¸‹ä»–å€‘ä¹‹é–“çš„å·®ç•° ä»‹ç´¹é¦–å…ˆè¦å…ˆäº†è§£ï¼ŒLibraryçš„æ„ç¾©ï¼Œå°±å–®ç´”ç‚ºä¸€å€‹æª”æ¡ˆå°‡æœƒå…±ç”¨çš„ç¨‹å¼ç¢¼æ‰“åŒ…å†ä¸€èµ·çš„æª”æ¡ˆå°±ç¨±ç‚ºLibrary å‡è¨­ç¾åœ¨è‹¥è¦ä½¿ç”¨printé€™å€‹æ–¹æ³•ä¾†å°å‡ºæ±è¥¿åœ¨è¢å¹•ï¼Œæ•…å¯ä»¥å°‡printç·¨è­¯æˆLibraryï¼Œä¾›å„å€‹é–‹ç™¼è€…ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨è®“é–‹ç™¼è€…è‡ªå·±å®šç¾©printæ–¹æ³•ï¼Œè¦ç…©æƒ±å¦‚ä½•èˆ‡OSæºé€šä¸¦å°å‡ºç•«é¢çš„é‚è¼¯ç¨‹å¼ç¢¼ Static LibraryStatic Libararyé€šå¸¸ç‚ºæˆ‘å€‘è‡ªå·±å¯«å¥½çš„ç¨‹å¼ç¢¼ï¼Œç¶“éCompileä¹‹å¾Œï¼Œæ‰€å¾—åˆ°çš„å°±æ˜¯ Static Library Sharedå‰‡æ˜¯æˆ‘å€‘ä¹Ÿæ˜¯å°‡ç¨‹å¼ç¢¼ç¶“éCompileï¼Œä¹Ÿæ˜¯å¾—åˆ° Shared Library è½èµ·ä¾†éç¨‹éƒ½å¾ˆåƒï¼Œé‚£åˆ°åº•å·®ç•°åœ¨å“ªï¼Ÿ å…¶å¯¦å¾å­—é¢ä¸Šæ›‰å¾—ï¼Œå¾ä½¿ç”¨å…¶æ„ç¾©ä¾†è§£é‡‹ åœ¨å°ˆæ¡ˆç¨‹å¼ä½¿ç”¨å…¶Static Libraryæ™‚ï¼Œè©²å°ˆæ¡ˆé€²è¡ŒCompileï¼ŒCompileræœƒåœ¨Compile Timeæ™‚å°‡Static Libraryçš„ç¨‹å¼ç¢¼çµ¦â€è¤‡è£½â€åˆ°å°ˆæ¡ˆç¨‹å¼ç¢¼ä¸­ã€‚ å‡å¦‚æˆ‘å€‘Static Libä¸­æœ‰å€‹print()æ–¹æ³•ï¼Œé‚£å°ˆæ¡ˆCompileæ™‚å°±æœƒæŠŠprint()æ–¹æ³•copyåˆ°APPä¸­ï¼ŒAPPå•Ÿå‹•æ™‚å°±æœƒæœ‰print()æ–¹æ³• 12CODE (import static lib) -&gt; Compiled STATIC LibAPP å•Ÿå‹• -&gt; PRINT() Shared Libraryé¡§åæ€ç¾©å°±æ˜¯ç›´æ¥å…±äº«Libraryå…§çš„ç¨‹å¼ç¢¼ ç•¶å°ˆæ¡ˆä½¿ç”¨çš„æ˜¯Shared Libraryï¼Œé‚£å°ˆæ¡ˆé€²è¡ŒCompileæ™‚ï¼ŒCompileræœƒå»Link Shared Libarayçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç”¨è¤‡è£½çš„ã€‚ å‡å¦‚Shared Library Libä¸­åŒæ¨£æœ‰å€‹print()æ–¹æ³•ï¼Œé‚£å°ˆæ¡ˆCompileå°±æœƒé€£çµè©²Shared Libä¸­çš„print()æ–¹æ³•ï¼Œæ–¼æ˜¯APPå•Ÿå‹•ä¹ŸåŒæ¨£æœƒæœ‰print()æ–¹æ³•å¯ä½¿ç”¨ 12CODE (import shared lib) -&gt; CompiledAPP å•Ÿå‹• -&gt; é€£çµä½¿ç”¨ Shared Libå…§çš„ print() Shared Libraryæ”¯æ´å‹•æ…‹é€£çµè¼‰å…¥ ä½¿ç”¨æƒ…å¢ƒè‹¥è¦çµ¦å®¢æˆ¶æä¾›ä¸€å€‹æœ‰100å€‹åŠŸèƒ½çš„APP äº¤ä»˜çµ¦å®¢æˆ¶çš„è‹¥æ˜¯ Static Libraryå»ºç¯‰å‡ºçš„APP: 1å®¢æˆ¶è½è‘—ï¼Œä½ åªè¦æœ‰é€™ä¸€å€‹æª”æ¡ˆï¼Œå°±åŒ…å«äº†ä½ éœ€è¦çš„100å€‹åŠŸèƒ½ è‹¥äº¤ä»˜çµ¦å®¢æˆ¶çš„åŠŸèƒ½ï¼Œæ¯ä¸€éš»åŠŸèƒ½éƒ½ç”¨Shared Libraryå¯¦ä½œï¼Œé‚£éº¼ã€‚ã€‚ã€‚ 1å®¢æˆ¶è½è‘—ï¼Œæˆ‘é€™å€‹æª”æ¡ˆå¾ˆå°ï¼Œä½†åŒæ™‚è¦é€£çµ100çš„æª”æ¡ˆ (Shared Library)ï¼Œä¸€å€‹éƒ½ä¸èƒ½å°‘ï¼Œæ‰èƒ½å•Ÿå‹• å„ªç¼ºé» Static Shared å°ˆæ¡ˆå¤§å° å°ˆæ¡ˆsizeæ¯”è¼ƒè‚¥å¤§ å°ˆæ¡ˆçš„sizeè¼ƒå° å•Ÿå‹•ç‹€æ³ ç¨‹å¼ç¢¼åœ¨Compileæ™‚éƒ½æ”¾åœ¨ä¸€èµ·äº†ï¼Œç›´æ¥é‹è¡Œè©²å°ˆæ¡ˆå°±å¥½ è‹¥æŸå€‹Shared Libä¸è¦‹ï¼Œå°ˆæ¡ˆæœƒç„¡æ³•å•Ÿå‹• æ˜¯å¦æ”¯æ´å‹•æ…‹é€£çµ ç„¡ï¼Œå°ˆæ¡ˆé‹ä½œæ™‚è¼ƒè€—è²»è¨˜æ†¶é«” æœ‰æ”¯æ´ï¼Œç•¶åŸ·è¡Œåˆ°æœ‰ä½¿ç”¨Shared Libraryçš„classæ™‚ï¼Œæ‰æœƒè¼‰å…¥ä¹‹åˆ°è¨˜æ†¶é«”ï¼Œé¿å…è¨˜æ†¶é«”ç©ºé–“æµªè²» Libraryç·¨è­¯çš„æª”æ¡ˆæ ¼å¼ Shared Libraries .so (Linus) .dll (Win) .dylib (Mac) Static Libraries .a .lib åƒè€ƒStatic vs. Shared Librarieshttps://www.youtube.com/watch?v=-vp9cFQCQCo Static èˆ‡ Shared çš„å‡½å¼åº«æ’°å¯«https://fred-zone.blogspot.com/2006/03/static-shared.html å‹•æ…‹é€£çµå‡½å¼åº«https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93","categories":[{"name":"Computer Science","slug":"Computer-Science","permalink":"http://a10000005588.github.io/categories/Computer-Science/"}],"tags":[{"name":"Computer Science","slug":"Computer-Science","permalink":"http://a10000005588.github.io/tags/Computer-Science/"}]},{"title":"State Pattern ç‹€æ…‹æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-State-Pattern-ç‹€æ…‹æ¨¡å¼","date":"2020-08-08T14:10:35.000Z","updated":"2021-01-28T12:17:50.577Z","comments":true,"path":"2020/08/08/Design-Pattern-Java-State-Pattern-ç‹€æ…‹æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/08/08/Design-Pattern-Java-State-Pattern-ç‹€æ…‹æ¨¡å¼/","excerpt":"é€éçµ±ä¸€çš„â€ç‹€æ…‹é¡åˆ¥â€ï¼Œä¾†å®šç¾©ç‰©ä»¶çš„å…§éƒ¨ç‹€æ…‹æ˜¯å¦‚ä½•","text":"é€éçµ±ä¸€çš„â€ç‹€æ…‹é¡åˆ¥â€ï¼Œä¾†å®šç¾©ç‰©ä»¶çš„å…§éƒ¨ç‹€æ…‹æ˜¯å¦‚ä½• ä»¥ç³–æœæ©Ÿç‚ºä¾‹å­ï¼Œæ²’æœ‰ä½¿ç”¨State Patternçš„ç‹€æ³æˆ‘å€‘ç¾åœ¨æœ‰å€‹ç³–æœæ©Ÿï¼Œé€šå¸¸ä¸€å°ç³–æœæ©Ÿå¯ä»¥é€²è¡ŒæŠ•å¹£ï¼Œè½‰å‹•æ‰‹æŠŠï¼Œä¸¦åå‡ºä¸€é¡†ç³–æœ æ‰€ä»¥è©²ç³–æœæ©Ÿå…±æœ‰å››ç¨®ç‹€æ…‹ (NoCoinStateç›®å‰æ²’æœ‰éŒ¢å¹£, HasCoinStateç›®å‰æœ‰éŒ¢å¹£, SoldCandyStateå”®å‡ºç³–æœä¸­, NoCandyStateæ²’æœ‰ç³–æœä¸­)ï¼Œå¦‚é™„åœ–æ‰€ç¤ºï¼š æˆ‘å€‘æœƒå¾ˆç›´è¦ºçš„å®šç¾©ç³–æœæ©Ÿé¡åˆ¥èˆ‡é€™å››å€‹ç‹€æ…‹ç‚ºå…¨åŸŸè®Šæ•¸ï¼Œä¸¦ä¸”å¯¦ä½œä¸€ä¸‹ç³–æœæ©Ÿå…·å‚™çš„å‹•ä½œæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344class CandyMachine &#123; public static int NoCandyState = 0; public static int NoCoinState = 1; public static int HasCoinState = 2; public static int SoldCandyState = 3; int state = NoCandyState; // ä¸€é–‹å§‹ç³–æœæ©Ÿæ˜¯æ²’æœ‰ç³–æœçš„ int count = 0; // ç³–æœæ•¸ç›® CandyMachine(int count) &#123; this.count = count; this.state = NoCoinState; // æœ‰äº†ç³–æœï¼Œç­‰å¾…è¢«æŠ•éŒ¢ &#125; public void insertCoin() &#123; System.out.println(\"æŠ•å…¥éŒ¢å¹£\"); this.state = HasCoinState; &#125; public void turnCrank() &#123; System.out.println(\"è½‰å‹•æŠŠæ‰‹ä¸­......\"); // åˆ¤æ–·ç›®å‰æ˜¯å¦æœ‰éŒ¢ if (this.state == HasCoinState) &#123; this.state = SoldCandyState; this.dispense(); &#125; else &#123; System.out.println(\"ç›®å‰æ²’æœ‰éŒ¢å¹£\"); &#125; &#125; public void dispense() &#123; // æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾† System.out.println(\"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ\"); this.count--; if (this.count == 0) &#123; // æ²’æœ‰ç³–æœäº†ï¼Œå›æ­¸åˆ°æ²’ç³–æœç‹€æ…‹ this.state = NoCandyState; &#125; else &#123; // é‚„æœ‰ç³–æœçš„è©±ï¼Œé¡¯ç¤ºç›®å‰æ²’æœ‰éŒ¢å¹£ this.state = NoCoinState; &#125; &#125;&#125; é‚£æˆ‘å€‘ç¾åœ¨å¯ä»¥ä¾†è·Ÿç³–æœæ©Ÿäº’å‹•ä¸€ä¸‹ 12345678910111213141516public class main &#123; public static void main(String[] args) &#123; CandyMachine candyMachine = new CandyMachine(1); // å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹• System.out.println(\"====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====\"); candyMachine.insertCoin(); candyMachine.turnCrank(); // ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹• System.out.println(\"====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====\"); candyMachine.turnCrank(); // æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº† System.out.println(\"=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†====\"); candyMachine.insertCoin(); &#125;&#125; 12345678910====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====æŠ•å…¥éŒ¢å¹£è½‰å‹•æŠŠæ‰‹ä¸­......ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====è½‰å‹•æŠŠæ‰‹ä¸­......ç›®å‰æ²’æœ‰éŒ¢å¹£=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†====æŠ•å…¥éŒ¢å¹£ç›®å‰æ²’æœ‰ç³–æœï¼ŒéŒ¢é€€é‚„çµ¦æ‚¨ ç›®å‰çœ‹èµ·ä¾†é‹ä½œçš„å¾ˆæ­£å¸¸ å‡å¦‚æœ‰æ–°éœ€æ±‚ï¼šè½‰å‹•æ™‚æœƒæœ‰æ©Ÿç‡å¯ä»¥å†å¤šé€ä¸€é¡†ï¼é‚£é€™æ™‚å€™â€¦æˆ‘å€‘å¾—å°CandyMachineçš„dispense()åšå€‹èª¿æ•´ï¼š 12345678910111213141516171819202122232425 public void dispense() &#123; // å®šç¾©æ©Ÿç‡ï¼Œå¦‚æœæ©Ÿç‡å°æ–¼10%å°±åå‡ºå…©é¡†ç³–æœ Random rand = new Random(); if (rand.nextInt(10) &lt;= 5) &#123; System.out.println(\"æ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ\"); if (this.count &gt;= 2) &#123; // åå‡ºå…©é¡†ç³–æœ this.count--; this.count--; &#125; &#125; else &#123; // æ²’ä¸­çï¼Œåªåä¸€é¡† this.count--; // æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾† System.out.println(\"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ\"); &#125; if (this.count == 0) &#123; // æ²’æœ‰ç³–æœäº†ï¼Œå›æ­¸åˆ°æ²’ç³–æœç‹€æ…‹ this.state = NoCandyState; &#125; else &#123; // é‚„æœ‰ç³–æœçš„è©±ï¼Œé¡¯ç¤ºç›®å‰æ²’æœ‰éŒ¢å¹£ this.state = NoCoinState; &#125;&#125; é€™æ™‚å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è‹¥æœ‰æ–°éœ€æ±‚ï¼Œå°±éœ€è¦ä¸€ç›´å°CandyMachineé¡åˆ¥ä¸€ç›´åšä¿®æ­£ï¼Œå…¶æœªä¾†è‹¥æœ‰æ›´å¤šç‹€æ…‹æ™‚ï¼Œç¨‹å¼ç¢¼æœƒè®Šå¾—ä¸å¥½ç¶­è­· ä½¿ç”¨ç‹€æ…‹æ¨¡å¼æ”¹å–„ç›®å‰ç³–æœæ©Ÿçš„è¨­è¨ˆå…ˆä¾†çœ‹çœ‹è©²è¨­è¨ˆæ¨¡å¼çš„åœ–è¡¨æ˜¯é•·æ€æ¨£ ç‹€æ…‹æ¨¡å¼çš„é¡åˆ¥åœ– é€™æ™‚æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œå°‡åŸæœ¬ç³–æœæ©Ÿå…§çš„staticå…¨åŸŸè®Šæ•¸ç‹€æ…‹ï¼Œéƒ½çµ±ä¸€è®Šæˆä¸€å€‹stateè®Šæ•¸ (ç‚ºStateComponentä»‹é¢å‹æ…‹)ã€‚ é€™æ™‚æˆ‘å€‘å°±æƒ³æŠŠæ¯å€‹ç‹€æ…‹ (NoCoinStateç›®å‰æ²’æœ‰éŒ¢å¹£, HasCoinStateç›®å‰æœ‰éŒ¢å¹£, SoldCandyStateå”®å‡ºç³–æœä¸­, NoCandyStateæ²’æœ‰ç³–æœä¸­) éƒ½çµ±ä¸€è®Šæˆ ConcreteStateé¡åˆ¥ï¼Œä¾†å¯¦ä½œStateæŠ½è±¡ä»‹é¢ï¼Œä»¥åˆ©Clienté¡åˆ¥å¯ä»¥æŠ½æ›ç‹€æ…‹ æ¥è‘—ç›´æ¥ä¾†æ”¹é€ ç³–æœæ©Ÿï¼Œå…ˆå®šç¾©æ¯å€‹ç‹€æ…‹éƒ½æœƒæœ‰å°æ‡‰çš„æ–¹æ³• å› ç‚ºç•¶ç³–æœæ©Ÿç‚ºæŸç¨®ç‹€æ…‹æ™‚ï¼Œè‹¥å‘¼å«å…¶å‹•ä½œï¼Œå°±æœƒå°å‡ºå°æ‡‰çš„è³‡è¨Š é€™è£¡æˆ‘å€‘å…ˆç‚ºæ¯å€‹å‹•ä½œéƒ½å…ˆæ‹‹å‡ºä¾‹å¤–ï¼Œå› ç‚ºæœ‰äº›æ–¹æ³•æœ‰çš„ç‹€æ…‹å¯èƒ½ä¸éœ€è¦ä½¿ç”¨ 1234567891011abstract class State &#123; void insertCoin() &#123; throw new UnsupportedOperationException(); &#125; void turnCrank() &#123; throw new UnsupportedOperationException(); &#125; void dispense() &#123; throw new UnsupportedOperationException(); &#125;&#125; å®šç¾©ç³–æœæ©Ÿçš„é››å½¢ç³–æœæ©Ÿæ“æœ‰äº†å„å€‹ç‹€æ…‹çš„é¡åˆ¥ï¼Œä¸¦ä¸”æä¾›getXXX()æ–¹æ³•ï¼Œä¾›å…¶ä»–ç‹€æ…‹å¯ä»¥æŠ½æ›è‡ªå·±çš„ç‹€æ…‹ 1234567891011121314151617181920212223242526272829303132333435363738class CandyMachine &#123; public State state; public int count; State noCoinState; State hasCoinState; State soldCandyState; State noCandyState; CandyMachine(int count) &#123; this.count = count; noCoinState = new NoCoinState(this); hasCoinState = new HasCoinState(this); soldCandyState = new SoldCandyState(this); noCandyState = new NoCandyState(this); &#125; public void setState(State state) &#123; this.state = state; &#125; public State getNoCoinState() &#123; return this.noCoinState; &#125; public State getHasCoinState() &#123; return this.hasCoinState; &#125; public State getSoldCandyState() &#123; return this.soldCandyState; &#125; public State getNoCandyState() &#123; return this.noCandyState; &#125;&#125; å¯¦ä½œå„å€‹ç‹€æ…‹æ¯å€‹ç‹€æ…‹éƒ½æœƒå¼•å…¥CandyMachiné¡åˆ¥ï¼Œä»¥ä¾¿èƒ½å¤ å¹«åŠ©ç³–æœæ©Ÿé€²è¡Œç‹€æ…‹è®ŠåŒ– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105class NoCoinState extends State &#123; CandyMachine candyMachine; NoCoinState(CandyMachine candyMachine) &#123; this.candyMachine = candyMachine; &#125; @Override void insertCoin() &#123; System.out.println(\"æŠ•å…¥éŒ¢å¹£\"); this.candyMachine.setState(this.candyMachine.getHasCoinState()); &#125; @Override public void turnCrank() &#123; System.out.println(\"ç›®å‰æ²’æœ‰éŒ¢å¹£\"); &#125;&#125;class HasCoinState extends State &#123; CandyMachine candyMachine; HasCoinState(CandyMachine candyMachine) &#123; this.candyMachine = candyMachine; &#125; @Override public void insertCoin() &#123; System.out.println(\"ç›®å‰å·²ç¶“æœ‰éŒ¢å¹£äº†ï¼\"); &#125; @Override public void turnCrank() &#123; System.out.println(\"è½‰å‹•æ‰‹æŠŠä¸­\"); // åˆ‡æ›åˆ°ä¸‹ä¸€å€‹ç‹€æ…‹ candyMachine.setState(this.candyMachine.getSoldCandyState()); this.candyMachine.state.dispense(); &#125; @Override public void dispense() &#123; System.out.println(\"ç›®å‰æ²’æœ‰éŒ¢å¹£\"); &#125;&#125;class SoldCandyState extends State &#123; CandyMachine candyMachine; SoldCandyState(CandyMachine candyMachine) &#123; this.candyMachine = candyMachine; &#125; @Override public void insertCoin() &#123; System.out.println(\"ç›®å‰æ­£åœ¨åç³–æœä¸­ï¼Œè«‹å‹¿æŠ•å¹£ï¼\"); &#125; @Override public void turnCrank() &#123; System.out.println(\"ç›®å‰æ­£åœ¨åç³–æœä¸­ï¼Œè«‹å‹¿è½‰å‹•ï¼\"); &#125; @Override public void dispense() &#123; System.out.println(\"é–‹å§‹åç³–æœ\"); // å®šç¾©æ©Ÿç‡ï¼Œå¦‚æœæ©Ÿç‡å°æ–¼10%å°±åå‡ºå…©é¡†ç³–æœ Random rand = new Random(); if (rand.nextInt(10) &lt;= 5) &#123; System.out.println(\"æ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ\"); if (this.candyMachine.count &gt;= 2) &#123; // åå‡ºå…©é¡†ç³–æœ this.candyMachine.count--; this.candyMachine.count--; &#125; &#125; else &#123; // æ²’ä¸­çï¼Œåªåä¸€é¡† this.candyMachine.count--; // æœ‰éŒ¢çš„è©±å°±åä¸€é¡†ç³–æœå‡ºä¾† System.out.println(\"ç³–æœæ©Ÿåäº†ä¸€é¡†ç³–æœ\"); &#125; if (this.candyMachine.count == 0) &#123; this.candyMachine.setState(this.candyMachine.getNoCandyState()); &#125; else &#123; this.candyMachine.setState(this.candyMachine.getNoCoinState()); &#125; &#125;&#125;class NoCandyState extends State &#123; CandyMachine candyMachine; NoCandyState(CandyMachine candyMachine) &#123; this.candyMachine = candyMachine; &#125; @Override public void insertCoin() &#123; System.out.println(\"ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£ï¼\"); &#125; @Override public void turnCrank() &#123; System.out.println(\"ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£\"); &#125;&#125; æ“ä½œç³–æœæ©Ÿ12345678910111213141516public class main &#123; public static void main(String[] args) &#123; CandyMachine candyMachine = new CandyMachine(2); // å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹• System.out.println(\"====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====\"); candyMachine.state.insertCoin(); candyMachine.state.turnCrank(); // ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹• System.out.println(\"====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====\"); candyMachine.state.turnCrank(); // æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº† System.out.println(\"=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿå¯èƒ½ç›®å‰æ²’ç³–æœäº†====\"); candyMachine.state.insertCoin(); &#125;&#125; 123456789====å…ˆæŠ•éŒ¢ï¼Œåœ¨è½‰å‹•====æŠ•å…¥éŒ¢å¹£è½‰å‹•æ‰‹æŠŠä¸­é–‹å§‹åç³–æœæ­å–œä¸­çï¼Œç³–æœæ©Ÿåäº†äºŒé¡†ç³–æœ====ä¸æŠ•éŒ¢ï¼Œç›´æ¥è½‰å‹•====ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£=====æŠ•éŒ¢ï¼Œä½†ç³–æœæ©Ÿç›®å‰æ²’ç³–æœäº†====ç›®å‰æ²’æœ‰ç³–æœï¼Œè«‹å‹¿æŠ•å¹£ï¼ ç”¨é€™å¼µåœ–å¯ä»¥æ›´äº†è§£ç³–æœæ©Ÿæ˜¯å¦‚ä½•èˆ‡ç‹€æ…‹å€‘åšäº’å‹• å°çµæˆ‘å€‘å¯ä»¥çœ‹åˆ°å¥—ç”¨ç‹€æ…‹æ¨¡å¼å¾Œï¼Œè‹¥æœªä¾†è¦æ–°å¢ç‹€æ…‹æ™‚ï¼Œç›´æ¥å¯¦ä½œStateæŠ½è±¡é¡åˆ¥ï¼Œä¸¦ä¸”åªæœƒéœ€è¦æ›´å‹•åˆ°è·Ÿæ–°å¢ç‹€æ…‹é¡åˆ¥çš„ç›¸é—œé€£ç‹€æ…‹ï¼Œä½¿å¾—æˆ‘å€‘ç¨‹å¼æ›´å¥½ç¶­è­·","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Composite Pattern åˆæˆæ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Composite-Pattern-åˆæˆæ¨¡å¼","date":"2020-08-06T13:34:16.000Z","updated":"2021-01-28T12:17:21.724Z","comments":true,"path":"2020/08/06/Design-Pattern-Java-Composite-Pattern-åˆæˆæ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/08/06/Design-Pattern-Java-Composite-Pattern-åˆæˆæ¨¡å¼/","excerpt":"å°‡æœ‰éšå±¤é—œä¿‚çš„é¡åˆ¥ç‹€æ…‹çµ¦æ‰å¹³åŒ–ï¼Œçµ¦ä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ä¸€è‡´æ€§çš„é—œä¿‚","text":"å°‡æœ‰éšå±¤é—œä¿‚çš„é¡åˆ¥ç‹€æ…‹çµ¦æ‰å¹³åŒ–ï¼Œçµ¦ä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ä¸€è‡´æ€§çš„é—œä¿‚ è‹¥æ²’æœ‰åˆæˆæ¨¡å¼æœƒæ€æ¨£ï¼Ÿå‡å¦‚ç¾åœ¨æˆ‘å€‘ä¾†åˆ°ä¸€é–“è‡ªåŠ©å§ï¼Œæœ‰ä¸€å€‹èœå–®é¡åˆ¥ï¼Œä½†é€™å€‹èœå–®é¡åˆ¥è£¡é¢é‚„æœƒæœ‰ç”œé»é€™å€‹å­èœå–® å¤§æ¦‚é•·ä¸‹é¢é€™æ¨£ æ–¼æ˜¯æˆ‘å€‘å¤§æ¦‚æœƒé€™æ¨£å¯¦ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970class BuffetMenu &#123; String name; ArrayList&lt;String&gt; items; DessertMenu dessertMenu; BuffetMenu() &#123; this.name = \"è‡ªåŠ©é¤èœå–®\"; this.items = new ArrayList&lt;&gt;(); this.dessertMenu = new DessertMenu(); // åˆå§‹åŒ–é …ç›® this.init(); &#125; private void init() &#123; this.items.add(\"ç‰›è‚‰éºµ\"); this.items.add(\"æµ·é®®é£¯\"); this.items.add(\"ç‰›æ’\"); &#125; public void setMenuItem(String item) &#123; this.items.add(item); &#125; public void showMenuItem() &#123; for(String item: items) &#123; System.out.println(this.name + \":\" + item); &#125; &#125; public void print() &#123; System.out.println(\"é–‹å§‹ä»‹ç´¹\" + this.name); showMenuItem(); &#125;&#125;class DessertMenu &#123; String name; ArrayList&lt;String&gt; items; ChocolateMenu chocolateMenu; DessertMenu() &#123; this.name = \"ç”œé»èœå–®\"; this.items = new ArrayList&lt;&gt;(); this.init(); &#125; private void init() &#123; this.items.add(\"é›è›‹é¤…ä¹¾\"); this.items.add(\"å·§å…‹åŠ›\"); this.items.add(\"æ£‰èŠ±ç³–\"); &#125; public void setMenuItem(String item) &#123; this.items.add(item); &#125; public void showMenuItem() &#123; for(String item: items) &#123; System.out.println(this.name + \":\" + item); &#125; &#125; public void print() &#123; System.out.println(\"é–‹å§‹ä»‹ç´¹\" + this.name); showMenuItem(); &#125;&#125; å¯ä»¥çœ‹åˆ°DessertMenué¡åˆ¥åŒ…å«åœ¨BuffetMenué¡åˆ¥äº† æˆ‘å€‘ç¾åœ¨æœ‰ä½æœå‹™ç”Ÿæä¾›ä»‹ç´¹èœå–®å…§å®¹ï¼Œå®šç¾©å¦‚ä¸‹ 123456789101112131415class Waitress &#123; BuffetMenu buffetMenu; Waitress(BuffetMenu buffetMenu) &#123; this.buffetMenu = buffetMenu; &#125; public void introduceMenu() &#123; // ä»‹ç´¹èœå–® this.buffetMenu.print(); this.buffetMenu.showMenuItem(); this.buffetMenu.dessertMenu.print(); this.buffetMenu.dessertMenu.showMenuItem(); &#125;&#125; ç„¶å¾Œæˆ‘å€‘è«‹æœå‹™ç”Ÿé–‹å§‹ä»‹ç´¹èœå–® 123456789public class main &#123; public static void main(String[] args) &#123; BuffetMenu buffetMenu = new BuffetMenu(); Waitress waitress = new Waitress(buffetMenu); waitress.introduceMenu(); &#125;&#125; 12345678é–‹å§‹ä»‹ç´¹è‡ªåŠ©é¤èœå–®è‡ªåŠ©é¤èœå–®:ç‰›è‚‰éºµè‡ªåŠ©é¤èœå–®:æµ·é®®é£¯è‡ªåŠ©é¤èœå–®:ç‰›æ’é–‹å§‹ä»‹ç´¹ç”œé»èœå–®ç”œé»èœå–®:é›è›‹é¤…ä¹¾ç”œé»èœå–®:æ£‰èŠ±ç³–ç”œé»èœå–®:å·§å…‹åŠ› ä½†å‡å¦‚ç¾åœ¨è®Šæˆé€™æ¨£å‘¢ï¼šç”œé»å…§çš„å·§å…‹åŠ›åˆæœ‰ä¸åŒé¡å‹çš„å·§å…‹åŠ›ï¼Œé‚£æˆ‘å€‘åˆè¦å†ä¿®æ”¹ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œå°‡Chocolateé¡åˆ¥åŠ å…¥åˆ°Desserté¡åˆ¥å…§ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364class DessertMenu &#123; String name; ArrayList&lt;String&gt; items; ChocolateMenu chocolateMenu; // å¤šäº†å·§å…‹åŠ›èœå–® DessertMenu() &#123; this.chocolateMenu = new ChocolateMenu(); this.name = \"ç”œé»èœå–®\"; this.items = new ArrayList&lt;&gt;(); this.init(); &#125; private void init() &#123; this.items.add(\"é›è›‹é¤…ä¹¾\"); this.items.add(\"æ£‰èŠ±ç³–\"); &#125; public void setMenuItem(String item) &#123; this.items.add(item); &#125; public void showMenuItem() &#123; for(String item: items) &#123; System.out.println(this.name + \":\" + item); &#125; &#125; public void print() &#123; System.out.println(\"é–‹å§‹ä»‹ç´¹\" + this.name); &#125;&#125;// å¤šäº†å·§å…‹åŠ›èœå–®class ChocolateMenu &#123; String name; ArrayList&lt;String&gt; items; ChocolateMenu() &#123; this.name = \"å·§å…‹åŠ›èœå–®\"; items = new ArrayList&lt;&gt;(); this.init(); &#125; private void init() &#123; this.items.add(\"ç™½å·§å…‹åŠ›\"); this.items.add(\"é»‘å·§å…‹åŠ›\"); this.items.add(\"é…’é‡€å·§å…‹åŠ›\"); &#125; public void setMenuItem(String item) &#123; this.items.add(item); &#125; public void showMenuItem() &#123; for(String item: items) &#123; System.out.println(this.name + \":\" + item); &#125; &#125; public void print() &#123; System.out.println(\"é–‹å§‹ä»‹ç´¹\" + this.name); &#125;&#125; é€™æ™‚è¦ä¿®æ”¹æœå‹™ç”Ÿçš„è…¦è¢‹ï¼Œä½¿å…¶çŸ¥é“å·§å…‹åŠ›èœå–®çš„å…§å®¹ã€‚ã€‚ã€‚ 123456789101112131415class Waitress &#123; BuffetMenu buffetMenu; Waitress(BuffetMenu buffetMenu) &#123; this.buffetMenu = buffetMenu; &#125; public void introduceMenu() &#123; // ä»‹ç´¹èœå–® this.buffetMenu.print(); this.buffetMenu.dessertMenu.print(); this.buffetMenu.dessertMenu.chocolateMenu.print(); &#125;&#125; ä½†é€™æ™‚å€™å°±æœƒç™¼ç¾ï¼Œæ¯æ¬¡è‹¥æ–°å¢ä¸€å€‹å­èœå–®æ™‚ï¼Œå‘¼å«è€…å°±éœ€è¦ç›´æ¥å°å…¶æ“ä½œï¼Œæ‰èƒ½å¤ å°å‡ºè©²å­èœå–®çš„é …ç›®åˆ—è¡¨ ä¸€ä½†å­èœå–®å…§åˆæœ‰å­èœå–®ï¼Œé‚£æ•´å€‹ç¨‹å¼ç¢¼çš„ç¶­è­·çš„ä»£åƒ¹å°±æœƒéå¸¸çš„é«˜ 123å¯ä»¥çœ‹åˆ°å­èœå–®å…§è‹¥åˆæœ‰å­èœå–®ï¼Œè¦å°å‡ºè©²åç¨±çš„è©±ï¼Œé‚£é€™è¡Œç¨‹å¼ç¢¼æœƒè¶Šä¾†è¶Šé•·ã€‚ã€‚ã€‚this.buffetMenu.dessertMenu.chocolateMenu.print(); ç¶­è­·ä¿®æ”¹çš„ä»£åƒ¹èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æƒ³è¦å«æœå‹™ç”Ÿèªªæ˜ï¼Œå“ªäº›èœ/ç”œé»æ˜¯ç´ é£Ÿçš„ï¼Œé€™æ™‚æœƒæ”¹codeæ”¹åˆ°æƒ³å“­ è§£æ±ºæœå‹™ç”Ÿä¸ç”¨ç¬¨æ‹™åœ°å­˜å–èœå–®èˆ‡å…¶å­èœå–®å€‘ï¼šåˆæˆæ¨¡å¼ç™»å ´åˆæˆæ¨¡å¼ä¸»è¦å¹«æˆ‘å€‘å»ºç«‹ä¸€å€‹é¡åˆ¥é—œä¿‚ï¼Œå»ºç«‹èµ·çˆ¶é¡åˆ¥èˆ‡å­é¡åˆ¥çš„éšå±¤é—œä¿‚ï¼Œä¸¦è®“å®¢æˆ¶ç«¯ä»¥ä¸€è‡´çš„æ–¹å¼å­˜å–æ¨¹ç‹€çµæ§‹å…§çš„å„å€‹é¡åˆ¥ å…ˆè¬›çµè«–ï¼Œä»¥ä¸Šçš„èœå–®å€‘ï¼Œå¥—ç”¨åˆæˆæ¨¡å¼å¾Œï¼Œæœå‹™ç”Ÿä¸ç”¨é€éä»¥ä¸‹æ–¹å¼å­˜å–å­èœå–®ä¸¦ä»‹ç´¹å‡ºä¾†äº†ï¼Œè€Œæ˜¯ç›´æ¥å¯ä»¥ç”¨ä¸€è‡´çš„æ–¹å¼å°‡æ‰€æœ‰èœå–®èˆ‡å­èœå–®éƒ½å‘¼å«å‡ºä¾†1234567891011public void introduceMenu() &#123; // ä»‹ç´¹èœå–® &lt;-- å¯ä»¥ä¸ç”¨ä¸€ä¸€åœ¨å‘¼å«èœå–®èˆ‡å­èœå–®å’Œå­èœå–®çš„å­èœå–®ã€‚ã€‚ã€‚ public void introduceMenu() &#123; // ä»‹ç´¹èœå–® this.buffetMenu.print(); this.buffetMenu.showMenuItem(); this.buffetMenu.dessertMenu.print(); this.buffetMenu.dessertMenu.showMenuItem(); this.buffetMenu.dessertMenu.chocolateMenu.print(); this.buffetMenu.dessertMenu.chocolateMenu.showMenuItem(); &#125; é€™æ™‚æˆ‘å€‘å…ˆä¾†çœ‹ åˆæˆæ¨¡å¼ çš„é¡åˆ¥é—œä¿‚åœ– Componenté¡åˆ¥ï¼šå®šç¾©äº†å…¶æ‰€æœ‰åº•ä¸‹è‘‰ç¯€é»èˆ‡åˆæˆé¡åˆ¥çš„çµæ§‹ æ‰€æœ‰çš„Leafç¯€é»èˆ‡Compositeç¯€é»éƒ½æœƒç¹¼æ‰¿(å¯¦ä½œ)è©²Componenté¡åˆ¥ Componentæ˜¯è€å¤§å“¥ï¼Œè€å¤§å“¥æœƒçš„ä¸‹é¢çš„ä¹Ÿæœƒå­¸åˆ° Leafé¡åˆ¥ï¼šæœƒå¯¦ä½œComponenté¡åˆ¥ï¼Œä½†ç”±æ–¼Leafç¯€é»æ²’æœ‰å­é¡åˆ¥ï¼Œæ‰€ä»¥åªæœƒæœ‰operation()çš„æ–¹æ³•ä¾›å‘¼å« Compositeé¡åˆ¥ï¼šåˆæˆé¡åˆ¥ï¼Œå°‡ä»¥ä¸‹å…©é»åšåˆæˆ æ‰€è¦åŸ·è¡Œçš„åŠŸèƒ½operation() ç®¡ç†å­é¡åˆ¥çš„æ–¹æ³• add() remove() getChild() å°æ‡‰Compositeé¡åˆ¥é—œä¿‚åœ–åˆ°æˆ‘å€‘ä¸Šè¿°æ‰€ç•«çš„èœå–®é—œä¿‚åœ–ï¼Œå°±æœƒé•·å¾—å¦‚ä¸‹ï¼š æŠŠä¸Šé¢æ‰€æåˆ°çš„é€™å¼µåœ–ä½œè½‰æ› å°±æœƒè®Šæˆé€™æ¨£å­ (çœç•¥Chocolateé¡åˆ¥çš„èœå–®é …ç›®) å®šç¾©MenuComponentæŠ½è±¡é¡åˆ¥å®šç¾©MenuComponent, æä¾›èœå–®åŸºæœ¬çš„æ–¹æ³• é€™é‚Šä¸»è¦ä¸æ˜¯å®šç¾©æˆInterface, è€Œæ˜¯æŠ½è±¡é¡åˆ¥çš„ä¸»è¦åŸå› æ˜¯å› ç‚ºï¼Œæˆ‘å€‘æœƒçµ¦ å­èœå–®å»ç¹¼æ‰¿èœå–®æ‰€å…·æœ‰çš„æ–¹æ³• ä½†åˆå› æœƒçµ¦èœå–®é …ç›®(MenuItem)ç¹¼æ‰¿(å¦‚ ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’)ï¼Œä½†èœå–®é …ç›®ä¸éœ€è¦åƒæ˜¯ add(), remove()ç­‰æ–¹æ³•ï¼Œæ‰€ä»¥æœƒåœ¨è©²æ–¹æ³•å…§å…ˆæ‹‹å‡º UnsupportedOperationException() Menu.java123456789101112131415161718192021222324252627282930313233abstract class MenuComponent &#123; void add(MenuComponent menuComponent) &#123; throw new UnsupportedOperationException(); &#125; void remove(MenuComponent menuComponent) &#123; throw new UnsupportedOperationException(); &#125; MenuComponent getChild(int i) &#123; throw new UnsupportedOperationException(); &#125; String getName() &#123; throw new UnsupportedOperationException(); &#125; String getDescription() &#123; throw new UnsupportedOperationException(); &#125; double getPrice() &#123; throw new UnsupportedOperationException(); &#125; boolean isVegetarian() &#123; throw new UnsupportedOperationException(); &#125; void print() &#123; throw new UnsupportedOperationException(); &#125;&#125; å¯ä»¥çœ‹åˆ°æˆ‘å€‘å®šç¾©äº†ä»¥ä¸‹æ–¹æ³•ï¼Œä¸¦ç­‰å¾…çœŸæ­£çš„èœå–®é¡åˆ¥ä¾†å¯¦ä½œå…¶ç´°ç¯€ add(): å¯æ–°å¢ å¯¦ä½œMenuComponentçš„ç‰©ä»¶ remove(): ç§»é™¤ å¯¦ä½œMenuComponentçš„ç‰©ä»¶ getChild(): å–å¾—Menuå…§çš„èœå–®é …ç›®/å­èœå–® getName(): å–å¾—èœå–®åç¨± getPrice: å–å¾—èœå–®é …ç›®åƒ¹æ ¼ isVegetarian(): ç¢ºèªæ˜¯å¦ç‚ºç´ é£Ÿ print(): å°å‡ºè‡ªå·±çš„æ‰€æœ‰èœå–®é …ç›®/å­èœå–®å…§å®¹ 12345é‚„è¨˜å¾—æœ€ä¸Šé¢çš„è‹¥è¦è«‹æœå‹™ç”Ÿç¢ºèªèœè‰²æ˜¯å¦æ˜¯ç´ é£Ÿï¼Œä½†è¦åˆ°è™•ä¿®æ”¹çš„æ…˜ç—›çš„ç¶“é©—å—ï¼Ÿé€™æ™‚å€™è‹¥åœ¨å…±é€šçš„ä»‹é¢ï¼Œå®šç¾©å¥½ä¸€å€‹isVegetarian(), è«‹èœè‰²è‡ªè¡Œæä¾›æ˜¯å¦æ˜¯ç´ é£Ÿï¼Œæ˜¯çš„è©±å›å‚³true, ä¸æ˜¯å°±å›å‚³false, å¦‚æ­¤ä¸€ä¾†æœå‹™ç”Ÿå°±å¯ä»¥åœ¨å‘¼å«print()æ™‚ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–·é€™é“é …ç›®æ˜¯å¦æ˜¯ç´ é£Ÿå›‰é—œæ–¼print()çš„å¯¦ç¾ç´°ç¯€å¾Œé¢æœƒä»‹ç´¹ é–‹å§‹å¯¦ä½œèœå–®å…ƒä»¶ï¼šå®šç¾©è‡ªåŠ©å¼èœå–®æ¥è‘—é–‹å§‹å¯¦ä½œè‡ªåŠ©é¤çš„å®Œæ•´èœå–®å§ï¼ BuffetMenu.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class BuffetMenu extends MenuComponent &#123; // å®£å‘Šè¦æ”¾ç½®èœå–®é …ç›®èˆ‡å­èœå–®çš„ArrayList ArrayList&lt;MenuComponent&gt; menuItems = new ArrayList&lt;&gt;(); // èœå–®åç¨± String name; BuffetMenu() &#123; this.name = \"è‡ªåŠ©å¼èœå–®\"; &#125; @Override void add(MenuComponent menuComponent) &#123; this.menuItems.add(menuComponent); &#125; @Override void remove(MenuComponent menuComponent) &#123; this.menuItems.remove(menuComponent); &#125; @Override MenuComponent getChild(int i) &#123; return this.menuItems.get(i); &#125; @Override String getName() &#123; return this.name; &#125; @Override String getDescription() &#123; return \"è‡ªåŠ©å¼èœå–®æä¾›äº†ä¸»èœå€‘(ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’), ä»¥åŠç”œé»èœå–®, è«‹ç›¡æƒ…äº«ç”¨ï¼\"; &#125; // ä¸ç”¨å¯¦ä½œgetPrice å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼ // ä¸ç”¨å¯¦ä½œisVegetarian å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼ // å¦‚æœæ˜¯èœå–®çš„è©±, printä½¿ç”¨iterator, å°‡ArrayListå‹æ…‹çš„menusä¸­çš„menuComponentä¸€ä¸€å–å‡ºä¾†, ä¸¦å‘¼å« @Override void print() &#123; System.out.println(this.getName()); System.out.println(this.getDescription()); Iterator iterator = menuItems.iterator(); while(iterator.hasNext()) &#123; // å–å‡ºä¾†çš„å¯èƒ½æ˜¯èœå–®é …ç›®, ä¹Ÿå¯èƒ½æ˜¯å­èœå–® MenuComponent menuComponent = (MenuComponent)iterator.next(); menuComponent.print(); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°åœ¨BuffetMenuä¸­ï¼Œå·²ç¶“é™¤äº† getPrice()å’ŒisVegetarian()é€™å…©é …èœå–®ä¸ç”¨å»å¯¦ä½œï¼Œå…¶ä»–éƒ½æœ‰å®šç¾©é‚è¼¯ é€™é‚Šè¦æ³¨æ„çš„æ˜¯ print() æˆ‘å€‘ä½¿ç”¨ iterator, å°‡èœå–®å…§çš„MenuComponentä¸€ä¸€å–å‡ºä¾†ï¼Œä¸¦ä¸”åœ¨å‘¼å«å…¶print(), ä¾åºå°è‡ªåŠ©å¼èœå–®å…§çš„èœå–®é …ç›®åšä»‹ç´¹é€™æ¨£ å®šç¾©èœå–®é …ç›®æ¥è‘—æˆ‘å€‘å®šç¾©ä¸€å€‹ç‰›è‚‰éºµé¡åˆ¥ BeefNoodles, å¯¦ä½œ MenuComponent 123456789101112131415161718192021222324252627282930313233class BeefNoodles extends MenuComponent &#123; // èœå–®åç¨± String name; @Override String getName() &#123; return this.name; &#125; @Override String getDescription() &#123; return \"å¥½åƒçš„ç‰›è‚‰éºµ, é“åœ°çš„å››å·å£å‘³ï½ï½\"; &#125; @Override double getPrice() &#123; return 120; &#125; @Override boolean isVegetarian() &#123; return false; // ç‰›è‚‰éºµä¸æ˜¯ç´ é£Ÿ &#125; // ä¸æ˜¯èœå–®, æ‰€ä»¥åªè¦å‘¼å«åç¨±èˆ‡æè¿°å°±å¥½ @Override void print() &#123; System.out.println(this.getName()); System.out.println(this.getDescription()); System.out.println(this.getPrice()); &#125;&#125; ç”±æ–¼ç‰›è‚‰éºµæ˜¯èœå–®çš„é …ç›®ï¼Œæ‰€ä»¥åªè¦å¯¦ä½œè·Ÿä»–è‡ªå·±æœ‰é—œçš„æ–¹æ³•å°±å¥½ï¼Œåœ¨print()ä¹Ÿåªè¦å°±å°å‡ºè‡ªå·±åç¨±æ˜¯ä»€éº¼ï¼Œä»¥åŠæè¿°, åƒ¹æ ¼ã€‚ å¯¦ä½œå­èœå–®: ç”œé»èœå–®è·Ÿå‰›å‰›å¯¦ä½œè‡ªåŠ©é¤çš„ç´°ç¯€éå¸¸é¡ä¼¼ DessertMenu.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class DessertMenu extends MenuComponent &#123; // å®£å‘Šè¦æ”¾ç½®èœå–®é …ç›®èˆ‡å­èœå–®çš„ArrayList ArrayList&lt;MenuComponent&gt; menuItems = new ArrayList&lt;&gt;(); // èœå–®åç¨± String name; DessertMenu() &#123; this.name = \"ç”œé»èœå–®\"; &#125; @Override void add(MenuComponent menuComponent) &#123; this.menuItems.add(menuComponent); &#125; @Override void remove(MenuComponent menuComponent) &#123; this.menuItems.remove(menuComponent); &#125; @Override MenuComponent getChild(int i) &#123; return this.menuItems.get(i); &#125; @Override String getName() &#123; return this.name; &#125; @Override String getDescription() &#123; return \"ç”œé»èœå–®æä¾›äº†ä¸€æ˜Ÿç±³å…¶æ—ä¸»å»šæ‰€è£½ä½œçš„ç”œé»å€‘ï¼\"; &#125; // ä¸ç”¨å¯¦ä½œgetPrice å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼ // ä¸ç”¨å¯¦ä½œisVegetarian å› ç‚ºèœå–®æ²’æœ‰åƒ¹æ ¼ // å¦‚æœæ˜¯èœå–®çš„è©±, printä½¿ç”¨iterator, å°‡ArrayListå‹æ…‹çš„menusä¸­çš„menuComponentä¸€ä¸€å–å‡ºä¾†, ä¸¦å‘¼å« @Override void print() &#123; System.out.println(this.getName()); System.out.println(this.getDescription()); Iterator iterator = menuItems.iterator(); while(iterator.hasNext()) &#123; // å–å‡ºä¾†çš„å¯èƒ½æ˜¯èœå–®é …ç›®, ä¹Ÿå¯èƒ½æ˜¯å­èœå–® MenuComponent menuComponent = (MenuComponent)iterator.next(); menuComponent.print(); &#125; &#125;&#125; æœ€å¾Œä¹Ÿæ˜¯ä¸€æ¨£ï¼Œå°‡ç”œé»é …ç›®éƒ½å¯¦ä½œä¸€è¼ªï¼Œä¸éé€™é‚Šéƒ½å¾ˆé¡ä¼¼å°±ä¸æ•˜è¿°äº† é‡æ–°å®šç¾©æœå‹™ç”Ÿå¯ä»¥çœ‹åˆ°æœå‹™ç”Ÿå¾ˆå¿«æ¨‚, åªè¦å‘¼å«MenuComponentçš„print(), å°±æŠŠæ‰€æœ‰èœå–®éƒ½ä»‹ç´¹å‡ºä¾†å›‰ 123456789101112class Waitress &#123; MenuComponent menuComponent; Waitress(MenuComponent menuComponent) &#123; this.menuComponent = menuComponent; &#125; public void introduceMenu() &#123; // é€™æ™‚åªè¦å‘¼å«print(), å°±å¯ä»¥æŠŠå…¨éƒ¨èœå–®çš„é …ç›®èˆ‡åç¨±éƒ½ä»‹ç´¹å‡ºä¾†äº†ï¼ this.menuComponent.print(); &#125;&#125; å®¢æˆ¶é–‹å§‹é€²ä¾†ï¼Œè«‹æœå‹™ç”Ÿä»‹ç´¹1234567891011121314151617181920212223public class main &#123; public static void main(String[] args) &#123; MenuComponent buffetMenu = new BuffetMenu(); MenuComponent beefNoodles = new BeefNoodles(); MenuComponent seaRice = new SeaRice(); MenuComponent steak = new Steak(); buffetMenu.add(beefNoodles); buffetMenu.add(seaRice); buffetMenu.add(steak); // å®šç¾©å­èœå–® MenuComponent dessertMenu = new DessertMenu(); MenuComponent eggCookie = new EggCookie(); MenuComponent cottonCandy = new CottonCandy(); dessertMenu.add(eggCookie); dessertMenu.add(cottonCandy); // å°‡å­èœå–®åŠ å…¥è‡ªåŠ©å¼èœå–® buffetMenu.add(dessertMenu); Waitress waitress = new Waitress(buffetMenu); // è«‹æœå‹™ç”Ÿé–‹å§‹ä»‹ç´¹ï¼ waitress.introduceMenu(); &#125;&#125; 12345678910111213141516171819è‡ªåŠ©å¼èœå–®è‡ªåŠ©å¼èœå–®æä¾›äº†ä¸»èœå€‘(ç‰›è‚‰éºµ, æµ·é®®é£¯, ç‰›æ’), ä»¥åŠç”œé»èœå–®, è«‹ç›¡æƒ…äº«ç”¨ï¼ç‰›è‚‰éºµå¥½åƒçš„ç‰›è‚‰éºµ, é“åœ°çš„å››å·å£å‘³ï½ï½120.0æµ·é®®é£¯å¥½åƒçš„æµ·é®®é£¯ï½ï½200.0ç‰›æ’å¥½åƒçš„ç‰›æ’ï½ï½400.0ç”œé»èœå–®ç”œé»èœå–®æä¾›äº†ä¸€æ˜Ÿç±³å…¶æ—ä¸»å»šæ‰€è£½ä½œçš„ç”œé»å€‘ï¼é›è›‹é¤…ä¹¾é›è›‹å£å‘³çš„é¤…å–®, å¤§äººå°å­©éƒ½æ„›ï½ï½60.0æ£‰èŠ±ç³–æ£‰èŠ±ç³–å¥½æ»‹å‘³ï½ï½30.0 å°çµé€éåˆæˆæ¨¡å¼, å°‡å–å¾—èœå–®èˆ‡å­èœå–®çš„å‹•ä½œçµ¦ä¸€è‡´åŒ–äº† æœå‹™ç”Ÿåªè¦å‘¼å«å¯¦ä½œMenuComponentçš„èœå–®èˆ‡å­èœå–®å€‘, å°±å¯ä»¥ä¸€å£æ°£å°‡æ‰€æœ‰èœå–®èˆ‡å­èœå–®çš„é …ç›®å€‘å…¨éƒ½ä»‹ç´¹å‡ºä¾†ï¼ æœªä¾†è‹¥è¦æ“´å……å­èœå–®çš„é …ç›®ï¼Œä¹Ÿä¸ç”¨æ“”å¿ƒéœ€è¦å†ä¿®æ”¹æœå‹™ç”Ÿçš„é¡åˆ¥ï¼Œåªè¦æ–°çš„èœå–®æœ‰å¯¦ä½œMenuComponentå°±å¥½ é”åˆ° â€œå°ä¿®æ”¹é—œé–‰, å°æ“´å……é–‹æ”¾â€çš„åŸå‰‡ï¼ å°‡æ¯å€‹èœå–®çš„Iteratorçµ¦åˆä½µèµ·ä¾†: IteratorCompositeé‚„è¨˜å¾—å‰›å‰›æœ‰æåˆ°å¦‚ä½•åˆ¤æ–·è©²èœå–®æ˜¯å¦æ˜¯ç´ é£Ÿçš„æƒ…æ³å‘¢ï¼Ÿï¼Ÿ (å¾…çºŒ)","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Iterator Pattern åè¦†å™¨æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Iterator-Pattern-åè¦†å™¨æ¨¡å¼","date":"2020-08-03T15:50:41.000Z","updated":"2021-02-07T14:33:41.544Z","comments":true,"path":"2020/08/03/Design-Pattern-Java-Iterator-Pattern-åè¦†å™¨æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/08/03/Design-Pattern-Java-Iterator-Pattern-åè¦†å™¨æ¨¡å¼/","excerpt":"å°‡è™•ç†é™£åˆ—æˆ–æ˜¯å–å€¼æ–¹å¼çš„é‚è¼¯çµ¦å°è£èµ·ä¾†ï¼Œä¸éœ€è®“ä½¿ç”¨è€…ç›´æ¥è™•ç†æ“ä½œå–å€¼çš„é‚è¼¯","text":"å°‡è™•ç†é™£åˆ—æˆ–æ˜¯å–å€¼æ–¹å¼çš„é‚è¼¯çµ¦å°è£èµ·ä¾†ï¼Œä¸éœ€è®“ä½¿ç”¨è€…ç›´æ¥è™•ç†æ“ä½œå–å€¼çš„é‚è¼¯ æ²’æœ‰Iterator Patternçš„æƒ…æ³å‡è¨­ç¾åœ¨æœ‰2ç¨®èœå–®, åˆ†åˆ¥å«åšä¸­å¼æ–™ç†èœå–® èˆ‡ è¥¿å¼æ–™ç†èœå–® ä¸­å¼æ–™ç†èœå–®æ˜¯ç”¨ArrayListçš„æ–¹å¼å„²å­˜èœå–®é …ç›® ç¾å¼æ–™ç†èœå–®æ˜¯ç”¨Array[]å„²å­˜ ä¸­å¼æ–™ç†èœå–®1234567891011121314151617class ChineseMenu &#123; ArrayList&lt;String&gt; menu; ChineseMenu() &#123; this.setMenuItem(); &#125; public void setMenuItem() &#123; this.menu = new ArrayList&lt;&gt;(); this.menu.add(\"éº»å©†è±†è…\"); this.menu.add(\"è±¬è¡€ç³•\"); &#125; public ArrayList&lt;String&gt; getMenu() &#123; return menu; &#125;&#125; ç¾å¼æ–™ç†èœå–®123456789101112131415161718class AmericanMenu &#123; String[] menu; AmericanMenu() &#123; this.menu = new String[3]; this.setMenuItem(); &#125; public void setMenuItem() &#123; this.menu[0] = \"æ¼¢å ¡\"; this.menu[1] = \"è–¯æ¢\"; this.menu[2] = \"ç‚¸é›\"; &#125; public String[] getMenu() &#123; return menu; &#125;&#125; æ¥è‘—å®šç¾©ä¸€å€‹é¡åˆ¥ï¼šæœå‹™ç”Ÿï¼Œä½†æœå‹™ç”Ÿéœ€è¦çŸ¥é“è¦æ€éº¼æ’ˆå…§å®¹, ArrayListèˆ‡Arrayçš„æ’ˆæ³•å°±æœƒä¸ä¸€æ¨£ï¼Œè¦å¯«å…©å€‹for loopâ€¦ 12345678910111213141516171819202122232425class Waitress &#123; ChineseMenu chineseMenu; AmericanMenu americaMenu; Waitress( ChineseMenu chMenu, AmericanMenu amerMenu ) &#123; this.chineseMenu = chMenu; this.americaMenu = amerMenu; &#125; // é€™æ™‚å€™æœå‹™ç”Ÿéœ€è¦é‡å°å„å€‹menuåšèœè‰²ä»‹ç´¹ public void introduceMenu() &#123; System.out.println(\"=======ä»‹ç´¹ä¸­å¼æ–™ç†========\"); for(String dish: chineseMenu.getMenu()) &#123; System.out.println(dish); &#125; System.out.println(\"=======ä»‹ç´¹ç¾å¼å¼æ–™ç†========\"); for(int i=0; i&lt;americaMenu.getMenu().length; i++) &#123; System.out.println(americaMenu.menu[i]); &#125; &#125;&#125; æ¥è‘—å‘¼å«æœå‹™ç”Ÿï¼Œä»‹ç´¹èœå–® 123456789public class main &#123; public static void main(String[] args) &#123; ChineseMenu chineseMenu = new ChineseMenu(); AmericanMenu americanMenu = new AmericanMenu(); Waitress waitress = new Waitress(chineseMenu, americanMenu); waitress.introduceMenu(); &#125;&#125; 1234567=======ä»‹ç´¹ä¸­å¼æ–™ç†========éº»å©†è±†è…è±¬è¡€ç³•=======ä»‹ç´¹ç¾å¼å¼æ–™ç†========æ¼¢å ¡è–¯æ¢ç‚¸é› å•é¡Œå¯ä»¥çœ‹åˆ°æœå‹™ç”Ÿå¿…é ˆè¦äº†è§£å¦‚ä½•å¾èœå–®å–å‡ºä¾†ï¼Œè®Šæˆæ¯ä¸€æ¬¡è‹¥åˆæœ‰æ–°çš„èœå–®ï¼Œé‚£æ¯æ¬¡æœå‹™ç”Ÿåˆå¾—æ›‰å¾—æ–°èœå–®çš„å–å¾—æ–¹å¼æ˜¯æ€æ¨£ï¼Œå¦‚æ­¤ä¸€ä¾†å°±å¾—ä¸€ç›´å¢åŠ for loop, æœ‰Nå€‹èœå–®å°±æœ‰Nå€‹for loop, ä¸å¤§å¥½ç¶­è­·ã€‚ Iteratoræ¨¡å¼ç™»å ´è©²æ¨¡å¼ä¸»è¦ç›®çš„ï¼šã€è®“æœå‹™ç”Ÿä¸éœ€çŸ¥é“å…¶å–å‡ºç´°ç¯€æ˜¯å¦‚ä½•ï¼Œåªè¦é€éä¸€å€‹æ¨™æº–çš„ä»‹é¢(Iterator)ï¼Œå°±å¯ä»¥ç›´æ¥å‘¼å«èœå–®å…§å®¹ã€ å®šç¾© Iterator ä»‹é¢1234interface Iterator&lt;T&gt; &#123; Boolean hasNext(); T next();&#125; æ”¹è‰¯ä¸€ä¸‹Menu å°‡å„å€‹Menuå¯¦ä½œåŒä¸€å€‹ä»‹é¢1234567891011121314151617181920212223242526272829303132333435363738394041interface Menu&lt;T&gt; &#123; void setMenuItem(); T getMenu();&#125;class ChineseMenu implements Menu&lt;ArrayList&lt;String&gt;&gt; &#123; ArrayList&lt;String&gt; menu; ChineseMenu() &#123; this.setMenuItem(); &#125; public void setMenuItem() &#123; this.menu = new ArrayList&lt;&gt;(); this.menu.add(\"éº»å©†è±†è…\"); this.menu.add(\"è±¬è¡€ç³•\"); &#125; public ArrayList&lt;String&gt; getMenu() &#123; return menu; &#125;&#125;class AmericanMenu implements Menu&lt;String[]&gt; &#123; String[] menu; AmericanMenu() &#123; this.menu = new String[3]; this.setMenuItem(); &#125; public void setMenuItem() &#123; this.menu[0] = \"æ¼¢å ¡\"; this.menu[1] = \"è–¯æ¢\"; this.menu[2] = \"ç‚¸é›\"; &#125; public String[] getMenu() &#123; return menu; &#125;&#125; é€™æ™‚æ”¹ç”¨å¯¦ä½œå…©å€‹Iteratoré¡åˆ¥ ChineseMenuIteratorèˆ‡AmericanMenuIteratorï¼Œè² è²¬å®šç¾©å¦‚ä½•å–å‡ºèœå–®å…§å®¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243class ChineseMenuIterator implements Iterator&lt;String&gt; &#123; ArrayList&lt;String&gt; menu; int count = -1; public ChineseMenuIterator(Menu&lt;ArrayList&lt;String&gt;&gt; menu) &#123; this.menu = menu.getMenu(); &#125; // ChineseMenuæ˜¯ä½¿ç”¨ArrayListå®šç¾©èœå–®åˆ—è¡¨ public Boolean hasNext() &#123; if (count + 1 &gt;= menu.size()) &#123; return false; &#125; return true; &#125; public String next() &#123; count++; return this.menu.get(count); &#125;&#125;class AmericanMenuIterator implements Iterator&lt;String&gt; &#123; String[] menu; int count = -1; public AmericanMenuIterator(Menu&lt;String[]&gt; menu) &#123; this.menu = menu.getMenu(); &#125; public Boolean hasNext() &#123; if (count + 1 &gt;= menu.length) &#123; return false; &#125; return true; &#125; public String next() &#123; count++; return this.menu[count]; &#125;&#125; é€™æ™‚å›åˆ°æœå‹™ç”Ÿï¼Œè‹¥è¦ä»‹ç´¹èœå–®å…§å®¹çš„è©±ï¼Œåªè¦ä½¿ç”¨ä¸Šé¢å®šç¾©çš„ ChineseMenuIteratorèˆ‡AmericanMenuIterator, å°±å¯ä»¥ç›´æ¥å–å‡ºèœå–®é …ç›®å…§å®¹äº†ï¼Œæœå‹™ç”Ÿä¸éœ€è¦åœ¨æ›‰å¾—è¦æ€éº¼è™•ç†æ’ˆå–çš„ç´°ç¯€ï¼Œçœ‹åˆ°ä¸€å †for loopäº† Waitress class123456789101112131415161718192021222324252627282930class Waitress &#123; ChineseMenu chineseMenu; AmericanMenu americaMenu; ChineseMenuIterator chineseMenuIterator; AmericanMenuIterator americanMenuIterator; Waitress( ChineseMenu chMenu, AmericanMenu amerMenu, ChineseMenuIterator chineseMenuIterator, AmericanMenuIterator americanMenuIterator ) &#123; this.chineseMenu = chMenu; this.americaMenu = amerMenu; this.chineseMenuIterator = chineseMenuIterator; this.americanMenuIterator = americanMenuIterator; &#125; // é€™æ™‚å€™æœå‹™ç”Ÿåªè¦é€éiterator, å°±å¯ä»¥ç›´æ¥ç”¨ä¸€å€‹for loopå…¨éƒ¨å–å‡ºä¾† public void introduceMenu() &#123; System.out.println(\"=======ä»‹ç´¹ä¸­å¼æ–™ç†========\"); while(chineseMenuIterator.hasNext()) &#123; System.out.println(chineseMenuIterator.next()); &#125; System.out.println(\"=======ä»‹ç´¹ç¾å¼æ–™ç†========\"); while(americanMenuIterator.hasNext()) &#123; System.out.println(americanMenuIterator.next()); &#125; &#125;&#125; å†åº¦å‘¼å«æœå‹™ç”Ÿä»‹ç´¹èœå–® Main class123456789101112131415public class main &#123; public static void main(String[] args) &#123; ChineseMenu chineseMenu = new ChineseMenu(); ChineseMenuIterator chineseMenuIterator = new ChineseMenuIterator(chineseMenu); AmericanMenu americanMenu = new AmericanMenu(); AmericanMenuIterator americanMenuIterator = new AmericanMenuIterator(americanMenu); Waitress waitress = new Waitress( chineseMenu, americanMenu, chineseMenuIterator, americanMenuIterator); waitress.introduceMenu(); &#125;&#125; å°çµé€éIteratorä»‹é¢å®šç¾©å¦‚ä½•å¯¦ä½œæŠ½å–è³‡æ–™çµæ§‹çš„å…§å®¹ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ä¸ç”¨è²»å¿ƒå»äº†è§£è¦æ€éº¼å–å¾—ï¼Œç›´æ¥å‘¼å«å·²ç¶“æœ‰å¯¦ä½œIteratorä»‹é¢çš„class å‚™è¨»Collection é¡åˆ¥ä¸­å…¶å¯¦å°±å·²ç¶“å®šç¾©äº†Iteratorä»‹é¢ï¼Œä¸éç‚ºäº†ä»‹ç´¹åè¦†å™¨æ¨¡å¼ï¼Œæ•…åœ¨ArrayListä¸­ç°¡å–®å¯¦ä½œäº†Iteratorä»‹é¢å…§å®¹ Reference: https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Template Pattern æ¨£æ¿æ¨¡å¼  [Design Pattern in Java]","slug":"Design-Pattern-Java-Template-Pattern-æ¨£æ¿æ¨¡å¼","date":"2020-07-29T15:33:47.000Z","updated":"2021-01-28T12:17:59.406Z","comments":true,"path":"2020/07/29/Design-Pattern-Java-Template-Pattern-æ¨£æ¿æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Template-Pattern-æ¨£æ¿æ¨¡å¼/","excerpt":"æ¨£æ¿, é¡§åæ€ç¾©å°±æ˜¯æŠŠåŒæ¨£çš„é‚è¼¯å®šç¾©æˆä¸€å€‹æ¨£æ¿, å¯è®“å…¶ä»–é¡åˆ¥å…±åŒä½¿ç”¨ æ¨£æ¿ä¹Ÿæœƒé–‹æ”¾å¯å®¢è£½åŒ–çš„æ–¹æ³• (æŠ½è±¡æ–¹æ³•), ä¾›å…¶ä»–é¡åˆ¥å¯¦ä½œ","text":"æ¨£æ¿, é¡§åæ€ç¾©å°±æ˜¯æŠŠåŒæ¨£çš„é‚è¼¯å®šç¾©æˆä¸€å€‹æ¨£æ¿, å¯è®“å…¶ä»–é¡åˆ¥å…±åŒä½¿ç”¨ æ¨£æ¿ä¹Ÿæœƒé–‹æ”¾å¯å®¢è£½åŒ–çš„æ–¹æ³• (æŠ½è±¡æ–¹æ³•), ä¾›å…¶ä»–é¡åˆ¥å¯¦ä½œ æ¨£æ¿ä¸»è¦æ ¸å¿ƒ å°‡å…±åŒæ¼”ç®—æ³•é‚è¼¯åŒ…è£å¥½ å®šç¾©éå…±åŒçš„æ–¹æ³•ç‚ºæŠ½åƒæ–¹æ³•, è«‹ä½¿ç”¨æ¨£æ¿æ–¹æ³•çš„é¡åˆ¥è‡ªè¡Œå¯¦ä½œ é€éæ³¡èŒ¶èˆ‡æ³¡å’–å•¡ä¾†ç­è§£æ¨£æ¿æ¨¡å¼å§é€™æ™‚å€™è‹¥ç›´æ¥å¯«code, æœƒåˆ†åˆ¥å®šç¾©å‡º Tea èˆ‡ Coffee class 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657class Tea &#123; Tea() &#123;&#125; public void prepare() &#123; System.out.println(\"=======é–‹å§‹æº–å‚™èŒ¶çš„å‹•ä½œ=======\"); boilWater(); steepTeaBag(); addLenmon(); pourIntoCup(); System.out.println(\"=======çµæŸ=======\"); &#125; private void boilWater() &#123; System.out.println(\"ç‡’é–‹æ°´\"); &#125; private void steepTeaBag() &#123; System.out.println(\"æ³¡é–‹èŒ¶åŒ…\"); &#125; private void addLenmon() &#123; System.out.println(\"åŠ å…¥æª¸æª¬\"); &#125; private void pourIntoCup() &#123; System.out.println(\"å€’å…¥æ¯ä¸­\"); &#125;&#125;class Coffee &#123; Coffee() &#123;&#125; public void prepare() &#123; System.out.println(\"=======é–‹å§‹æº–å‚™å’–å•¡çš„å‹•ä½œ=======\"); boilWater(); greedCoffeeGrinds(); addCreamer(); pourIntoCup(); System.out.println(\"=======çµæŸ=======\"); &#125; private void boilWater() &#123; System.out.println(\"ç‡’é–‹æ°´\"); &#125; private void greedCoffeeGrinds() &#123; System.out.println(\"ç£¨å’–å•¡è±†\"); &#125; private void addCreamer() &#123; System.out.println(\"åŠ å¥¶ç²¾\"); &#125; private void pourIntoCup() &#123; System.out.println(\"å€’å…¥æ¯ä¸­\"); &#125;&#125; ä½¿ç”¨ä»¥ä¸Šå®šç¾©çš„æ–¹æ³• 123456789public class main &#123; public static void main(String[] args) &#123; Tea tea = new Tea(); tea.prepare(); Coffee coffee = new Coffee(); coffee.prepare(); &#125;&#125; å¥—ç”¨Template Patternå§ä»”ç´°æ¯”è¼ƒæ³¡èŒ¶å’Œæ³¡å’–å•¡, éƒ½æœƒæœ‰è‘—ä»¥ä¸‹é¡ä¼¼çš„å‹•ä½œ ç…®æ²¸é–‹æ°´ å°‡(èŒ¶çš„èŒ¶åŒ…/å’–å•¡è—¥ç£¨æˆç²‰)æ³¡é–‹ &lt;â€“ é€™å€‹å‹•ä½œä¸€æ¨£, ä½†èŒ¶æ˜¯ç”¨èŒ¶åŒ…, å’–å•¡æ˜¯éœ€è¦å…ˆç£¨æˆç²‰ æ·»åŠ æœ‰çš„æ²’çš„ (å’–å•¡æœƒç”¨å¥¶ç²¾/èŒ¶æœƒæ”¾æª¸æª¬) &lt;â€“ é€™é‚Šçš„ä¹Ÿæ˜¯ä¸€æ¨£ å€’é€²æ¯ä¸­ å‰›å¥½èŒ¶èˆ‡å’–å•¡éƒ½æ˜¯å«æœ‰å’–å•¡å› çš„é£²æ–™ï¼Œé€™æ™‚å°±å¯ä»¥å®šç¾©ä¸€å€‹æ¨£æ¿å«åš CaffeineBeverage, ä¸¦æŠŠä¸Šè¿° 2,3æ­¥é©Ÿ,å®šç¾©æˆæŠ½è±¡æ–¹æ³•, è®“èŒ¶èˆ‡å’–å•¡é¡åˆ¥è‡ªå·±å»å¯¦ä½œè‡ªå·±çš„é‚è¼¯ 12345678910111213141516171819202122232425262728abstract class CaffeineBeverage &#123; String name = \"å’–å•¡å› é£²æ–™\"; CaffeineBeverage(String name) &#123; this.name = name; &#125; public void prepare() &#123; System.out.println(\"=======é–‹å§‹æº–å‚™ \" + this.name + \" çš„å‹•ä½œ=======\"); boilWater(); brew(); addCondiments(); pourIntoCup(); System.out.println(\"=======çµæŸ=======\"); &#125; private void boilWater() &#123; System.out.println(\"ç‡’é–‹æ°´\"); &#125; // å®šç¾©å¦‚ä½•æ³¡çš„æŠ½è±¡æ–¹æ³•, è®“èŒ¶èˆ‡å’–å•¡è‡ªè¡Œå®šç¾© abstract void brew(); // å®šç¾©è¦æ·»åŠ å…¶ä»–é…æ–™, è®“èŒ¶èˆ‡å’–å•¡è‡ªè¡Œå®šç¾© abstract void addCondiments(); private void pourIntoCup() &#123; System.out.println(\"å€’é€²æ¯ä¸­\"); &#125;&#125; æ¥è‘—Teaèˆ‡Coffeeå¯¦ç¾è©²æ¨£æ¿é¡åˆ¥ CaffeineBeverageä¸¦æ ¹æ“šè‡ªå·±çš„é‚è¼¯å¯¦ä½œabstractæ–¹æ³• brew()èˆ‡addCondiments() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class Tea extends CaffeineBeverage &#123; Tea(String name) &#123; super(name); &#125; public void prepare() &#123; System.out.println(\"=======é–‹å§‹æº–å‚™èŒ¶çš„å‹•ä½œ=======\"); boilWater(); brew(); addCondiments(); pourIntoCup(); System.out.println(\"=======çµæŸ=======\"); &#125; @Override void brew() &#123; System.out.println(\"æ³¡é–‹èŒ¶åŒ…\"); &#125; @Override void addCondiments() &#123; System.out.println(\"åŠ å…¥æª¸æª¬\"); &#125;&#125;class Coffee extends CaffeineBeverage&#123; Coffee(String name) &#123; super(name); &#125; public void prepare() &#123; System.out.println(\"=======é–‹å§‹æº–å‚™å’–å•¡çš„å‹•ä½œ=======\"); boilWater(); brew(); addCondiments(); pourIntoCup(); System.out.println(\"=======çµæŸ=======\"); &#125; @Override void brew() &#123; System.out.println(\"ç£¨å’–å•¡è±†\"); &#125; @Override void addCondiments() &#123; System.out.println(\"åŠ å¥¶ç²¾\"); &#125;&#125; æ¥è‘—ä¸€æ¨£ä½¿ç”¨ä¹‹ 123456789public class main &#123; public static void main(String[] args) &#123; CaffeineBeverage tea = new Tea(\"èŒ¶\"); tea.prepare(); CaffeineBeverage coffee = new Coffee(\"å’–å•¡\"); coffee.prepare(); &#125;&#125; å°çµé€éä»¥ä¸Šæ–¹æ³•å¯ä»¥çœ‹åˆ° æ¨£æ¿æ¨¡å¼ å°‡é‡è¤‡çš„åœ°æ–¹çµ¦çµ±æ•´èµ·ä¾†æˆç‚ºæ¼”ç®—æ³•é‚è¼¯, ä¸¦å®šç¾©ä¸€å€‹æŠ½è±¡é¡åˆ¥, å°‡éœ€è¦å®¢è£½åŒ–çš„éƒ¨åˆ†å®šç¾©æˆæŠ½è±¡æ–¹æ³•, çµ±ä¸€çš„éƒ¨åˆ†å°±ç›´æ¥å®šç¾©å¯¦é«”æ–¹æ³• å¦‚æ­¤ä¸€ä¾†å„å€‹é¡åˆ¥åœ¨å¯¦ä½œæ™‚ï¼Œå°±ä¸ç”¨åœ¨è‡ªå·±å»åšé‡è¤‡ä¸€æ¨£çš„å‹•ä½œ(ä¾‹å¦‚ç‡’é–‹æ°´, å€’å…¥æ¯ä¸­) åªè¦ç›´æ¥ç¹¼æ‰¿æ¨£æ¿æŠ½è±¡é¡åˆ¥å°±æœ‰å›‰, ç„¶å¾Œåœ¨è‡ªå·±å¯¦ä½œè‡ªå·±éœ€è¦çš„éƒ¨åˆ† (å¦‚èŒ¶æœ‰è‡ªå·±çš„èŒ¶åŒ…æ³¡æ³•, å’–å•¡å‰‡æœ‰è‡ªå·±çš„å’–å•¡è±†è¦ç£¨ æ‰èƒ½æ³¡) ä»¥å¯¦ç¾æ¨£æ¿æ¨¡å¼çš„ç²¾ç¥ é€éhookæ–¹æ³•å°‡å°è£çš„æ¼”ç®—æ³•é‚è¼¯éƒ¨åˆ†åšæ§åˆ¶ä½¿ç”¨å¾…è£œå……","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Facade Pattern è¡¨è±¡æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Facade-Pattern-è¡¨è±¡æ¨¡å¼","date":"2020-07-29T12:20:24.000Z","updated":"2021-01-28T12:17:26.218Z","comments":true,"path":"2020/07/29/Design-Pattern-Java-Facade-Pattern-è¡¨è±¡æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Facade-Pattern-è¡¨è±¡æ¨¡å¼/","excerpt":"å°‡è¤‡é›œçš„é¡åˆ¥é—œä¿‚, ç”¨ä¸€å€‹é¡åˆ¥åŒ…è£èµ·ä¾†, ä¾›å‘¼å« ä¸æœƒè®“ä½¿ç”¨è€…ç›´æ¥çœ‹åˆ°èƒŒå¾Œè¤‡é›œçš„é‚è¼¯, åªæœƒçœ‹åˆ° â€œè¡¨é¢çš„ç¾è±¡â€, æ•…å«åšè¡¨è±¡æ¨¡å¼","text":"å°‡è¤‡é›œçš„é¡åˆ¥é—œä¿‚, ç”¨ä¸€å€‹é¡åˆ¥åŒ…è£èµ·ä¾†, ä¾›å‘¼å« ä¸æœƒè®“ä½¿ç”¨è€…ç›´æ¥çœ‹åˆ°èƒŒå¾Œè¤‡é›œçš„é‚è¼¯, åªæœƒçœ‹åˆ° â€œè¡¨é¢çš„ç¾è±¡â€, æ•…å«åšè¡¨è±¡æ¨¡å¼ ä»¥ä¸€å€‹å®¶åº­åŠ‡é™¢ä¾†è§£èªªå¦‚æœååœ¨å®¢å»³, æƒ³è¦ç‡Ÿé€ ä¸€å€‹å®¶åº­åŠ‡é™¢ æˆ‘å€‘å¾—åšä»¥ä¸‹äº‹æƒ…ï¼š æ‰“é–‹ç‡ˆ, èª¿æ•´äº®åº¦ æ‰“é–‹é›»è¦–, åˆ‡æ›åˆ°DVDæ¨¡å¼ æ‰“é–‹éŸ³éŸ¿, èª¿æ•´å¤§å°è² æ‰“é–‹DVD, è®€å–è¦çœ‹çš„ç‰‡ ç­‰ç­‰ä¹‹é¡çš„, ä»¥ä¸‹å®šç¾©é€™äº›æœå‹™çš„class 12345678910111213141516171819202122232425262728293031class LightService &#123; LightService() &#123;&#125; public void lightOn() &#123; System.out.println(\"Turn on the light\"); &#125;&#125;class TVService &#123; TVService() &#123;&#125; public void openTV() &#123; System.out.println(\"Turn on the TV\"); &#125;&#125;class SoundService &#123; SoundService() &#123;&#125; public void openSound() &#123; System.out.println(\"Turn on the Sound\"); &#125;&#125;class DVDPlayerService &#123; DVDPlayerService() &#123;&#125; public void openDVD() &#123; System.out.println(\"Turn on the DVD\"); &#125;&#125; ç„¶å¾Œç›´è¦ºä¸Šæœƒå‘¼å«ä¹‹ 1234567891011121314public class main &#123; public static void main(String[] args) &#123; LightService lightService = new LightService(); TVService tvService = new TVService(); SoundService soundService = new SoundService(); DVDPlayerService dvdPlayerService = new DVDPlayerService(); lightService.lightOn(); tvService.openTV(); soundService.openSound(); dvdPlayerService.openDVD(); &#125;&#125; å…¶çµæœç‚ºï¼š è¡¨è±¡æ¨¡å¼ç™»å ´ä¸éå°æ–¼ä½¿ç”¨è€…ä¾†èªª, å…¶å¯¦å°±åªæƒ³è¦äº«å—å®¶åº­åŠ‡é™¢çš„å¨›æ¨‚, æ‰€ä»¥å…¶å¯¦æˆ‘å€‘å¯ä»¥ç”¨åŒ…è£çš„æ–¹å¼, å°‡ä¸Šé¢mainè£¡é¢ç›¸é—œæœå‹™çš„classéƒ½åŒ…åœ¨ä¸€å€‹classå…§, å«åšMovieTheaterFacadeService 12345678910111213141516class MovieTheaterFacadeService &#123; MovieTheaterFacadeService() &#123;&#125; public void startMovieTheaterService() &#123; LightService lightService = new LightService(); TVService tvService = new TVService(); SoundService soundService = new SoundService(); DVDPlayerService dvdPlayerService = new DVDPlayerService(); lightService.lightOn(); tvService.openTV(); soundService.openSound(); dvdPlayerService.openDVD(); &#125;&#125; å¦‚æ­¤ä¸€ä¾†, æˆ‘å€‘çš„ä½¿ç”¨è€…(main()), åªè¦å‘¼å« MovieTheaterFacadeService å°±å¯ä»¥ç›´æ¥äº«å—å®¶åº­åŠ‡é™¢, ä¸ç”¨è¦ªè‡ªå»è™•ç†éç¨‹ä¸­çš„äº‹ 1234567public class main &#123; public static void main(String[] args) &#123; MovieTheaterFacadeService movieTheaterFacadeService = new MovieTheaterFacadeService(); movieTheaterFacadeService.startMovieTheaterService(); &#125;&#125; ç¸½çµé€éä»¥ä¸Šçš„ä¾‹å­, å¯ä»¥çœ‹åˆ°è¡¨è±¡æ¨¡å¼æœ€å¤§çš„ç”¨è™•å°±æ˜¯å°‡è¤‡é›œçš„æœå‹™é¡åˆ¥å€‘çµ¦åŒ…è£åœ¨ä¸€èµ·, ä¸¦é–‹æ”¾å–®ä¸€å€‹é¡åˆ¥ä¾›ä½¿ç”¨è€…ä½¿ç”¨, è®“ä½¿ç”¨è€…åƒ…éœ€è¦çœ‹åˆ°è¡¨é¢å³å¯, ä¸ç”¨ç†è§£ç´°ç¯€æ˜¯ä»€éº¼ã€‚","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Adaptor Pattern è½‰æ¥å™¨æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Adaptor-Pattern-è½‰æ¥å™¨æ¨¡å¼","date":"2020-07-29T00:15:30.000Z","updated":"2021-01-28T12:17:17.461Z","comments":true,"path":"2020/07/29/Design-Pattern-Java-Adaptor-Pattern-è½‰æ¥å™¨æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/29/Design-Pattern-Java-Adaptor-Pattern-è½‰æ¥å™¨æ¨¡å¼/","excerpt":"å‡å¦‚è¦ä½¿ç”¨A, ä½†ç„¡æ³•ç›´æ¥ä½¿ç”¨, åªèƒ½ä½¿ç”¨Bä»‹é¢ æ‰€ä»¥æˆ‘å€‘ç”¨è½‰æ¥å™¨é¡åˆ¥åŒ…è£Açš„æ–¹æ³•ï¼Œä¸¦ä¸”å¯¦ä½œBï¼Œé”åˆ°è½‰æ¥çš„æ•ˆæœ","text":"å‡å¦‚è¦ä½¿ç”¨A, ä½†ç„¡æ³•ç›´æ¥ä½¿ç”¨, åªèƒ½ä½¿ç”¨Bä»‹é¢ æ‰€ä»¥æˆ‘å€‘ç”¨è½‰æ¥å™¨é¡åˆ¥åŒ…è£Açš„æ–¹æ³•ï¼Œä¸¦ä¸”å¯¦ä½œBï¼Œé”åˆ°è½‰æ¥çš„æ•ˆæœ ç”¨è¢å¹•è½‰æ¥å™¨çš„ä¾‹å­ç›´æ¥è§£é‡‹ä¾‹å¦‚æˆ‘å€‘æœ‰å€‹ HDMIçš„ç·š, å«åš HDMI interface 12345interface HDMI &#123; // å®šç¾©é€£æ¥è£ç½®çš„æ–¹æ³•æ ¼å¼ boolean connect(String device);&#125; ä½†ç¾åœ¨æœ‰å€‹è¢å¹•åªæœ‰æ”¯æ´VGAçš„æ’å­” æ‰€ä»¥æˆ‘å€‘éœ€è¦å€‹ HDMIè½‰VGAçš„Adaptoré¡åˆ¥, æŠŠVGAçš„é¡åˆ¥å¼•å…¥é€²ä¾†, ä¸¦ä½¿ç”¨ä¹‹ 12345678910111213141516class HdmiToVgaAdpator implements HDMI &#123; VGA vgaCable = null; HdmiToVgaAdpator(VGA vgaCable) &#123; this.vgaCable = vgaCable; &#125; // å¿…é ˆè¦å¯¦ä½œHDMIçš„æ–¹æ³• public boolean connect(String device) &#123; // ä»‹æ¥Vgaç·šçš„connectåŠŸèƒ½ System.out.println(\"ä½¿ç”¨è½‰æ¥å™¨çš„connectåŠŸèƒ½!\"); vgaCable.connect(device); return true; &#125;&#125; å› ç‚ºæœ‰ä½¿ç”¨åˆ°VGAé¡åˆ¥, æ‰€ä»¥ä¾†å®šç¾©ä¸€ä¸‹ 123456789101112interface VGA &#123; // å®šç¾©é€£æ¥è£ç½®çš„æ–¹æ³•æ ¼å¼ boolean connect(String device);&#125;class VGACable implements VGA &#123; public boolean connect(String device) &#123; System.out.println(\"VGAç·šé€£æ¥: \" + device); return true; &#125;&#125; ä¾†å®šç¾©æœ‰å°ç­†é›», æ˜¯åªæœ‰å…·å‚™hdmiå­”, ä½†å…·å‚™è‘—å¯ä»¥é€£æ¥åˆ°æŸè£ç½®é€²è¡ŒæŠ•å½± 1234567class Labtop &#123; // è©²å°ç­†é›»åªæœ‰hdmiå­”, ä¸¦æŒ‡å®šè¦é€£æ¥çš„è¢å¹•(device) public void connectToDevice(HDMI hdmi, String device) &#123; System.out.println(\"ç­†é›»åªæœ‰hdmiå­”, ä½¿ç”¨å¯¦ä½œhdmiä»‹é¢çš„ 'hdmiè½‰vgaçš„è½‰æ¥å™¨' é¡åˆ¥ï¼\"); hdmi.connect(device); &#125;&#125; æ¥è‘—ä¾†ä½¿ç”¨å§ 1234567891011public class main &#123; public static void main(String[] args) &#123; Labtop laptop = new Labtop(); // å¦‚æœæŸç­†é›»åªæœ‰hdmiæ’å­”, ä½†è¦æ¥çš„æŠ•å½±è¢å¹•åªæœ‰vga laptop.connectToDevice( new HdmiToVgaAdpator( // é€™æ™‚å¯ä»¥ä½¿ç”¨Hdmiè½‰Vgaçš„è½‰æ¥å™¨ï¼ è½‰æ¥å™¨éœ€è¦å¸¶å…¥å¯¦éš›å…·æœ‰VGAåŠŸèƒ½çš„VGAç·šç‰©ä»¶ new VGACable()), \"è€èˆŠæŠ•å½±æ©Ÿ\"); &#125;&#125; æˆ‘å€‘å¯ä»¥çœ‹åˆ°çµæœç‚º: ç­†é›»ä½¿ç”¨äº† å¯¦ä½œhdmiä»‹é¢çš„è½‰æ¥å™¨ (è½‰æ¥å™¨å› ç‚ºå¯¦ä½œäº†hdmi interface, æ‰€ä»¥å¯ä»¥æ’å…¥ç­†é›»çš„hdmiå­”) æ¥è‘—è½‰æ¥å™¨å¼•å…¥äº†VGA cableé¡åˆ¥, æ•…è½‰æ¥å™¨å°±å¯ä»¥ä½¿ç”¨VGAçš„connect()åŠŸèƒ½ æœ€å¾Œå°±è§¸ç™¼VGAåŠŸèƒ½, èˆ‡æŠ•å½±è£ç½®é€£å‹• å¯¦éš›æ‡‰ç”¨å ´æ™¯é€šå¸¸è½‰æ¥å™¨æ¨¡å¼å¯ç”¨åœ¨è½‰æ¥é‚£äº›å·²ç¶“éæ™‚çš„æ¨¡çµ„&amp;æ–¹æ³• ä¾‹å¦‚æœ‰æ¨¡çµ„æ˜¯ç”¨Javaè¼ƒèˆŠè¿­ä»£Collectionçš„ç‰ˆæœ¬å»å¯«çš„, ç‚ºEnumeration Interface ä½†ç¾åœ¨æ–°çš„å°ˆæ¡ˆä¸­ï¼Œæ˜¯ä½¿ç”¨Iteratoræ–¹å¼å»è¿­ä»£Collection 12345678910class NewLoopService &#123; // ä½¿ç”¨Java 5ç‰ˆæœ¬ä¹‹å¾Œæ”¯æ´çš„Iterator public void loopCollection(Collection col, Iterator itr) &#123; itr = col.iterator(); while(itr.hasNext()) &#123; System.out.println(itr.next()); &#125; &#125;&#125; ä½¿ç”¨NewLoopService12345678910111213class main() &#123; public static void main(String[] args) &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add(\"apple\"); list.add(\"banana\"); // å®£å‘ŠIteratorçš„è®Šæ•¸ Iterator itr; NewLoopService loopService = new NewLoopService(); loopService.loopCollection(list, itr); &#125;&#125; ä½†ç¾åœ¨è‹¥åªèƒ½ç”¨èˆŠç‰ˆçš„ Enumeration æ–¹å¼å»è¿­ä»£ é€™æ™‚å°±å¯ä»¥å¯«ä¸€å€‹ EnumeratorAdaptor ä¾†å¯¦ä½œå¯å…¼å®¹Iteratorçš„é¡åˆ¥, ä¸¦å¯å‘¼å« Enumerationçš„æ–¹æ³• 1234567891011121314151617181920212223// å¯¦ä½œIteratorçš„æ–¹æ³•class EnumeratorAdaptor&lt;E&gt; implement Iterator &#123; Enumeration&lt;E&gt; enumeration; EnumeratorAdaptor(Enumeration&lt;E&gt; enumeration) &#123; this.enumeration = enumeration; &#125; // å¯¦ä½œIterator ä»‹é¢æ‰€éœ€çš„æ–¹æ³• public boolean hasNext() &#123; // ä½†å¯¦éš›ä¸Šæ˜¯ä½¿ç”¨Enumerationçš„æ–¹æ³• return this.enumeration.hasMoreElements(); &#125; public Object next() &#123; return this.enumeration.nextElement(); &#125; // ä½†é€™æ™‚å€™æœƒé‡åˆ°Enumerationæ²’æœ‰çš„æ–¹æ³•, ä½†åˆå¿…é ˆè¦å¯¦ä½œ æ»¿è¶³Iteratorçš„ä»‹é¢è¦ç¯„, é€™æ™‚å¯ä»¥throw Exceptionä¾†è™•ç† public void remove() &#123; throw new UnsupportedOperationException(); &#125;&#125; é€™æ™‚æˆ‘å€‘å¯ä»¥åœ¨main()ä¸­æ”¹ç”¨è½‰æ¥å™¨, ä¾†é–“æ¥ä½¿ç”¨Enumerationäº†ï¼ 1234567891011121314151617181920212223242526class main() &#123; public static void main(String[] args) &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add(\"apple\"); list.add(\"banana\"); // ä½¿ç”¨ `å¯¦ä½œIteratorä»‹é¢` çš„è½‰æ¥å™¨ EnumeratorAdaptor itr; NewLoopService loopService = new NewLoopService(); loopService.loopCollection(list, itr); &#125;&#125;class NewLoopService &#123; // ä½¿ç”¨Java 5ç‰ˆæœ¬ä¹‹å¾Œæ”¯æ´çš„Iterator public void loopCollection(Collection col, Iterator itr) &#123; itr = col.iterator(); // é€™æ™‚æœƒæ˜¯ä½¿ç”¨EnumeratorAdaptorå…§çš„hasNext()èˆ‡next() é”åˆ°è½‰æ¥çš„æ•ˆæœ while(itr.hasNext()) &#123; System.out.println(itr.next()); &#125; &#125;&#125; é€éä»¥ä¸Šæ–¹æ³•, å¯ä»¥æŠŠè¦ä½¿ç”¨Enumerationæ–¹å¼çš„service, ä½†è©²Serviceåˆæ˜¯åªèƒ½åƒIteratorçš„è¼¸å…¥, é‚£å°±å¯ä»¥å¯¦ä½œä¸€å€‹ EnumeratorAdaptor, å¸¶å…¥Service, ä¸¦é€éè½‰æ¥å™¨ä½¿ç”¨ Enumerationçš„æ–¹å¼å»æ’ˆå‡ºCollectionå…§å®¹.","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Observer Pattern è§€å¯Ÿè€…æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Observer-Pattern-è§€å¯Ÿè€…æ¨¡å¼","date":"2020-07-26T08:59:48.000Z","updated":"2021-01-28T12:17:41.422Z","comments":true,"path":"2020/07/26/Design-Pattern-Java-Observer-Pattern-è§€å¯Ÿè€…æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Observer-Pattern-è§€å¯Ÿè€…æ¨¡å¼/","excerpt":"è§€å¯Ÿè€…æ¨¡å¼å¯ä»¥è®“ç‰©ä»¶äº†è§£è³‡æ–™è®ŠåŒ–çš„æƒ…æ³ã€‚ç‰©ä»¶ç”šè‡³å¯ä»¥åœ¨åŸ·è¡ŒæœŸé–“æ±ºå®šæ˜¯å¦è¦ç¹¼çºŒè¢«é€šçŸ¥ï¼Œåˆæˆ–è€…æ˜¯å¯ä»¥ä¸»å‹•å»è©¢å•è³‡æ–™çš„ç‹€æ…‹ã€‚åœ¨æ­¤æ¨¡å¼ä¸­ä¹Ÿæœƒäº†è§£ä¸€å°å¤šï¼Œä»¥åŠç‰©ä»¶é¬†ç¶çš„æ„ç¾©æ˜¯å¦‚ä½•ã€‚","text":"è§€å¯Ÿè€…æ¨¡å¼å¯ä»¥è®“ç‰©ä»¶äº†è§£è³‡æ–™è®ŠåŒ–çš„æƒ…æ³ã€‚ç‰©ä»¶ç”šè‡³å¯ä»¥åœ¨åŸ·è¡ŒæœŸé–“æ±ºå®šæ˜¯å¦è¦ç¹¼çºŒè¢«é€šçŸ¥ï¼Œåˆæˆ–è€…æ˜¯å¯ä»¥ä¸»å‹•å»è©¢å•è³‡æ–™çš„ç‹€æ…‹ã€‚åœ¨æ­¤æ¨¡å¼ä¸­ä¹Ÿæœƒäº†è§£ä¸€å°å¤šï¼Œä»¥åŠç‰©ä»¶é¬†ç¶çš„æ„ç¾©æ˜¯å¦‚ä½•ã€‚ ä»¥æ°£è±¡ç›£æ¸¬ç³»çµ±çš„æ¦‚æ³ä¾†ç•¶åšä¾‹å­å‡è¨­ç³»çµ±ä¸­æœ‰ä¸‰å€‹çµ„æˆè¦ä»¶ï¼š(1) æ°£è±¡ç«™: ç²å–å¯¦éš›æ°£è±¡çš„ç‰©ç†è£ç½®ï¼Œå‡è¨­æœ‰ä¸‰å€‹:æº«åº¦,æ¿•åº¦,å£“åŠ›æ„Ÿæ‡‰(2) Weather Dataç‰©ä»¶: è¿½è¹¤ä¾†è‡ªæ°£è±¡ç«™çš„è³‡æ–™ï¼Œä¸¦ä¸”é¡¯ç¤ºåœ¨ä½ˆå‘Šç‰ˆä¸Š(3) ä½ˆå‘Šç‰ˆ: å°‡Weather Dataç‰©ä»¶çµ¦äºˆçš„è³‡æ–™å‘ˆç¾å‡ºä¾† æ•´å€‹ä¾‹å­æœƒæœ‰ï¼Œä¸€å€‹æ°£è±¡ç«™(ç”¢å‡ºå‡çš„æ°£è±¡è³‡æ–™)ï¼ŒWeather Dataç‰©ä»¶(ç²å–æ°£è±¡è³‡æ–™ä¸¦é€šçŸ¥ä½ˆå‘Šç‰ˆ)ï¼Œä½ˆå‘Šç‰ˆå°‡æ‹¿åˆ°çš„è³‡æ–™çµ¦å‘ˆç¾å‡ºä¾† æ²’ä½¿ç”¨è§€å¯Ÿè€…æ¨¡å¼ Observer Patternçš„æƒ…æ³åˆå­¸è€…æœƒå¾ˆç›´è¦ºçš„å¯«å‡ºé€™æ¨£çš„ç¨‹å¼æ¶æ§‹ï¼š ä½ˆå‘Šæ¬„CurrentConditionsDisplay.class123456789101112131415161718public class CurrentConditionsDisplay &#123; private int temp; private int humidity; private int pressure; public void update() &#123; this.temp = temp; this.humidity = humidity; this.pressure = pressure; &#125; // é¡¯ç¤ºè³‡æ–™ public void display() &#123; System.out.println(temp); System.out.println(humidity); System.out.println(pressure); &#125;&#125; WeatherData.class1234567891011121314151617181920212223242526272829303132public class WeatherData &#123; // instance variable declarations // å®£å‘Šä½ˆå‘Šæ¬„ CurrentConditionsDisplay currentConditionsDisplay; StatisticsDisplay statisticsDisplay; // å»ºæ§‹å­ public WeatherData( CurrentConditionsDisplay currentConditionsDisplay, StatisticsDisplay statisticsDisplay ) &#123; this.currentConditionsDisplay = currentConditionsDisplay; this.statisticsDisplay = statisticsDisplay; &#125; public int getTemperature() &#123;...&#125; public int getHumidity() &#123;...&#125; public int getPressure() &#123;...&#125; public void measurementsChanged() &#123; float temp = getTemperature(); float humidity = getHumidity(); float pressure = getPressure(); // å°ä½ˆå‘Šæ¬„é¡åˆ¥é€²è¡Œæ›´æ–°ä»–å€‘çš„é¡¯ç¤ºå…§å®¹ currentConditionsDisplay.update(temp, humidity, pressure); statisticsDisplay.update(temp, humidity, pressure); // å…¶ä»–WeatherData function... &#125;&#125; ä½†æ˜¯ä»¥ä¸Šç¨‹å¼çµæ§‹æœƒæœ‰è€¦åˆæ€§çš„ç‹€æ³ï¼š æ‰€ä»¥æ¥ä¸‹ä¾†ä¾†äº†è§£è§€å¯Ÿè€…æ¨¡å¼çš„å…§æ¶µ è§€å¯Ÿè€…æ¨¡å¼è§£æå®šç¾©äº†ç‰©ä»¶ä¹‹é–“ä¸€å°å¤šé—œä¿‚ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œç•¶ä¸€å€‹ç‰©ä»¶æ”¹è®Šç‹€æ…‹æ™‚ï¼Œå…¶ä»–ç›¸ä¾è€…éƒ½æœƒæ”¶åˆ°é€šçŸ¥ä¸¦è‡ªå‹•åšæ”¹è®Š å…¶ç¤ºæ„åœ–å¦‚ä¸‹ï¼š ä¸»é¡Œèˆ‡è§€å¯Ÿè€…å€‘å®šç¾©äº†ä¸€å°å¤šçš„é—œä¿‚ è‹¥è¦å¯¦è¸å‡ºå¯ä»¥éš”é›¢ä¸»é¡Œå’Œè§€å¯Ÿè€…å€‘çš„æ–¹å¼ï¼Œä»¥ Subjectä»‹é¢å’ŒObserverä»‹é¢æœ€ç‚ºå¸¸è¦‹ åœ¨é€™å¼µåœ–è¦æ³¨æ„ä¸€å€‹é‡é»æ˜¯ï¼Œç”±æ–¼ç¾åœ¨å·²ç¶“é‡å°ä»‹é¢å¯¦ä½œï¼Œç¾åœ¨çš„Subjectä¸­çš„è¨»å†ŠObserveréƒ½æ˜¯ä»¥è¨»å†Šâ€ä»‹é¢â€œç‚ºä¸»ï¼è€Œéæ˜¯åƒä¸Šé¢ä¸€é–‹å§‹çš„æ–°æ‰‹ä¾‹å­æ˜¯ç›´æ¥é‡å°å¯¦è¸è€Œå¯« å¦‚æ­¤ä¸€ä¾†å¦‚æœè¦åœ¨æ–°å¢ä¸€å€‹ä½ˆå‘Šæ¬„å«åšForecastDisplayï¼Œç›´æ¥å¯¦è¸Observerå°±å¥½ï¼Œé€™æ¨£å°±ä¸ç”¨å‹•åˆ°å¯¦è¸Subjectä»‹é¢çš„WeatherDataä¹‹ç¨‹å¼ç¢¼ ä»¥è§€å¯Ÿè€…æ¨¡å¼ä¾†é‡å¯«æ°£è±¡ç›£æ¸¬ç³»çµ±Subject.interface 12345public interface Subject &#123; void registerObserver(Observer o); void removeObserver(Observer o); void notifyObservers();&#125; ObserverInterface 123public interface Observer &#123; void update(float temperature, float humidity, float pressure);&#125; WeatherData.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import java.util.ArrayList;public class WeatherData implements Subject&#123; private ArrayList observers; private float temperature; private float humidity; private float pressure; public WeatherData() &#123; observers = new ArrayList(); &#125; public void registerObserver(Observer o) &#123; int i = observers.indexOf(o); observers.add(o); &#125; public void removeObserver(Observer o) &#123; int i = observers.indexOf(o); if(i&gt;=0) &#123; observers.remove(i); &#125; &#125; // å‘è§€å¯Ÿè€…å€‘é€ä»¥æ”¹å‹•çš„è³‡æ–™ // å¯ä»¥çœ‹åˆ°ç¾åœ¨æˆ‘å€‘æ˜¯ç›´æ¥è¨»å†ŠObserverä»‹é¢ï¼Œå¦‚æ­¤ä¸€ä¾†è§€å¯Ÿè€…é¡åˆ¥çš„å¯¦ä½œå°±ä¸ç”¨å»åœ¨æ„ // åªè¦çŸ¥é“è¦è¨»å†Šçš„å°è±¡å¿…é ˆè¦æœ‰å¯¦ä½œObserverä»‹é¢å°±å¥½ public void notifyObservers() &#123; for(int i=0; i&lt;observers.size(); i++) &#123; Observer observer = (Observer)observers.get(i); observer.update(temperature, humidity, pressure); &#125; &#125; // åŸ·è¡Œå‘è§€å¯Ÿè€…å€‘é€šçŸ¥è³‡æ–™ public void measurementsChanged() &#123; notifyObservers(); &#125; // è®€å–å‡è³‡æ–™ï¼Œå¯ä»¥æ”¹å‹•é€™åœ°æ–¹ï¼Œæ”¹ç‚ºå‘æ°£è±¡å±€ç¶²ç«™çˆ¬è³‡æ–™ public void setMeasurements( float temperature, float humidity, float pressure) &#123; this.temperature = temperature; this.humidity = humidity; this.pressure = pressure; measurementsChanged(); &#125;&#125; é€™è£¡æˆ‘å€‘åªå¯¦è¸ä¸€å€‹ä½ˆå‘Šæ¬„ CurrentConditionDisplay CurrentConditionDisplay.java12345678910111213141516171819202122public class CurrentConditionDisplay implements Observer &#123; private float temperature; private float humidity; private float pressure; private Subject weatherData; public CurrentConditionDisplay(Subject weatherData) &#123; this.weatherData = weatherData; weatherData.registerObserver(this); &#125; public void update(float temperature, float humidity, float pressure) &#123; this.temperature = temperature; this.humidity = humidity; this.pressure = pressure; display(); &#125; public void display() &#123; System.out.println(\"Current condition: \"+temperature + \"F degrees and \" + humidity + \"% humidity and \"+ pressure + \" pressure\"); &#125;&#125; åŸ·è¡Œç¨‹å¼ 12345678910public class Main &#123; public static void main(String[] args) &#123; WeatherData weatherData = new WeatherData(); CurrentConditionDisplay currentDisplay = new CurrentConditionDisplay(weatherData); weatherData.setMeasurements(80, 64, 30.4f); &#125;&#125; å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çµæœ 1Current condition: 80.0F degrees and 64.0% humidity and 30.4 pressure ä¹‹å¾Œåªè¦é€éä¸»é¡Œå‘¼å«è§€å¯Ÿè€…çš„update()çš„æ–¹æ³•ï¼Œå°±å¯ä»¥é€šçŸ¥æ–°çš„è³‡æ–™çµ¦è§€å¯Ÿè€… ä¸¦ä¸”é€éè¨»å†Šçš„æ–¹å¼+åªåŠ å…¥é‡å°å¯¦è¸Observerä»‹é¢çš„è§€å¯Ÿè€…ï¼Œå¦‚æ­¤ä¸€ä¾†å¯ä»¥é”åˆ°åˆ†é›¢ä¸»é¡Œç‰©ä»¶èˆ‡è§€å¯Ÿè€…ç‰©ä»¶çš„é‚è¼¯ï¼Œä¹‹å¾Œæ–°å¢æ–°çš„ä½ˆå‘Šæ¬„å°±ä¸ç”¨å‹•åˆ°ä¸»é¡Œçš„ç¨‹å¼é‚è¼¯ã€‚ è£œå……java sdkä¹Ÿæœ‰è‡ªè¡Œæä¾›Observeræ–¹æ³•å…¶ä¸­æœƒæœ‰setChange()çš„æ–¹æ³•ï¼Œä¸»è¦è®“å‘¼å«è€…å®šç¾©ä»€éº¼æ™‚å€™æ‰è¦é€šçŸ¥æ–°çš„è³‡æ–™çµ¦è§€å¯Ÿè€…ï¼Œé¿å…æ¯æ¬¡è³‡æ–™ä¸€æ”¹è®Šå°±ä¸€ç›´é€šçŸ¥è§€å¯Ÿè€…ã€‚Ex: å¦‚æœæ²’æœ‰setChangedçš„æ–¹æ³•ï¼ŒWeahterDataç‰©ä»¶å°±æœƒæŒçºŒä¸æ–·çš„é€šçŸ¥è§€å¯Ÿè€…ï¼Œæ‰€ä»¥è‹¥æˆ‘å€‘å¸Œæœ›æº«åº¦å·®è·åŠåº¦æ‰æ›´æ–°ï¼Œæº«åº¦å·®è·æ’åˆ°åŠåº¦ä»¥ä¸Šï¼Œä¸»é¡Œæ‰æœƒå‘¼å«è§€å¯Ÿè€…çš„update()çš„æ–¹æ³•ã€‚ 12345678910111213141516setChanged() &#123; changed = ture;&#125;notifyObservers(Object arg) &#123; if(changed) &#123; for every observer on the list &#123; call update(this. org) &#125; changed = false; &#125;&#125;notifyObsergers() &#123; notifyObservers(null);&#125;","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Strategy Pattern ç­–ç•¥æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Strategy-Pattern-ç­–ç•¥æ¨¡å¼","date":"2020-07-26T08:58:12.000Z","updated":"2021-01-28T12:17:55.339Z","comments":true,"path":"2020/07/26/Design-Pattern-Java-Strategy-Pattern-ç­–ç•¥æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Strategy-Pattern-ç­–ç•¥æ¨¡å¼/","excerpt":"å¯ä»¥åœ¨åŸ·è¡ŒæœŸå‹•æ…‹æ›´æ›ç‰©ä»¶çš„è¡Œç‚º ã€ç­–ç•¥æ¨¡å¼ã€å®šç¾©äº†æ¼”ç®—æ³•å®¶æ—ï¼Œå°‡ä»–å€‘å€‹åˆ¥å°è£èµ·ä¾†ï¼Œå¯ä»¥è®“ä»–å€‘ä¹‹é–“äº’ç›¸æ›¿æ›ï¼Œæ­¤æ¨¡å¼ä¸æœƒå½±éŸ¿åˆ°ä½¿ç”¨æ­¤æ¼”ç®—æ³•çš„ç¨‹å¼ã€‚","text":"å¯ä»¥åœ¨åŸ·è¡ŒæœŸå‹•æ…‹æ›´æ›ç‰©ä»¶çš„è¡Œç‚º ã€ç­–ç•¥æ¨¡å¼ã€å®šç¾©äº†æ¼”ç®—æ³•å®¶æ—ï¼Œå°‡ä»–å€‘å€‹åˆ¥å°è£èµ·ä¾†ï¼Œå¯ä»¥è®“ä»–å€‘ä¹‹é–“äº’ç›¸æ›¿æ›ï¼Œæ­¤æ¨¡å¼ä¸æœƒå½±éŸ¿åˆ°ä½¿ç”¨æ­¤æ¼”ç®—æ³•çš„ç¨‹å¼ã€‚ æ²’æœ‰æ€è€ƒä½¿ç”¨è¨­è¨ˆæ¨¡å¼çš„æ™‚å€™:æ¨¡æ“¬é´¨å­ç‰ˆæœ¬å‡è¨­æˆ‘å€‘è¦é–‹ç™¼æ¨¡æ“¬é´¨å­éŠæˆ²ï¼Œæœƒæœ‰å„ç¨®ä¸åŒçš„é´¨å­ï¼Œé€™æ™‚å€™æœƒå€‘é€šå¸¸éƒ½æœƒå…ˆè¨­è¨ˆå‡ºä¸€å€‹classå«åš Duckï¼Œç„¶å¾ŒDuckæœƒåŒ…å«é´¨å­çš„å…±åŒè¡Œç‚ºï¼šç™¼å‡ºå«è² quack(), æ¸¸æ³³ swin(), ä»¥åŠå±•ç¾å¤–è§€ display()ï¼Œç„¶å¾Œæœ‰ç¶ é ­é´¨ MallardDuck classå’Œ ç´…é ­é´¨ RedheadDuck classåˆ†åˆ¥ç¹¼æ‰¿ Ducké¡åˆ¥ (åšUML) è‹¥ç¾åœ¨éœ€è¦è®“æ¯éš»é´¨å­éƒ½æœƒé£›ï¼Œæˆ‘å€‘æœƒå¾ˆç›´è¦ºçš„åœ¨ Duck classä¸­åŠ å…¥ fly() ä½†è‹¥ç¾åœ¨æœ‰å€‹æ©¡çš®é´¨å­ï¼Œæœƒä¸å°å¿ƒç¹¼æ‰¿åˆ°Duck classçš„fly(), ä½†æ©¡çš®é´¨ä¸æœƒé£›ï¼ ç”¨ç¹¼æ‰¿çš„å¯ä»¥æ”¹å–„ä½œæ³•ç›´æ¥åœ¨æ©¡çš®é´¨ classä¸­çš„fly() ä¸å®šç¾©ä»»ä½•äº‹æƒ… (åšUML) å•é¡Œè‹¥åˆé‡åˆ°èª˜é¤Œé´¨ï¼Œå°±æœƒé¢è‡¨fly()æ²’å®šç¾©ä»»ä½•äº‹æƒ…ï¼Œquack()ä¹Ÿæ²’å®šç¾©ä»»ä½•äº‹æƒ…å› ç‚ºè‹¥æœ‰å¾ˆå¤šæ–°å‹æ…‹çš„é´¨å­ï¼Œæœƒå°è‡´æ¯ä¸€å€‹ä¸åŒçš„é´¨å­éƒ½å¾—æª¢è¦–è©²é´¨å­æ˜¯å¦å¯é£›æˆ–å¯å« (åšUML) æ”¹ç”¨ä»‹é¢åšæ”¹å–„å°‡flyèˆ‡quackå¾DuckæŠ½é›¢å‡ºä¾†è®Šæˆ Flyableèˆ‡Quackableä»‹é¢ï¼Œè®“æœ‰éœ€è¦é£›æˆ–å«çš„é´¨å­å¯¦ä½œä¹‹ å•é¡Œé‡è¤‡çš„ç¨‹å¼ç¢¼æœƒè®Šè¶…å¤šï¼Œå› ç‚ºåŒæ¨£æœƒé£›æˆ–å«çš„é´¨å­éƒ½å„è‡ªå¯¦ä½œäº†Flyableèˆ‡Quackableä»‹é¢çš„ç¨‹å¼ç¢¼ï¼Œè©²ç¨‹å¼ç¢¼é‚è¼¯éƒ½æ˜¯ç›¸åŒçš„ã€‚ è¨­è¨ˆå®ˆå‰‡(ä¸€) æ‰¾å‡ºç¨‹å¼ä¸­éœ€è¦æ›´å‹•ä¹‹è™•ï¼Œä¸¦å°‡ä¹‹ç¨ç«‹å‡ºä¾†ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦æ›´å‹•çš„ç¨‹å¼ç¢¼æ··åœ¨ä¸€èµ· æŠŠæœƒè®Šå‹•çš„éƒ¨åˆ†å–å‡ºä¾†ä¸¦å°‡ä¹‹å°è£èµ·ä¾†ï¼Œä»¥ä¾¿ä»¥å¾Œå¯ä»¥è¼•æ˜“åœ°æ“´å……æ­¤éƒ¨åˆ†ï¼Œè€Œä¸å½±éŸ¿ä¸éœ€è¦æ›´å‹•çš„éƒ¨åˆ†ã€‚ å°‡é´¨å­çš„è¡Œç‚ºå¾Ducké¡åˆ¥å–å‡ºä¾†ï¼ æŠ½é›¢æœƒè®Šå‹•çš„éƒ¨åˆ†æˆç‚ºç¨ç«‹é¡åˆ¥å°‡é£›è¡Œè¡Œç‚º fly,èˆ‡å‘±å‘±å«è¡Œç‚º quackç¨ç«‹æˆclass ä¸¦ä¸”åœ¨Ducké¡åˆ¥è¨­ç½® â€œå¯ä»¥è¨­å®šè¡Œç‚ºçš„æ–¹æ³•â€ï¼Œå¯ä»¥åœ¨â€œåŸ·è¡ŒæœŸâ€å‹•æ…‹åœ°æ”¹è®Šé´¨å­çš„é£›è¡Œæˆ–å‘±å‘±å«è¡Œç‚º è¨­è¨ˆå®ˆå‰‡(äºŒ)å¯«ç¨‹å¼æ˜¯é‡å°ä»‹é¢è€Œå¯«ï¼Œè€Œä¸æ˜¯é‡å°å¯¦è¸ ç”¨ä»‹é¢ä»£è¡¨æ¯å€‹è¡Œç‚º: FlyBehavior, QuackBehaviorç”¨å„å€‹é´¨å­çš„è¡Œç‚ºé¡åˆ¥å»å¯¦è¸FlyBehaviorå’ŒQuackBehaviorä»‹é¢è€Œä¸æ˜¯ç”±Ducké¡åˆ¥å¯¦è¸è©²ä»‹é¢ :::infoå¯«ç¨‹å¼æ˜¯é‡å°ä»‹é¢å»å¯«ï¼šå…¶çœŸæ­£æ„æ€æ˜¯ã€å¯«ç¨‹å¼æ˜¯é‡å°è¶…å‹æ…‹(supertype)è€Œå¯«ã€ ä½¿ç”¨è¶…å‹æ…‹çš„è©±å¯ä»¥ä¸ç”¨ç†æœƒä»¥å¾ŒåŸ·è¡Œæ™‚çš„çœŸæ­£ç‰©ä»¶å‹æ…‹ï¼šç‚ºâ€œå¤šå‹â€çš„å¯¦è¸ ex: Animal interface { makeSound() }Dog implment Animal { makeSound() { bark() }}Cat implement Animal { makeSound() { meow() }} Animal animal = new Dog();animal.makeSound(); æœ‰å€‹å¥½è™•æ˜¯ï¼Œå¯ä»¥ä¸ç”¨ç›´æ¥åœ¨ä¸€é–‹å§‹åƒµåŒ–æŸå€‹è®Šæ•¸çš„å®£å‘Šå‹æ…‹ ex: Dog x = new dog(); // åƒµåŒ–äº†xè®Šæ•¸ç‚ºdogå‹æ…‹ è€Œæ˜¯å¯ä»¥åœ¨åŸ·è¡ŒæœŸï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨çš„æ™‚å€™æŒ‡å®šè©²ç‰©ä»¶å‹æ…‹ ex: 1234567// å®šç¾©getAnimalç‚ºå›å‚³Dog();x = getAnimal(); // å¾—åˆ° Dogå‹æ…‹x.makeSound(); // ç™¼å‡ºç‹—å«è²// å°‡getAnimal() ä¸­æ”¹æˆå‚³å›Cat();x = getAnimal(); // å¾—åˆ° Catå‹æ…‹x.makeSound(); // ç™¼å‡ºè²“å«è² ::: å¯¦è¸é´¨å­çš„è¡Œç‚º FlyBehaviorä»‹é¢ï¼Œç”¨FlyWithWings(å¯¦è¸æ‰€æœ‰æœ‰ç¿…è†€çš„é´¨å­æœƒé£›çš„è¡Œç‚º)èˆ‡FlyNoWay(å¯¦è¸æ‰€æœ‰ä¸æœƒé£›çš„é´¨å­çš„å‹•ä½œ)é€™å…©å€‹é¡åˆ¥ä¾†å¯¦ä½œ QuackBehaviorä»‹é¢ï¼Œç”¨Quack(çœŸçš„å‘±å‘±å«)ã€Squeak(æ©¡çš®å±å±å«)èˆ‡MuteQuack(å«ä¸å‡ºè²éŸ³)é€™ä¸‰å€‹é¡åˆ¥ä¾†å¯¦ä½œ 1ä»¥ä¸Šè¨­è¨ˆå°‡é£›è¡Œèˆ‡å‘±å‘±å«çš„è¡Œç‚ºå¯ä»¥è¢«å…¶ä»–ç‰©ä»¶å†ä¸‰åˆ©ç”¨ï¼Œå°‡é´¨å­çš„è¡Œç‚ºæŠ½é›¢å‡ºä¾† å•é¡Œèˆ‡æ€è€ƒ æ˜¯å¦è©²å…ˆæŠŠç³»çµ±åšå‡ºä¾†ï¼Œåœ¨çœ‹çœ‹å“ªäº›åœ°æ–¹éœ€è¦æ›´å‹•ï¼Œå†å›é ­å°‡éœ€æ›´å‹•çš„é‚è¼¯ç¨ç«‹å‡ºä¾†ï¼Ÿ ç­”ï¼šä¸å„˜ç„¶ï¼Œè¨­è¨ˆç³»çµ±ä¸­å¯ä»¥é å…ˆè€ƒæ…®åˆ°æœªä¾†å“ªäº›åœ°æ–¹å¯èƒ½éœ€è¦è®Šå‹• é´¨å­æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è¨­è¨ˆæˆä¸€å€‹ä»‹é¢ï¼Ÿ ç­”: ä¸æ°ç•¶ï¼Œå› ç‚ºå·²ç¶“å°‡æœƒè®Šå‹•çš„é‚è¼¯(flyèˆ‡quack)æŠ½é›¢å‡ºdock class, é‚£dock classå°±å¯ä»¥ç›´æ¥ç‚ºæ¯éš»é´¨å­éƒ½æœƒæœ‰åŒæ¨£é‚è¼¯çš„é¡åˆ¥ï¼Œè®“ä¸åŒé¡å‹çš„é´¨å­ç›´æ¥ç¹¼æ‰¿ä½¿ç”¨ æ•´åˆé´¨å­çš„è¡Œç‚ºå°‡é£›è¡Œèˆ‡å‘±å‘±å«çš„å‹•ä½œï¼Œå§”è¨—å…¶ä»–äººè™•ç† (åœ¨Docké¡åˆ¥ä¸­å®£å‘Š FlyBehaviorèˆ‡QuackBehaviorï¼Œé€éBehaviorä»‹é¢å–å¾— æœ‰å¯¦ä½œè©²Behaviorä»‹é¢çš„è¡Œç‚ºå€‘ ex: FlyBehaviorä»‹é¢æœƒæœ‰FlyWithNoWingsé¡åˆ¥å¯¦ä½œ) 123456789101112public class Duck &#123; FlyBehavior flyBehavior; QuackBehavior quackBehavior; public void performQuack() &#123; quackBehavior.quack(); &#125; public void performFly() &#123; flyBehavior.fly(); &#125;&#125; ç¾åœ¨ç”±ç¶ é ­é´¨(MallarDuck)ä¾†ä½¿ç”¨Duckçš„quackBehavioræ‰€æ“æœ‰çš„æœ‰å¯¦è¸è‡ªå·±çš„å­é¡åˆ¥ Quack()ç”¨flyBehaviorçš„FlyWithNoWings ä¸”MallarDuckç¹¼æ‰¿äº†Ducké¡åˆ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨quackBehaviorå’ŒflyBehaviorå–ç”¨è‡ªå·±å°æ‡‰çš„å‹•ä½œ12345678910public class MallardDuck extends Duck &#123; // constructor pubilc MallardDuck() &#123; quackBehavior = new Quack(); flyBehavior = new FlyWithNoWings(); &#125; quackBehavior.performQuack(); flyBehavior.performFly();&#125; å®Œæ•´æ¸¬è©¦çš„codeï¼šå¯¦ä½œä¸€å€‹MiniDuckDuck class12345678910111213141516171819public abstract class Duck &#123; FlyBehavior flyBehavior; QuackBehavior quackBehavior; public Duck() &#123;&#125; public abstract void display(); public void performFly() &#123; flyBehavior.fly(); &#125; public void performQuack() &#123; quackBehavior.quack(); &#125; public void swim() &#123; System.out.println(\"All ducks float, even decoys!\"); &#125;&#125; FlyBehavior and QuackBehaviorä»‹é¢èˆ‡å¯¦è¸ä¹‹çš„å‹•ä½œFlyBehavior.inrface123public interface FlyBehavior &#123; void fly();&#125; å„ç¨®å¯¦è¸Flyçš„é¡åˆ¥ FlyWithWings.java12345public class FlyWithWings implements FlyBehavior &#123; public void fly() &#123; System.out.println(\"I am flying\"); &#125;&#125; FlyNoWay.java12345public class FlyNoWay implements FlyBehavior &#123; public void fly() &#123; System.out.println(\"I cannot fly\"); &#125;&#125; QuackBehavior.java123public interface QuackBehavior &#123; public void quack();&#125; å„ç¨®å¯¦è¸Quackçš„é¡åˆ¥ Quack.java12345public class Quack implements QuackBehavior &#123; public void quack() &#123; System.out.println(\"Quack\"); &#125;&#125; MuteQuack.java12345public class MuteQuack implements QuackBehavior &#123; public void quack() &#123; System.out.println(\"&lt;&lt;Silence&gt;&gt;\"); &#125;&#125; Squeak.java12345public class Squeak implements QuackBehavior &#123; public void quack() &#123; System.out.println(\"Squeak\"); &#125;&#125; å¯¦è¸ç¶ é ­é´¨çš„é¡åˆ¥ï¼šMallardDuck.java1234567891011public class MallardDuck extends Duck &#123; // constructor public MallardDuck() &#123; quackBehavior = new Quack(); flyBehavior = new FlyWithWings(); &#125; public void display() &#123; System.out.println(\"I am a real Mallard duck\"); &#125;&#125; æ¸¬è©¦ç”¨é¡åˆ¥ï¼šMiniDuckSimulator.java12345678910public class MiniDuckSimulator &#123; public static void main(String[] args) &#123; Duck mallard = new MallardDuck(); // æœƒå‘¼å« MallardDuckç¹¼æ‰¿ä¾†çš„performQuack() // é€²è€Œå§”è¨— quackBehaviorè™•ç†quackè¡Œç‚ºï¼Œè€Œéåœ¨è‡ªå·±classå…§è™•ç† mallard.performQuack(); mallard.performFly(); &#125;&#125; å‹•æ…‹è¨­å®šè¡Œç‚ºåœ¨é´¨å­é¡åˆ¥ä¸­å¯ä»¥åŠ å…¥è¨­ç½®flyBehaviorå’ŒquackBehaviorçš„æ–¹æ³• å¯ä»¥éš¨æ™‚å‘¼å«ä»¥ä¸‹æ–¹æ³•æ”¹è®Šé´¨å­çš„è¡Œç‚º12345678910public abstract class Duck &#123;... public void setFlyBehavior(FlyBehavior fb) &#123; flyBehavior = fb; &#125; public void setQuackBehavior(QuackBehavior qb) &#123; quackBehavior = qb; &#125;&#125; ä¾‹å¦‚æœ‰å€‹ â€œæ¨¡å‹é´¨â€œ 12345678910public class ModelDuck extends Duck &#123; public ModelDuck() &#123; flyBehavior = new FlyNoWay(); quackBehavior = new Quack(); &#125; public void display() &#123; System.out.println(\"Model duck\"); &#125;&#125; å»ºç«‹ä¸€å€‹æ–°çš„FlyBehaviorå‹æ…‹ï¼Œå…·æœ‰ç«ç®­å™´å°„çš„åŠŸèƒ½ 12345public class FlyRocketPowered implements FlyBehavior &#123; public void fly() &#123; System.out.println(\"I am flying a rocket\"); &#125;&#125; æ”¹è®Šæ¸¬è©¦é¡åˆ¥ï¼ŒåŠ ä¸Šæ¨¡å‹é´¨å­ï¼Œä½¿æ¨¡å‹é´¨å…·æœ‰ç«ç®­å‹•åŠ›ï¼ 123456789101112131415public class MiniDuckSimulator &#123; public static void main(String[] args) &#123; Duck mallard = new MallardDuck(); ... /** * å…·æœ‰å™´å°„å‹•åŠ›çš„æ¨¡å‹é´¨å­ */ Duck modelDuck = new ModelDuck(); modelDuck.performFly(); // ä¸æœƒé£› // å‹•æ…‹åœ°æ›´æ›é£›è¡Œçš„è¡Œç‚º modelDuck.setFlyBehavior(new FlyRocketPowered()); modelDuck.performFly(); // å™´å°„ï¼ &#125;&#125; ä»¥ä¸Šçš„è¡Œç‚ºç‚ºå°‡å…©å€‹é¡åˆ¥(FlyBehaviorèˆ‡QuackBehavior)çµ„åˆèµ·ä¾†ä½¿ç”¨ï¼Œç‚ºâ€Composition åˆæˆâ€çš„ç²¾ç¥ï¼Œèˆ‡ç¹¼æ‰¿ä¸ä¸€æ¨£çš„æ˜¯ï¼Œé´¨å­Duckçš„è¡Œç‚ºä¸æ˜¯ç¹¼æ‰¿è€Œä¾†ï¼Œè€Œæ˜¯é€éé©ç•¶çš„è¡Œç‚ºç‰©ä»¶ã€åˆæˆã€è€Œä¾†ï¼ è¨­è¨ˆå®ˆå‰‡å¤šç”¨åˆæˆï¼Œå°‘ç”¨ç¹¼æ‰¿ åˆæˆå¯ä»¥å°‡æ¼”ç®—æ³•å°è£æˆé¡åˆ¥ï¼Œæ›´å¯ä»¥ã€åœ¨åŸ·è¡Œå‹•æ…‹åœ°æ”¹è®Šè¡Œç‚ºã€ï¼Œåªè¦åˆæˆçš„è¡Œç‚ºç‰©ä»¶ï¼Œç¬¦åˆç‰¹å®šçš„ä»‹é¢æ¨™æº–å³å¯","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Factory Pattern å·¥å» æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Factory-Pattern-å·¥å» æ¨¡å¼","date":"2020-07-26T08:57:20.000Z","updated":"2021-01-28T12:17:31.169Z","comments":true,"path":"2020/07/26/Design-Pattern-Java-Factory-Pattern-å·¥å» æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Factory-Pattern-å·¥å» æ¨¡å¼/","excerpt":"å·¥å» æ¨¡å¼æä¾›äº†å¯å‰µå»º(new)å„ç¨®ä¸åŒé¡åˆ¥(class)çš„å¯¦ä¾‹(instance) å·¥å» æ¨¡å¼ä¸»è¦åˆæ¶µè“‹äº† (1) ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Pattern (2) å·¥å» æ–¹æ³•æ¨¡å¼ (3) æŠ½è±¡æ–¹æ³•æ¨¡å¼ ç°¡å–®å·¥å» æ–¹æ³•æ˜¯æœ€åˆéšçš„ç”¨æ³•ï¼Œæœƒé•åOOPçš„Open-close principle(OCP)ç„¶è€Œå·¥å» æ–¹æ³•å’ŒæŠ½è±¡æ–¹æ³•å‰‡æ¯”è¼ƒèƒ½è®“æ¨¡çµ„é–“è€¦åˆåº¦é™ä½ã€‚ ä»¥ä¸‹æœƒä¾åºåšä»‹ç´¹","text":"å·¥å» æ¨¡å¼æä¾›äº†å¯å‰µå»º(new)å„ç¨®ä¸åŒé¡åˆ¥(class)çš„å¯¦ä¾‹(instance) å·¥å» æ¨¡å¼ä¸»è¦åˆæ¶µè“‹äº† (1) ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Pattern (2) å·¥å» æ–¹æ³•æ¨¡å¼ (3) æŠ½è±¡æ–¹æ³•æ¨¡å¼ ç°¡å–®å·¥å» æ–¹æ³•æ˜¯æœ€åˆéšçš„ç”¨æ³•ï¼Œæœƒé•åOOPçš„Open-close principle(OCP)ç„¶è€Œå·¥å» æ–¹æ³•å’ŒæŠ½è±¡æ–¹æ³•å‰‡æ¯”è¼ƒèƒ½è®“æ¨¡çµ„é–“è€¦åˆåº¦é™ä½ã€‚ ä»¥ä¸‹æœƒä¾åºåšä»‹ç´¹ ç°¡å–®å·¥å» æ¨¡å¼ Simple Factory Methodç°¡å–®å·¥å» æ¨¡å¼åƒ…æä¾›ä¸€å€‹å·¥å» é¡åˆ¥ï¼Œæ¥æ”¶åƒæ•¸(æ±ºå®šç”Ÿç”¢å“ªç¨®ç”¢å“)ï¼Œä¾†ç”¢ç”Ÿå‡ºå°æ‡‰çš„ç”¢å“ç‰©ä»¶(Object) ä»¥ç”Ÿç”¢Pizzaç‚ºä¾‹ï¼Œå‡è¨­æˆ‘å€‘æœ‰å€‹æŠ«è–©ç°¡å–®å·¥å» (SimplePizzaFactory)å¯ä»¥ç”Ÿç”¢å…©ç¨®ä¸åŒå£å‘³çš„Pizza(Cheeseå’ŒPotato): SimplePizzaFactory.java 123456789101112public class SimplePizzaFactory &#123; public Pizza createPizza(String type) &#123; Pizza pizza = null; if(type.equals(\"cheese\")) &#123; pizza = new CheesePizza(); &#125; else if (type.equals(\"potato\")) &#123; pizza = new PotatoPizza(); &#125; return pizza; &#125;&#125; å·¥å» æœƒå›å‚³æŠ½è±¡çš„Pizzaé¡åˆ¥ Pizza.java1234567891011121314151617public abstract class Pizza &#123; String name; String ingridient; void prepare() &#123; System.out.println(\"Preparing\" + name); System.out.println(\"Ingredient\" + ingridient); &#125; void bake() &#123; System.out.println(\"Bake for 20 mins\"); &#125; String getName() &#123; return name; &#125;&#125; ä»¥åŠå¯¦ä½œäº†å…©å€‹å£å‘³çš„æŠ«è–© CheesePizzaå’ŒPotatoPizza CheesePizza.java12345public class CheesePizza extends Pizza &#123; String name = \"CheesePizza\"; String ingridient = \"Cheese\";&#125; PotatoPizza.java1234public class PotatoPizza extends Pizza &#123; String name = \"PotatoPizza\"; String ingridient = \"Potato\";&#125; Pizzaéƒ½å®šç¾©å®Œç•¢å¾Œï¼Œå®šç¾©SimplePizzaFactory.java SimplePizzaFactory.java123456789101112131415161718public class SimplePizzaFactory &#123; public void orderPizza(String type) &#123; Pizza pizza = null; pizza = createPizza(type); pizza.prepare(); pizza.bake(); &#125; public Pizza createPizza(String type) &#123; Pizza pizza = null; if(type.equals(\"cheese\")) &#123; pizza = new CheesePizza(); &#125; else if (type.equals(\"potato\")) &#123; pizza = new PotatoPizza(); &#125; return pizza; &#125;&#125; åœ¨Main.javaé€éSimplePizzaFactoryè£½ä½œå…©å€‹Pizza: Main.java123456789public class Main &#123; public static void main(String[] args) &#123; SimplePizzaFactory simplePizzaFactory = new SimplePizzaFactory(); simplePizzaFactory.orderPizza(\"cheese\"); simplePizzaFactory.orderPizza(\"potato\"); &#125;&#125; åŸ·è¡ŒMain.java 123456Preparing: CheesePizzaIngredient: CheeseBake for 20 minsPreparing: PotatoPizzaIngredient: PotatoBake for 20 mins ä½†æ­¤è‹¥ä¹‹å¾Œè¦æ“´å……Pizzaçš„ç¨®é¡ï¼Œä¾‹å¦‚è¦å¤šä¸€å€‹å«åšOnionPizzaï¼Œå‹¢å¿…å¾—ä¿®æ”¹SimplePizzaFacotory.java SimplePizzaFactory.java1234567891011121314151617181920public class SimplePizzaFactory &#123; public void orderPizza(String type) &#123; Pizza pizza = null; pizza = createPizza(type); pizza.prepare(); pizza.bake(); &#125; public Pizza createPizza(String type) &#123; Pizza pizza = null; if(type.equals(\"cheese\")) &#123; pizza = new CheesePizza(); &#125; else if (type.equals(\"potato\")) &#123; pizza = new PotatoPizza(); &#125; else if (type.equals(\"onion\")) &#123; // æ–°å¢æ´‹è”¥å£å‘³pizza pizza = new OnionPizza(); &#125; return pizza; &#125;&#125; :::dangerä¸Šè¿°åšæ³•ç ´å£äº†OODçš„OCP(Open-Close Principle)çš„åŸå‰‡ï¼Œäº¦å³é€²è¡Œæ“´å……æ™‚ä¸ä¿®æ”¹åˆ°SimplePizzaFactoryçš„ç¨‹å¼ç¢¼ã€‚::: å·¥å» æ–¹æ³•æ¨¡å¼ç‚ºäº†æ”¹å–„ç°¡å–®å·¥å» æ¨¡å¼ï¼Œå·¥å» æ–¹æ³•æ¨¡å¼é€éâ€æŠ½è±¡æ–¹æ³•â€çš„æ¨¡å¼ï¼Œè®“ä¹‹å¾Œæ“´å……çš„å·¥å» å¯¦ä½œè©²â€æŠ½è±¡æ–¹æ³•â€ï¼Œä»¥é€²è¡Œå…¶ä»–é¡åˆ¥çš„æ“´å…… èˆ‰ä¾‹ï¼šæœ‰å€‹PizzaFactoryè² è²¬å®šç¾©äº†Pizzaå·¥å» è©²åšçš„ä¸€ä»¶äº‹(æŠ½è±¡æ–¹æ³•)å«åš createPizza(); PizzaFactory.java 12345678910public abstract class PizzaFactory &#123; public void orderPizza(String type) &#123; Pizza pizza = null; pizza = createPizza(type); pizza.prepare(); pizza.bake(); &#125; abstract Pizza createPizza(String type);&#125; åŸæœ¬æˆ‘å€‘å·²ç¶“æœ‰å…©ç¨®å£å‘³(Cheeseå’ŒPotato) Pizzaï¼Œå«åšåŸå‘³æŠ«è–©(OriginalPizzaFactory), ä½¿OringinalPizzaFactoryå»å¯¦ä½œPizzaFactoryçš„createPizza()æ–¹æ³• OringinalPizzaFactory.java123456789101112public class OriginalPizzaFactory extends PizzaFactory &#123; public Pizza createPizza(String type) &#123; Pizza pizza = null; if(type.equals(\"cheese\")) &#123; pizza = new CheesePizza(); &#125; else if (type.equals(\"potato\")) &#123; pizza = new PotatoPizza(); &#125; return pizza; &#125;&#125; è‹¥è¦æ–°å¢æ´‹è”¥å£å‘³çš„Pizzaçš„è©±ï¼Œé‚£å°±ç›´æ¥åœ¨å®šç¾©ä¸€å€‹é¡å¤–çš„å·¥å» å«åšï¼Œç‰¹åˆ¥æŠ«è–©å·¥å»  (SpecialPizzaFactory)é€²è¡Œæ“´å……ï¼Œå¦‚æ­¤ä¸€ä¾†å°±ä¸ç”¨æ›´å‹•åˆ°åˆ°åŸæœ¬åŸå‘³æŠ«è–©å·¥å» (OriginalPizzaFactory)çš„ç¨‹å¼ç¢¼ SpecialPizzaFactory.java123456789public class SpecialPizzaFactory extends PizzaFactory &#123; public Pizza createPizza(String type) &#123; Pizza pizza = null; if(type.equals(\"onion\")) &#123; pizza = new OnionPizza(); &#125; return pizza; &#125;&#125; è¨˜å¾—å¤šæ–°å¢ä¸€å€‹æ´‹è”¥æŠ«è–©çš„é¡åˆ¥ OnionPizza.java123456public class OnionPizza extends Pizza &#123; public OnionPizza() &#123; name = \"OnionPizza\"; ingridient = \"Onion\"; &#125;&#125; åœ¨Main.javaä¸­å‘¼å«åŸå‘³å’Œç‰¹åˆ¥å£å‘³çš„æŠ«è–© Main.java1234567891011public class Main &#123; public static void main(String[] args) &#123; PizzaFactory originalPizzaFactory = new OriginalPizzaFactory(); originalPizzaFactory.orderPizza(\"cheese\"); originalPizzaFactory.orderPizza(\"potato\"); PizzaFactory specialPizzaFactory = new SpecialPizzaFactory(); specialPizzaFactory.orderPizza(\"onion\"); &#125;&#125; é€éä¸‹é¢çš„åœ–å¯ä»¥çœ‹åˆ°ï¼Œé€éå®šç¾©ä¸€å€‹æŠ½è±¡æ–¹æ³•çš„å·¥å» ï¼Œè‹¥è¦æ“´å……ç”¢å“(åœ¨é€™è£¡æˆ‘å€‘ç”¨çš„æ˜¯Pizza)é¡åˆ¥çš„è©±ï¼Œé€éå¯¦ä½œè©²æŠ½è±¡æ–¹æ³•å·¥å» ï¼Œä¾†é€²è¡Œæ“´å……ã€‚ ç”±æ–¼æˆ‘å€‘äº¦æŠŠPizzaé¡åˆ¥çµ¦ç¨ç«‹å‡ºä¾†æˆç‚ºä¸€å€‹æŠ½è±¡é¡åˆ¥ï¼Œè‹¥è¦æ–°å¢å…¶ä»–å£å‘³çš„Pizzaä¹Ÿå¯ä»¥é”åˆ°ä¸é•åOCPç²¾ç¥çš„æ“´å……ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š æŠ½è±¡å·¥å» æŠ½è±¡å·¥å» é¡§åæ€ç¾©å°±æ˜¯å®šç¾©ä¸€å€‹æŠ½è±¡ä»‹é¢å·¥å» ï¼Œæ¬²æ“´å……çš„è©±å°±å¯¦ä½œè©²æŠ½è±¡ä»‹é¢å·¥å»  ä»¥æŠ«è–©åŸæ–™å·¥å» (PizzaIngredientFactory)ç‚ºä¾‹ï¼Œæœ‰é†¬æ–™å’Œè”¬èœå…©ç¨®åŸæ–™ï¼šæ–¹é¢çµ¦ä¹‹å¾Œæˆ‘å€‘è¦è£½ä½œçš„ä¸­å¼å’Œç¾å¼æŠ«è–©çš„åŸæ–™å¯¦ä½œï¼Œåšæ“´å±•ï¼š PizzaIngredientFactory.java1234public interface PizzaIngredientFactory &#123; public Sauce createSauce(); public Vegetable createVegetable();&#125; æŠ½è±¡å·¥å» (åŸæ–™å·¥å» )åœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“æˆ‘å€‘å†åˆ†åˆ¥ç”¢ç”Ÿç¾å¼ç‰ˆæœ¬(AmericaIngredientFactory)å’Œä¸­å¼ç‰ˆæœ¬(ChinesePizzaFactory)çš„æŠ«è–©åŸæ–™å·¥å» ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†createSauceå’ŒcreateVegetableï¼Œé€éå·¥å» æ–¹æ³•ä¾†ç”¢ç”ŸåŸæ–™ç”¢å“ AmericaIngredientFactory.java12345678public class AmericaIngredientFactory implements PizzaIngredientFactory &#123; public Sauce createSauce() &#123; return new TomatoSauce(); &#125; public Vegetable createVegetable() &#123; return new Potato(); &#125;&#125; ChineseIngredientFactory.java12345678public class ChineseIngredientFactory implements PizzaIngredientFactory &#123; public Sauce createSauce() &#123; return new SoySauce(); &#125; public Vegetable createVegetable() &#123; return new Onion(); &#125;&#125; æ¥è‘—å®šç¾©å‰›å‰›åŸæ–™å·¥å» æœ‰ä½¿ç”¨åˆ°çš„åŸæ–™é¡åˆ¥å€‘(Sauce: SoySauceèˆ‡PotatoSauce; Vegetable: Onionå’ŒPotatoï¼Œè©²åŸæ–™äº¦åœ¨å¯¦ä½œPizzaé¡åˆ¥çš„å…·é«”é¡åˆ¥äº¦æœƒç”¨åˆ° :::infoPizza.java123456789public abstract class Pizza &#123; String name; // åœ¨Pizzaé¡åˆ¥ä¸­å·²ç¶“æœ‰å®£å‘Šæœƒç”¨åˆ°çš„åŸæ–™æœ‰å“ªäº›ï¼Œæ˜¯ä»¥ä»‹é¢ä¾†å¯¦ä½œï¼Œæ–¹ä¾¿åšæ“´å±• Sauce sauce; Vegetable vegetable; ...&#125; ::: å®šç¾©é†¬æ–™SauceåŸæ–™å€‘ï¼š Sauce.java12345public abstract class Sauce &#123; String name; public abstract String getSauce();&#125; SoySauce.java12345678910public class SoySauce extends Sauce &#123; public SoySauce() &#123; name = \"soy sauce\"; &#125; public String getSauce() &#123; System.out.println(\"The sauce is :\" + name); return this.name; &#125;&#125; TomatoSauce.java1234567891011public class TomatoSauce extends Sauce &#123; public TomatoSauce() &#123; name = \"tomato sauce\"; &#125; public String getSauce() &#123; System.out.println(\"The sauce is :\" + name); return this.name; &#125;&#125; æ¥ä¸‹ä¾†æ›å®šç¾©VegetableåŸæ–™å€‘ Vegetable.java12345public abstract class Vegetable &#123; String name; public abstract String getVegetable();&#125; Onion.java123456789public class Onion extends Vegetable &#123; public Onion() &#123; name = \"onion\"; &#125; public String getVegetable() &#123; System.out.println(\"The vegetable is :\" + name); return this.name; &#125;&#125; Potato.java1234567891011public class Potato extends Vegetable &#123; public Potato() &#123; name = \"potato\"; &#125; public String getVegetable() &#123; System.out.println(\"The vegetable is :\" + name); return this.name; &#125;&#125; å°‡æŠ«è–©ä¿®æ”¹æˆåŒ…å«ä¸Šè¿°åŸæ–™ (Sauceå’ŒVegetable) Pizza.java123456789101112131415161718192021public abstract class Pizza &#123; String name; Sauce sauce; Vegetable vegetable; // å°‡prepareä¿®æ”¹æˆæŠ½è±¡ï¼Œè©²æ–¹æ³•éœ€è¦æ”¶é›†Pizzaæ‰€éœ€çš„åŸæ–™ï¼ŒåŸæ–™ä¾†è‡ªæ–¼åŸæ–™å·¥å» ï¼ public abstract void prepare(); public void bake() &#123; System.out.println(\"Bake for 30 mins\"); &#125; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125;&#125; å®šç¾©å…©å€‹styleçš„Pizza: ä¸­å¼æŠ«è–©(Chinese Pizza)å’Œç¾å¼æŠ«è–©(America Pizza)ï¼Œåœ¨é€™å…©éš»é¡åˆ¥å¯ä»¥çœ‹åˆ°æˆ‘å€‘å‚³å…¥äº†åŸæ–™å·¥å» ï¼Œä»¥æ±ºå®šå“ªç¨®é¢¨æ ¼çš„æŠ«è–©å°±ç”¨å°æ‡‰é¢¨æ ¼çš„åŸæ–™å·¥å»  ChinesePizza.java1234567891011121314151617public class ChinesePizza extends Pizza &#123; PizzaIngredientFactory ingredientFactory; public ChinesePizza(PizzaIngredientFactory ingredientFactory) &#123; this.ingredientFactory = ingredientFactory; &#125; public void prepare() &#123; System.out.println(\"Preparing: \" + name); sauce = ingredientFactory.createSauce(); sauce.getSauce(); vegetable = ingredientFactory.createVegetable(); vegetable.getVegetable(); &#125;&#125; AmericaPizza.java123456789101112131415161718public class AmericaPizza extends Pizza &#123; PizzaIngredientFactory ingredientFactory; public AmericaPizza(PizzaIngredientFactory ingredientFactory) &#123; this.ingredientFactory = ingredientFactory; &#125; public void prepare() &#123; System.out.println(\"Preparing: \" + name); sauce = ingredientFactory.createSauce(); sauce.getSauce(); vegetable = ingredientFactory.createVegetable(); vegetable.getVegetable(); &#125;&#125; æ¥è‘—å†åˆ©ç”¨å·¥å» æ–¹æ³•ï¼Œå®šç¾©ä¸­å¼å’Œç¾å¼çš„æŠ«è–©å·¥å» ï¼Œè£½ä½œå‡ºä¸­å¼å’Œç¾å¼çš„æŠ«è–© PizzaFactory.java12345678910public abstract class PizzaFactory &#123; public void orderPizza(String type) &#123; Pizza pizza = null; pizza = createPizza(type); pizza.prepare(); pizza.bake(); &#125; abstract Pizza createPizza(String type);&#125; AmericaPizzaFactory.java123456789101112131415public class AmericaPizzaFactory extends PizzaFactory &#123; protected Pizza createPizza(String style) &#123; Pizza pizza = null; // ä½¿ç”¨äº†ç¾å¼åŸæ–™å·¥å»  PizzaIngredientFactory ingredientFactory = new AmericaIngredientFactory(); if(style.equals(\"America\")) &#123; pizza = new AmericaPizza(ingredientFactory); pizza.setName(\"America style pizza\"); &#125; return pizza; &#125;&#125; :::infoå¯ä»¥åœ¨å°ç¾å¼å·¥å» æ–°å¢å…¶ä»–ç¨®ä¸åŒå£å‘³çš„Pizzaï¼Œç”¨ä¸åŒçš„åŸæ–™å·¥å» ä¾†é”æˆ::: ChinesePizzaFactory.java123456789101112131415public class ChinesePizzaFactory extends PizzaFactory &#123; protected Pizza createPizza(String style) &#123; Pizza pizza = null; // ä½¿ç”¨äº†ä¸­å¼åŸæ–™å·¥å»  PizzaIngredientFactory ingredientFactory = new ChineseIngredientFactory(); if(style.equals(\"Chinese\")) &#123; pizza = new ChinesePizza(ingredientFactory); pizza.setName(\"Chinese style pizza\"); &#125; return pizza; &#125;&#125; æœ€å¾Œåœ¨Main.javaä¸­ä¾†è£½ä½œæŠ«è–©ï¼š Main.java1234567891011public class Main &#123; public static void main(String[] args) &#123; PizzaFactory AmericaPizzaFactory = new AmericaPizzaFactory(); AmericaPizzaFactory.orderPizza(\"America\"); PizzaFactory ChinesePizzaFactory = new ChinesePizzaFactory(); ChinesePizzaFactory.orderPizza(\"Chinese\"); &#125;&#125; å¯ä»¥çœ‹åˆ°æŠ½è±¡å·¥å» æ–¹æ³•å¯ä»¥å¹«æˆ‘å€‘æŠŠç›¸é—œç”¢å“é›†çµèµ·ä¾†(ä¸Šè¿°ä¾‹å­ç‚ºåŸæ–™å€‘)ï¼Œå¯ä»¥ç”¢ç”Ÿå‡ºä¸åŒçµ„çš„åŸæ–™é¡åˆ¥å€‘ï¼Œå¦å¤–æŠ½è±¡å·¥å» é€šå¸¸é‚„æœƒå†æ­é…å·¥å» æ–¹æ³•ï¼Œä¾†å»ºç«‹å…¶ç”¢å“(æŠ«è–©å€‘ï¼Œå„å€‹æŠ«è–©æœƒç”¨åˆ°å„å€‹ä¸åŒçš„æŠ½è±¡å·¥å» æ‰€å»ºç«‹çš„åŸæ–™å·¥å» )ï¼Œå¦‚åŒè©²é€£çµæ‰€åšçš„-&gt;é€£çµåœ¨é€éå·¥å» æ–¹æ³•ä¾†è£½ä½œåŸæ–™ç”¢å“)","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Singleton Pattern ç¨é«”æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Java-Singleton-Pattern-ç¨é«”æ¨¡å¼","date":"2020-07-26T08:56:27.000Z","updated":"2021-01-28T12:24:58.355Z","comments":true,"path":"2020/07/26/Design-Pattern-Java-Singleton-Pattern-ç¨é«”æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/26/Design-Pattern-Java-Singleton-Pattern-ç¨é«”æ¨¡å¼/","excerpt":"æ¯æ¬¡å¼•ç”¨é¡åˆ¥éƒ½åªæœƒç”¢å‡ºç›¸åŒçš„ç‰©ä»¶ é©åˆç”¨åœ¨: åŸ·è¡Œç·’æ± (thread pool)ï¼Œå¿«å–å€(cache)ï¼Œå°è©±ç›’ã€è™•ç†å°è©±è¨­å®šå’Œç™»éŒ„çš„ç‰©ä»¶ï¼Œå’Œé©…å‹•ç¨‹å¼æºé€šçš„ç‰©ä»¶ã€‚","text":"æ¯æ¬¡å¼•ç”¨é¡åˆ¥éƒ½åªæœƒç”¢å‡ºç›¸åŒçš„ç‰©ä»¶ é©åˆç”¨åœ¨: åŸ·è¡Œç·’æ± (thread pool)ï¼Œå¿«å–å€(cache)ï¼Œå°è©±ç›’ã€è™•ç†å°è©±è¨­å®šå’Œç™»éŒ„çš„ç‰©ä»¶ï¼Œå’Œé©…å‹•ç¨‹å¼æºé€šçš„ç‰©ä»¶ã€‚ ä½œæ³•å‡å¦‚æœ‰ä¸€å€‹é¡åˆ¥å«åšMyClassï¼Œç¾åœ¨è¦è®“MyClassè®Šæˆç¨é«”æ¨¡å¼ï¼Œè®“å¤–é¢çš„é¡åˆ¥åªèƒ½é€é MyClass.getInstance() å–å¾—MyClassç‰©ä»¶ã€‚ 12345678910111213141516public class MyClass &#123; // è¨­å®šæˆprivateèˆ‡staticï¼Œä¸èƒ½çµ¦å¤–é¢é¡åˆ¥å­˜å– private static MyClass uniqueInstance; // å°‡å»ºæ§‹å¼è¨­å®šæˆ privateï¼Œé€™æ¨£å°±å¯ä»¥é¿å…ç›´æ¥è¢«é¡åˆ¥ newå‡ºä¾† private MyClass() &#123;&#125; // è¨­ç½®æˆstaticï¼Œä½¿å¤–é¢é¡åˆ¥å¯ä»¥ç›´æ¥å­˜å–MyClass.getInstanceæ–¹æ³• public static MyClass getInstance() &#123; // è‹¥ç¬¬ä¸€æ¬¡å–å¾—MyClassï¼Œ new å‡ºMyClass(); if(uniqueInstance == null) &#123; uniqueInstance = new MyClass(); &#125; return uniqueInstance; &#125;&#125; å…¶ä»–é¡åˆ¥è¦å–ç”¨MyClass 12345678910public static void main(String args[]) &#123; // 1. ç¬¬ä¸€æ¬¡å–ç”¨getInstance Myclass instance = MyClass.getInstance(); // 2. ç¬¬äºŒæ¬¡å–ç”¨getInstanceæ™‚ï¼ŒMyClassçš„uniqueInstanceå·²ç¶“æœ‰å€¼äº†ï¼Œå¾—åˆ°èˆ‡ä¸Šé¢instanceä¸€æ¨£çš„object Myclass instance1 = MyClass.getInstance(); if(instance == instance1) &#123; System.out.println(&quot;instance and instance1 are the same&quot;); &#125;&#125; å¤šåŸ·è¡Œç·’ä¸‹ç¨é«”æ¨¡å¼æœƒé‡åˆ°çš„ç‹€æ³å‡å¦‚æœ‰å…©å€‹thread(thread 1å’Œthread 2)ï¼ŒåŒæ™‚è¦è·ŸMyClasså–å¾—ç‰©ä»¶ï¼Œä½†æœƒé¢è‡¨thread1å’Œthread2æœƒå–å¾—ä¸åŒçš„MyClassç‰©ä»¶ï¼Œæƒ…æ³å¦‚ä¸‹ï¼š è§£æ³•ä¸€ï¼šåªè¦æŠŠgetInstance()çµ¦åŒæ­¥åŒ– (æœƒæœ‰æ•ˆèƒ½ä¸ä½³çš„ç‹€æ³ï¼Œå¯èƒ½é€ æˆæ•ˆç‡ä¸‹é™100å€)12345678910111213public class MyClass &#123; private static MyClass uniqueInstance; private MyClass() &#123;&#125; // è¨­å®šæˆsynchronizedï¼Œå°±å¯ä»¥è®“åŸ·è¡Œç·’ä¾åºé€²å…¥getInstanceå…§ public static synchronized MyClass getInstance() &#123; if(uniqueInstance == null) &#123; uniqueInstance = new MyClass(); &#125; return uniqueInstance; &#125;&#125; ä½†æˆ‘å€‘åªéœ€è¦ç¬¬ä¸€æ¬¡é€²å…¥getInstanceæ‰é€²è¡ŒåŒæ­¥åŒ–å°±å¥½ï¼Œä¸ç„¶å…¶ä»–æ¬¡è¦å–å¾—uniqueInstnaceéƒ½å¾—è®ŠæˆåŒæ­¥çš„æ–¹å¼ï¼Œé€ æˆå–ç”¨Instanceçš„ç·©æ…¢ è§£æ³•äºŒï¼šç‡å…ˆå»ºç«‹å¯¦é«”ï¼Œä¸è¦ç­‰åˆ°æœ‰äººå‘¼å«getInstanceæ‰newå‡ºMyClasså¯¦é«”1234567891011public class MyClass &#123; // ç›´æ¥åˆå§‹è©±MyClass()ï¼Œä¸¦è¨­æˆprivate private static MyClass uniqueInstnace = new MyClass(); private MyClass() &#123;&#125; public static MyClass getInstance() &#123; return uniqueInstance; &#125; &#125; æ­¤ä½œæ³•ä¾è³´JVMè¼‰å…¥æ­¤é¡åˆ¥æ™‚ï¼Œé¦¬ä¸Šå»ºç«‹æ­¤å”¯ä¸€çš„ç¨é«”ç‰©ä»¶ï¼ŒJVMä¿è­‰åœ¨ä»»ä½•åŸ·è¡Œç·’å­˜å–uniqueInstnaceéœæ…‹è®Šæ•¸ä¹‹å‰ï¼Œä¸€å®šå…ˆå»ºç«‹æ­¤å¯¦é«” è§£æ³•ä¸‰ï¼šåˆ©ç”¨ â€œé›™é‡æª¢æŸ¥ä¸Šé–â€ åœ¨getInstance()ä¸­æ¸›å°‘ä½¿ç”¨åŒæ­¥åŒ–åˆ©ç”¨é›™é‡æª¢æŸ¥ä¸Šé–ï¼Œé¦–å…ˆæª¢æŸ¥æ˜¯å¦å¯¦é«”å·²ç¶“å»ºç«‹äº†ï¼Œè‹¥æ²’æœ‰ï¼Œâ€œæ‰â€é€²è¡ŒåŒæ­¥åŒ–ï¼Œå¦‚æ­¤ä¸€ä¾†åªæœ‰ç¬¬ä¸€æ¬¡é€²å…¥getInstanceæ‰åŒæ­¥åŒ–ï¼Œæ‰æ˜¯æˆ‘å€‘æ‰€æƒ³è¦çš„ã€‚ `java=public class MyClass { // volatileç‚ºJava 6ä¹‹å¾Œæ‰æœ‰çš„é—œéµå­—ï¼Œèƒ½å¤ ä½¿åŸ·è¡Œç·’å€‘å–å¾—ç›¸åŒçš„uniqueInstance private volatile static MyClass uniqueInstance; private MyClass() {} public static MyClass getInstance() { // åªæœ‰ç¬¬ä¸€æ¬¡æ‰å¾¹åº•åŸ·è¡Œä»¥ä¸‹ç¨‹å¼ç¢¼ // ç•¶åŸ·è¡Œç·’é‡åˆ°è¢«å®£å‘Šæˆvolatileçš„uniqueInstnaceï¼Œæœƒè®Šå¾—è¬¹æ… if(uniqueInstance == null) { synchronized(MyClass.class) { // å†æª¢æŸ¥ä¸€æ¬¡ï¼Œè‹¥ç‚ºnullå‰‡new MyClass(); if(uniqueInstance == null) { uniqueInstance = new MyClass(); } } } return uniqueInstance; } }","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"Command Pattern å‘½ä»¤æ¨¡å¼ [Design Pattern in Java]","slug":"Design-Pattern-Command-Pattern-å‘½ä»¤æ¨¡å¼","date":"2020-07-26T08:52:42.000Z","updated":"2021-01-28T12:17:01.716Z","comments":true,"path":"2020/07/26/Design-Pattern-Command-Pattern-å‘½ä»¤æ¨¡å¼/","link":"","permalink":"http://a10000005588.github.io/2020/07/26/Design-Pattern-Command-Pattern-å‘½ä»¤æ¨¡å¼/","excerpt":"å‘½ä»¤æ¨¡å¼ä¸»è¦å°‡åŸ·è¡Œçš„å‘½ä»¤, èˆ‡åŸ·è¡Œè€…åšé¬†ç¶çš„å‹•ä½œ","text":"å‘½ä»¤æ¨¡å¼ä¸»è¦å°‡åŸ·è¡Œçš„å‘½ä»¤, èˆ‡åŸ·è¡Œè€…åšé¬†ç¶çš„å‹•ä½œ æ²’æœ‰å‘½ä»¤æ¨¡å¼æœƒæ˜¯æ€æ¨£çš„å¯«æ³•ï¼Ÿï¼Ÿå‡å¦‚æˆ‘å€‘ç¾åœ¨è¦å¯«ä¸€å€‹ é™æ§å™¨ RemoteControl (åŸ·è¡Œè€…), ä¸Šé¢æœƒæœ‰å¾ˆå¤šæŒ‰éˆ•åŠŸèƒ½ (å‘½ä»¤) æ¯å€‹æŒ‰éˆ•å¯èƒ½éƒ½å°æ‡‰å„å€‹åŠŸèƒ½, ä¾‹å¦‚ æ‰“é–‹, é—œé–‰æŸäº›æˆ¿é–“çš„ç‡ˆ æ–¼æ˜¯æˆ‘å€‘å®šç¾©äº† Light æŠ½è±¡é¡åˆ¥, æœ‰è‘— on()èˆ‡off()é–‹é—œç‡ˆçš„æ–¹æ³•, ä¸¦ä¸”å¯¦ä½œäº† LivingRoomLight, KitchenLighté€™å…©å€‹æˆ¿é–“ä¸¦ç¹¼æ‰¿ LightæŠ½è±¡é¡åˆ¥çš„æ–¹æ³•, ä½¿ä»–å€‘éƒ½æœ‰é–‹é—œçš„åŠŸèƒ½ï¼ æ¥è‘—åœ¨é™æ§å™¨ RemoteControlé¡åˆ¥å…§å®šç¾©äº† Light[] é™£åˆ—, å„²å­˜æ¬²åŸ·è¡Œçš„åŠŸèƒ½ (å¯¦ä½œLightçš„é¡åˆ¥å€‘) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public class main &#123; public static void main(String[] args) &#123; // å®šç¾©å‡ºä¸€å€‹é™æ§å™¨instance RemoteControl remoteControl = new RemoteControl( new Light[]&#123; new LivingRoomLight(), new KitchenLight() &#125;); // 0: æ‰“é–‹LivingRoom Light // 1: æ‰“é–‹Kitchen Light remoteControl.turnOnLight(0); remoteControl.turnOnLight(1); // 0: é—œé–‰LivingRoom Light // 1: é—œé–‰Kitchen Light remoteControl.turnOffLight(0); remoteControl.turnOffLight(1); &#125;&#125;class RemoteControl &#123; Light[] lights = new Light[10]; RemoteControl(Light[] lights) &#123; // å°‡å‚³é€²ä¾†çš„lightsæ”¾å…¥åˆ°lightså…§ for(int i=0; i&lt;lights.length; i++) &#123; this.lights[i] = lights[i]; &#125; &#125; public void turnOnLight(int buttonNumber) &#123; this.lights[buttonNumber].on(); &#125; public void turnOffLight(int buttonNumber) &#123; this.lights[buttonNumber].off(); &#125;&#125;abstract class Light &#123; Light() &#123;&#125; abstract void on(); abstract void off();&#125;class LivingRoomLight extends Light &#123; LivingRoomLight() &#123;&#125; @Override public void on() &#123; System.out.println(\"Turn on the living room light\"); &#125; @Override public void off() &#123; System.out.println(\"Turn off the living room light\"); &#125;&#125;class KitchenLight extends Light &#123; KitchenLight() &#123;&#125; @Override public void on() &#123; System.out.println(\"Turn on the kitchen light\"); &#125; @Override public void off() &#123; System.out.println(\"Turn off the kitchem light\"); &#125;&#125; åŸ·è¡Œçµæœå¦‚ä¸‹ å•é¡Œå‡å¦‚ç¾åœ¨åˆæƒ³è¦æ·»åŠ é›»è¦–èˆ‡å†·æ°£é–‹é—œçš„åŠŸèƒ½ TV, AirConditioner, é‚£ä¸å°±åˆè¦åœ¨RemoteControlé¡åˆ¥å…§é€²è¡Œä¿®æ”¹ 12345678910111213141516171819202122class RemoteControl &#123; // åˆæ–°å¢äº†HomeDeviceé™£åˆ—...å®šç¾©å®¶å…·é›†åˆçš„é¡åˆ¥ HomeDevice[] homeDevices = new HomeDevice[10]; Light[] lights = new Light[10]; RemoteControl(Light[] lights) &#123; // å°‡å‚³é€²ä¾†çš„lightsæ”¾å…¥åˆ°lightså…§ for(int i=0; i&lt;lights.length; i++) &#123; this.lights[i] = lights[i]; &#125; &#125; public void turnOnLight(int buttonNumber) &#123; this.lights[buttonNumber].on(); &#125; public void turnOffLight(int buttonNumber) &#123; this.lights[buttonNumber].off(); &#125; // åˆåœ¨å®šç¾©HomeDeviceçš„é–‹é—œåŠŸèƒ½...&#125; å¯çœ‹åˆ°æ¯æ¬¡è‹¥è¦ç‚ºé™æ§å™¨é¡åˆ¥æ–°å¢åŠŸèƒ½, éƒ½è¦å°RemoteControlé€²è¡Œä¿®æ”¹çš„å‹•ä½œ, å¦‚æ­¤ä¸€ä¾†å¯èƒ½æœƒé€ æˆå…¶ä»–å·²ç¶“å…§åµŒå¥½çš„åŠŸèƒ½å¯èƒ½è¢«æ”¹å£çš„ç‹€æ³ç™¼ç”Ÿ, é€™æ™‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ Command æ¨¡å¼ ä¾†é¿å…é€™ç¨®ç‹€æ³ç™¼ç”Ÿ Command å‘½ä»¤æ¨¡å¼çš„å„ªå‹¢å‘½ä»¤æ¨¡å¼å¯ä»¥å¹«æˆ‘å€‘æŠŠè¦è³¦äºˆRemoteControlçš„é€™äº›åŠŸèƒ½çµ¦å°è£èµ·ä¾†, æˆç‚ºä¸€å€‹ç¨ç«‹çš„å€‹é«”, ä¸æœƒè·ŸRemoteControlçµ¦è€¦åˆå†ä¸€èµ· (åƒä¸Šé¢turnOnLight, turnOffLightç­‰åŠŸèƒ½) æˆ‘å€‘å¯ä»¥æŠŠ Light çš„é–‹é—œåŠŸèƒ½éƒ½è¦–ä½œç‚º Command (å‘½ä»¤)æŠ½è±¡ä»‹é¢, è©²ä»‹é¢åŒ…å«äº†ä¸€å€‹ execute()åŠŸèƒ½, æ¥è‘—ç”±Command (å‘½ä»¤)è¡ä¼¸å‡º LightOnCommandèˆ‡LightOffCommandé€™å…©å€‹å¯¦ä½œé¡åˆ¥, è² è²¬å®šç¾©Lightçš„é–‹èˆ‡é—œçš„å‹•ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * å®šç¾©ä¸€å€‹å‘½ä»¤, åŒ…å«çš„åŸ·è¡Œexecuteçš„å‹•ä½œ */interface Command &#123; void execute();&#125;/** * å¯¦ä½œç‡ˆçš„é–‹é—œå‘½ä»¤ */class Light &#123; void on() &#123; System.out.println(\"Turn on the light\"); &#125;; void off() &#123; System.out.println(\"Turn off the light\"); &#125;;&#125;class LightOnCommand implements Command &#123; Light light; LightOnCommand() &#123; this.light = new Light(); &#125; public void execute() &#123; light.on(); &#125;&#125;class LightOffCommand implements Command &#123; Light light; LightOffCommand() &#123; this.light = new Light(); &#125; public void execute() &#123; light.off(); &#125;&#125;class NoCommand implements Command &#123; NoCommand() &#123;&#125; public void execute() &#123; System.out.println(\"Not yet defined\"); &#125;&#125; æ¥è‘—æˆ‘å€‘éœ€è¦åœ¨é™æ§å™¨é¡åˆ¥ RemoteControl å®šç¾©å¯æ”¾ç½®Commandçš„å‹•ä½œ setXXXCommand(), ä»¥åŠå‘¼å«Commandçš„ pressOnButton()èˆ‡pressOffButton() 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * å®šç¾©é™æ§å™¨é¡åˆ¥ */class RemoteControl &#123; Command[] onCommands = new Command[7]; Command[] offCommands = new Command[7]; // åˆå§‹åŒ–ä¸€é–‹å§‹çš„æ’æ§½, è‹¥æ²’åŠŸèƒ½å°±å®šç¾©ä¸€å€‹æ²’ä½œç”¨çš„commandä¾›å‘¼å« (å¯é¿å…ç”¨ if (command != null) é€™ç¨®åˆ¤æ–·æ–¹å¼ RemoteControl() &#123; for(int i=0; i&lt;7; i++) &#123; onCommands[i] = new NoCommand(); offCommands[i] = new NoCommand(); &#125; &#125; public void setOnCommand(int slot, Command onCommand) &#123; this.onCommands[slot] = onCommand; &#125; public void setOffCommand(int slot, Command offCommand) &#123; this.offCommands[slot] = offCommand; &#125; public void pressOnButton(int slot) &#123; this.onCommands[slot].execute(); &#125; public void pressOffButton(int slot) &#123; this.offCommands[slot].execute(); &#125; // é¡¯ç¤ºæˆ‘å€‘å¡äº†å“ªäº›åŠŸèƒ½åˆ°slotå…§ public String toString() &#123; StringBuffer stringBuff = new StringBuffer(); stringBuff.append(\"\\n ------- Remote Control-------\\n\"); for (int i=0; i &lt; onCommands.length; i++) &#123; stringBuff.append(\"[slot \" + i + \"] \" + onCommands[i].getClass().getName() + \" \" + offCommands[i].getClass().getName() + \"\\n\"); &#125; return stringBuff.toString(); &#125;&#125; é€éé€™æ¨£çš„åšæ³•, æˆ‘å€‘å¯ä»¥çœ‹åˆ°åŸæœ¬RemoteControlå…§çš„èˆ‡Lightæ“ä½œæœ‰é—œçš„å‹•ä½œ, éƒ½è¢«æˆ‘å€‘é€é Command æŠ½è±¡ä»‹é¢ä»¥åŠå…¶ LightOnCommandèˆ‡LightOffCommandå¯¦ä½œé¡åˆ¥çµ¦æŠ½é›¢å‡ºä¾†äº† æ–¼æ˜¯æˆ‘å€‘å¯ä»¥ä¾†åŸ·è¡Œçœ‹çœ‹ 123456789101112131415161718192021222324252627public class main &#123; public static void main(String[] args) &#123; RemoteControl remoteControl = new RemoteControl(); // å®šç¾©å‡ºå…©ç¨®æˆ¿é–“çš„ç‡ˆ Light LivingRoomLight = new Light(\"Living Room\"); Light KitchenLight = new Light(\"Kitchen\"); // è¨­ç½®CommandæŒ‰éˆ• remoteControl.setOnCommand(0, new LightOnCommand(LivingRoomLight)); remoteControl.setOffCommand(0, new LightOffCommand(LivingRoomLight)); remoteControl.setOnCommand(1, new LightOnCommand(KitchenLight)); remoteControl.setOffCommand(1, new LightOffCommand(KitchenLight)); // é¡¯ç¤ºæœ‰å“ªäº›åŠŸèƒ½ System.out.println(remoteControl.toString()); // åŸ·è¡Œå‘½ä»¤ //// å®¢å»³çš„ remoteControl.pressOnButton(0); remoteControl.pressOffButton(0); //// å»šæˆ¿çš„ remoteControl.pressOnButton(1); remoteControl.pressOffButton(1); &#125;&#125; è‹¥æ¥ä¸‹ä¾†éœ€è¦æ–°å¢å¦‚æµ´å®¤é–‹é—œ, é›»è¦–é–‹é—œ, åªè¦é€éRemoteConrolçš„setCommand()æ–¹æ³•, å³å¯ä»¥å‹•æ…‹åšè¨­ç½®, ä¸éœ€æ›´å‹•åˆ°é™æ§å™¨é¡åˆ¥åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼ (é™¤éè¦æ”¹è®Šé™æ§å™¨çš„slotå¤§å°äº†) é€²éšçš„Command PatternæŠ€å·§ç­‰å¾…è£œå…… (ç‚ºCommandä»‹é¢æ–°å¢ undo()æ–¹æ³•, ä½¿å‹•ä½œå¾©åŸ) æ‡‰ç”¨å ´æ™¯é‹ç”¨åœ¨ä»»å‹™åºåˆ—ä¸­, å¤šåŸ·è¡Œç·’åªè¦æ‹¿åˆ°Commandç‰©ä»¶, ä¸¦ä¸”åŸ·è¡Œexecuteæ–¹æ³•è² è²¬åŸ·è¡Œå®Œå°±å¥½ æˆ–æ˜¯ç”¨åœ¨æ—¥èªŒç®¡ç†, å°‡åŸ·è¡Œéçš„å‹•ä½œçµ¦è¨˜éŒ„èµ·ä¾†, ä¸¦ä¸”è‹¥å¾ŒçºŒä¼ºæœå™¨ç•¶æ©Ÿ, å¯å°‡å‘½ä»¤çµ¦å¾©åŸ","categories":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/categories/Design-Pattern/"}],"tags":[{"name":"Design Pattern","slug":"Design-Pattern","permalink":"http://a10000005588.github.io/tags/Design-Pattern/"},{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"}]},{"title":"ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº«","slug":"ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº«","date":"2020-05-16T12:47:39.000Z","updated":"2021-01-28T12:13:44.948Z","comments":true,"path":"2020/05/16/ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº«/","link":"","permalink":"http://a10000005588.github.io/2020/05/16/ä¸‹ç­è‡ªä¿®çš„ç¶“é©—åˆ†äº«/","excerpt":"æœ€è¿‘å‰›å¥½åœ¨Backendç‰ˆä¸Šçœ‹åˆ°æœ‰äººPoæ–‡å•èªª: â€œä¸‹ç­å¾Œè¦å¦‚ä½•ç²¾é€²è‡ªä¿®â€, æ„å¤–çœ‹åˆ°è¨±å¤šå¤§å¤§å€‘åœ¨ä¸‹é¢ç•™è¨€, æ­£å¥½æœ€è¿‘æˆ‘ä¹Ÿåœ¨æ€è€ƒè¦å¦‚ä½•ç²¾é€²è‡ªå·±, æ‰€ä»¥è¶é€™æ©Ÿæœƒä¾†çµ±æ•´ä¸€ä¸‹å¤§å¤§å€‘æå‡ºä¾†çš„æƒ³æ³•ä¸¦ä¸”èˆ‡è‡ªå·±ç›®å‰çš„é€²ä¿®æ–¹å¼åšçµåˆ, ä¸»è¦æœƒä»¥Full-Stack engineerçš„ç²¾é€²æ–¹å¼ä¾†åšå€‹ç´€éŒ„åˆ†äº«.","text":"æœ€è¿‘å‰›å¥½åœ¨Backendç‰ˆä¸Šçœ‹åˆ°æœ‰äººPoæ–‡å•èªª: â€œä¸‹ç­å¾Œè¦å¦‚ä½•ç²¾é€²è‡ªä¿®â€, æ„å¤–çœ‹åˆ°è¨±å¤šå¤§å¤§å€‘åœ¨ä¸‹é¢ç•™è¨€, æ­£å¥½æœ€è¿‘æˆ‘ä¹Ÿåœ¨æ€è€ƒè¦å¦‚ä½•ç²¾é€²è‡ªå·±, æ‰€ä»¥è¶é€™æ©Ÿæœƒä¾†çµ±æ•´ä¸€ä¸‹å¤§å¤§å€‘æå‡ºä¾†çš„æƒ³æ³•ä¸¦ä¸”èˆ‡è‡ªå·±ç›®å‰çš„é€²ä¿®æ–¹å¼åšçµåˆ, ä¸»è¦æœƒä»¥Full-Stack engineerçš„ç²¾é€²æ–¹å¼ä¾†åšå€‹ç´€éŒ„åˆ†äº«. å¦‚æœå°æŸç¨‹å¼èªè¨€&amp;æ¡†æ¶æŒæ¡åº¦é‚„ä¸å¤ , è«‹å…ˆç†Ÿæ‚‰ä¹‹ï¼å¦‚æœä¸Šç­æ¥è§¸åˆ°æŸç¨®è‡ªå·±ä¸ç†Ÿæ‚‰çš„èªè¨€æˆ–æ¡†æ¶, åƒæˆ‘ç›®å‰éœ€è¦å¯«Java &amp; Spring, èˆ‡Angular &amp; Typescript. æ‰€ä»¥æˆ‘æœƒåå¥½å…ˆåˆ°ç·šä¸Šç¨‹å¼èªè¨€ç·šä¸Šå¹³å°é€²ä¿®ä¹‹, å› ç‚ºé€™äº›å­¸ç¿’å¹³å°èƒ½å¤ æä¾›å®Œæ•´çš„å­¸ç¿’è¼ªå»“, èƒ½å¤ è®“æˆ‘å¿«é€ŸæŒæ¡è©²ç¨‹å¼èªè¨€&amp;æ¡†æ¶æ‰€éœ€å…·å‚™çš„ç¡¬çŸ¥è­˜ç‚ºä½•. èªªåˆ°ç·šä¸Šç¨‹å¼å­¸ç¿’å¹³å°, æˆ‘è »æ¨è–¦ Pluralsight, å› ç‚ºè©²å¹³å°æä¾›äº†è©²ç¨‹å¼èªè¨€æˆ–æ¡†æ¶æ¨è–¦å­¸ç¿’çš„å½±ç‰‡, ä¸¦ä¸”é€éæ¸¬é©—æ¨ä¼°ä½ å°è©²æŠ€è¡“çš„çŸ¥è­˜ç¨‹åº¦ç‚ºä½•. æœ‰èˆˆè¶£å¯ä»¥åˆ°è©²å¹³å°è©¦è©¦çœ‹, ä¸éæ¯å€‹æœˆæœƒæ”¶å–29ç¾å…ƒçš„èŠ±è²», ä¸éé€™èŠ±è²»ç•¶ä½œæŠ•è³‡æ˜¯è »å€¼å¾—çš„. è‹¥å·²ç¶“å°ç¨‹å¼èªè¨€&amp;æ¡†æ¶æœ‰ç¶“é©—, å¯ä»¥å˜—è©¦çœ‹çœ‹Side Projectç‚ºä»€éº¼æœƒç‰¹åœ°æåˆ°Side Project?? é‚£æ˜¯å› ç‚ºåœ¨å…¬å¸å…¶å¯¦å¾ˆé›£è‡ªå·±èƒ½å¤ è² è²¬å°ˆæ¡ˆçš„æ‰€æœ‰å…¨è²Œ, ä¾‹å¦‚å¯èƒ½åªæ˜¯è² è²¬å¯«API, ä¹Ÿå¯èƒ½åªè² è²¬å‰ç«¯é é¢çš„åˆ»ç•«. æ‰€ä»¥é€éSide Project, ä¾¿èƒ½å¤ æœ‰æ©Ÿæœƒå˜—è©¦æ‰€æœ‰æŠ€è¡“çš„æ©Ÿæœƒ, ä¸¦ä¸”å¾ä¸­å»é«”æœƒåˆ°è‡ªå·±æœ€æƒ³è¦åŠ å¼·çš„é ˜åŸŸæ˜¯å“ªé‚Š, ä¾‹å¦‚å¾Œç«¯æ•ˆèƒ½? å‰ç«¯æ¸²æŸ“é€Ÿåº¦? Container, CI/CDçš„é‹ä½œ? è«¸å¦‚æ­¤é¡, å¾è€ŒåŸ¹é¤Šä¸€å€‹Full-Stackçš„ç¶“é©—. æ‰€ä»¥ä¸‹ç­å¾Œè‡ªå·±è·‘ä¸€å€‹Side Projectæ˜¯å€‹ä¸éŒ¯çš„ç²¾é€²æ–¹å¼. ä½†è¦æ€éº¼æ¨£æƒ³å‡ºä¸€å€‹Side Project?æˆ‘è¦ºå¾—å­¸ç¿’æœ€å¿«çš„æ–¹å¼å°±æ˜¯æ¨¡ä»¿, å¯ä»¥åˆ°Githubä¸Šæœå°‹æœ‰èˆˆè¶£çš„å°ˆæ¡ˆ, ä¸¦ä¸”è©¦è‘—ç”¨è‡ªå·±çš„ç¨‹å¼èªè¨€èˆ‡æ¡†æ¶è‡ªå·±åšå‡ºä¸€å¥—æ˜¯æœ€å¿«çš„æ–¹å¼. åƒæˆ‘å› ç‚ºå¾ˆå–œæ­¡ç”¨Markdownæ–¹å¼ä¾†åšç­†è¨˜, ç›®å‰æ‰“ç®—è‡ªå·±åšå€‹å°å‹çš„ç·šä¸Šç­†è¨˜ç·¨è¼¯ç³»çµ±, ä¸¦çœ‹åˆ°Githubä¸Šæœ‰æä¾›CodiMD çš„é–‹æºå°ˆæ¡ˆå¯åƒè€ƒ,ä¾†è©¦è‘—è‡ªå·±å»ºé€ å‡ºä¸€å€‹çœ‹çœ‹. ä¹‹å¾Œæœ‰æ©Ÿæœƒå†åˆ†äº«åˆ°è‡ªå·±çš„éƒ¨è½æ ¼ä¸Šæ€éº¼ä¸€æ­¥ä¸€æ­¥é€²è¡Œçš„. å˜—è©¦æ’°å¯«ç·šä¸Šç­†è¨˜æˆ–éƒ¨è½æ ¼å§æˆ‘èªç‚ºç¾åœ¨æŠ€è¡“çœŸçš„å¤ªå¤šå¤ªå¤šäº†, å¦‚æœæ²’æœ‰å°‡è‡ªå·±çœ‹éçš„æŠ€è¡“æ–‡ç« æˆ–å­¸ç¿’å½±ç‰‡çµ¦æ¶ˆåŒ–å’Œè¨˜éŒ„èµ·ä¾†, å¾ˆå¿«å°±åˆæœƒå¿˜è¨˜. æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯æœ‰å€‹åšç­†è¨˜çš„ç¿’æ…£! åšç­†è¨˜çš„è©±æˆ‘éƒ½æ˜¯ç”¨Hackmdå…ˆè¨˜éŒ„èµ·ä¾†, ä¹‹å¾Œç­‰æœ‰ç©ºçš„æ™‚é–“æœƒå†æ¶ˆåŒ–å¯©è¦–è‡ªå·±å¯«éçš„å…§å®¹, ä¸¦ç™¼ä½ˆåˆ°è‡ªå·±çš„Blogerä¸Š, é€™æ¨£æœ‰åŠ©æ–¼å°‡å­¸ç¿’éçš„çŸ¥è­˜çµ¦å…§åŒ–åˆ°è‡ªå·±çš„è…¦æµ·ä¸­. å…¶ä»–æ›´é€²éšçš„é€²ä¿®æ–¹æ³•æ ¹æ“šæŠ€èƒ½æ¨¹(RoadMap)ä¾†è£œå……è‡ªå·±æœ€å¸¸ç”¨,æœ‰èˆˆè¶£ä½†æ‰€ç¼ºä¹çš„è§€å¿µèˆ‡æŠ€è¡“é€™ç¶²ç«™Roadmapæä¾›äº†å„é–‹ç™¼è€…(Frontend, Backend, DevOps)æ‰€éœ€è¦å…·å‚™çš„æŠ€èƒ½æ¨¹ç‚ºä½•, è‹¥æƒ³è¦å¾€å¾Œç«¯ç²¾é€², å¯ä»¥çœ‹åˆ°ä¸‹é¢é€™å¼µåœ–æœƒç¢°åˆ°å“ªäº›æ‰€éœ€å…·å‚™çš„èƒ½åŠ›. çœ‹å®Œä¹‹å¾Œæœƒç™¼è¦ºæœ‰å¤ªå¤šæ±è¥¿éœ€è¦Coveräº†, å­¸æµ·ç„¡æ¶¯ (èŒ¶). ç¶“ç‡Ÿ Stackoverflowé€™é»æ˜¯æˆ‘çœ‹åˆ°å¤§å¤§å€‘æå‡ºä¾†å¯ä»¥å˜—è©¦çš„æ–¹å¼, ä¸éæˆ‘ç›®å‰ä¹Ÿåªæœ‰åœ¨Stackoverflowä¸Šé¢å•å¹¾å€‹å°å•é¡Œ, å°é€™æ–¹é¢é‚„æ²’æœ‰æ¶‰ç•¥, å¯åƒè€ƒä¸‹é¢å¤§å¤§æ‰€å¯«çš„Stackoverflowçš„ä»‹ç´¹, æœªä¾†æˆ‘æœƒæƒ³åœ¨é€™é‚Šå˜—è©¦çœ‹çœ‹èƒ½ä¸èƒ½ä¹Ÿè©¦è‘—å›ç­”åˆ¥äººé‡åˆ°çš„å•é¡Œ. å·¥ç¨‹å¸«é›éŠæ¥è»Œä¸–ç•Œçš„èƒ½åŠ›å¾stackoverflow é–‹å§‹ - é˜¿è²å¥½å¨çš„å¯¦é©—å®¤ å°çµä¸‹ç­å¾Œè¦å†è‡ªä¿®çœŸçš„éœ€è¦æœ‰èˆˆè¶£ä½¿ç„¶ä»¥åŠå¼·å¤§çš„æ¯…åŠ›, å¦å‰‡å¾ˆå®¹æ˜“å°±æœƒåŠé€”è€Œå»¢. æ‰€ä»¥æœ€é‡è¦çš„é‚„æ˜¯è¦è®“è‡ªå·±æœ‰å€‹è¦åŠƒ, ä¸¦ä¸”å¾å¯¦è¸è¦åŠƒä¸­å…§åŒ–æˆè‡ªå·±çš„æ—¥å¸¸ç¿’æ…£, ä¹…è€Œä¹…ä¹‹å°±æœƒè®“è‡ªå·±è®Šå¾—æ›´å¼·çš„ï¼","categories":[{"name":"Life","slug":"Life","permalink":"http://a10000005588.github.io/categories/Life/"}],"tags":[{"name":"Mindset","slug":"Mindset","permalink":"http://a10000005588.github.io/tags/Mindset/"}]},{"title":"Spring Security åŠŸèƒ½ä»‹ç´¹","slug":"Spring-Securityä»‹ç´¹","date":"2020-04-11T13:34:23.000Z","updated":"2020-08-03T14:32:05.404Z","comments":true,"path":"2020/04/11/Spring-Securityä»‹ç´¹/","link":"","permalink":"http://a10000005588.github.io/2020/04/11/Spring-Securityä»‹ç´¹/","excerpt":"Spring Security åŠŸèƒ½ä»‹ç´¹å…ˆä»‹ç´¹ä»¥ä¸‹å¸¸ç”¨èªè­‰åŠŸèƒ½","text":"Spring Security åŠŸèƒ½ä»‹ç´¹å…ˆä»‹ç´¹ä»¥ä¸‹å¸¸ç”¨èªè­‰åŠŸèƒ½ User name / password åŸºæœ¬èªè­‰ä½¿ç”¨ä½¿ç”¨è€…åç¨±/å¯†ç¢¼åšé©—è­‰ SSO / Okta / LDAPSSO (Single Sign On)ç‚ºOAuthçš„è¿‘ä¸€æ­¥å¯¦ç¾ï¼Œè‹¥å·²ç¶“é€éGoogleå–å¾—token, å°±å¯ä»¥åœ¨å…¶ä»–æœå‹™çš„å°ç¶²ç«™ï¼Œéƒ½ä½¿ç”¨Googleæä¾›çš„èº«ä»½é©—è­‰æœå‹™ Oktaå”åŠ©éç‡Ÿåˆ©çµ„ç¹”çš„æ–¹å¼ã€‚å¾åŸºæœ¬çš„å–®ä¸€ç™»å…¥ï¼ˆsingle sign-onï¼Œç°¡ç¨±ç‚º SSOï¼‰åˆ°é€²éšçš„èº«ä»½èªè­‰å’Œå­˜å–æ¬Šé™çš„ç®¡ç†æ–¹æ¡ˆ LDAP (Lightweight Directory Access Protocol)ç‚ºä¸€ç¨®è¼•é‡çš„ç›®éŒ„æœå‹™å”å®šï¼Œåƒæ˜¯é€šè¨ŠéŒ„ä¸€æ¨£ç´€éŒ„äººå“¡è³‡è¨Šï¼Œå¯ä»¥æ‹¿ä¾†åšå¸³è™Ÿæ•´åˆ,é©—è­‰ã€‚ LDAPç›®éŒ„æœå‹™é€šå¸¸æœ‰å±¤ç´šçµæ§‹ï¼Œåƒæ˜¯å…¬å¸çµ„ç¹”éšå±¤ OAuth (Intra App Authorization)OAuthè®“ç”¨æˆ¶å¯ä»¥æˆæ¬Šç¬¬ä¸‰æ–¹ç¶²ç«™å­˜å–ä»–å€‘åœ¨å¦å¤–æœå‹™æä¾›è€…(ex: Facebook, Line)çš„æŸäº›ç‰¹å®šè³‡è¨Šï¼Œè€Œéæ‰€æœ‰å…§å®¹ã€‚ ç‚ºä»€éº¼æœ‰OAuthå‡ºç¾ï¼Ÿå› ç‚ºå„å€‹ç¶²ç«™éƒ½åšæœƒå“¡æ©Ÿåˆ¶å¾ˆéº»ç…©ï¼Œä¸”å°ç¶²ç«™å¯èƒ½æœ‰è³‡å®‰é¢¨éšªã€‚ æ•…å¤§ç¶²ç«™åƒæ˜¯Facebook, Lineæ—©å·²ç¶“åšå¥½è¶…ç´šå®‰å…¨çš„æœƒå“¡ç®¡ç†æ©Ÿåˆ¶ï¼Œå¤§ç¶²ç«™å¹«ä½ ç®¡ç†å€‹è³‡ï¼Œæä¾›ç™»å…¥çš„æœå‹™ã€‚ ä½†æä¾›é€™æ¨£æœå‹™çš„å¤§å» è¶Šä¾†è¶Šå¤šï¼Œè‹¥å°ç¶²ç«™åŒæ™‚è¦æä¾›ç”¨æˆ¶é€£çµåˆ°å¤šå€‹æœ‰æä¾›èº«åˆ†æœå‹™çš„å¤§ç¶²ç«™æœƒè®Šå¾—å¾ˆè¤‡é›œï¼Œæ–¼æ˜¯å°±è¨‚å®šçš„å·¥æ¥­æ¨™æº–ï¼šOAuth. åŠŸèƒ½ é€²å…¥å°ç¶²ç«™ -&gt; è·³è½‰åˆ°å¤§ç¶²ç«™ç™»å…¥ç•«é¢ -&gt; ç™»å…¥æˆåŠŸå¤§ç¶²ç«™çµ¦äºˆä¸€å€‹æœ‰æ™‚æ•ˆçš„token çµ¦å°ç¶²ç«™ -&gt; å°ç¶²ç«™é€étokenè·Ÿå¤§ç¶²ç«™ç´¢å–ç”¨æˆ¶çš„è³‡è¨Š (é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æ¯æ¬¡ç™»å…¥ç¬¬ä¸‰æ–¹éƒ½æœƒè©¢å•ä½ æ˜¯å¦è¦æ­éœ²ä»¥ä¸‹è³‡è¨Šçµ¦å°ç¶²ç«™) ä¸éä¸€èˆ¬å°ç¶²ç«™â€ç„¡æ³•â€ç›´æ¥å–å¾—token, è€Œæ˜¯å–å¾—ä¸€å€‹code, å†ç”¨é€™å€‹codeå‘å¤§ç¶²ç«™æ›å¾—ä¸€å€‹token(å¤šé€™é“æ‰‹çºŒçš„åŸå› æ˜¯å› ç‚ºï¼ŒInternetå¯èƒ½æœƒè¢«è·¯ä¸Šç¶“æ‰‹çš„routeræˆ–å…¶ä»–è¨­å‚™æ“·å–,å½é€ ,è®Šæ›´) å¯¦éš›æƒ…æ³åœ¨ Line Loginæ™‚, Line Notifyä¸­ï¼Œçµ„å‡ºä¸€å€‹URLï¼Œå–å¾—Authorization Code, é€™ä¸€æ®µå–å¾—çš„Codeç‚ºæ˜ç¢¼, èµ°çš„æ˜¯http getï¼Œé€éç€è¦½å™¨ç¶²å€åˆ—ä¾†å‚³é (è‹¥æ²’æœ‰ç”¨SSLå‚³éçš„è©±ï¼Œæœƒè¢«ä»»ä½•äººæ“·å–çœ‹åˆ°). æ¥ä¸‹ä¾†å°ç¶²ç«™å–å¾—Authorization Codeå¾Œï¼Œåœ¨é€éhttp postï¼Œå¾å¾Œç«¯è·Ÿå¤§ç¶²ç«™æ›å¾—token (å› ç‚ºèµ°å¾Œç«¯ å¤§ç¶²ç«™å°±çŸ¥é“å°ç¶²ç«™çš„èº«ä»½å’Œæ‰€æ‹¿çš„code) :::warningOAuthä¸»è¦åŠŸèƒ½æ˜¯æˆæ¬Šï¼Œä¸æ˜¯èªè­‰ï¼Œæ‰€ä»¥å¾Œä¾†æ‰å»¶ä¼¸å‡ºOpenID Connect (OIDC)ä¾†æä¾›èªè­‰ç”¨ã€‚::::::infoAuthentication æª¢æŸ¥ç™¼é€æª¢æŸ¥äººçš„èº«ä»½æ˜¯èª°ã€æ˜¯å¦åˆæ ¼;Authorization å‰‡æ˜¯è¦ç¯„ä½¿ç”¨è€…æ¬Šé™çš„è¦å‰‡ï¼Œè¦å®šå“ªäº›èƒ½åšã€å“ªäº›ä¸èƒ½ å› æ­¤å¦‚æœè©² Request æœªå¸¶ token æˆ–æ˜¯ token éæœŸã€ä¸åˆæ³•çš†ç®—æ˜¯ Authentication Error ï¼Œè·Ÿ http status code çš„ 401 æ„æ€ä¸€æ¨£ ; å¦‚æœ Request çš„ token èªè­‰æˆåŠŸä½†æ˜¯è©²ä½¿ç”¨è€…çš„æ¬Šé™ä¸è¶³ä»¥åŸ·è¡Œè©² Request å‰‡æ˜¯ Forbidden Error (å³ å›  Authorization ç™¼ç”Ÿçš„éŒ¯èª¤) ï¼Œå¦‚ http status code çš„ 403 æ„æ€ç›¸åŒã€‚ ::: :::successå–®ç´”ç”¨å¤§ç¶²ç«™çš„OAuthç•¶è‡ªå·±çš„æœƒå“¡ç³»çµ±é‚„æ˜¯æœ‰å¾ˆå¤§çš„å•é¡Œæœ€æ˜é¡¯çš„æ˜¯ç•¶ä½¿ç”¨è€…åŒæ™‚æœ‰Google èˆ‡ Facebookçš„å¸³è™Ÿæ™‚å…©å€‹å¸³è™Ÿä¸Šé¢çš„Emailå¯èƒ½ä¸æ˜¯ä¸€æ¨£çš„è‡ªå·±çš„ç¶²ç«™å¾ˆå¯èƒ½ç„¡æ³•è¾¨èªé€™æ˜¯åŒä¸€å€‹äººçš„å¸³æˆ¶æ‰€ä»¥ä¸€èˆ¬é‚„æ˜¯æœƒéœ€è¦è‡ªå·±çš„æœƒå“¡ç³»çµ±åšæ•´åˆ::: Microservice security (using tokens, JWT)JWT (JSON web token): JWTåŸºæ–¼JSONçš„é–‹æ”¾æ¨™æº– (RFC 7519) è¢«ç”¨åœ¨èº«ä»½æä¾›è€…å’Œæœå‹™æä¾›è€…é–“å‚³éï¼Œè¢«èªè­‰çš„ç”¨æˆ¶èº«ä»½è¨Šæ¯ å¯é¡å¤–å¢åŠ è²æ˜è¨Šæ¯ï¼Œè©²JWT tokenå¯ä»¥ç›´æ¥è¢«ç”¨æ–¼èªè­‰(Authorization)ï¼Œä¹Ÿå¯è¢«åŠ å¯† ç‰¹åˆ¥é©ç”¨æ–¼SSO JWT èˆ‡ Sessionå·®åˆ¥ï¼šSession:ç”±æ–¼httpå”è­°ç‚ºstateless,ç„¡æ³•çŸ¥é“æ¯æ¬¡requestæ˜¯èª°ï¼Œä½†æ¯æ¬¡requestè‹¥éƒ½è¦å¸³è™Ÿå¯†ç¢¼å¾ˆéº»ç…© æ•…ç”¨æˆ¶ç¬¬ä¸€æ¬¡ç™¼Requestæ™‚ï¼Œå°±ç”¢ç”Ÿä¸€çµ„tokenç´€éŒ„åœ¨dbèˆ‡session, ä¸¦å°‡tokençµ¦ç”¨æˆ¶ï¼Œå‘Šè¨´ç”¨æˆ¶å°‡tokenå­˜åœ¨cookieï¼Œç•¶ä¸‹æ¬¡ç™¼é€requestæ™‚ï¼Œé€étokenè­‰æ˜è‡ªå·±èº«ä»½ã€‚ JWTçµ„æˆå…§å®¹æœ‰ä¸‰å€‹éƒ¨åˆ†(Header, Paylaod,Signature)ä¸¦ç”±. åšå€éš”ï¼Œæœ€å¾Œé€éé€™ä¸‰å€‹éƒ¨åˆ†ï¼Œä¸²æˆä¸€å€‹ Jwt å­—ä¸² Header: 1234&#123; &apos;typ&apos;: &apos;JWT&apos;, # è²æ˜é¡å‹ &apos;alg&apos;: &apos;HS256&apos; # åŠ å¯†çš„æ–¹æ³•: HMACã€SHA256ã€RSA é€²è¡Œ Base64 ç·¨ç¢¼&#125; Payload: æ”¾è²æ˜å…§å®¹ï¼Œå¯ä»¥èªªå°±æ˜¯å­˜æ”¾æºé€šè¨Šæ¯çš„åœ°æ–¹ åœ¨å®šç¾©ä¸Šæœ‰ 3 ç¨®è²æ˜ (Claims) Reserved (è¨»å†Šè²æ˜) Public (å…¬é–‹è²æ˜) Private (ç§æœ‰è²æ˜) è¨»å†Šè²æ˜åƒæ•¸ (å»ºè­°ä½†ä¸å¼·åˆ¶ä½¿ç”¨) iss (Issuer) - jwtç°½ç™¼è€… sub (Subject) - jwtæ‰€é¢å‘çš„ç”¨æˆ¶ aud (Audience) - æ¥æ”¶jwtçš„ä¸€æ–¹ exp (Expiration Time) - jwtçš„éæœŸæ™‚é–“ï¼Œé€™å€‹éæœŸæ™‚é–“å¿…é ˆè¦å¤§æ–¼ç°½ç™¼æ™‚é–“ nbf (Not Before) - å®šç¾©åœ¨ä»€éº¼æ™‚é–“ä¹‹å‰ï¼Œè©²jwtéƒ½æ˜¯ä¸å¯ç”¨çš„ iat (Issued At) - jwtçš„ç°½ç™¼æ™‚é–“ jti (JWT ID) - jwtçš„å”¯ä¸€èº«ä»½æ¨™è­˜ï¼Œä¸»è¦ç”¨ä¾†ä½œç‚ºä¸€æ¬¡æ€§token,å¾è€Œè¿´é¿é‡æ”¾æ”»æ“Š 12345&#123; &quot;sub&quot;: &quot;1234567890&quot;, &quot;name&quot;: &quot;John Doe&quot;, &quot;iat&quot;: 1516239022&#125; Signature: ç”±ä¸‰å€‹éƒ¨åˆ†çµ„æˆ header (base64å¾Œçš„) payload (base64å¾Œçš„) secret 1HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), &apos;secret&apos;) :::warningsecret è¦ä¿å­˜åœ¨ server ç«¯ï¼Œjwt çš„ ç°½ç™¼é©—è­‰éƒ½å¿…é ˆä½¿ç”¨é€™å€‹ secretï¼Œç•¶å…¶ä»–äººå¾—çŸ¥é€™å€‹ secretï¼Œé‚£å°±æ„å‘³è‘—å®¢æˆ¶ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç°½ç™¼ jwt ï¼Œå› æ­¤åœ¨ä»»ä½•å ´æ™¯éƒ½ä¸æ‡‰è©²å¤–æµ::: æœ€å¾Œå°‡ Header, Payload, Signatureåšbase64ç·¨ç¢¼ï¼Œçµ„æˆ ä½¿ç”¨çš„æ™‚å€™ï¼Œåœ¨reqeustçš„headeråŠ ä¸Š Authorization: Bearer &lt;token&gt; 12345post(&apos;api/user/1&apos;, &#123; headers: &#123; &apos;Authorization&apos;: &apos;Bearer &apos; + token &#125;&#125;) JWT å‰å¾Œç«¯äº’å‹•ç¤ºæ„åœ– JWTå„ªé» è·¨èªè¨€ï¼Œå› ç‚º json æ ¼å¼å¤§éƒ¨åˆ†èªè¨€éƒ½å¯ä½¿ç”¨ å¯å„²å­˜ä¸€äº›ç°¡å–®ä½†éæ•æ„Ÿçš„å•†æ¥­é‚è¼¯ - role .. æ§‹æˆå…§å®¹ç°¡å–®ï¼Œä½”ç”¨ Size å°æ–¹ä¾¿å‚³è¼¸ !!! ä¸éœ€åœ¨ server ä¿å­˜ sessionï¼Œæ‰€ä»¥å®ƒæ˜“æ–¼æ‡‰ç”¨çš„æ“´å±• Spring Security æ•™å­¸è¦–é »Spring Boot + Spring Security + JWT from scratch - Java Brainshttps://www.youtube.com/watch?v=X80nJ5T7YpE åƒè€ƒè³‡æºï¼šOkta å¦‚ä½•å”åŠ©éç‡Ÿåˆ©çµ„ç¹”-å¾ 25 å€‹å…è²»çš„æˆæ¬Šé–‹å§‹https://www.techsoup-taiwan.org.tw/okta LDAP ç°¡ä»‹https://poychang.github.io/ldap-introduction/ ä¸€æ¬¡ææ‡‚OAuthèˆ‡SSOåœ¨å¹¹ä»€éº¼?http://studyhost.blogspot.com/2017/01/oauthsso.html GraphQL è¨­è¨ˆï¼š Autentication èˆ‡ Authorization å¤§å…¨https://ithelp.ithome.com.tw/articles/10208278 JSON Web Token(JWT) ç°¡å–®ä»‹ç´¹https://mgleon08.github.io/blog/2018/07/16/jwt/ What is Spring Security really all about? Java Brains Brain Bytes https://www.youtube.com/watch?v=sm-8qfMWEV8&amp;list=PLqq-6Pq4lTTYTEooakHchTGglSvkZAjnE","categories":[{"name":"Spring","slug":"Spring","permalink":"http://a10000005588.github.io/categories/Spring/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"http://a10000005588.github.io/tags/Spring/"},{"name":"Authentication","slug":"Authentication","permalink":"http://a10000005588.github.io/tags/Authentication/"}]},{"title":"Spring Annotationç­†è¨˜æ•´ç†","slug":"Spring-Annotationä»‹ç´¹","date":"2020-03-10T14:13:00.000Z","updated":"2020-08-01T02:39:49.090Z","comments":true,"path":"2020/03/10/Spring-Annotationä»‹ç´¹/","link":"","permalink":"http://a10000005588.github.io/2020/03/10/Spring-Annotationä»‹ç´¹/","excerpt":"Spring Annotation ç­†è¨˜é€™é‚Šä¸»è¦æ•´ç†äº†æˆ‘ä½¿ç”¨æˆ–æ˜¯é‡åˆ°çš„Spring Annotationè³‡æ–™æŸ¥è©¢èˆ‡çµ±æ•´çš„ç´€éŒ„","text":"Spring Annotation ç­†è¨˜é€™é‚Šä¸»è¦æ•´ç†äº†æˆ‘ä½¿ç”¨æˆ–æ˜¯é‡åˆ°çš„Spring Annotationè³‡æ–™æŸ¥è©¢èˆ‡çµ±æ•´çš„ç´€éŒ„ API ç›¸é—œ @Annotation@RestControllerå°‡classè¨­ç½®ç‚ºå¤–éƒ¨æ§åˆ¶å™¨ @RestControllerAdviceç­‰åŒæ–¼@ControllerAdvice + @ResponseBody @ControllerAdviceç‚ºå¯åœ¨å®£å‘Šçš„å‡½å¼ä¸­ä½¿ç”¨@ExceptionHandler, @InitBinderæˆ– @ModelAttributeè¨»è§£çš„æ–¹æ³• @ExceptionHandleræ””æˆªæ‰€æœ‰æ§åˆ¶å™¨æ‰€ç™¼å‡ºçš„exceptionï¼Œä¸¦è¿”å›bodyå‹å¼ @RequestMappingæ§åˆ¶å™¨è£¡é¢çš„æ–¹æ³•ï¼Œä½¿ä¹‹æˆç‚ºå¤–éƒ¨è«‹æ±‚ è‹¥è¦è¨­ç½®GET method, å¦‚ä¸‹(ä¹Ÿå¯ä»¥æ”¹æˆ POST, PUT, DELETE) å®šç¾©ä¸€çµ„restful apiå‰ç¶´è·¯ç”±ex : @RequestMapping(â€œ/api/v1â€) 1234567@RequstMapping(\"/api/v1\")public class hello &#123; @GetMapping(\"/hello\") public hello()&#123; return \"helloworld\"; &#125;&#125; è¦ä½¿ç”¨çš„è©±å¾—åœ¨postmanä¸­ç”¨ /api/v1/hello HTTPå‹•ä½œAnnotation@PostMapping@GetMapping@PutMapping@DeleteMapping@RequestBodyå¯ä»¥æ¥æ”¶Bodyåƒæ•¸ï¼Œå¾—é€éclasså®£å‘Šä¸€çµ„objectä¾†æ¥æ”¶ 123456789101112131415class Car &#123; private String type; private Integer number; public setType(String type) &#123; this.type = type; &#125; public setNumber(Integer number) &#123; this.number = number; &#125; public getType... public getNumber...&#125; 1234567@RequestMapping(\"/api/v1\")public class CarController&#123; // é€éå®£å‘Šä¸€å€‹carï¼Œä¾†æ¥æ”¶Bodyçš„å€¼ (type, number) @GetMapping(\"/car\") function getCar(@RequestBody Car car);&#125; @RequestHeaderã€@CookieValueè™•ç†request headeréƒ¨åˆ†çš„æ³¨è§£ï¼š Request Headerçš„å…§å®¹123456Host localhost:8080 Accept text/html,application/xhtml+xml,application/xml;q=0.9 Accept-Language fr,en-gb;q=0.7,en;q=0.3 Accept-Encoding gzip,deflate Accept-Charset ISO-8859-1,utf-8;q=0.7,*;q=0.7 Keep-Alive 300 é€é @RequestHeader(â€œâ€)æ¥å—å…¶Headerå€¼1234@RequestMapping(&quot;/displayHeaderInfo.do&quot;) public void displayHeaderInfo(@RequestHeader(&quot;Accept-Encoding&quot;) String encoding, @RequestHeader(&quot;Keep-Alive&quot;) long keepAlive) &#123; &#125; @SessionAttributesè©²è¨»è§£ç”¨ä¾†ç¶å®šHttpSessionä¸­çš„attributeå°è±¡çš„å€¼ï¼Œä¾¿æ–¼åœ¨æ–¹æ³•ä¸­çš„åƒæ•¸é‡Œä½¿ç”¨ã€‚ è©²è¨»è§£æœ‰valueã€typeså…©å€‹å±¬æ€§ï¼Œå¯ä»¥é€šéåå­—å’Œé¡å‹æŒ‡å®šè¦ä½¿ç”¨çš„attribute å°è±¡ï¼› 123456@Controller @RequestMapping(\"/editPet.do\") @SessionAttributes(\"pet\") public class EditPetForm &#123; // ... &#125; åƒè€ƒè³‡æ–™:Spring MVCå¸¸ç”¨æ³¨è§£@PathVariableã€@RequestHeaderã€@CookieValueã€@RequestParamã€@RequestBodyã€@SessionAttributesã€@ModelAttribute https://www.cnblogs.com/EasonJim/p/8323017.html @JsonProperty (é‡é»ï¼Œé‡åˆ°æ¥ä¸åˆ°requestçš„å€¼ï¼Œç”¨é€™å°±å°äº†)ç”¨ä¾†æ¥æ”¶application/jsonä¸­ï¼Œæœ‰å¤§å°ä¸ä¸€å‹åˆ¥çš„è®Šæ•¸ ex: Postman script1234567&#123; \"contact\":&#123; \"cPhone\":\"0912345678\", \"cMail\":\" abc@test.com.tw \", \"cAddress\":\"å°åŒ—å¸‚ä¸­æ­£å€ä¿¡ç¾©è·¯ä¸€æ®µ21-3è™Ÿ\" &#125;,...&#125; è‹¥è¦æ¥åˆ° PHONEæˆ–Websiteï¼Œéœ€è¦å®šç¾© @JsonProperty(â€œPHONEâ€), @JsonProperty(â€œWebsiteâ€) 123456789101112131415161718@Datapublic class Lia201iReqDTO &#123; contactDto contact; @Data @AllArgsConstructor @NoArgsConstructor public static class contactDto &#123; @NotNull @JsonProperty(\"cPhone\") String cPhone; @JsonProperty(\"cMail\") String cMail; @JsonProperty(\"cAddress\") String cAddress; &#125;&#125; åƒè€ƒè³‡æ–™Spring REST consuming JSON uppercase vs lowercasehttps://stackoverflow.com/questions/26890398/spring-rest-consuming-json-uppercase-vs-lowercase é©—è­‰ç›¸é—œçš„Annotation@Validèˆ‡@Validatedè² è²¬é©—è­‰æœ‰è¢«å®šç¾©æ ¡æ­£çš„åƒæ•¸æˆ–object å…ˆç”¢ç”Ÿè¦æ ¡æ­£çš„å¯¦é«”é¡(class)1234567891011121314151617public class Foo &#123; @NotBlank private String name; @Min(18) private Integer age; @Pattern(regexp = \"^1(3|4|5|7|8)\\\\d&#123;9&#125;$\",message = \"æ‰‹æœºå·ç æ ¼å¼é”™è¯¯\") @NotBlank(message = \"æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º\") private String phone; @Email(message = \"é‚®ç®±æ ¼å¼é”™è¯¯\") private String email; //... getter setter&#125; æ–¼@Controllerä¸­ ä½¿ç”¨Validåšæ ¡æ­£ 12345678910111213141516@Controllerpublic class FooController &#123; // å°Foo classç”¢ç”Ÿçš„fooåšæ ¡æ­£ @RequestMapping(&quot;/foo&quot;) public String foo(@Validated Foo foo &lt;1&gt;, BindingResult bindingResult &lt;2&gt;) &#123; if(bindingResult.hasErrors())&#123; for (FieldError fieldError : bindingResult.getFieldErrors()) &#123; //... &#125; return &quot;fail&quot;; &#125; return &quot;success&quot;; &#125;&#125; @Validate èˆ‡ @Validå·®ç•°@Validèƒ½é€²è¡ŒåµŒå¥—é©—è­‰ï¼Œ @Validateä¸è¡Œ å› ç‚º@Validèƒ½åŠ åœ¨æˆå“¡å±¬æ€§ä¸Šï¼Œåè€Œ@Validatedä¸èƒ½ç”¨åœ¨æˆå“¡å±¬æ€§ã€‚ èˆ‰ä¾‹ï¼š12345678910public class Item &#123; @NotNull(message = \"idä¸èƒ½ç‚ºç©ºå€¼\") @Min(value = 1, message = \"idå¿…é ˆç‚ºæ­£æ•´æ•¸\") private Long id; @NotNull(message = \"propsä¸èƒ½ç‚ºç©ºç›´\") @Size(min = 1, message = \"è‡³å°‘è¦æœ‰ä¸€å€‹å±¬æ€§\") private List&lt;Prop&gt; props;&#125; ç„¶è€Œ Prop classå¦‚ä¸‹12345678910111213141516public class Prop &#123; @NotNull(message = \"pidä¸èƒ½ç‚ºç©º\") @Min(value = 1, message = \"pidå¿…é ˆç‚ºæ­£æ•´æ•¸\") private Long pid; @NotNull(message = \"vidä¸èƒ½ç‚ºç©º\") @Min(value = 1, message = \"vidå¿…é ˆç‚ºæ­£æ•´æ•¸\") private Long vid; @NotBlank(message = \"pidNameä¸èƒ½ç‚ºç©º\") private String pidName; @NotBlank(message = \"vidNameä¸èƒ½ç‚ºç©º\") private String vidName;&#125; ç¾åœ¨æˆ‘å€‘æœ‰å€‹ItemControlleræ¥å—ä¸€å€‹Itemçš„åƒæ•¸ï¼Œæƒ³è¦å°Itemé€²è¡Œé©—è­‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678@RestControllerpublic class ItemController &#123; @RequestMapping(\"/item/add\") public void addItem(@Validated Item item, BindingResult bindingResult) &#123; doSomething(); &#125;&#125; åœ¨ä¸Šåœ–ä¸­ï¼Œå¦‚æœItemå¯¦é«”çš„propså±¬æ€§ä¸é¡å¤–åŠ è¨»é‡‹ï¼Œåªæœ‰@NotNullå’Œ@Sizeï¼Œç„¡è«–å…¥åƒæ¡ç”¨@Validatedé‚„æ˜¯@Validé©—è­‰ï¼ŒSpring Validationæ¡†æ¶åªæœƒå°Itemçš„idå’Œpropsåšéç©ºå’Œæ•¸é‡é©—è­‰ï¼Œä¸æœƒå°propså­—æ®µè£¡çš„Propå¯¦é«”é€²è¡Œå­—æ®µé©—è­‰ï¼Œä¹Ÿå°±æ˜¯@Validatedå’Œ@ValidåŠ åœ¨æ–¹æ³•åƒæ•¸å‰ï¼Œéƒ½ä¸æœƒè‡ªå‹•å°åƒæ•¸é€²è¡ŒåµŒå¥—é©—è­‰&lt;/ span&gt; :::infoé€™é‚ŠæŒ‡çš„åµŒå¥—(Nested)é©—è­‰ï¼ŒæŒ‡çš„æ˜¯è‹¥class Itemä¸­é‚„æœ‰ä¸€å€‹è®Šæ•¸List ä¸”é€™å€‹Propsçš„classå…§ä¹Ÿæœ‰è‡ªå·±å®šç¾©é©—è­‰@Notnull, @NotBlank, ä¸€å±¤classå…§é‚„æœ‰ä¸€å€‹classå®šç¾©è‡ªå·±çš„é©—è­‰ï¼Œå°±å«åšåµŒå¥—é©—è­‰::: è¦é€²è¡ŒåµŒå¥—é©—è­‰çš„è©±å¾—åœ¨ class Propsä¸­åŠ å…¥@Valid 1234567891011public class Item &#123; @NotNull(message = \"idä¸èƒ½ä¸ºç©º\") @Min(value = 1, message = \"idå¿…é¡»ä¸ºæ­£æ•´æ•°\") private Long id; @Valid // åµŒå¥—éªŒè¯å¿…é¡»ç”¨@Valid @NotNull(message = \"propsä¸èƒ½ä¸ºç©º\") @Size(min = 1, message = \"propsè‡³å°‘è¦æœ‰ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§\") private List&lt;Prop&gt; props;&#125; è£œå…… è² è²¬æ ¡é©—çš„Annotation12345678910111213141516171819@Null è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º null@NotNull è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆä¸ç‚º null@AssertTrue è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º true@AssertFalse è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç‚º false@Min(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å°å€¼@Max(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå°æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å¤§å€¼@DecimalMin(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å°å€¼@DecimalMax(value) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆå°æ–¼ç­‰æ–¼æŒ‡å®šçš„æœ€å¤§å€¼@Size(max=, min=) è¢«è¨»é‡‹çš„å…ƒç´ çš„å¤§å°å¿…é ˆåœ¨æŒ‡å®šçš„ç¯„åœå…§@Digits (integer, fraction) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹æ•¸å­—ï¼Œå…¶å€¼å¿…é ˆåœ¨å¯æ¥å—çš„ç¯„åœå…§@Past è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹éå»çš„æ—¥æœŸ@Future è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯ä¸€å€‹å°‡ä¾†çš„æ—¥æœŸ@Pattern(regex=,flag=) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆç¬¦åˆæŒ‡å®šçš„æ­£å‰‡è¡¨é”å¼@NotBlank(message =) é©—è­‰å­—ç¬¦ä¸²énullï¼Œä¸”é•·åº¦å¿…é ˆå¤§æ–¼0@Email è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆæ˜¯é›»å­éƒµç®±åœ°å€@Length(min=,max=) è¢«è¨»é‡‹çš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é ˆåœ¨æŒ‡å®šçš„ç¯„åœå…§@NotEmpty è¢«è¨»é‡‹çš„å­—ç¬¦ä¸²çš„å¿…é ˆéç©º@Range(min=,max=,message=) è¢«è¨»é‡‹çš„å…ƒç´ å¿…é ˆåœ¨åˆé©çš„ç¯„åœå…§ è£œå……: ç”¨BindingResultæ¥æ”¶@Validæ‹‹å‡ºä¾†çš„éŒ¯èª¤è¨Šæ¯å‡è¨­æœ‰é©—è­‰éŒ¯èª¤çš„ç‰©ä»¶ç‚º BindingResult bindingResultå¯é€ébindResultå–å¾—éŒ¯èª¤è³‡è¨Š èˆ‰ä¾‹: 123456789public class FlightDTO &#123; @NotBlank private String terminal; // èˆªå»ˆ @NotBlank private String type; // èˆªç­ç¨®é¡ @NotBlank private String carrier; // èˆªç©ºå…¬å¸ä»£ç¢¼ ...&#125; è‹¥ä½¿ç”¨@Validå°FlightDTOåšåƒæ•¸é©—è­‰ï¼Œå‡è¨­æœ‰ä¸€Requestå°‘è¼¸å…¥terminalè³‡è¨Šï¼Œå°±æœƒç™¼å‡ºbindingResultè¨Šæ¯ï¼Œå…¶ä¸­åŒ…å«ï¼š 12345678910List&lt;FieldError&gt; fieldErrors = bindingResult.getFieldErrors();for(FieldError fieldError: fieldErrors) &#123; // å°è£éŒ¯èª¤æ ¼å¼ FieldResource fieldResource = new FieldResource( fieldError.getObjectName(), // å–å¾—ç‰©ä»¶åç¨±ï¼šç‚ºFlightDTO fieldError.getField(), // ç‚ºproperties(terminal) fieldError.getCode(), // ç‚º@Notblank fieldError.getDefaultMessage() // ç‚º@Notblankçš„éŒ¯èª¤è³‡è¨Š );&#125; :::infoBindingResultç‚ºErrorçš„å­ä»‹é¢ BindingResulthttps://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/BindingResult.htmlError:https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Errors.html::: åƒè€ƒè³‡æ–™ï¼šä½¿ç”¨spring validationå®Œæˆæ•°æ®åç«¯æ ¡éªŒhttps://www.cnkirito.moe/spring-validation/ @Validatedå’Œ@ValidåŒºåˆ«ï¼šSpring validationéªŒè¯æ¡†æ¶å¯¹å…¥å‚å®ä½“è¿›è¡ŒåµŒå¥—éªŒè¯å¿…é¡»åœ¨ç›¸åº”å±æ€§ï¼ˆå­—æ®µï¼‰åŠ ä¸Š@Validè€Œä¸æ˜¯@Validatedhttps://blog.csdn.net/qq_27680317/article/details/79970590 æ“ä½œæ•¸æ“šåº«ç›¸é—œæ•¸æ“šç›¸é—œçš„Annotation@Entityè¡¨ç¤ºæ˜¯ä¸€å€‹å°æ‡‰åˆ°DB Tableçš„ç‰©ä»¶ @Idè²æ˜è©²æ¬„ä½ç‚ºä¸»éµ @GeneratedValueæŒ‡å®šIDç”Ÿæˆçš„ç­–ç•¥ï¼Œè‹¥æ²’æœ‰è¨­ç½®çš„åŒ–, Hibernateå°æ‡‰çš„æ˜¯ç‚ºä¸€å€‹Not nullçš„ç‰©ä»¶ï¼Œå¾—è‡ªè¡Œè¨­å®šidåˆ°ç‰©ä»¶å…§ã€‚ä½†é€šå¸¸æœƒè‡ªè¡Œåœ¨æ–°å¢è³‡æ–™æ™‚ç”¢ç”ŸID, æ•…@Idèˆ‡@GeneratedValueæœƒå¸¸å¸¸åŒæ™‚å‡ºç¾ å› ç‚ºHibernateæœƒé‡è¦‹ä¸åŒçš„Databaseï¼Œæ‰€ä»¥æœ‰å„ç¨®ä¸åŒçš„ç”Ÿæˆç­–ç•¥: GenerationType.AutoHibernateæœƒæ ¹æ“šæ¡ç”¨çš„Databaseç‚ºä½•ï¼Œä¾†æ±ºå®šè¦ç”¨ GenerationType.Identity æˆ– GenerationType.SEQUENCEã€‚(å¤§éƒ¨åˆ†çš„æƒ…æ³éƒ½æœƒæ¡ç”¨ GenerationType.SEQUENCE) GenerationType.IDENTITYé€éauto-incremented database columnä¾†ç”¢ç”Ÿprimary key.å¸¸è¦‹çš„MySQLå’ŒMMSQLéƒ½æ¡ç”¨è©²æ–¹å¼ï¼Œç›¸å°æ‡‰çš„DDLèªè¨€ç‚ºä»¥ä¸‹æ‰€ç¤º:1id BIGINT NOT NULL AUTO_INCREMENT GenerationType.SEQUENCEè¨­å®šè©²ç­–ç•¥ï¼Œé€šå¸¸ä¹Ÿæœƒçµ¦å…¥å¦ä¸€å€‹Annotation @SequenceGeneratorï¼Œå¦‚ä¸‹ 12345@Id@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = \"author_generator\")@SequenceGenerator(name=\"author_generator\", sequenceName = \"author_seq\", allocationSize=50)@Column(name = \"id\", updatable = false, nullable = false)private Long id è‹¥æ²’æœ‰æŒ‡å®šï¼ŒHibernateæœƒä½¿ç”¨é è¨­çš„SequenceGenerator å¯ä»¥çœ‹åˆ°è‹¥æŒ‡å®š sequenceGeneratorçš„nameç‚ºauthor_seq, Hibernateå°±æœƒåœ¨ author_seqé€™å€‹tableæŸ¥æ‰¾ä¸‹ä¸€å€‹idå€¼ç‚ºå¤šå°‘ æ³¨æ„ï¼Œåœ¨Postgresæƒ…æ³ä¸‹ä¸é©åˆç”¨è©²æ–¹æ³•https://stackoverflow.com/questions/4288740/hibernate-use-of-postgresql-sequence-does-not-affect-sequence-table/4502062#4502062 GenerationType.SEQUENCEç•¶ä¸å¸Œæœ›æ‡‰ç”¨ç¨‹å¼èˆ‡æŸä¸€ç¨® Database Engine ç¶æ­»çš„æ™‚å€™ï¼Œå¯ä»¥ä½¿ç”¨é€™ç¨®æ–¹æ³•ï¼Œé€éå¦å¤–ä¸€å€‹è¡¨æ ¼ä¾†å®šç¾© ID æœƒé€éSQLï¼Œå»ºç«‹å­˜æ”¾å„ç¨®columnçš„seqeunce1CREATE TABLE APP_SEQ_STORE ( APP_SEQ_NAME VARCHAR(255) NOT NULL, APP_SEQ_VALUE BIGINT NOT NULL, PRIMARY KEY(APP_SEQ_NAME) ); Reference: https://thoughts-on-java.org/jpa-generate-primary-keys/@IdClass å¤åˆä¸»é”®å¤åˆä¸»é”®ç”±å¤šä¸ªä¸»é”®å­—æ®µç»„æˆã€‚æ¯ä¸ªä¸»é”®å­—æ®µå¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ”¯æŒç±»å‹ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é¡¹ç›®å®ä½“ç±»çš„ä¸»é”®ç”±ä¸¤ä¸ªå­—æ®µç»„æˆ:12345@Entity @IdClass(ProjectId.class)public class Project &#123; @Id int departmentId; @Id long projectId;&#125; åœ¨ProjectId.classä¸­è²æ˜å…©å€‹ä¸»éµå€¼1234Class ProjectId &#123; int departmentId; long projectId;&#125; @EmbeddableåµŒå…¥å¼ä¸»é”®è¡¨ç¤ºå¤åˆä¸»é”®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å¯åµŒå…¥çš„ç±» 12345678910@Entitypublic class Project &#123; @EmbeddedId ProjectId id;&#125;@EmbeddableClass ProjectId &#123; int departmentId; long projectId;&#125; @Columnå®£å‘Šè©²è®Šæ•¸èˆ‡è³‡æ–™åº«æ¬„ä½çš„å°æ˜  1234@Column(nam=â€category_nameâ€ length=20)Public void getCategoryName()&#123; Return this.categoryName;&#125; åƒè€ƒè³‡æ–™:SPRINGä¸­å¸¸ç”¨çš„æ³¨è§£ï¼ˆ@ENTITYï¼Œ@TABLEï¼Œ@COLUMNï¼Œ@REPOSITORYï¼Œ@SERVICEï¼‰https://www.cnblogs.com/hoojjack/p/6568920.html JPA ä¸»é”®@Idã€@IdClassã€@Embeddableã€@EmbeddedIdhttps://blog.csdn.net/tracycater/article/details/78319021 @Data@Data è‡ªå‹•ç”¢ç”Ÿ getter(), setter(), toString(), ç¯€çœä¸€å¤§å †ä»£ç¢¼çš„ç¥Annotation å‰ç½®ä½œæ¥­ï¼š å¼•å…¥lombokè¦ä½¿ç”¨ @Data æ³¨è§£è¦å…ˆå¼•å…¥lombok 1lombokç‚ºä¸€å€‹Libraryï¼Œå¯ä»¥ç”¨ç°¡å–®çš„è¨»è§£å½¢å¼ä¾†ç°¡åŒ–ä»£ç¢¼ï¼Œæé«˜é–‹ç™¼æ•ˆç‡ã€‚ å¦‚ä½•ä½¿ç”¨lobok åœ¨mavenä¸­æ·»åŠ ä¾è³´ 123456&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.4&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; åœ¨ç·¨è­¯å™¨ä¸­æ·»åŠ æ’ä»¶ ä»¥IDEAç‚ºä¾‹ï¼Œåœ¨settingçš„pluginè£¡æœç´¢lombok pluginï¼Œå®‰è£æ’ä»¶ã€‚ ç›´æ¥åœ¨Classä¸ŠåŠ ä¸Š@Dataå³å¯ ä¾‹å¦‚ä¸€ä¸ªç®€å•çš„Person Class 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public class Person &#123; private String name; private String address; private Integer age; private String hobbit; private String phone; public Person() &#123; &#125; public Person(String name, String address, Integer age, String hobbit, String phone) &#123; this.name = name; this.address = address; this.age = age; this.hobbit = hobbit; this.phone = phone; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getAddress() &#123; return address; &#125; public void setAddress(String address) &#123; this.address = address; &#125; public Integer getAge() &#123; return age; &#125; public void setAge(Integer age) &#123; this.age = age; &#125; public String getHobbit() &#123; return hobbit; &#125; public void setHobbit(String hobbit) &#123; this.hobbit = hobbit; &#125; public String getPhone() &#123; return phone; &#125; public void setPhone(String phone) &#123; this.phone = phone; &#125; @Override public String toString() &#123; return \"Person&#123;\" + \"name='\" + name + '\\'' + \", address='\" + address + '\\'' + \", age=\" + age + \", hobbit='\" + hobbit + '\\'' + \", phone='\" + phone + '\\'' + '&#125;'; &#125;&#125; ä½¿ç”¨äº† @Data 12345678910@Data@AllArgsConstructor@NoArgsConstructorpublic class Person &#123; private String name; private String address; private Integer age; private String hobbit; private String phone;&#125; åœ¨æŒ‰å¿«æ·éµ Ctrl + F12ï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°set,get,toString æ–¹æ³•ã€‚ ä½¿ç”¨ @Data è¨»è§£å°±å¯ä»¥æœ‰ä¸‹é¢å¹¾å€‹è¨»è§£çš„åŠŸèƒ½ï¼š @ToStringã€@Getterã€@Setterã€@EqualsAndHashCodeã€@NoArgsConstructor ã€‚ :::infoå¸¸ç”¨çš„å¹¾å€‹è¨»è§£ï¼š@Data ï¼š æ³¨åœ¨é¡ä¸Šï¼Œæä¾›é¡çš„getã€setã€equalsã€hashCodeã€canEqualã€toStringæ–¹æ³•@Setter ï¼š æ³¨åœ¨å±¬æ€§ä¸Šï¼Œæä¾› set æ–¹æ³•@Getter ï¼š æ³¨åœ¨å±¬æ€§ä¸Šï¼Œæä¾› get æ–¹æ³•æ§‹é€ å‡½æ•¸ @AllArgsConstructorä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å˜é‡ï¼ŒåŒæ—¶å¦‚æœå˜é‡ä½¿ç”¨äº†NotNull annotation ï¼Œ ä¼šè¿›è¡Œæ˜¯å¦ä¸ºç©ºçš„æ ¡éªŒï¼Œå…¨éƒ¨å‚æ•°çš„Constructorå‡½æ•°çš„è‡ªåŠ¨ç”Ÿæˆï¼Œè¯¥æ³¨è§£çš„ä½œç”¨åŸŸä¹Ÿæ˜¯åªæœ‰åœ¨å®ä½“ç±»ä¸Šï¼Œå‚æ•°çš„é¡ºåºä¸å±æ€§å®šä¹‰çš„é¡ºåºä¸€è‡´ã€‚ ç¯„ä¾‹:123456789101112131415import lombok.AllArgsConstructor;@AllArgsConstructorclass MyClass&#123; private String one; private Integer three; private Integer two; &#125;è‡ªå‹•ç”Ÿæˆå»ºæ§‹å­:public MyClass(String one, Integer three, Integer two) &#123; this.one = one; this.three = three; this.two = two; &#125; åƒè€ƒ: https://stackoverflow.com/questions/49106072/how-to-specify-the-order-of-parameters-in-allargsconstructor-in-lombok @NoArgsConstructorç”¢ç”Ÿæ²’æœ‰åƒæ•¸çš„å»ºæ§‹å­generate a constructor with no parameters. @RequiredArgsConstructorä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«å¸¸é‡ï¼ˆfinalï¼‰ï¼Œå’Œæ ‡è¯†äº†@NotNullçš„å˜é‡ çš„æ„é€ æ–¹æ³•ã€‚ @EqualsAndHashCode ï¼š æ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ equals å’Œ hashCode æ–¹æ³•@Log4j/@Slf4j ï¼š æ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ Logger å¯¹è±¡ï¼Œå˜é‡åä¸º log::: :::warningæ³¨æ„çš„æ˜¯ï¼ŒåŒæ—¶ä½¿ç”¨@Data å’Œ @AllArgsConstructor å ï¼Œé»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°å¤±æ•ˆï¼Œå¦‚æœéœ€è¦å®ƒï¼Œè¦é‡æ–°è®¾ç½® @NoArgsConstructor::: åƒè€ƒè³‡æ–™ @Dataæ³¨è§£ ä¸ lombokhttps://www.jianshu.com/p/c1ee7e4247bfå­¦ä¹ Spring Bootï¼šï¼ˆåäº”ï¼‰ä½¿ç”¨Lombokæ¥ä¼˜é›…çš„ç¼–ç https://blog.wuwii.com/springboot-15.html Springè¼‰å…¥Beanèˆ‡æ¨™ç¤ºç‚ºBeanæœ‰é—œçš„Annotation@Beanå®šç¾©å¯å…±ç‰©ä»¶åŒ–çš„é¡åˆ¥ï¼Œå«åšBeanï¼Œä¸¦ä¸”æ”¾ç½®åœ¨Spring Ioc Containerä¸­ä¸¦ä¸”çµ¦å…¶ç®¡ç†ï¼Œç­‰å¾…è¢«å‘¼å«ä½¿ç”¨ã€‚ é…ç½®æ–¹å¼1. ç¨‹å¼ç¢¼Java Codeé…ç½®Spring çš„@Beané€šå¸¸å®£å‘Šåœ¨æ›æœ‰@Configurationçš„Springé…ç½®é¡åˆ¥ä¸­çš„æ–¹æ³•å‰ï¼Œä¾‹å¦‚å®£å‘Šä¸€å€‹ AppConfig.javaï¼Œè‹¥æœ‰è¶…éä¸€å€‹ä»¥ä¸Šçš„beanï¼Œä½¿ç”¨ @Qualifierçµ¦äºˆåç¨± AppConfig.java1234567891011121314151617@Configurationpublic class AppConfig &#123; @Bean(name=\"add\") Calculator addCalculator() &#123; return new AddCalculator(); &#125; @Bean(name=\"sub\") Calculator subCalculator() &#123; return new SubCalculator(); &#125; @Bean(name=\"mul\") Calculator mulCalculator() &#123; return new MulCalculator(); &#125;&#125; å®šç¾©Calculatorçš„ä»‹é¢ Calculator.interface123public interface Calculator &#123; int calc(int a, int b);&#125; å®šç¾©ä¸€å€‹å¯¦ä½œCalculatorçš„é¡åˆ¥ CalculatorImpl.java1234567891011121314151617181920212223package com.will.advanced.demo.bean;class AddCalculator implements Calculator &#123; @Override public int calc(int a, int b) &#123; return a + b ; &#125;&#125;class SubCalculator implements Calculator &#123; @Override public int calc(int a, int b) &#123; return a - b; &#125;&#125;class MulCalculator implements Calculator &#123; @Override public int calc(int a, int b) &#123; return a * b; &#125;&#125; å–å¾—è¨»å†Šçš„beançš„æ–¹å¼1. ä½¿ç”¨@Autowire èˆ‡ @Qualifierç„¶å¾Œåœ¨ CommandLineRunnerä¸­ä½¿ç”¨ @AutoWireä½¿ç”¨@Beanï¼Œç„¶è€Œè‹¥è¦Autowiredçš„é¡åˆ¥å°è±¡æ˜¯ä»‹é¢çš„è©±ï¼Œä¸”ä»‹é¢æœ‰å¾ˆå¤šçš„å¯¦ä½œå­é¡åˆ¥(AddCalculator, SubCalculator, MulCalculator) é‚£å¾—é€é @Qualifierä¾†æŒ‡åæ˜¯å“ªä¸€å€‹å­é¡åˆ¥ CommandLineAppStartupRunner.java123456789101112131415161718192021@SpringBootApplicationpublic class CommandLineAppStartupRunner implements CommandLineRunner &#123; @Autowired private ApplicationContext context; @Autowired @Qualifier(\"add\") Calculator addCalculator; @Autowired @Qualifier(\"sub\") Calculator subCalculator; @Autowired @Qualifier(\"mul\") Calculator mulCaculator; @Override public void run(String...args) throws Exception &#123; System.out.println(addCalculator.calc(1,3)); System.out.println(subCalculator.calc(3,2)); System.out.println(mulCaculator.calc(2,6)); &#125;&#125; 2. ä½¿ç”¨getBean()CommandLineAppStartupRunner.java1234567891011121314151617181920@SpringBootApplicationpublic class CommandLineAppStartupRunner implements CommandLineRunner &#123; @Autowired private ApplicationContext context; @Override public void run(String...args) throws Exception &#123; // å–å¾—æ‰€æœ‰å·²ç¶“è¨»å†Šçš„bean System.out.println(Arrays.asList(context.getBeanDefinitionNames())); // å–å¾—åç¨±ç‚ºaddçš„bean Calculator addCalculator = context.getBean(\"add\", Calculator.class); Calculator subCalculator = context.getBean(\"sub\", Calculator.class); Calculator mulCalculator = context.getBean(\"mul\", Calculator.class); System.out.println(addCalculator.calc(1,3)); System.out.println(subCalculator.calc(3,2)); System.out.println(mulCalculator.calc(2,3)); &#125;&#125; è£œå……: ä½¿ç”¨CommandlineRunnerè®“Springè¨­ç½®å¯ä»¥å…ˆè¢«è¼‰å…¥ï¼Œç„¶å¾Œå¯é€érun()å®šç¾©è‡ªè¨‚ç¾©åŸ·è¡Œçš„å…§å®¹https://dzone.com/articles/spring-boot-applicationrunner-and-commandlinerunne 3. xmlæª”æ¡ˆé…ç½®ä¸Šé¢çš„å¯«æ³•ç­‰åŒåœ¨ appConfig.xml å®£å‘Š:123&lt;beans&gt; &lt;bean name=&quot;addCalculator&quot; class=&quot;com.will.advanced.TransferServiceImpl&quot;/&gt;&lt;/beans&gt; @ComponentScan: æƒææŒ‡å®špackageä¸­æ›æœ‰@Componentçš„é¡åˆ¥ï¼Œè‡ªå‹•è¨»å†ŠåŒ…å«çš„beanä¸éä¸€èˆ¬åœ¨æ²’æœ‰ç‰¹æ®Šéœ€æ±‚çš„æƒ…æ³ä¸‹éƒ½æœƒä½¿ç”¨@ComponentScanæƒææŒ‡å®špackageä¸­æ›æœ‰@Componentçš„é¡åˆ¥ä¾†è‡ªå‹•è¨»å†Šç‚ºbeanã€‚ è€Œæœƒä½¿ç”¨@Beançš„æ™‚æ©Ÿç‚ºï¼Œç•¶è¦è¢«è¨»å†Šç‚ºbeançš„é¡åˆ¥å»ºæ§‹æ­¥é©Ÿæˆ–é‚è¼¯æ¯”è¼ƒè¤‡é›œï¼Œæ­¤æ™‚å°±éœ€è¦@Beanè®“ä½ å¯ä»¥åœ¨æ§‹é€ beançš„æ–¹æ³•å…§æ’°å¯«æ§‹é€ çš„è©³ç´°é‚è¼¯ï¼Œè€Œ@ComponentScanå°±ç„¡æ³•æ»¿è¶³æ¯”è¼ƒç´°å¾®çš„é…ç½®ã€‚ ä¾‹å¦‚åœ¨ serviceå±¤ä¸­æ–°å¢ä¸€å€‹ TestService classé€é@Componentå°‡TestServiceè¨»å†ŠæˆBean123456@Componentpublic class TestService &#123; public String test() &#123; return &quot;testing&quot;; &#125;&#125; é€é@ComponentScanå¯ä½¿ç”¨@Componentè¨»å†Šçš„beanï¼Œ 12345678910@ComponentScanpublic class CommandLineAppStartupRunner implements CommandLineRunner &#123; @Autowired TestService testService; @Override public void run(String...args) throws Exception &#123; System.out.println(testService.test()); &#125;&#125; åƒè€ƒè³‡æ–™Spring: A Head Start ğŸ”¥ â€” Beans Configuration (Part 2)https://medium.com/omarelgabrys-blog/spring-a-head-start-beans-configuration-part-2-4a8c239b070a @Scope: å®šç¾©Beanè¢«å¼•ç”¨æ™‚è¦æ€æ¨£è¢«ä½¿ç”¨ singletonï¼šåœ¨Spring IoC Containerï¼Œè©²beanåªæœƒæœ‰å–®ä¸€å¯¦ä¾‹(a single instance)ï¼Œæ­¤ç‚ºSpringé è¨­å€¼ prototypeï¼šåœ¨Spring IoC Containerä¸­ï¼Œè©²beanå¯ä»¥æœ‰å¤šå€‹å¯¦ä¾‹(any number of object instances) requestï¼š åœ¨æ¯ä¸€æ¬¡çš„HTTP Requestï¼Œspring containeræœƒæ ¹æ“šloginAction beançš„å®šç¾©ä¾†å»ºç«‹ä¸€å€‹å…¨æ–°çš„instanceï¼Œè€Œä¸”åƒ…åœ¨ç›®å‰çš„requestä¸­æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒçš„å»æ›´æ”¹instanceçš„å…§éƒ¨ç‹€æ…‹ï¼Œè«‹æ±‚çµæŸï¼Œrequest scopeçš„bean instanceæœƒè¢«destroy sessionï¼šé‡å°æŸå€‹HTTP Sessionï¼Œspring containeræœƒæ ¹æ“šuserPreference beançš„å®šç¾©ä¾†å»ºç«‹ä¸€å€‹å…¨æ–°çš„instanceï¼ŒåŒæ¨£çš„ï¼Œå’Œrequest scopeä¸€æ¨£ï¼Œå¯ä»¥æ”¾å¿ƒçš„å»æ›´æ”¹instanceå…§éƒ¨ç‹€æ…‹ã€‚ global-sessionï¼šåƒ…åœ¨portletç‚ºåŸºç¤çš„Webæ‡‰ç”¨ä¸‹æœ‰ä½œç”¨ã€‚Porletçš„è¦ç¯„ä¸­å®šç¾©äº†global sessionçš„æ¦‚å¿µã€‚ åƒè€ƒè³‡æ–™:Spring Bean Scope å­¸ç¿’https://kevingo75.blogspot.com/2012/03/spring-bean-scope.html è£œå……: ä»€éº¼æ˜¯Spring IoC (Inversion of Control) container. Inversion of Control, or IoC for short, is a process in which an object defines its dependencies without creating them. This object delegates the job of constructing such dependencies to an IoC container. ç”¨ä¸€æŸ±è©±æè¿°IoCï¼š classä¸ç”¨è‡ªå·±ä¸»å‹•newæ¬²ä¾è³´classçš„instanceï¼Œè€Œæ˜¯é€éå¤–éƒ¨ (main()æ–¹æ³•) ä»¥å»ºæ§‹å­ã€setteræˆ–æ˜¯ä»‹é¢æ³¨å…¥ä¾†ç”¢ç”Ÿä¾è³´classçš„instance :::successéœ€è¦çš„ éŠæˆ²ï¼Œä¸ç”¨è‡ªå·± ä¸‹è¼‰ï¼Œè€Œæ˜¯ ç¶²å’–æä¾› çµ¦ä½ ã€‚â€”â€”â€”â€”â€”â€”â€”-||â€”â€”â€”â€”â€”â€”â€” éœ€è¦çš„ ç‰©ä»¶ï¼Œä¸ç”¨è‡ªå·± å–å¾—ï¼Œè€Œæ˜¯ æœå‹™å®¹å™¨ æä¾› çµ¦ä½ ã€‚â€”â€”â€”â€”â€”â€”â€”-||â€”â€”â€”â€”â€”â€”â€”éœ€è¦çš„ ä¾è³´å¯¦ä¾‹ï¼Œä¸ç”¨ ä¸»å‹• (Active) å»ºç«‹ï¼Œè€Œæ˜¯ è¢«å‹• (Passive) æ¥æ”¶ã€‚::: åƒè€ƒè³‡æ–™ï¼šæ§åˆ¶åè½‰ (IoC) èˆ‡ ä¾è³´æ³¨å…¥ (DI)https://notfalse.net/3/ioc-di @Repositoryç®€åŒ– Spring çš„å¼€å‘ã€‚@Repositoryæ³¨è§£ä¾¿å±äºæœ€å…ˆå¼•å…¥çš„ä¸€æ‰¹ï¼Œå®ƒç”¨äºå°†æ•°æ®è®¿é—®å±‚ (DAO å±‚ ) çš„ç±»æ ‡è¯†ä¸º Spring Beanã€‚å…·ä½“åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ DAOç±»ä¸Šå³å¯ã€‚ @Serviceã€@Controller å’Œ @Component å°‡classæ¨™ç¤ºä¸ºBean @Component æ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºä¸€ä¸ªç»„ä»¶ (Bean) ï¼Œå¯ä»¥ä½œç”¨åœ¨ä»»ä½•å±‚æ¬¡ã€‚ @Service é€šå¸¸ä½œç”¨åœ¨æ¥­å‹™é‚è¼¯å±¤ï¼Œä½†æ˜¯ç›®å‰è¯¥åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚ @Controller é€šå¸¸ä½œç”¨åœ¨æ§åˆ¶å±¤(Controller)ï¼Œä½†æ˜¯ç›®å‰è¯¥åŠŸèƒ½èˆ‡@Component ç›¸åŒã€‚ @PostConstructè¢«@PostConstructä¿®é£¾çš„æ–¹æ³•æœƒåœ¨æœå‹™å™¨åŠ è¼‰Servletçš„æ™‚å€™é‹è¡Œï¼Œä¸¦ä¸”åªæœƒè¢«æœå‹™å™¨åŸ·è¡Œä¸€æ¬¡ã€‚ @Transactionalå‡è‹¥ä½ åœ¨classä¸­è¨­å®šäº†@Transactional, è©²classæ‰€æœ‰çš„methodæœ‰ä½¿ç”¨åˆ°JPAçš„éƒ½æœƒè¢«springçš„transactionæ‰€ç®¡ç†ã€‚ èˆ‰ä¾‹ï¼šç•¶æœ‰å€‹Transactionæœ‰ä¸‰å€‹å‹•ä½œï¼šentity1.save, entity2.save, entity3.save. è‹¥entity3.saveå¤±æ•—ï¼Œé‚£Springå°±æœƒå°‡entity1.saveèˆ‡entity2.saveçš„åŸ·è¡Œçµæœçµ¦rollbackï¼Œé‚„åŸå…¶å‹•ä½œã€‚ åƒè€ƒè³‡æ–™https://stackoverflow.com/questions/1099025/spring-transactional-what-happens-in-background AOPç›¸é—œçš„Annotaion@Aspect@Aspect:å®šç¾©AOPï¼Œä½œç”¨åœ¨class AOPç‚º Aspect Oritented ProgrammingAOPé€šéçµ¦ç¨‹åºå®šç¾©ä¸€å€‹åˆ‡å…¥é»ï¼Œç„¶å¾Œåœ¨å…¶å‰å¾Œåˆ‡å…¥ä¸åŒçš„åŸ·è¡Œå…§å®¹AOPä¸æœƒç ´å£åŸä¾†çš„ç¨‹åºé‚è¼¯AOPä½¿ç”¨å ´æ™¯ï¼š ç´€éŒ„æ—¥èªŒ äº‹å‹™ç®¡ç† å®‰å…¨æª¢æŸ¥ è³‡æºæ§åˆ¶ @Pointcut, @Before, @Afterç¯„ä¾‹1234567891011121314151617181920212223@Aspect@Componentpublic class LogAspect &#123; private final Logger logger = LoggerFactory.getLogger(this.getClass()); // åˆ‡å…¥packageç‚ºcom.william.demo.apiçš„LogTestApié¡åˆ¥çš„logå‡½å¼ @Pointcut(\"execution(* com.william.demo.api.LogTestApi.log(..))\") public void log() &#123; &#125; // å¸Œæœ›åœ¨åˆ‡å…¥é» log()å‡½å¼å‰åŸ·è¡ŒæŸäº›å…§å®¹ // æˆ–æ˜¯ç”¨ç›´æ¥ç”¨ @Before(\"execution(* com.william.demo.api.LogTestApi.log(..))\"); @Before(\"log()\") public void doBefore() &#123; logger.info(\"----------do before---------\"); &#125; @After(\"log()\") public void doAfter() &#123; logger.info(\"----------do after----------\"); &#125;&#125; å…¶ä»–Annotation@Cacheå®šç¾©cacheç­–ç•¥èˆ‡ç¯„åœï¼Œå¯ä»¥å®šç¾©ä»¥ä¸‹åƒæ•¸ï¼š usage: ç•¶å‰ç·©å­˜ç­–ç•¥(NONE, READ_ONLY, NONSTRICT_READ_WRITE, TRANSACTIONAL) read-only: åªè®€ç·©å­˜ å¦‚æœä½ çš„æ‡‰ç”¨ç¨‹åºåªéœ€è®€å–ä¸€å€‹æŒä¹…åŒ–é¡çš„å¯¦ä¾‹ï¼Œè€Œç„¡éœ€å°å…¶ä¿®æ”¹ï¼Œ é‚£éº¼å°±å¯ä»¥å°å…¶é€²è¡Œåªè®€ç·©å­˜ read-write: è®€å¯«ç·©å­˜ å¦‚æœæ‡‰ç”¨ç¨‹åºéœ€è¦æ›´æ–°æ•¸æ“šï¼Œé‚£éº¼ä½¿ç”¨è®€/å¯«ç·©å­˜æ¯”è¼ƒåˆé©ã€‚å¦‚æœæ‡‰ç”¨ç¨‹åºè¦æ±‚â€œåºåˆ—åŒ–äº‹å‹™â€çš„éš”é›¢ç´šåˆ¥ï¼ˆserializable transaction isolation levelï¼‰ï¼Œé‚£éº¼å°±æ±ºä¸èƒ½ä½¿ç”¨é€™ç¨®ç·©å­˜ç­–ç•¥ nonstrict-read-write: ä¸åš´æ ¼è®€å¯«ç·©å­˜ å¦‚æœæ‡‰ç”¨ç¨‹åºåªå¶çˆ¾éœ€è¦æ›´æ–°æ•¸æ“šï¼ˆä¹Ÿå°±æ˜¯èªªï¼Œå…©å€‹äº‹å‹™åŒæ™‚æ›´æ–°åŒä¸€è¨˜éŒ„çš„æƒ…æ³å¾ˆä¸å¸¸è¦‹ï¼‰ï¼Œä¹Ÿä¸éœ€è¦ååˆ†åš´æ ¼çš„äº‹å‹™éš”é›¢ï¼Œé‚£éº¼æ¯”è¼ƒé©åˆä½¿ç”¨éåš´æ ¼è®€/å¯«ç·©å­˜ç­–ç•¥ã€‚ transactional :äº‹å‹™æ€§ç·©å­˜ Hibernate çš„äº‹å‹™ç·©å­˜ç­–ç•¥æä¾›äº†å…¨äº‹å‹™çš„ç·©å­˜æ”¯æŒï¼Œä¾‹å¦‚å° JBoss TreeCache çš„æ”¯æŒã€‚é€™æ¨£çš„ç·©å­˜åªèƒ½ç”¨æ–¼ JTA ç’°å¢ƒä¸­ï¼Œä½ å¿…é ˆæŒ‡å®šç‚ºå…¶hibernate.transaction.manager_lookup_classå±¬æ€§ã€‚ region: å¯é¸åƒæ•¸ï¼ŒæŒ‡å®šäºŒç´šç·©å­˜çš„å»åŸŸåï¼Œé»˜èªç‚ºé¡æˆ–è€…é›†åˆçš„åå­—ã€‚ include: å¯é¸åƒæ•¸(all, non-lazy)ã€‚ allåŒ…å«æ‰€æœ‰å±¬æ€§ï¼Œnon-lazyåƒ…åŒ…å«éå»¶é²åŠ è¼‰çš„å±¬æ€§ã€‚ ç¯„ä¾‹12345@Table(name = &quot;PROVICE&quot;)@Cache(usage =CacheConcurrencyStrategy.READ_ONLY)public class Province() &#123;...&#125; 1234567@Table(name = &quot;PROVICE&quot;)@Cache(usage =CacheConcurrencyStrategy.READ_ONLY)public class Province() &#123; @OneToMany(fetch = FetchType.LAZY) @JoinColumn(name = &quot;cityId&quot;) @Cache(usage = CacheConcrrencyStrategy.READ_ONLY) private Set&lt;City&gt; cities; åƒè€ƒè³‡æ–™Hibernate @Cacheæ³¨è§£-å¤©æ‰å°å°å¸ƒhttps://blog.csdn.net/w410589502/article/details/54603265 @Configuration@Configurationçš„ä½œç”¨åŒä»¥å‰çš„xmlé…ç½®æª”ï¼ˆä¾‹å¦‚Springçš„applicationContext.xmlæˆ–dispatcher-servlet.xmlï¼‰ï¼Œç”¨ä¾†è¨­å®šSpringç’°å¢ƒé…ç½®ï¼Œä¾‹å¦‚å®£å‘ŠåŠè¨»å†Šbeanè‡³Springå®¹å™¨ä¸­ï¼Œæ³¨å…¥propertiesåƒæ•¸ç­‰ã€‚ ç¯„ä¾‹ä¾‹å¦‚æˆ‘å€‘æœ‰ä¸€å€‹FooServiceé¡åˆ¥ï¼Œè‹¥æ­¤é¡åˆ¥è¦æˆç‚ºSpringå®¹å™¨ç®¡ç†çš„beanï¼Œæœ‰å…©ç¨®æ–¹æ³•ï¼š ä¸€èˆ¬åœ¨è©²é¡åˆ¥ä¸Šå®£å‘Š@Componentä¸¦æ­é…@ComponentScanæƒæçš„æ–¹å¼è¨»å†Šç‚ºbean é€éåœ¨@Configurationé¡åˆ¥ä¸­æ­é…@Beançš„æ–¹å¼è¨»å†Šã€‚ ä¾‹å¦‚å»ºç«‹ä¸€å€‹AppConfigä¸¦åœ¨é¡åˆ¥åç¨±å‰æ›ä¸Š@Configurationï¼Œå‰‡æ­¤é¡åˆ¥åŠæˆç‚ºSpringçš„é…ç½®é¡ã€‚åœ¨é…ç½®é¡çš„æ–¹æ³•å‰æ›ä¸Š@Beanå‰‡æ–¹æ³•å›å‚³çš„ç‰©ä»¶å°±æœƒè¢«è¨»å†Šç‚ºSpringå®¹å™¨ç®¡ç†çš„bean fooService()æ–¹æ³•ä¾¿æœƒå°‡FooServiceè¨»å†Šç‚ºbeanã€‚ 1234567891011121314package com.will.advanced.demo.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import com.will.advanced.demo.service.FooService;@Configurationpublic class AppConfig &#123; @Bean public FooService fooService() &#123; return new FooService(); &#125;&#125; ç‚ºäº†ç¨‹å¼ç®¡ç†åŠç¶­è­·ä¸Šçš„æ–¹ä¾¿ï¼Œé€šå¸¸æˆ‘å€‘æœƒæŠŠæŸäº›ç›¸é—œçš„é…ç½®å¯«åœ¨å¦å¤–çš„é…ç½®æª”ï¼Œè€Œä¸æ˜¯å…¨éƒ¨å¡åœ¨åŒä¸€å€‹é¡åˆ¥ï¼Œæ­¤æ™‚å°±å¯ä»¥åˆ©ç”¨@Configurationå¦å¤–å®šç¾©ä¸€å€‹é…ç½®æª”ï¼Œä¾‹å¦‚ä¸Šé¢çš„AppConfigã€‚ @SpringBootApplication: æœ¬èº«ä¹ŸåŒ…å«@Configurationè€Œåœ¨Spring Bootä¸­ï¼Œ@SpringBootApplicationé¡æœ¬èº«å³åŒ…å«äº†@Configurationï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨è£¡é¢é€²è¡Œå¦‚ä¸ŠBeançš„é…ç½®ï¼Œä¾‹å¦‚ 123456789101112131415161718192021package com.will.advanced.demo;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.Bean;import com.will.advanced.demo.FooService;@SpringBootApplicationpublic class SpringBootBeanDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootBeanDemoApplication.class, args); &#125; @Bean public FooService fooService() &#123; return new FooService(); &#125;&#125; åƒè€ƒè³‡æ–™Spring @Configurationä½œç”¨https://matthung0807.blogspot.com/2019/04/spring-configuration_28.html @SpringBootApplicationå®šç¾© @SpringBootApplicationçš„é è¨­æƒç„beançš„ç¯„åœ Spring Bootçš„@SpringBootApplicationé è¨­åªæœƒæƒææ‰€å±¬packageä¸‹çš„é¡ï¼Œå› æ­¤è‹¥@Configurationé¡åˆ¥å®šç¾©åœ¨@SpringBootApplicationé¡ä»¥å¤–çš„packageï¼Œå‰‡è¦ç”¨scanBasePackageså±¬æ€§ä¾†è¨­å®šè¦é¡å¤–æƒæçš„packageï¼Œä¾‹å¦‚@SpringBootApplication(scanBasePackages=â€com.will.advanced.demo.configâ€) ï¼ˆ@ConfigurationåŒ…å«äº†@Componentï¼‰ï¼Œ 12345678910111213package com.will.advanced.demo;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;// æ³¨æ„åœ¨scanBasePackagesçš„packageåç¨±@SpringBootApplication(scanBasePackages=\"com.will.advanced.demo.config\") public class SpringBootBeanDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootBeanDemoApplication.class, args); &#125;&#125; @Importæˆ–æ˜¯é€é@Importä¾†å¼•å…¥ ï¼Œä¾‹å¦‚12345678910111213141516package com.will.advanced.demo;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.Import;@SpringBootApplication// æ³¨æ„pacakgeåç¨±@Import(value = &#123; com.will.advanced.demo.config.AnotherAppConfig.class &#125;)public class SpringBootBeanDemoApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootBeanDemoApplication.class, args); &#125;&#125; :::warningæ³¨æ„ä½¿ç”¨@Importæœƒå¿½ç•¥@Configurationè¨­å®š::: @Autowiredä¾è³´æ³¨å…¥ç‰©ä»¶ Springçš„@Autowiredç”¨ä¾†ä¾è³´æ³¨å…¥ç‰©ä»¶ï¼Œå…¸å‹çš„ç”¨æ³•å°±æ˜¯æ›åœ¨é¡åˆ¥æˆå“¡è®Šæ•¸ä¸Šã€‚@Autowiredé è¨­æœƒä¾æ³¨å…¥å°è±¡çš„é¡åˆ¥å‹æ…‹ä¾†é¸æ“‡å®¹å™¨(é€é@Configurationå®šç¾©çš„classæœƒæˆç‚ºå®¹å™¨)ä¸­ç›¸ç¬¦çš„ç‰©ä»¶(è¨­ç½®æˆbean)ä¾†æ³¨å…¥ã€‚ 12@Autowiredprivate Car car; Springæœƒè‡ªå‹•å»å®¹å™¨ä¸­æ‰¾åˆ° æœ‰å®¹å™¨å®šç¾©CarBeansçš„bean 123456import ....xxx.Car;@Configuationpublic class CarBeans &#123; @Bean public Car car() &#123; return new Car() &#125;&#125; @Autowireç‚ºSpring IoCçš„å¯¦ç¾ï¼Œä¸ç”¨è‡ªå·±å»newä¸€å€‹carå‡ºä¾†ï¼Œè€Œæ˜¯é€éå®¹å™¨(æœƒåšconstructor or setter or interface injection)ï¼Œä¾†å»å¯¦ç¾å¤–éƒ¨æ³¨å…¥ï¼Œé™ä½æ¨¡çµ„(class)ä¹‹é–“çš„è€¦åˆæ€§ @EnableSchedulingè‹¥é–‹ç™¼è€…åœ¨AppConfigé¡ä¸­ä½¿ç”¨äº†@EnableSchedulingï¼Œä¸¦åœ¨æŸå€‹task classä¸­ä½¿ç”¨äº†@Scheduleè¨»è§£ï¼Œé‚£éº¼è¢«@Scheduleæ¨™è¨»çš„æ–¹æ³•æ—¢å¯ä»¥åœ¨æŒ‡å®šæ™‚é–“å…§è‡ªå‹•åŸ·è¡Œ æ³¨æ„ï¼š@EnableSchedulingè¦èˆ‡@Scheduleæ­é…ä½¿ç”¨æ‰æœ‰æ•ˆæœ @ConfigurationPropertiesè‹¥æƒ³è¦æŠŠé…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè®€å–å¥½ä¸¦è‡ªå‹•å°è£(getterè®€å–privateçš„configå€¼)æˆå¯¦é«”é¡ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘åœ¨ä»£ç¢¼è£¡é¢ä½¿ç”¨å°±è¼•é¬†è¨±å¤šï¼Œé€™æ™‚å°±å¯ä»¥ä½¿ç”¨@ConfiguationPropertiesï¼ŒæŠŠåŒé¡çš„é…ç½®è¨Šæ¯è‡ªå‹•å°è£æˆå¯¦é«”é¡ã€‚ å‡è¨­æœ‰è¨­å®šæ–‡ä»¶åœ¨ application.propertiesä¹‹ä¸‹ï¼š123connection.username=adminconnection.password=kyjufskifas2jsfsconnection.remoteAddress=192.168.1.1 æˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹å¯¦é«”é¡åœ¨è£è¼‰é…ç½®æ–‡ä»¶ä¿¡æ¯ 12345678910111213141516171819202122232425262728@Component@ConfigurationProperties(prefix=\"connection\")public class ConnectionSettings &#123; private String username; private String remoteAddress; private String password ; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getRemoteAddress() &#123; return remoteAddress; &#125; public void setRemoteAddress(String remoteAddress) &#123; this.remoteAddress = remoteAddress; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125;&#125; äº¦å¯ä»¥æŠŠ @ConfigurationProperties å®šç¾©åœ¨@Beanä¹‹ä¸‹ï¼Œèªªæ˜@Beanæ˜¯åƒè€ƒåˆ°æœ‰ç”¨configuationPropertiesè¨­å®šçš„class 12345678910111213141516@SpringBootApplicationpublic class DemoApplication&#123; //... @Bean @ConfigurationProperties(prefix = \"connection\") public ConnectionSettings connectionSettings()&#123; return new ConnectionSettings(); &#125; public static void main(String[] args) &#123; SpringApplication.run(DemoApplication.class, args); &#125;&#125; éœ€è¦ä½¿ç”¨æ™‚ç›´æ¥ç”¨@Autowireæ³¨å…¥ 12345678910111213@RestController@RequestMapping(\"/task\")public class TaskController &#123; // åœ¨é€™è£¡æ³¨å…¥ configï¼ @Autowired ConnectionSettings conn; @RequestMapping(value = &#123;\"/\",\"\"&#125;) public String hellTask()&#123; String userName = conn.getUsername(); return \"hello task !!\"; &#125;&#125; åƒè€ƒè³‡æ–™ï¼šspring boot ä½¿ç”¨@ConfigurationPropertieshttps://blog.csdn.net/yingxiake/article/details/51263071 @ConditionalOnClassæ˜¯Springbootå®ç°è‡ªåŠ¨é…ç½®çš„é‡è¦æ”¯æ’‘ä¹‹ä¸€ã€‚å…¶ç”¨é€”æ˜¯åˆ¤æ–­å½“å‰classpathä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šç±»ï¼Œè‹¥æ˜¯åˆ™å°†å½“å‰çš„é…ç½®è£…è½½å…¥springå®¹å™¨ã€‚ åƒè€ƒè³‡æ–™ï¼š@ConditionalOnClassçš„ä½¿ç”¨æ¢ç´¢ æ–°æ—¥æš®é‡Œæ ¼æ–—å¤§ä¼šhttps://blog.csdn.net/lucyTheSlayer/article/details/80430912 @ConditionalOnMissingBeanç»“åˆä½¿ç”¨æ³¨è§£@ConditionalOnMissingBeanå’Œ@Bean,å¯ä»¥åšåˆ°åªæœ‰ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„Beanä¸å­˜åœ¨äºBeanFactoryä¸­æ—¶æ‰åˆ›å»ºæŸä¸ªBean 12345678910111213141516171819202122232425@Configurationpublic class ConditionalOnMissingBeanConfig &#123; // ç„¡æ¢ä»¶å®šç¾©ä¸€å€‹bean @Bean public A beanA ()&#123; return new A(); // &#125; @Bean @ConditionalOnMissingBean(name=\"beanA\") public B beanB()&#123; // å¦‚æœ beanFactory ä¸­å­˜åœ¨ä¸€ä¸ªåç§°ä¸º beanA çš„ beanï¼Œæ‰å®šä¹‰bean ï¼š beanBï¼› // å› ä¸ºä¸Šé¢çš„æ–¹æ³•å·²ç»å®šä¹‰äº†ä¸€ä¸ª beanAï¼Œæ‰€ä»¥è¿™é‡Œ beanBå®šä¹‰å¹¶ä¸ä¼šå‘ç”Ÿã€‚ return new B(); &#125; @Bean @ConditionalOnMissingBean(name=\"beanD\") public C beanC()&#123; // å¦‚æœ beanFactory ä¸­å­˜åœ¨ä¸€ä¸ªåç§°ä¸º beanDçš„ beanï¼Œæ‰å®šä¹‰bean ï¼š beanCï¼› return new C(); &#125;&#125; åƒè€ƒè³‡æ–™ï¼šSpring BootåŸºäºç‰¹å®šæ¡ä»¶åˆ›å»ºBeanä¾‹å­ : ConditionalOnMissingBeanhttps://blog.csdn.net/andy_zhang2007/article/details/81285130","categories":[{"name":"Spring","slug":"Spring","permalink":"http://a10000005588.github.io/categories/Spring/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://a10000005588.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"http://a10000005588.github.io/tags/Spring/"}]},{"title":"èªè­˜èˆ‡å­¸ç¿’Bash [Linuxé³¥å“¥ Ch10]","slug":"linux-bash","date":"2020-01-28T12:38:19.000Z","updated":"2021-02-14T05:53:01.427Z","comments":true,"path":"2020/01/28/linux-bash/","link":"","permalink":"http://a10000005588.github.io/2020/01/28/linux-bash/","excerpt":"","text":"Bash shell åŠŸèƒ½æ‰“éçš„æŒ‡ä»¤éƒ½æ˜¯è¨˜éŒ„åœ¨ ./bash_history. æ³¨æ„é§­å®¢å¯ä»¥é€é history ä¾†æŸ¥çœ‹ä½ å…ˆå‰æ‰“éæŒ‡ä»¤ ex: MySQL ç™»å…¥å¸³æˆ¶å¯†ç¢¼è³‡è¨Š alias å–ä»£å¾ˆé•·çš„æŒ‡å®šè‹¥ä¸æƒ³è¦æ¯æ¬¡æ‰“é€™éº¼é•·æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨alias ä¾†å–ä»£ä¾‹å¦‚ï¼š ls -a å¯ä»¥é€é alias lm=&#39;ls -al&#39; ä»¥lmä¾†å–ä»£ type æŸ¥çœ‹æŒ‡ä»¤æ˜¯å…§éƒ¨æŒ‡ä»¤æˆ–å¤–éƒ¨æŒ‡ä»¤åƒä¸Šé¢ä¾‹å­ lm=&#39;ls -al&#39; çš„lm ç‚ºæˆ‘å€‘è‡ªè¡Œå®šç¾©çš„å¤–éƒ¨æŒ‡ä»¤é‚£cd, lsé€™äº›å‰‡æ˜¯å…§éƒ¨æŒ‡ä»¤ é€é type lm, å¯ä»¥çœ‹åˆ°lm ç‚ºå¤–éƒ¨æŒ‡ä»¤ è‹¥è¦ºå¾—ä¸‹çš„æŒ‡ä»¤å¤ªé•· å¯ä»¥é€é \\å°‡ä¸‰å€‹æª”æ¡ˆcpåˆ° /rootå…§â€¦ä¸¦ç”¨ \\ä¾†æ¥çºŒæŒ‡ä»¤12cp /var/spool/mail/root /etc/crontab \\ &gt; /etc/fstab /root å–å¾—ç‰ˆæœ¬è™Ÿuname -r å¯ç”¨è®Šæ•¸å°‡ç‰ˆæœ¬è™Ÿå­˜èµ·ä¾†123version=$(uname -r) // å°‡ç‰ˆæœ¬è™Ÿæ”¾åˆ°versionè®Šæ•¸echo $version è®Šæ•¸è¨­å®šè¦å‰‡ç­‰è™Ÿä¸èƒ½æœ‰ç©ºæ ¼1myname=VBird è®Šæ•¸å…§å®¹æœ‰ç©ºç™½ï¼Œå¯ç”¨â€â€ æˆ– â€˜â€™åŒ…èµ·ä¾†1var=&quot;lang is $LANG&quot; å¯ç”¨è·³è„«å­—å…ƒ â€œ\\â€ å°‡ç‰¹æ®Šç¬¦è™Ÿè®Šæˆä¸€èˆ¬å­—å…ƒ è®Šæ•¸ç‚ºæ“´å¢è®Šæ•¸å…§å®¹æ™‚ï¼Œå¯ä»¥ç”¨$è®Šæ•¸åç¨± æˆ–${è®Šæ•¸} ç´¯åŠ å…§å®¹1PATH=$PATH:/home/bin è®Šæ•¸éœ€è¦åœ¨å…¶ä»–å­ç¨‹åºåŸ·è¡Œï¼Œéœ€è¦ä»¥ export ä¾†ä½¿è®Šæ•¸æˆç‚ºç’°å¢ƒè®Šæ•¸1export PATH ä»€éº¼æ˜¯å­ç¨‹åºï¼Ÿ åœ¨ç›®å‰çš„shellæƒ…æ³ä¸‹ï¼Œé–‹å•Ÿå¦å¤–ä¸€å€‹shelläº¦å³ç‚ºå­ç¨‹åº å–æ¶ˆè®Šæ•¸çš„æ–¹æ³•ç‚º unset $() è¢«å…©å€‹é€—è™ŸåŒ…èµ·ä¾†çš„æŒ‡ä»¤æœƒå„ªå…ˆåŸ·è¡Œ 123cd /lib/modules/$(uname -r)/kernalå…ˆç”¨ uname -r å–å¾—ç•¶å‰linux kernalç‰ˆæœ¬è™Ÿï¼Œå†cdåˆ°è©²ç‰ˆæœ¬çš„ç›®éŒ„ é€é env å¯ä»¥çœ‹åˆ°ç›®å‰è¨­ç½®çš„ç’°å¢ƒè®Šæ•¸ HOME: å®¶ç›®éŒ„ SHELL:ç›®å‰shellä½¿ç”¨çš„ç¨‹å¼ï¼Œé è¨­æ˜¯ /bin/bash HISTSIZE: ç´€éŒ„æ­·å²æŒ‡ä»¤å¾—æ•¸ç›® PATH: åŸ·è¡Œé»¨æœå°‹çš„è·¯å¾‘ LANG: èªç³»è³‡æ–™ RANDOM: éš¨æ©Ÿäº‚æ•¸ RANDOMæœƒç”¢å‡º 0~32767è‹¥æƒ³è¦éš¨æ©Ÿå–å‡º0~9declare -i number=$RANDOM*10/32768 ; echo $number é€é set å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®Šæ•¸ (ç’°å¢ƒè®Šæ•¸+è‡ªå®šç¾©è®Šæ•¸)é€é PS1 è¨­å®š æç¤ºå­—å…ƒex: PS1=&#39;[\\u@\\h \\w \\A #\\#]\\$ &#39;è¨­å®šå‘½ä»¤æç¤ºå­—å…ƒé¡¯ç¤ºç›®å‰è¼¸å…¥å¹¾æ¬¡æŒ‡ä»¤ ï¼ è®Šæ•¸éµç›¤çš„è®€å–ã€é™£åˆ—èˆ‡å®£å‘Š: read, array, declareread: è®€å–ä¾†è‡ªä½¿ç”¨è€… éµç›¤çš„è¼¸å…¥ex: æç¤ºä½¿ç”¨è€…30ç§’å…§è¼¸å…¥è‡ªå·±çš„å¤§åï¼Œä¸¦å°‡å¤§åå¡å…¥ $named è®Šæ•¸å…§123read -p &quot;Please keyin your name: &quot; -t 30 namedecho $named delcare: å®£å‘Šè®Šæ•¸çš„é¡å‹123456declare [-aixr] variable-a : å°‡å¾Œé¢åç‚ºvariableå®šç¾©ç‚º arrayé¡å‹-i : integer-x : è®Šæˆç’°å¢ƒè®Šæ•¸-r : è¨­ç½®æˆread only æ³¨æ„ï¼šè‹¥sum=100+300+200 echo $sum æœƒå¾—åˆ° â€œ100+300+200â€å­—ä¸²ï¼Œä¸¦éæ˜¯600çš„çµæœï¼Œéœ€è¦ç”¨ declare -i sum æ‰èƒ½å¾—åˆ°integer sum unlimit æª”æ¡ˆç³»çµ±èˆ‡ç¨‹åºçš„é™åˆ¶é—œä¿‚é™åˆ¶ä½¿ç”¨è€…æ‰€ä½¿ç”¨çš„ç³»çµ±è³‡æºï¼ŒåŒ…æ‹¬CPUæ™‚é–“ï¼Œè¨˜æ†¶é«”æ•¸é‡ 123456789ulimit [-SHacdltu] [é…é¡]-H : hard limit åš´å¾·çš„é™åˆ¶ï¼Œè‹¥è¶…éå‰‡ä¸èƒ½å†ç”¨-S : Soft limit è­¦å‘Šçš„é™åˆ¶ï¼Œè¶…éåªæ˜¯æœƒè­¦å‘Š-a : åˆ—å‡ºç›®å‰é™åˆ¶çš„æ•¸é‡ï¼Œè‹¥ä¸æ¥åƒæ•¸å‰‡åˆ—å‡ºå…¨éƒ¨-c : ç•¶æŸäº›ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤ï¼Œç³»çµ±æœƒå°‡è©²ç¨‹å¼åœ¨è¨˜æ†¶é«”çš„è³‡è¨Šå¯«æˆæª”æ¡ˆ (å¯é™¤éŒ¯ç”¨)-f : æ­¤shell å¯ä»¥å»ºç«‹çš„æœ€å¤§æª”æ¡ˆå®¹é‡-u : å–®ä¸€ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨çš„æœ€å¤§processæ•¸é‡... è®Šæ•¸çš„åˆªé™¤ã€å–ä»£èˆ‡æ›¿æ›ç›´æ¥çœ‹ç¯„ä¾‹ï¼š åˆªé™¤ \\#ï¼šå¾å‰é¢é–‹å§‹åˆªé™¤, åˆªé™¤ç¬¦åˆå–ä»£æ–‡å­—çš„ ã€æœ€çŸ­çš„ã€é‚£ä¸€å€‹ \\##ï¼š ï¼ï¼ï¼ï¼ã€æœ€é•·çš„ã€ \\%ï¼šå¾å¾Œé¢é–‹å§‹åˆªé™¤ï¼Œâ€¦..åˆªé™¤ã€æœ€çŸ­çš„ã€ \\%%ï¼š ã€æœ€é•·çš„ã€ æ›¿æ›username=${username-root}è‹¥usernameç‚ºç©ºå€¼ï¼Œæ›¿æ›æˆroot è‹¥åŠ ä¸Š: å¯ä»¥å¼·åˆ¶æ›¿æ›username=${username:-root} åŠ ä¸Š? å¯ä»¥åˆ¤æ–·æ˜¯å¦æœ‰ç„¡æ­¤è®Šæ•¸ bashçš„é€²ç«™èˆ‡æ­¡è¿è¨Šæ¯ : /etc/issue, /etc/motd1cat /etc/issue bashçš„ç’°å¢ƒè¨­å®šæª”login èˆ‡ non-login shell login shellå–å¾—bashæ™‚éœ€è¦å®Œæ•´è¼¸å…¥ç™»å…¥æµç¨‹(è¼¸å…¥å¸³è™Ÿå¯†ç¢¼) /etc/profile: ç³»çµ±æ•´é«”çš„è¨­å®šï¼ˆæœ€å¥½åˆ¥ä¿®æ”¹) ~/.bash_profile ~/.bash_login ~/.profile: å±¬æ–¼ä½¿ç”¨è€…å€‹äººè¨­å®š ç³»çµ±ç™»å…¥shellæ™‚ï¼Œå„ªå…ˆè¼‰å…¥ /etc/profile å†ä¾†æ‰æœƒä¾åºè¼‰å…¥ä½¿ç”¨è€…è¨­å®šæª”123~/.bash_profile~/.bash_login~/.profile åªæœƒè®€å–ä¸Šé¢çš„ä¸€å€‹ï¼Œç”±ä¸Šè€Œä¸‹ç„¶è€Œä¸Šé¢ä¸‰å€‹æª”æ¡ˆå¯èƒ½æœƒæœ‰åŒ…å«åŸ·è¡Œ ~/.bashrc çš„å…§å®¹ã€‚ã€‚ã€‚ 1234567# if running bash if [ -n \"$BASH_VERSION\" ]; then # include .bashrc if it exists if [ -f \"$HOME/.bashrc\" ]; then # here is the .bashrc . \"$HOME/.bashrc\" fi fi non-login shellç›´æ¥æ‰“é–‹å¦å¤–ä¸€å€‹çµ‚ç«¯æ©Ÿ(shell)ï¼Œè©²shellç‚º non-login shell åœ¨non-login shellå…§è¦è¼‰å…¥ä½¿ç”¨è€…ï¼Œ å¾—æ‰‹å‹• ./bashrc &gt;, &gt;&gt;, |&gt; : å–ä»£&gt;&gt; : ç´¯åŠ  å‘½ä»¤åŸ·è¡Œçš„åˆ¤æ–·ä¾æ“šï¼š ; , &amp;&amp; ||åˆ†è™Ÿ ; ï¼š å¯ä»¥åŸ·è¡Œé€£çºŒæŒ‡ä»¤1sync; sync; shutdown -h now $? ã€ &amp;&amp; ã€ || å¯ä»¥åˆ¤æ–·æŒ‡ä»¤æ˜¯å¦æˆåŠŸåŸ·è¡Œ$?ï¼šè‹¥å‰ä¸€å€‹æŒ‡ä»¤åŸ·è¡Œçš„çµæœæ­£ç¢ºï¼Œåœ¨linuxåº•ä¸‹æœƒå›å‚³ä¸€å€‹ $?=0çš„å€¼ (cmd1 &amp;&amp; cmd2): è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”æ­£ç¢ºåŸ·è¡Œ($?=0)ï¼Œå‰‡é–‹å§‹åŸ·è¡Œ cmd2 è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”åŸ·è¡ŒéŒ¯èª¤($? != 0)ï¼Œå‰‡ä¸åŸ·è¡Œ cmd2 (cmd1 || cmd2): è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”æ­£ç¢ºåŸ·è¡Œ($?=0)ï¼Œå‰‡cmd2ä¸åŸ·è¡Œ è‹¥cmd1åŸ·è¡Œå®Œç•¢ä¸”åŸ·è¡ŒéŒ¯èª¤($? != 0)ï¼Œå‰‡é–‹å§‹åŸ·è¡Œ cmd2 pipe ç®¡ç·šå‘½ä»¤ï¼š è³‡æ–™éœ€è¦ç¶“éå¤šå€‹è™•ç†æ‰‹çºŒ1ls -al /etc | less é€é | å¯ä»¥å°‡ /etc æ’ˆå‡ºä¾†çš„è³‡è¨Šçµ¦ lessè§£è®€ æ“·å–å‘½ä»¤ï¼š cut, grep cut: å°‡æŸä¸€æ®µè¨Šæ¯åˆ‡å‰²å‡ºä¾† 1echo $PATH | cut -d &apos;:&apos; -f 3,5 åˆ—å‡º PATHä¸­çš„ç¬¬3å’Œç¬¬5å€‹è·¯å¾‘ grep: éæ¿¾å‡º æœ‰ç¬¦åˆå­—å…ƒçš„è¨Šæ¯ æ’åºå‘½ä»¤ï¼š sort, wc, uniqsort å¯ä»¥ä½¿èªç³»çµ±ä¸€ LANG=C è®“è³‡æ–™æ’åºå¥½ä¸€äº› 1cat /etc/passwd | sort uniq: æ’åºå®Œæˆ ä¸¦å°‡é‡è¤‡çš„è³‡æ–™åƒ…åˆ—å‡ºä¸€å€‹é¡¯ç¤º 12last | cut -d &apos; &apos; -f1 | sort | uniq -cçŸ¥é“æ¯ä½ä½¿ç”¨è€…çš„ç™»å…¥æ¬¡æ•¸ wc: çŸ¥é“æŸå€‹æª”æ¡ˆçš„çµ„æˆ 1cat /etc/man.config | wc tee: é›™å‘é‡æ–°å°å‘last | tee last.list | cut -d &quot; &quot; -fi: é€™å€‹ç¯„ä¾‹å¯ä»¥è®“æˆ‘å€‘å°‡last çš„è¼¸å‡ºå­˜ä¸€ä»½åˆ°last.list æª”æ¡ˆä¸­ last | /home | tee ~/homefile | more: é€™å€‹ç¯„ä¾‹æ˜¯å°‡ ls çš„è³‡æ–™å­˜ä¸€ä»½åˆ° ~/homefile ï¼ŒåŒæ™‚è¢å¹•ä¹Ÿæœ‰è¼¸å‡ºè¨Šæ¯ å­—å…ƒè½‰æ›å‘½ä»¤: tr, col, join, paste, expandtr: åˆªé™¤ä¸€æ®µè¨Šæ¯ä¸­çš„æ–‡å­—ã€æˆ–è€…æ˜¯é€²è¡Œæ–‡å­—çš„è½‰æ› col: ç¶“å¸¸è¢«ç”¨ä¾†å°‡ man page è½‰å­˜ç‚ºç´”æ–‡å­—æª”æ¡ˆä»¥æ–¹ä¾¿æŸ¥é–± 1man col | col -b &gt; /root/col.man join: å…©å€‹æª”æ¡ˆç•¶ä¸­ï¼Œæœ‰ç›¸åŒè³‡æ–™çš„é‚£ä¸€è¡Œï¼Œæ‰å°‡å®ƒåŠ åœ¨ä¸€èµ· åˆ†å‰²å‘½ä»¤: split1cat termcap* &gt;&gt; termcapback ä½¿ç”¨ ls -al / è¼¸å‡ºçš„è³‡è¨Šä¸­ï¼Œæ¯åè¡Œç´€éŒ„è®Šæˆä¸€å€‹æª”æ¡ˆ1ls -al / | split -l 10 lsroot 1wc -l lsroot* åƒæ•¸ä»£æ›ï¼š xargs: ç”¢ç”ŸæŸå€‹æŒ‡ä»¤çš„åƒæ•¸æœ‰äº›æŒ‡ä»¤ä¸å…¶å¯¦ä¸¦ä¸æ”¯æ´ç®¡ç·šå‘½ä»¤ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€éxargè©²æŒ‡ä»¤å¼•ç”¨ standard inputä¹‹ç”¨ã€‚ æ¸›è™Ÿ -çš„ç”¨é€”tar -cvf - /home | tar -xvf - æˆ‘å°‡/homeè£¡é¢çš„æª”æ¡ˆçµ¦ä»–æ‰“åŒ…ï¼Œä½†æ‰“åŒ…çš„è³‡æ–™ä¸æ˜¯è¨˜éŒ„åˆ°æª”æ¡ˆï¼Œè€Œæ˜¯å‚³é€åˆ°stdout; ç¶“éç®¡ç·šå¾Œï¼Œå°‡tar -cvf - /home å‚³é€çµ¦å¾Œé¢çš„tar -xvf - å¾Œé¢ - å–ç”¨å‰ä¸€å€‹æŒ‡ä»¤çš„stdoutï¼Œ å› æ­¤ä¸éœ€è¦ä½¿ç”¨file","categories":[{"name":"Devops","slug":"Devops","permalink":"http://a10000005588.github.io/categories/Devops/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://a10000005588.github.io/tags/Linux/"}]},{"title":"2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ","slug":"2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ","date":"2020-01-01T13:30:48.000Z","updated":"2021-01-28T12:14:59.145Z","comments":true,"path":"2020/01/01/2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ/","link":"","permalink":"http://a10000005588.github.io/2020/01/01/2020å¹´çš„æƒ³æ³•èˆ‡è‡ªä¿®è¦åŠƒ/","excerpt":"å›é¡§äº†ä¸€ä¸‹2019å¹´å°è‡ªå·±çš„æœŸè¨±ï¼Œè‡ªå·±èˆ‡æœŸè¨±çš„ä¼¼ä¹é‚„æœ‰æ‰€å·®è·ï¼Œå°±å†æ¥å†å²ã€‚","text":"å›é¡§äº†ä¸€ä¸‹2019å¹´å°è‡ªå·±çš„æœŸè¨±ï¼Œè‡ªå·±èˆ‡æœŸè¨±çš„ä¼¼ä¹é‚„æœ‰æ‰€å·®è·ï¼Œå°±å†æ¥å†å²ã€‚ å¸Œæœ›ä»Šå¹´å¼·åŒ–è‡ªèº«çš„ç¶²ç«™é–‹ç™¼çš„å¯¦åŠ›(ä»¥å¾Œç«¯ç‚ºä¸»)æ¥ä¸‹ä¾†2020å¹´æƒ³è¦è¶ä¸‹ç­é–’æš‡æ™‚é–“æ™‚ä¾†åšï¼š åˆ·åˆ·leetcode æ‰¾ä¸€å€‹side projectä¾†ç¶“ç‡Ÿ (é è¨ˆç”¨Java Spring Bootå¾Œç«¯, Angularå‰ç«¯) è¤‡ç¿’è³‡æ–™çµæ§‹ï¼Œè³‡æ–™åº«SQLèªæ³•ç­‰ ä»¥ä¸Šç¹¼çºŒç²¾é€²ï¼Œè‡ªæˆ‘å‹‰å‹µ","categories":[{"name":"Life","slug":"Life","permalink":"http://a10000005588.github.io/categories/Life/"}],"tags":[{"name":"Mindsets","slug":"Mindsets","permalink":"http://a10000005588.github.io/tags/Mindsets/"}]},{"title":"å¦‚ä½•æŸ¥çœ‹é€éæ™ºèƒ½åˆç´„å­˜åœ¨ä»¥å¤ªåŠä¸Šçš„è³‡æ–™ï¼Ÿ","slug":"checksmartcontractdata","date":"2019-02-10T15:25:43.000Z","updated":"2019-02-10T15:36:44.807Z","comments":true,"path":"2019/02/10/checksmartcontractdata/","link":"","permalink":"http://a10000005588.github.io/2019/02/10/checksmartcontractdata/","excerpt":"åœ¨çœ‹é€™ç¯‡æ–‡ç« ä¹‹å‰å¿…é ˆè¦çŸ¥é“ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯é€éæ™ºèƒ½åˆç´„å­˜åœ¨å€å¡Šéˆä¸Šçš„è³‡è¨Šéƒ½æ˜¯å…¬é–‹çš„ã€‚","text":"åœ¨çœ‹é€™ç¯‡æ–‡ç« ä¹‹å‰å¿…é ˆè¦çŸ¥é“ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯é€éæ™ºèƒ½åˆç´„å­˜åœ¨å€å¡Šéˆä¸Šçš„è³‡è¨Šéƒ½æ˜¯å…¬é–‹çš„ã€‚ ä¸ç®¡ä½ æ˜¯å¦æœ‰åœ¨æ™ºèƒ½åˆç´„ä¸Šé¢æœ‰ç”¨requre(), revert(), assert()ç­‰ç­‰ä¾†é™åˆ¶æŸåœ°å€çš„äººä¾†å­˜å–æ™ºèƒ½åˆç´„ä¸Šçš„è®Šæ•¸ï¼Œä½†é€™äº›è®Šæ•¸éƒ½æœƒå­˜ä»¥å¤ªåŠEVMçš„Storageä¸Šé¢ï¼Œæ¯å€‹ç¯€é»éƒ½å¯ä»¥é€éä»¥ä¸‹æ–¹å¼ä¾†å°EVMçš„Storageå…§çš„ç·¨ç¢¼é€²è¡Œè§£æï¼Œä¸¦é‚„åŸç•¶åˆé€éåˆç´„æ‰€å„²å­˜çš„è®Šæ•¸è³‡æ–™ï¼ï¼ï¼ ä»¥ä¸‹é€éä¸€å€‹ç¯„ä¾‹ä¾†ç­è§£å¦‚ä½•é€éweb3.js libraryä¸­çš„eth.getStorage()æ–¹æ³•ä¾†è§£æStorageå…§å„²å­˜çš„è³‡è¨Šã€‚ æ™ºèƒ½åˆç´„ç¯„ä¾‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445prama solidity ^0.4.0;contract testStorage &#123; uint storeduint1 = 15; uint constant constuint = 16; uint128 investmentsLimit = 17055; uint32 investmentsDeadlinedTimeStamp = uint32(now); bytes16 string1 = 'test1'; bytes32 string2 = 'test1236'; string string3 = 'lets string something'; mapping (address =&gt; uint) uints1; mapping (address =&gt; DeviceData) structs1; uint[] uintarray; DeviceData[] deviceDataArray; struct DeviceData &#123; string deviceBrand; string deviceYear; string batteryWearLevel; &#125; function testStorage() &#123; address address1 = 0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6 address address2 = 0xaee905fdd3ed851e48d22059575b9f4245a82b04; uints1[address1] = 88; uints1[address2] = 99; var dev1 = DeviceData('deviceBrand', 'deviceYear', 'wearLevel'); var dev2 = DeviceData('deviceBrand2', 'deviceYear2', 'wearLevel2'); structs1[addresss1] = dev1; structs1[addresss2] = dev2; uintarray.push(8000); uintarray.push(9000); deviceDataArray.push(dev1); deviceDataArray.push(dev2); &#125;&#125; å‡è¨­æˆ‘å€‘åˆç´„çš„åœ°å€æ˜¯åœ¨ï¼š0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b æ‰€æœ‰å„²å­˜åœ¨storageå…§çš„åƒæ•¸éƒ½å¯ä»¥ç”¨indexä¾†ç´¢å¼•ï¼Œindexçš„æ ¼å¼ç‚º256 bytesä»¥åŠå°æ‡‰64ç¢¼ã€‚åœ¨ä»¥ä¸Šçš„ç¯„ä¾‹ä¸­æˆ‘å€‘æœ‰ 10å€‹åƒæ•¸ï¼Œæ‰€ä»¥å¯ä»¥é€éindexä¾†ä¸€ä¸€éæ­·ä»–å€‘ï¼š 12345678910111213141516let contractAddress = &apos;0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b&apos;for (index = 0; index &lt; 10; index++)&#123; console.log(`[$&#123;index&#125;]` + web3.eth.getStorageAt(contractAddress, index))&#125;result:[0] 0x000000000000000000000000000000000000000000000000000000000000000f[1] 0x00000000000000000000000059b92d9a0000000000000000000000000000429f[2] 0x0000000000000000000000000000000074657374310000000000000000000000[3] 0x7465737431323336000000000000000000000000000000000000000000000000[4] 0x6c65747320737472696e6720736f6d657468696e67000000000000000000002a[5] 0x0000000000000000000000000000000000000000000000000000000000000000[6] 0x0000000000000000000000000000000000000000000000000000000000000000[7] 0x0000000000000000000000000000000000000000000000000000000000000002[8] 0x0000000000000000000000000000000000000000000000000000000000000002[9] 0x0000000000000000000000000000000000000000000000000000000000000000 é–‹å§‹é‡å°åˆç´„å…§çš„10å€‹è®Šæ•¸ä¸€ä¸€åšéæ­·å’Œè§£æ index 0 - storeduint11234567let contractAddress = &apos;0xf1f5896ace3a78c347eb7eab503450bc93bd0c3b&apos;let index = 0console.log(web3.eth.getStorageAt(contractAddress, index))console.log(&apos;DEC:&apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, index)))result:0x000000000000000000000000000000000000000000000000000000000000000fDEC:15 constuintConstants(å¸¸æ•¸) ä¸æœƒè¢«å­˜åœ¨storageå…§ï¼Œåªèƒ½å¤ é€écodeä¾†å­˜å– index 1 - investmentsLimit, investmentsDeadlineTimeStamp12345let index = 1console.log(web3.eth.getStorageAt(contractAddress, index))result: 0x00000000000000000000000059b92d9a0000000000000000000000000000429fDEC: 1505308058 and 17055 åœ¨index 1ä¸­ï¼Œæœƒå°‡2å€‹è®Šæ•¸(investmentsLimit, investmentsDeadlineTimeStamp)åšåˆä½µä¾†æœ€ä½³åŒ–storageçš„å­˜æ”¾ index 2 - string11234567index = 2console.log(web3.eth.getStorageAt(contractAddress, index))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))result: 0x0000000000000000000000000000000074657374310000000000000000000000ASCII: test1 index 3 - string21234567index = 3console.log(web3.eth.getStorageAt(contractAddress, index))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))result:0x7465737431323336000000000000000000000000000000000000000000000000ASCII: test1236 index 4 - string31234567index = 4console.log(web3.eth.getStorageAt(contractAddress, index))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, index)))result:0x6c65747320737472696e6720736f6d657468696e67000000000000000000002aASCII: lets string something * (42) åœ¨resultæœ€å¾Œæœ‰ 2a(dec42)ç‚º stringå„²å­˜çš„é•·åº¦å¯åƒé–±solidityå®˜æ–¹æ–‡ä»¶æè¿°è®Šæ•¸åœ¨storageä¸­å‘ˆç¾çš„æ ¼å¼ï¼šhttps://solidity.readthedocs.io/en/latest/miscellaneous.html#layout-of-state-variables-in-storage index 5 â€” uints112345index = 5console.log(web3.eth.getStorageAt(contractAddress, index))result:0x0000000000000000000000000000000000000000000000000000000000000000PROBLEM!!!! è‹¥é‡åˆ° mapping structå®£å‘Šçš„è®Šæ•¸ï¼Œç„¡æ³•ç›´æ¥é€éä¸€èˆ¬çš„indexä¾†å–å¾—structå…§æ‰€å„²å­˜çš„å€¼ï¼Œå¿…é ˆå¾—æ›‰å¾—å°æ‡‰valueä¸­çš„ keyå€¼ï¼Œå¦å‰‡æ˜¯ä¸å¯èƒ½å–å¾—çš„ã€‚ 1234/* è¦å–å›åœ¨ uints1 structæ‰€å„²å­˜åœ¨addresss1çš„å€¼ :88// uints1[address1] = 88; address1 = 0xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6 1234567891011index = &apos;0000000000000000000000000000000000000000000000000000000000000005&apos;// convert address1 to the 256 bytes...key = &apos;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&apos;let newKey = web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;DEC: &apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))result:0x0000000000000000000000000000000000000000000000000000000000000058DEC: 88 index6 - structs1123456789index = &quot;0000000000000000000000000000000000000000000000000000000000000006&quot;key = &quot;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&quot;let newKey = web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))result:0x6465766963654272616e64000000000000000000000000000000000000000016ASCII: deviceBrand è‹¥è¦è®€å–ä¸‹ä¸€å€‹structçš„å€¼ï¼Œåªéœ€è¦å°‡newKeyçš„å€¼+1å³å¯å–åˆ°ã€‚ 12345678910111213141516function increaseHexByOne(hex) &#123; let x = new BigNumber(hex) let sum = x.add(1) let result = &apos;0x&apos; + sum.toString(16) return result&#125;index = &quot;0000000000000000000000000000000000000000000000000000000000000006&quot;key = &quot;00000000000000000000000xbccc714d56bc0da0fd33d96d2a87b680dd6d0df6&quot;let newKey = increaseHexByOne( web3.sha3(key + index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))console.log(web3.eth.getStorageAt(contractAddress,newKey))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))result:0x6465766963655965617200000000000000000000000000000000000000000014ASCII: deviceYear è‹¥é‚„éœ€è¦ç¬¬ä¸‰å€‹ä¹‹å¾Œçš„å€¼ï¼Œç¹¼çºŒå°‡newKeyéå¢ï¼Œå°±èƒ½å¤ å–åˆ°ã€‚ index 7 - uintarray12345index = &quot;7&quot;console.log(web3.eth.getStorageAt(contractAddress, index))result: 0x0000000000000000000000000000000000000000000000000000000000000002 ä»¥ä¸Šçš„resultè¡¨ç¤º arrayç›®å‰æœ‰2å€‹å€¼ (8000, 9000) 123456789101112131415161718index = &quot;0000000000000000000000000000000000000000000000000000000000000007&quot;let newKey = web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;DEC: &apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))result:0x0000000000000000000000000000000000000000000000000000000000001f40DEC: 8000---newKey = increaseHexByOne(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;DEC: &apos; + web3.toDecimal(web3.eth.getStorageAt(contractAddress, newKey)))result:0x0000000000000000000000000000000000000000000000000000000000002328DEC: 9000 index 8 - deviceDataArray1234567891011121314151617181920index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;let newKey = web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;)console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;ASCII: &apos; + web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))result:0x6465766963654272616e64000000000000000000000000000000000000000016ASCII: deviceBrand---index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;let newKey = increaseHexByOne(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;ASCII: &apos; +web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))result:0x6465766963655965617200000000000000000000000000000000000000000014ASCII: deviceYear ç¹¼çºŒå¢åŠ indexçš„å€¼(+1), result: 12345678index = &quot;0000000000000000000000000000000000000000000000000000000000000008&quot;let newKey = increaseHexByTwo(web3.sha3(index, &#123;&quot;encoding&quot;:&quot;hex&quot;&#125;))console.log(web3.eth.getStorageAt(contractAddress, newKey))console.log(&apos;ASCII: &apos; +web3.toAscii(web3.eth.getStorageAt(contractAddress, newKey)))result:0x776561724c6576656c0000000000000000000000000000000000000000000012ASCII: wearLevel è‹¥åŠ 3ä¹‹å¾Œï¼Œresultæœƒé¡¯ç¤ºç¬¬äºŒçµ„(dev2) å­˜é€²arrayçš„å€¼ 1234result:0x6465766963654272616e64320000000000000000000000000000000000000018ASCII: deviceBrand2 ReferenceHow to read Ethereum contract storage - Darius https://medium.com/aigang-network/how-to-read-ethereum-contract-storage-44252c8af925","categories":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/categories/Solidity/"}],"tags":[{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/tags/Ethereum/"},{"name":"Smart Contract","slug":"Smart-Contract","permalink":"http://a10000005588.github.io/tags/Smart-Contract/"},{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/tags/Solidity/"}]},{"title":"2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ","slug":"2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ","date":"2019-02-05T13:24:10.000Z","updated":"2021-01-28T12:15:13.966Z","comments":true,"path":"2019/02/05/2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ/","link":"","permalink":"http://a10000005588.github.io/2019/02/05/2019å¹´çš„æƒ³æ³•èˆ‡è¦åŠƒ/","excerpt":"å‰›å¥½åœ¨è¾²æ›†æ–°å¹´ç¬¬ä¸€å¤©ï¼Œç‚ºè‡ªå·±çš„Blogæ›çš„æ–°çš„Skinï¼ŒåŒæ™‚ä¹Ÿæƒ³å‹‰å‹µè‡ªå·±é‡æ‹¾å¯«éƒ¨è½æ ¼çš„æ‰‹æ„Ÿã€‚","text":"å‰›å¥½åœ¨è¾²æ›†æ–°å¹´ç¬¬ä¸€å¤©ï¼Œç‚ºè‡ªå·±çš„Blogæ›çš„æ–°çš„Skinï¼ŒåŒæ™‚ä¹Ÿæƒ³å‹‰å‹µè‡ªå·±é‡æ‹¾å¯«éƒ¨è½æ ¼çš„æ‰‹æ„Ÿã€‚ ç”±æ–¼è‡ªå·±æƒ³å¾€å€å¡Šéˆæˆ–æ˜¯é›²ç«¯å¾Œç«¯å·¥ç¨‹å¸«ç™¼å±•ï¼Œæ‰€ä»¥åœ¨2019å¹´å¸Œæœ›è‡ªå·±èƒ½å¤ å†æ¬¡è¤‡ç¿’ç¶²è·¯ä»¥åŠä½œæ¥­ç³»çµ±ç­‰çŸ¥è­˜ï¼Œ ä»¥ä¸Šï¼Œå¸Œæœ›2019å¹´èƒ½å¤ é †åˆ©å®Œæˆè«–æ–‡ï¼Œä¸”èƒ½å¤ æ‰¾åˆ°ä¸€ä»½å¥½å·¥ä½œï¼Œä¸¦ä¸”æŒçºŒç²¾é€²è‡ªå·±çš„æŠ€è¡“ã€‚","categories":[{"name":"Life","slug":"Life","permalink":"http://a10000005588.github.io/categories/Life/"}],"tags":[{"name":"Mindsets","slug":"Mindsets","permalink":"http://a10000005588.github.io/tags/Mindsets/"}]},{"title":"Go Interfaceä»‹ç´¹","slug":"go-interface","date":"2018-07-05T15:51:38.000Z","updated":"2020-08-17T13:55:20.039Z","comments":true,"path":"2018/07/05/go-interface/","link":"","permalink":"http://a10000005588.github.io/2018/07/05/go-interface/","excerpt":"ç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­ä¾†èˆ‰ä¾‹ï¼š Water-pipelineå°±åƒæ˜¯å€‹interface ä½ å°±åªèƒ½çŒæ¶²é«”é€²å»ï¼Œä¸èƒ½å¡éæ¶²é«”çš„æ±è¥¿åˆ° water-pipeline","text":"ç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­ä¾†èˆ‰ä¾‹ï¼š Water-pipelineå°±åƒæ˜¯å€‹interface ä½ å°±åªèƒ½çŒæ¶²é«”é€²å»ï¼Œä¸èƒ½å¡éæ¶²é«”çš„æ±è¥¿åˆ° water-pipelineå†ç”¨ç«è»Šéµè»Œç‚ºä¾‹ï¼šRailroads æ˜¯train çš„ interfaces ä¸ç®¡trainä¸Šé¢è¼‰çš„ä»€éº¼ç‰©é«”ï¼Œçœ‹æ˜¯passengers é‚„æ˜¯cargos ä½†trainçš„å¯¬åº¦ (width of the train) éƒ½å¿…é ˆè¦ç¬¦åˆéµè»Œå¯¬åº¦ã€‚ \bæ•… railroads çš„ interfacesæœƒæœ‰ä»¥ä¸‹çš„çµ„æˆè¦ç´ ï¼š 123type RailRoadWidthChecker interface &#123; CheckRailsWidth() int&#125; RailRoadWidthChecker è¦ç¯„äº† trainå¿…é ˆè¦å¯¦ä½œæª¢æŸ¥ç«è»Šè‡ªèº«çš„widthï¼Œç¢ºä¿trainçš„widthæ˜¯å‰›å¥½ç¬¦åˆ railroad çš„å¯¬åº¦ 123type RailRoad struct &#123; Width int&#125; // åªæœ‰å®£å‘Šç‚ºtype RailRoadæ‰èƒ½å‘¼å« IsCorrectSizeTrain1234567891011121314151617func (railroad *RailRoad) IsCorrectSizeTrain (trainInstance RailRoadWidthChecker) bool &#123; return trainInstance.CheckRailsWidth() == railroad.Width&#125;``` || ç–‘å•ï¼šç‚ºä½•ä¸æ˜¯åœ¨inputä¸­typeç‚ºTrain ???|| Answer: å› ç‚ºç”±struct typeç‚º Trainå¯¦ä½œäº† struct type: RailRoadWidthCheckçš„CheckRailWidth()çš„æ–¹æ³•IsCorrectSizeTrain æœƒæ¥å—äº†ä¸€å€‹æœ‰å¯¦ä½œ interface instanceçš„ç«è»Šï¼Œä¸¦ä¸”å›å‚³è©²ç«è»Šå¯¬åº¦æ˜¯å¦èˆ‡éµè»Œç›¸åŒ```gotype Train struct &#123; TrainWidth int&#125;// å®£å‘Šç‚ºTrainçš„struct instance å¯¦ä½œ checkRailsWidth()å‡½å¼ ä¸¦å›å‚³ intå‹æ…‹func (p Train) CheckRailsWidth() int &#123; Return p.TrainWidth&#125; æ¥ä¸‹ä¾†ç”¨ å…©å°train ä¸€å€‹æœ‰ç¬¦åˆrailroadå¯¬åº¦ ä¸€å€‹å‰‡æ²’ç¬¦åˆå¯¬åº¦ ä¾†ä½œç‚ºç¯„ä¾‹ 123456789101112func main() &#123; railroad := RailRoad&#123;Width: 10&#125; passengerTrain := Train &#123; TrainWidth: 10 &#125; cargoTrain := Train &#123; TrainWidth: 15 &#125; // interfaceè¦æ±‚typeç‚ºTrainå¿…é ˆè¦å¯¦ä½œ CheckRailsWidth\b canPassengerTrainPass := railroad.IsCorrectSizeTrain(passengerTrain) canCargoTrainPass := railroad.IsCorrectSizeTrain(cargoTrain) fmt.Printf(â€œCan passengerTrain pass? :%t \\nâ€, canPassengerTrainPass) fmt.Printf(â€œCan cargoTrain pass? :%t \\nâ€, canCargoTrainPass)&#125; è¼¸å‡ºï¼š12Can passengerTrain pass? :trueCan cargoTrain pass? :false","categories":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"ä»¥å¤ªåŠæ¸¬è©¦ç¶²é€£æ¥ï¼šConnect to the Rospen Network","slug":"rospen","date":"2018-05-13T08:22:06.000Z","updated":"2020-07-26T09:17:43.173Z","comments":true,"path":"2018/05/13/rospen/","link":"","permalink":"http://a10000005588.github.io/2018/05/13/rospen/","excerpt":"Enviroment: MacOS Assume reader has basic understanding of geth and ethereum.","text":"Enviroment: MacOS Assume reader has basic understanding of geth and ethereum. Create a Ethereum WalletWe can via myetherwallet to create a wallet.https://www.myetherwallet.com/#generate-wallet Record your privakey, pubkey:12private key: a406da76baa7c741ad28bfe87cef2133950d6bb6bcaaf0b1742d93c3bea56babpublic key: 0x2C58e0338435FE91FD2209105EcADebE8aaFCebB Because we are going to connect the testnet Rospen, we should do some stuffâ€¦ Get a ether from faucet: For simplicity, we just ask someone to send some ether on testnet to us. Please attach your account address to get some ether. https://l.facebook.com/l.php?u=http%3A%2F%2Ffaucet.ropsten.be%3A3001%2F&amp;h=ATPjPzMFxxXmP_Egwq9V35ye_LjGOM4A_vzMkbQOdLCN8FYVRgfurVVTwrcuUzqNCMUiXF2C8sUqt241q8nmTJO6hCnY7WhpkV6iUVWxsIqjlALAeEVFv_kH5Q Check Tx from Rospen networkhttps://ropsten.etherscan.io/address/0x6508a973F080A9042a29d13925d9DB006f8c2989 In serch bar, enter your account address to see whether if the ether is sending to your account or not. Start to build a node and synchronize the Rospen network. Notice that your geth version should be the latest so that you can sucessfully sync the network. Current version : Version: 1.8.7-stable Before sync the node , Put your keystore file in the testnet document.When you download your keystore file.For example, the filename will be:UTC--2018-05-13T04-05-37.569Z--2c58e0338435fe91fd2209105ecadebe8aafcebbCopy this file into your testnet key store:/User/Library/Ethereum/testnet/keystore Sync to the Rospen networkhttps://github.com/ethereum/ropsten 1geth --unlock &lt;account&gt; --testnet --syncmode &quot;full&quot; &quot;enode://20c9ad97c081d63397d7b685a412227a40e23c8bdc6688c6f37e97cfbc22d2b4d1db1510d8f61e6a8866ad7f0e17c02b14182d37ea7c3c8b9c2683aeb6b733a1@52.169.14.227:30303,enode://6ce05930c72abc632c58e2e4324f7c7ea478cec0ed4fa2528982cf34483094e9cbc9216e7aa349691242576d552a2a56aaeae426c5303ded677ce455ba1acd9d@13.84.180.240:30303&quot; Threre are some flags: â€“unlock : use password to unlock the account. â€“testnet: connect to the rospen network. â€“syncmode â€œfullâ€: in order to get our balances, we should synchronize whole blocks. 1geth --testnet --fast --bootnodes &quot;enode://20c9ad97c081d63397d7b685a412227a40e23c8bdc6688c6f37e97cfbc22d2b4d1db1510d8f61e6a8866ad7f0e17c02b14182d37ea7c3c8b9c2683aeb6b733a1@52.169.14.227:30303,enode://6ce05930c72abc632c58e2e4324f7c7ea478cec0ed4fa2528982cf34483094e9cbc9216e7aa349691242576d552a2a56aaeae426c5303ded677ce455ba1acd9d@13.84.180.240:30303&quot; If we already sync the entire network, we can just use--fast --bootnodes to connect testnetâ€¦ Attach your gethOn MacOS (for testnet): geth attach ipc:/Users/&lt;username&gt;/Library/Ethereum/testnet/geth.ipc Then, in the console do eth.syncing you will see those stuff: 12345678&gt; eth.syncing&#123; currentBlock: 542220, highestBlock: 3224277, knownStates: 0, pulledStates: 0, startingBlock: 31397&#125; That means you are sucessfully connecting the testnet.After finish syncing process, you can see there is some ether in your accounts Problem for connecting the ropsten networkhttps://stackoverflow.com/questions/49195614/connection-failed-to-ethereum-ropsten-testnet-network Deploy to rospen network toturial:https://michalzalecki.com/deploying-smart-contracts-with-truffle/","categories":[{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/categories/Ethereum/"}],"tags":[{"name":"Blockchain","slug":"Blockchain","permalink":"http://a10000005588.github.io/tags/Blockchain/"},{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/tags/Ethereum/"}]},{"title":"Goçš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ä»‹ç´¹ Defer, Panicèˆ‡Recover","slug":"go-defer","date":"2018-05-13T08:20:55.000Z","updated":"2020-08-17T13:56:01.618Z","comments":true,"path":"2018/05/13/go-defer/","link":"","permalink":"http://a10000005588.github.io/2018/05/13/go-defer/","excerpt":"Defer, Paic, Recoveræ˜¯Golang ç”¨ä¾†åšéŒ¯èª¤è™•ç†çš„å¸¸ç”¨å‡½å¼","text":"Defer, Paic, Recoveræ˜¯Golang ç”¨ä¾†åšéŒ¯èª¤è™•ç†çš„å¸¸ç”¨å‡½å¼ ä»‹ç´¹Panicç”¨ä¾†ç™¼å‡ºéŒ¯èª¤è¨Šæ¯ï¼Œä¸¦ä¸­æ–·ä»¥ä¸‹åŸ·è¡Œæµç¨‹ Deferå¯å°‡æŸè¨Šæ¯æˆ–æŸåŸ·è¡Œæ–¹æ³•æ¨å»¶å¾Œè‡³ç¨‹å¼çµæŸï¼Œåœ¨åŸ·è¡Œã€‚ Recoveråªèƒ½åœ¨Deferä¸­ä½¿ç”¨ï¼Œç”¨ä¾†æ¥æ”¶panicå‚³å…¥çš„åƒæ•¸ï¼Œä¸¦åšæ‰“å°æˆ–å…¶ä»–åŸ·è¡Œã€‚ ç¯„ä¾‹ç”¨ä»¥ä¸‹ä¾‹å­ä¾†çœ‹ Panicã€Recoverèˆ‡Deferçš„ç”¨æ³•ï¼š 1234567891011121314151617181920212223242526272829303132package mainimport \"fmt\"func main() &#123; f() fmt.Println(\"Returned normally from f.\")&#125;func f() &#123;// è¢«æ¨å»¶è‡³çµæŸæ‰åŸ·è¡Œï¼Œä¸¦ä¸”recover() æœƒæ¥å—panicæ‰€å‚³éçš„åƒæ•¸ defer func() &#123; if r := recover(); r != nil &#123; fmt.Println(\"Recovered in f\", r) &#125; &#125;() fmt.Println(\"Calling g.\") g(0) fmt.Println(\"Returned normally from g.\")&#125;func g(i int) &#123; if i &gt; 3 &#123; fmt.Println(\"Panicking!\") panic(fmt.Sprintf(\"%v\", i)) &#125; // å°‡ å°å‡ºâ€œDefer in g\"é€™æ®µè¨Šæ¯ å»¶å¾Œå°å‡ºï¼Œç›´åˆ°panicè§¸ç™¼æˆ–æ˜¯ç¨‹å¼çµæŸæ‰æœƒè¢«å°å‡ºä¾† // å…ˆè¢«deferçš„æœƒæœ€æ™šè¢«å°å‡ºä¾†ï¼Œç‚ºLast in first out ! defer fmt.Println(\"Defer in g\", i) fmt.Println(\"Printing in g\", i) g(i + 1)&#125; 123456789101112Calling g.Printing in g 0Printing in g 1Printing in g 2Printing in g 3Panicking!Defer in g 3Defer in g 2Defer in g 1Defer in g 0Recovered in f 4Returned normally from f. è£œå……é€šå¸¸ defer ä¹Ÿæœƒè¢«ç”¨åœ¨ è¦é—œé–‰ä¸€å€‹DBçš„instance ä¾‹å¦‚ä»¥ä¸‹ä»¥mongoDBç‚ºä¾‹ï¼š 12345678910111213141516171819202122232425func someFunction() &#123; var err error mongo, err := getMongoSession() // å›å‚³ä¸€å€‹mongoçš„instance mongo.SetSocketTimeout(1 * time.Hour) //session.SetSocketTimeout(1 * time.Hour) if err != nil &#123; errors := common.Error&#123; ErrorType: 1, ErrorDescription: err.Error(), &#125; logger.Console().Panic(errors) logger.File().Error(err) &#125; // å°‡é—œé–‰mongoçš„å‹•ä½œæ¨å»¶è‡³ è©²functionåŸ·è¡Œç©returnå¾ŒåŸ·è¡Œ defer mongo.Close() collection := mongo.DB(dbName).C(collectionName.BsBlocks) result := []blockStrcut.BlockWithOnlyTxHashesIntNum&#123;&#125; err = collection.Find(conditions).All(&amp;result) return result, err&#125; åƒè€ƒThe Go Blogï¼šDefer, Panic, and Recoverhttps://blog.golang.org/defer-panic-and-recover","categories":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"Golangçš„ç‰¹è‰²ä»‹ç´¹","slug":"go-features","date":"2018-05-13T08:19:10.000Z","updated":"2020-08-17T13:55:32.689Z","comments":true,"path":"2018/05/13/go-features/","link":"","permalink":"http://a10000005588.github.io/2018/05/13/go-features/","excerpt":"The benefit of Golang is as follows:","text":"The benefit of Golang is as follows: 1. Quick compile time than the C , C++ Golang provides lightning-quick compiler by using a smart compiler and simplified dependency resolution algorithm. When build the golang program, the compiler only looks at the libraries that you directly include. (C,C++,JAVA. those programming language will traverse entire dependency chainâ€¦) 2. Concurrencygo-routineGolang can create go-routine, which is like thread but use far less memory and require less code to use. Golang can create many go-routine on a single thread. 12345func log(msg string)&#123; ... some logging code here&#125;// Elsewhere in our code after we've discovered an error.go log(\"something dire happened\") channelchannel are data structure that let you send typed messages between goroutines with sychronization built in. Channel can also avoid the share memory problem in concurrency modification problem. Warning: channel isnâ€™t provide data access protection. 3. Go type system.Golang provides flexible hierachy-free type free system that enables code reuse with minimal refactoring overhead. In tradictional OOD, like JAVA, need to implenment all the method declared in interface.1234interface User &#123; public void login(); public void logout();&#125; But in golang type system, you only implement the method you would use.123type Reader interface &#123; Read(p []byte) (n int, err error)&#125; 4. Memory managementGolang has modern garbage collector that does hard work for you.","categories":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/categories/Golang/"}],"tags":[{"name":"Golang","slug":"Golang","permalink":"http://a10000005588.github.io/tags/Golang/"}]},{"title":"ERC Tokenä»‹ç´¹ï¼šERC20 & ERC721","slug":"erctoken","date":"2018-03-25T11:54:59.000Z","updated":"2020-07-26T09:16:56.792Z","comments":true,"path":"2018/03/25/erctoken/","link":"","permalink":"http://a10000005588.github.io/2018/03/25/erctoken/","excerpt":"å³åˆ©ç”¨ç•¶ä»Šç«ç´…çš„ä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆç´„ï¼Œå¯¦ä½œå‡ºä»£å¹£åŠŸèƒ½ã€‚å¯æ“æœ‰èˆ‡è™›æ“¬è²¨å¹£ä½œç‚ºåƒ¹å€¼å‚³éåŠŸèƒ½ã€‚","text":"å³åˆ©ç”¨ç•¶ä»Šç«ç´…çš„ä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆç´„ï¼Œå¯¦ä½œå‡ºä»£å¹£åŠŸèƒ½ã€‚å¯æ“æœ‰èˆ‡è™›æ“¬è²¨å¹£ä½œç‚ºåƒ¹å€¼å‚³éåŠŸèƒ½ã€‚ å¥½è™• ä¸ç”¨è‡ªå·±æ¶è¨­å…¬æœ‰éˆï¼Œå°±å¯ä»¥æ“æœ‰è‡ªå·±ç™¼è¡Œçš„ä»£å¹£ ä»¥æ—¢å®šåŒ¯ç‡ï¼Œå¯ä»¥ç›´æ¥èˆ‡ä»¥å¤ªå¹£é€²è¡Œäº¤æ›ã€‚ ç‚ºä½•éœ€è¦ERCæ¨™æº–åˆç´„ï¼Ÿç”±æ–¼ä»£å¹£æ˜¯å»ºç«‹åœ¨ä»¥å¤ªåŠä¸Šçš„æ™ºèƒ½åˆç´„ï¼Œæ•…å…¶ä»£å¹£ä¹Ÿåªæ˜¯å­˜åœ¨æ™ºèƒ½åˆç´„ä¸Šçš„æŸç­†ç´€éŒ„ã€‚æ•…é€éä¸€äº›ç‹€æ…‹æ”¹è®Šå’Œè½‰ç§»ï¼Œæ•…ERCåˆç´„å¯ä»¥æ˜ç¢ºå®šç¾©æŸå€‹ä»¥å¤ªåŠåœ°å€ä¸Šçš„æŸå€‹ä»£å¹£é¤˜é¡ï¼Œä¸¦å¯ä»¥å°å…¶é€²è¡Œæ“ä½œï¼Œè€Œæ“ä½œçš„è¦ç¯„å°±å®šç¾©åœ¨ERCä¸Šã€‚ æ•…ä¸€å€‹ä»£å¹£è¦æ“æœ‰åˆç†çš„ç™¼è¡Œæ©Ÿåˆ¶ï¼Œå°±å¾—ç¬¦åˆç¾åœ¨æ‰€æ“æœ‰çš„ERC20ä»¥åŠERC721ä¹‹é¡çš„æ¨™æº–ã€‚ ERCä»£å¹£æœ‰è‡ªå·±çš„éŒ¢åŒ…å—ï¼Ÿï¼Ÿç”±æ–¼æ˜¯é€éä»¥å¤ªåŠæ™ºèƒ½åˆç´„æ§åˆ¶çš„ï¼Œæ•…åªè¦é€éä»¥å¤ªåŠéŒ¢åŒ…(åœ°å€)å°±å¯ä»¥äº†ã€‚ ERC20 ä»‹ç´¹è¨˜è¼‰ERC20è¦å‰‡ å®˜æ–¹æ–‡ä»¶https://theethereum.wiki/w/index.php/ERC20_Token_Standard ERC20 Token Standard Interface12345678910interface ERC20 &#123; function totalSupply() public constant returns (uint); function balanceOf(address tokenOwner) public constant returns (uint balance); | function allowance(address tokenOwner, address spender) public constant returns (uint remaining); | function transfer(address to, uint tokens) public returns (bool success); | function approve(address spender, uint tokens) public returns (bool success); | function transferFrom(address from, address to, uint tokens) public returns (bool success); | event Transfer(address indexed from, address indexed to, uint tokens); | event Approval(address indexed tokenOwner, address indexed spender, uint tokens); &#125; ä»¥ä¸Šçš„Interfaceå®šç¾©äº†å…­å€‹Functionï¼Œæœ‰InputåŠOutputæ ¼å¼ã€‚ä»¥åŠå…©å€‹Eventï¼Œåƒ…æœ‰Inputã€‚ å…¶ä¸­Functionç‚ºå¯ä»¥æ“ç¸±æ™ºèƒ½åˆç´„ç‹€æ…‹çš„å‹•ä½œï¼Œæœƒéœ€è¦æ¶ˆè€—Gasï¼Œè€Œå¯ä»¥çœ‹åˆ°æœ‰äº›Functionå¾Œé¢æœ‰ constanté—œéµå­—ï¼Œè¡¨ç¤ºåƒ…åšå”¯ç¨ï¼Œä¸æœƒæ›´æ”¹åˆ°æ™ºèƒ½åˆç´„ä¸Šçš„Stateï¼Œä¸»è¦æ˜¯å›å‚³çš„Stateè³‡è¨Šï¼Œä¸æœƒæ¶ˆè€—åˆ°Gasã€‚ è€ŒEventç‚ºç´€éŒ„é‡å¤§äº‹ä»¶çš„ç™¼ç”Ÿï¼Œä¾‹å¦‚åœ¨éˆä¸Šé€²è¡ŒTokençš„è½‰ç§»ã€‚ è¨­å®šERC Tokenè³‡è¨Š123string public constant name = \"Token Name\"; string public constant symbol = \"TKN\"; uint8 public constant decimals = 18; // 18 is the most common number of decimal places ERC20 éœ€è¦è¨­å®šæ­¤ Token çš„ä¸‰å€‹è³‡è¨Š: nameã€symbolã€decimals name æ˜¯ Token çš„åå­—ã€‚ symbol å‰‡æ˜¯æ­¤ Token æœƒä½¿ç”¨çš„ä»£ç¨±ï¼Œåƒæ˜¯ Binance Token çš„ symbol å°±æ˜¯ BNBï¼Œè€Œæ­¤ symbol ä¹Ÿæœƒå‡ºç¾åœ¨ Etherscanä¸Šé¢ decimals æ˜¯ç”¨ä¾†è¨­å®šæ­¤ Token æœ€å°æœƒæœ‰å¹¾å€‹ä½æ•¸ï¼Œé€šå¸¸æœƒè¨­å®šæˆ 18ï¼Œæ„å³æœ€å¤šåˆ°é”å°æ•¸é»å¾Œ 18 ä½æ•¸ï¼Œé€™æ¨£çš„è¨­å®šè·Ÿ Ether æœ¬èº«çš„è¨­å®šä¹Ÿæ˜¯ä¸€æ¨£çš„(1 ether: 10 ^ 18 wei)ã€‚ è£œå……èªªæ˜ï¼šåœ¨ Solidity ä¸­ä¸¦æ²’æœ‰æµ®é»æ•¸çš„å­˜åœ¨ï¼Œæ‰€æœ‰çš„é‹ç®—éƒ½æ˜¯æ•´æ•¸ï¼Œå› æ­¤å¹³å¸¸æˆ‘å€‘æ‰€èªªçš„ 1 Etherï¼Œäº‹å¯¦ä¸Šåœ¨ Solidity ç¨‹å¼ä¸­æ˜¯ä»¥weiçš„å–®ä½(1 ether = 10Â¹â¸)ä¾†æ’°å¯«ã€‚ ERC20 è©³è¿°12345678910111213141516171819202122232425262728293031323334353637383940414243contract TokenContractFragment &#123; // Balances for each account mapping(address =&gt; uint256) balances; // Owner of account approves the transfer of an amount to another account mapping(address =&gt; mapping (address =&gt; uint256)) allowed; // Get the token balance for account \\`tokenOwner\\` function balanceOf(address tokenOwner) public constant returns (uint balance) &#123; return balances\\[tokenOwner\\]; &#125; // Transfer the balance from owner's account to another account function transfer(address to, uint tokens) public returns (bool success) &#123; balances\\[msg.sender\\] = balances\\[msg.sender\\].sub(tokens); balances\\[to\\] = balances\\[to\\].add(tokens); Transfer(msg.sender, to, tokens); return true; &#125; // Send \\`tokens\\` amount of tokens from address \\`from\\` to address \\`to\\` // The transferFrom method is used for a withdraw workflow, allowing contracts to send // tokens on your behalf, for example to \"deposit\" to a contract address and/or to charge // fees in sub-currencies; the command should fail unless the _from account has // deliberately authorized the sender of the message via some mechanism; we propose // these standardized APIs for approval: function transferFrom(address from, address to, uint tokens) public returns (bool success) &#123; balances\\[from\\] = balances\\[from\\].sub(tokens); allowed\\[from\\]\\[msg.sender\\] = allowed\\[from\\]\\[msg.sender\\].sub(tokens); balances\\[to\\] = balances\\[to\\].add(tokens); Transfer(from, to, tokens); return true; &#125; // Allow \\`spender\\` to withdraw from your account, multiple times, up to the \\`tokens\\` amount. // If this function is called again it overwrites the current allowance with _value. function approve(address spender, uint tokens) public returns (bool success) &#123; allowed\\[msg.sender\\]\\[spender\\] = tokens; Approval(msg.sender, spender, tokens); return true; &#125;&#125; ä½¿ç”¨ä¾‹å­Token Balanceæˆ‘å€‘å‡è¨­é€™å€‹æ™ºèƒ½åˆç´„ç›®å‰æœ‰å…©å€‹åœ°å€æ“æœ‰è©²Tokenbalances[â€˜0x123456â€™] = 100balances[â€˜0x654321â€™] = 200 å‰‡ Function balanceOf å‰‡æœƒå›å‚³ä»¥ä¸‹è³‡è¨Š:tokenContract.balanceOf(â€˜0x123456â€™) will return 100tokenContract.balanceOf(â€˜0x654321â€™) will return 200 Transfer Token Balanceå¦‚æœ 0x123456æƒ³è¦è½‰ç§» 10 tokens çµ¦ 0x654321ï¼Œå‰‡å‘¼å«tokenContract.transfer(â€˜0x654321â€™, 10) å°‡å¾—åˆ°ä¸‹åˆ—çµæœbalances[â€˜0x123456â€™] = 90balances[â€˜0x654321â€™] = 210 Approve And TransferFrom Token Balanceå¦‚æœ 0x123456 å…è¨± 0x654321 æ“æœ‰è½‰ç§» 30 tokens çš„æ¬Šåˆ©ï¼Œå‰‡å‘¼å«tokenContract.approve(â€˜0x654321â€™, 30) å°‡å¾—åˆ°ä¸‹åˆ—çµæœtokenContract.allowed[â€˜0x123456â€™][â€˜0x654321â€™] = 30 å¦‚æœæ­¤æ™‚â€™0x654321â€™ æƒ³è¦è½‰ç§» â€˜0x123456â€™ çš„ 20 tokens çµ¦è‡ªå·±ï¼Œå‰‡å‘¼å«â€˜tokenContract.transferFrom(â€˜0x123456â€™, â€˜0x654321â€™, 20) å°‡å¾—åˆ°ä¸‹åˆ—çµæœtokenContract.balances[â€˜0x123456â€™] = 70tokenContract.balances[â€˜0x654321â€™] = 230tokenContract.allowed[â€˜0x123456â€™][â€˜0x654321â€™] = 10 ERC721 ä»‹ç´¹ERC-721 æ˜¯ç”¨æ¥å®šç¾© Non-fungible token (ä¸å¯æ›¿ä»£çš„ä»£å¹£)ã€‚æ¯å€‹ä»£å¹£æ˜¯å”¯ä¸€çš„(unique)ï¼Œå…·ä¸å¯åˆ†å‰²æ€§ï¼Œä¸åƒERC20 æ¯å€‹tokenéƒ½ç›¸åŒã€‚ å…·é«”æ‡‰ç”¨: ä»¥å¤ªè²“(cryptokitties)æ¯å€‹ä»¥å¤ªè²“ï¼Œéƒ½æ˜¯ä¸€å€‹ERC721ä»£å¹£ã€‚ 1234567891011interface ERC721 &#123; function supportsInterface(bytes4 _interfaceID) external pure returns (bool); function ownerOf(uint256 \\_deedId) external view returns (address \\_owner); function countOfDeeds() external view returns (uint256 _count); function countOfDeedsByOwner(address \\_owner) external view returns (uint256 \\_count); function deedOfOwnerByIndex(address \\_owner, uint256 \\_index) external view returns (uint256 _deedId); event Transfer(address indexed from, address indexed to, uint256 indexed deedId); event Approval(address indexed owner, address indexed approved, uint256 indexed deedId); function approve(address \\_to, uint256 \\_deedId) external payable; function takeOwnership(uint256 _deedId) external payable;&#125; åƒè€ƒè³‡æ–™ ERC20 Token Standardhttps://theethereum.wiki/w/index.php/ERC20_Token_Standard è¯·é—®ä»¥å¤ªåŠé‡Œçš„ERC-721å’ŒERC-20æ˜¯ä»€ä¹ˆï¼Ÿhttp://www.blockchainbrother.com/question/510 What has ERC-721 better than ERC-20?https://medium.com/@PatrickGohBS/ethereum-erc-721-vs-erc-20-4bff8c147fdf","categories":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/categories/Solidity/"}],"tags":[{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/tags/Ethereum/"}]},{"title":"åˆ†æ•£å¼ç³»çµ±å…±è­˜ç®—æ³•ç­†è¨˜ï¼šPaxoså’ŒRaft","slug":"consensusAlgo","date":"2018-03-10T16:00:00.000Z","updated":"2019-02-05T13:06:27.330Z","comments":true,"path":"2018/03/11/consensusAlgo/","link":"","permalink":"http://a10000005588.github.io/2018/03/11/consensusAlgo/","excerpt":"Paxosä»‹ç´¹åˆ†å¸ƒå¼ç³»çµ±ä¸­ï¼Œåªæœ‰å‡ºç¾æ•…éšœç¯€é»(fault node),ä½†ä¸å­˜åœ¨æƒ¡æ„ç¯€é»(corrupt node)ä¸‹é”æˆå…±è­˜çš„å•é¡Œã€‚","text":"Paxosä»‹ç´¹åˆ†å¸ƒå¼ç³»çµ±ä¸­ï¼Œåªæœ‰å‡ºç¾æ•…éšœç¯€é»(fault node),ä½†ä¸å­˜åœ¨æƒ¡æ„ç¯€é»(corrupt node)ä¸‹é”æˆå…±è­˜çš„å•é¡Œã€‚ å•é¡Œèµ·æºæ•…äº‹èƒŒæ™¯ç‚ºå¤å¸Œè‡˜çš„Paxonå³¶ä¸Šæœ‰è«¸ä½æ³•å®˜è¦å°æŸä¸€ä»¶æ³•æ¡ˆé€²è¡Œè£æ±ºä¸¦å¦‚ä½•é”æˆå…±è­˜çš„çµæœã€‚ éç¨‹ä¸­æ³•å®˜æœƒé€éå‚³è¨Šé—œå‚³éè¨Šæ¯ï¼Œä½†æ³•å®˜å¯èƒ½ä¸­é€”é›¢å¸­ï¼Œè€Œæœå‹™å“¡å¯èƒ½å·æ‡¶ç¡è¦ºã€‚ æ•…Paxosç®—æ³•åŸºæ–¼â€œå…©éšæ®µæäº¤â€ä¾†ç¢ºä¿æ³•å®˜å€‘å¯ä»¥å¾—åˆ°å…±è­˜çµæœçš„ä¸€è‡´æ€§ã€‚ Paxosç‰¹æ€§Paxoså°‡åƒèˆ‡ç¯€é»ä¸­åˆ†ç‚ºä¸‰é¡ï¼š Proposer(å®¢æˆ¶ç«¯): æå‡ºä¸€å€‹æ¡ˆå­ï¼Œç­‰å¾…å¤§å®¶æ‰¹å‡†ä¸¦å¾—åˆ°ç­”æ¡ˆã€‚ Acceptor(æœå‹™ç«¯): æ¥å—ææ¡ˆï¼Œä¸¦é€²è¡ŒæŠ•ç¥¨ã€‚ Learner(å®¢æˆ¶ç«¯oræœå‹™ç«¯): è¢«å‘ŠçŸ¥ææ¡ˆçµæœï¼Œä¸¦å°‡è‡ªå·±çš„ç‹€æ…‹èˆ‡çµæœæ›´æ–°ã€‚ éç¨‹ä¸­å¿…é ˆæ»¿è¶³åˆ†æ•£å¼ç³»çµ±å…±è­˜æ‰€å¿…é ˆçš„å…©ç‰¹æ€§ï¼š Saftyï¼šä¿è­‰æ±ºè­°çµæœæ˜¯å°çš„ï¼Œç„¡ç•°è­°ï¼Œä¸¦ä¸æœƒå‡ºç¾éŒ¯èª¤æƒ…æ³ã€‚ Livenessï¼šä¿è­‰åœ¨â€æœ‰é™â€æ™‚é–“å…§å®Œæˆå…±è­˜çµæœã€‚ Paxoséç¨‹ ç”±Proposeræå‡ºææ¡ˆï¼Œçˆ­å–Acceptorsçš„æ”¯æŒã€‚ è¶…éä¸€åŠçš„Acceptorsæ”¯æŒï¼Œå‰‡ç™¼é€è©²ææ¡ˆçµæœçµ¦æ‰€æœ‰äººé€²è¡Œç¢ºèªã€‚ å…©éšæ®µæç¹³Step 1: Prepareéšæ®µ Proposerç™¼é€è‡ªå·±çš„è¨ˆç•«çµ¦å¤šå€‹Acceptors. Acceptoræ ¹æ“šè©²è¨ˆç•«çš„ç·¨è™Ÿï¼Œè‹¥æ˜¯æœ€æ–°çš„ç·¨è™Ÿå‰‡ä¿ç•™ï¼Œåä¹‹å‰‡é€€å›ã€‚ Step 2: Commitéšæ®µ Proposeræ”¶åˆ°Accpetorçš„ç¢ºèªå›è¦†ã€‚è‹¥æ”¶åˆ°çš„å›è¦†ä¸­ä¸å¸¶æœ‰æ–°çš„ææ¡ˆè«‹æ±‚ï¼Œè¡¨ç¤ºé–å®šæˆåŠŸã€‚ è‹¥æ²’æœ‰æ”¶åˆ°è¶…é1/2å€‹Accpetorçš„å›è¦†ã€‚ ç‰¹æ®Šæƒ…æ³ è‹¥Proposeråœ¨ææ¡ˆéç¨‹ä¸­ç™¼ç”Ÿæ•…éšœï¼Œå¯ä»¥é€éè¶…æ™‚æ©Ÿåˆ¶ç¥¨é¸ä¸‹ä¸€ä½Proposerã€‚ Paxosç®—æ³•ä¿è­‰åœ¨æ­£å¸¸ç¯€é»æœ‰ 1/2å€‹ä»¥ä¸Šæ™‚ï¼Œå¯æ»¿è¶³å…±è­˜çš„Safetyå’ŒLiveness. Raftä»‹ç´¹ç‚ºPaxosçš„ç°¡åŒ–ç‰ˆæœ¬ã€‚ åƒèˆ‡è€…åŒ…æ‹¬ä¸‰ç¨®è§’è‰²ï¼š 1.Leader 2.Candidate 3.Follower å…±è­˜æµç¨‹ Leaderé¸èˆ‰ï¼šæ¯å€‹Candidateåœ¨ä¸€å®šæ™‚é–“å…§æœƒæå‡ºé¸èˆ‰æ–¹æ¡ˆï¼Œè€Œé¸èˆ‰çµæœçš„é‚£ä½æˆç‚ºLeader. åŒæ­¥æ¯å€‹Replicationçš„Log: Leaderæœƒæ‰¾åˆ°ç³»çµ±ä¸­çš„Logæª”æ¡ˆä¸Šæœ€æ–°çš„ç´€éŒ„ï¼Œä¸¦è¦æ±‚æ‰€æœ‰Followeræ ¹æ“šè©²æœ€æ–°ç´€éŒ„åŒæ­¥åˆ°ä»–å€‘è‡ªå·±çš„Logæª”æ¡ˆä¸Šã€‚ logæª”å¯èƒ½ç‚ºç³»çµ±ä¸Šç™¼ç”Ÿçš„å‹•ä½œç´€éŒ„ã€‚ å°çµPaxoså’ŒRaftç‚ºç›®å‰åˆ†æ•£å¼ç³»çµ±çš„å¸¶ä¾†ä¸éŒ¯çš„å…±è­˜çµæœï¼Œå…¶ä»–å…±è­˜æ¼”ç®—æ³•åƒæ˜¯PBFT (practical byzantine fault tolerant protocal)ä»¥åŠç›®å‰ç”±Amisåœ˜éšŠæ‰€æ–¼etherumä¸Šæ‰€å¯¦ç¾çš„BFTç®—æ³•- Istanbul BFTï¼Œéƒ½ç®—æ˜¯æœ¬æ¬¡ç­†è¨˜æåˆ°çš„å†é€²éšçš„å…±è­˜ç®—æ³•ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åœ¨åˆ°ä»¥ä¸‹é€£çµå»æ·±å…¥ç­è§£ã€‚ Istanbul BFT - AMIS PBFT Introduction","categories":[{"name":"Consensus","slug":"Consensus","permalink":"http://a10000005588.github.io/categories/Consensus/"}],"tags":[{"name":"Consensus","slug":"Consensus","permalink":"http://a10000005588.github.io/tags/Consensus/"},{"name":"Blockchain","slug":"Blockchain","permalink":"http://a10000005588.github.io/tags/Blockchain/"}]},{"title":"Javascriptç­†è¨˜:Closure(é–‰åŒ…)æ¦‚å¿µ","slug":"javascript-closure","date":"2017-09-13T04:43:04.000Z","updated":"2020-07-26T09:17:28.824Z","comments":true,"path":"2017/09/13/javascript-closure/","link":"","permalink":"http://a10000005588.github.io/2017/09/13/javascript-closure/","excerpt":"é–‰åŒ…ï¼ˆclosure): ç‚ºä¸€å€‹functionåŒ…åœ¨æŸä¸€å€‹å‡½å¼å…§ï¼Œç”¨returnä¾†å–å¾—å…§éƒ¨functionçš„å›å‚³å€¼ Closure are commonly used to give objects data privacy.","text":"é–‰åŒ…ï¼ˆclosure): ç‚ºä¸€å€‹functionåŒ…åœ¨æŸä¸€å€‹å‡½å¼å…§ï¼Œç”¨returnä¾†å–å¾—å…§éƒ¨functionçš„å›å‚³å€¼ Closure are commonly used to give objects data privacy. ç‚ºä»€éº¼è¦æœ‰é–‰åŒ…ï¼Ÿï¼Ÿå› ç‚ºæœ‰ä»¥ä¸‹å•é¡Œã„§ã€Counter dilemma123456789101112var counter = 0;function add() &#123; counter += 1;&#125;add();add();add();// the counter is now equal to 3 counterè¢«æ”¹è®Šæˆ3ã€ä¸éä¹Ÿå¯ä»¥ä¸ç”¨é€éadd()ç›´æ¥æ›´æ”¹counterçš„å€¼ã€‚é‚£é€™æ¨£æœƒé€ æˆè®Šæ•¸æ±¡æŸ“è¡çªã€‚ 12345678function add() &#123; var counter = 0; counter += 1;&#125;add();add();add(); counterè¢«å®£å‘Šåœ¨add()å…§ï¼Œç‚ºlocal variableï¼Œä¸æœƒè¢«å…¶ä»–functionæˆ–globalæ”¹å¯«ã€‚ä½†æœƒæœ‰é‡è¤‡å‘¼å«add()å¾Œç„¡æ³•ä½¿counterå€¼åšç´¯åŠ çš„å‹•ä½œã€‚(å› ç‚ºvar counterä½¿è®Šæ•¸é‡è¤‡è¢«å®šç¾©)ã€‚ äºŒã€è§£æ±ºæ–¹æ³• 1234567function add() &#123; var counter = 0; function plus() &#123;counter += 1;&#125; plus(); return counter; &#125; é€éå…§éƒ¨pluså‡½å¼æ‰èƒ½æ›´æ”¹counterå€¼ã€è§£æ±ºcounter dilemmaå•é¡Œï¼Œä¸éé‚„æœƒé‡åˆ°var counteré‡è¤‡å®£å‘Šçš„å•é¡Œï¼Œé€™æ™‚å€™å°±å¾—ç”¨é–‰åŒ…çš„æŠ€å·§ï¼å¦‚ä¸‹ï¼š 1234567891011var add = (function () &#123; var counter = 0; return function () &#123;return counter += 1;&#125;&#125;)();add();add();add();// the counter is now 3 å°‡addè®Šæ•¸å®£å‘Šæˆ self-invoking function(åƒ…åŸ·è¡Œå…§éƒ¨ä¸€æ¬¡ var counterä¸æœƒåœ¨add()ç¬¬äºŒæ¬¡è¢«å‘¼å«æ™‚å†æ¬¡è¢«å®£å‘Š)ï¼Œç„¶å¾Œå›å‚³function expressionï¼Œå¦‚æ­¤ä¸€ä¾†addè®Šæ•¸å°±è®Šæˆ add() functionäº†ï¼ 12var counter = 0;return function () ***&#123;return counter += 1;***&#125; å°±è¢«åŒ…åœ¨add()å‡½å¼å…§ï¼Œç›´æ¥å‘¼å«add() å°±åªæœƒè·‘ä¸Šé¢*çš„éƒ¨åˆ†ã€‚ ä»¥ä¸Šåšæ³•å³ç‚ºclosureé–‰åŒ…ï¼Œä½¿å¾—è®Šæ•¸ä¸æœƒè¢«æ±¡æŸ“å’Œè¡çªã€‚","categories":[{"name":"Javascript","slug":"Javascript","permalink":"http://a10000005588.github.io/categories/Javascript/"}],"tags":[{"name":"Javascript","slug":"Javascript","permalink":"http://a10000005588.github.io/tags/Javascript/"}]},{"title":"Javascriptç­†è¨˜:ä½¿ç”¨prototype chain(åŸå‹éŠ)ä¾†é”æˆç¹¼æ‰¿æ•ˆæœ","slug":"javascript-prototypechain","date":"2017-09-13T04:39:37.000Z","updated":"2020-07-26T09:17:34.981Z","comments":true,"path":"2017/09/13/javascript-prototypechain/","link":"","permalink":"http://a10000005588.github.io/2017/09/13/javascript-prototypechain/","excerpt":"å…ˆçŸ¥é“å€‹keywordï¼š __proto__ï¼š javascriptè‡ªå·±å®šç¾©çš„è®Šæ•¸ï¼Œç”¨ä¾†å¯¦ç¾inheritanceæ•ˆæœï¼Œæœ‰é»é¡ä¼¼åƒlink list nodeçš„æ¦‚å¿µï¼Œé€£çµå…¶ä»–çš„ prototype","text":"å…ˆçŸ¥é“å€‹keywordï¼š __proto__ï¼š javascriptè‡ªå·±å®šç¾©çš„è®Šæ•¸ï¼Œç”¨ä¾†å¯¦ç¾inheritanceæ•ˆæœï¼Œæœ‰é»é¡ä¼¼åƒlink list nodeçš„æ¦‚å¿µï¼Œé€£çµå…¶ä»–çš„ prototype javascriptè¨˜æ†¶é«”ç®¡ç†çš„é…ç½®ï¼š classå„²å­˜åœ¨ globalåº•ä¸‹ classçš„prototypeæ”¾ç½®åœ¨heap ï¼ˆå³classåº•ä¸‹çš„å„ç¨®variableå’Œfunction) instanceï¼ˆex var b = new B()) çš„bå„²å­˜åœ¨ callstack(è¨˜æ†¶é«”RAMè£¡é¢) slogan:åœ¨è‡ªå·±çš„scopeè£¡é¢æ‰¾ä¸åˆ°è¦çš„å‡½å¼æˆ–è®Šæ•¸å°±è·Ÿè‡ªå·±çš„__proto__è¦ï¼ ç¹¼æ‰¿ç¯„ä¾‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051var Car = function()&#123; //constructor this.brand = \"default\"; var _wheels // private method var initialWheels = function () &#123; _wheels = 4 &#125; this.getNumberofWheel = function()&#123; return this.brand; &#125;&#125;var Benz = function(brandName) &#123; //constructor Car.apply(this, argument) //ç­‰æ–¼å‘¼å« super(args); //argumentç‚º var Benz = function(args...); çš„ argså€‘ = [brandName, wheel] // é€™ä¸€è¡Œå°±æ˜¯æŠŠ Benz.prototype.__proto__ = Car.prototypeæ¥èµ·ä¾†; // å³Benz class inheritance Car // ç–‘å•ï¼šä¸Šé¢æ•˜è¿°éœ€å’ŒBenç¢ºèªä¸€ä¸‹ é‚£é€™æ¨£ç‚ºä»€éº¼ä¸‹é¢åˆå¾—è‡ªå·±åšBenz.prototype = Object.create(Car.prototype) ?? // è§£ç­”ï¼šè‹¥æ²’æœ‰åšCar.apply (å³super()) å‹•ä½œï¼Œé€™æ¨£å­é¡åˆ¥æœƒç„¡æ³•å°‡æ¥å—çš„argumentså‚³éçµ¦å¾parentè¤‡è£½éä¾†çš„å‡½å¼ this.brand = brandName; //åˆå§‹åŒ–è»Šå“ç‰Œçš„åç¨± &#125;// javascript ES5å¾—è‡ªå·±ç¶å®šç¹¼æ‰¿é—œä¿‚ï¼Œç”¨__proto__é€™å€‹keyword// å»ºç«‹çˆ¶é¡åˆ¥å¯¦é«” è¨­å®šç¹¼æ‰¿é—œä¿‚:Benz.prototype = Object.create(Car.prototype) //ä¸Šé¢å³æ˜¯åšäº†Benz.prototype.__proto__ = Car.prototype//ä½¿Benz classç¹¼æ‰¿Car class(Benz extends Car)Benz.prototype.constructor = Benz//Benzçš„constructoræŒ‡å‘Benz class//å°‡Benzçš„constructorç¶å®šåˆ°è‡ªå·±èº«ä¸Šï¼Œ//æ‰èƒ½åœ¨Benz newå‡ºä¸€å€‹ç‰©ä»¶æ™‚ä½œåˆå§‹åŒ–å‹•ä½œï¼ˆå³å‘¼å«Benz =functionå‡½å¼&#123;&#125;) //var benz = new Benz(\"Benz\") åˆå§‹åŒ–è©²è»Šå­åç¨±ï¼š\"Benz\"; var benz = new Benz() // benz.__proto__ = Benz.prototype// å®£å‘Šä¸€å€‹ç‰©ä»¶å« benzconsole.log(benz.numberOfWheels()) // æœƒå…ˆæœå°‹benz.prototypeæœ‰æ²’æœ‰numberOfWheels()æ–¹æ³•// æ²’æœ‰==&gt;é‚£å°±æ‰¾benz.__proto__ = Benz.prototype;// Benz.prototypeå°±æœƒæ‰¾åˆ° numberOfWheels()çš„æ–¹æ³•ï¼ benz.numberOfWheels() æœ‰æ­¤æ–¹æ³• æ¯æ¬¡å‘¼å«Car.apply(this, arguments)æ™‚â€è¤‡è£½â€åˆ°å­é¡åˆ¥çš„ç‰©ä»¶ä¸Šåˆå§‹åŒ–ç‰©ä»¶æ™‚è¼ƒæ…¢ï¼Œåœ¨run timeæƒ³è¦å‹•æ…‹æ”¹è®ŠnumberOfWheels()çš„å¯¦ä½œæ™‚ ç„¡æ³•å½±éŸ¿å·²ç¶“å‰µå»ºçš„å­é¡åˆ¥æˆ–çˆ¶é¡åˆ¥instances. ä»¥ä¸‹ç‚ºåˆå§‹åŒ–è¼ƒæœ‰æ•ˆç‡çš„å¯«æ³•ï¼š1234567891011121314151617181920212223242526var Car = function () &#123; // constructor // public property this.wheels = 4 // pulic property this.brand = 'default'&#125;// é€™ç¨®å¯«æ³•ä¸æ”¯æ´å­˜å–private property// å› ç‚ºæ¯å€‹ç‰©ä»¶éƒ½å¯ä»¥ç›´æ¥å­˜å–æ›åœ¨parent.prototypeä¸Šçš„property// ä½†å¯ä»¥åœ¨run timeä¿®æ”¹æ­¤Car.prototype.numberOfWheels()çš„å¯¦ä½œ// å°±å¯ä»¥é€éprototype chainæ›´æ”¹æ‰€æœ‰ç›¸é—œçš„instanceåŠŸèƒ½ å› ç‚ºinstanceå…±ç”¨prototype chainä¸Šçš„æ–¹æ³•Car.prototype.numberOfWheels = function () &#123; return this.wheels&#125;var Benz = function (brandName) &#123; Car.apply(this, arguments) // è¤‡è£½ç¹¼æ‰¿çˆ¶é¡åˆ¥public property this.brand = 'brandName'; this.getBrand = function () &#123; return this.brand &#125;&#125;... numberOfWheelsè©²æ–¹æ³•å·²ç¶“è¢«æ›åœ¨ Car.prototypeä¸Šï¼Œæ‰€ä»¥ä¸¦ä¸åƒCar.applyä¸Šç›´æ¥è¤‡è£½ä¸€ä»½çµ¦å­classå€‘ï¼Œè€Œæ˜¯å­classå»å…±ç”¨Car.prototype.numberOfWheels é€™å€‹æ–¹æ³•ã€‚ å„ªé»ï¼šç¯€çœåˆå§‹åŒ–çš„æ™‚é–“å’Œæå‡æ•ˆç‡ ç¼ºé»ï¼šé€™ç¨®å¯«æ³•ä¸æ”¯æ´å­˜å–private property javascript é¡åˆ¥ã€prototypeä»¥åŠreferenceä¸­çš„protoæ‰€æŒ‡å‘çš„é—œä¿‚ç¤ºæ„åœ–ï¼šåœ–ç‰‡ä½œè€…ï¼š Benå¤§å¤§ å‡è¨­ B class extend A;let b = new B(); // b.__proto__ = B.prototypelet a = new A(); // a.__proto__ = A.prototypelet o = new Object(); o.__proto__ = Object.prototype//å°æ‡‰åˆ°åœ–ç‰‡å·¦é‚Šçš„bã€aã€o. (å…ˆå¾åœ–ç‰‡æœ€å·¦ä¸Šè§’é–‹å§‹çœ‹é‚£ var b = new B();bæƒ³è¦ä½¿ç”¨ç¹¼æ‰¿Açš„ getValue() å‡½å¼ï¼Œé‚£éº¼å°±å¾—å…ˆæ‰¾è‡ªå·±çš„ b.prototype æ²’æœ‰çš„è©± æ‰¾ b.__proto__ = B.prototype è‹¥b.__proto__ä¹Ÿæ²’æœ‰çš„è©±(å³B.prototype)ä¹Ÿæ²’æœ‰ï¼Œé‚£éº¼æ‰¾ B.prototype.__proto__ == A.prototypeåœ¨A.prototypeå°±æœƒæ‰¾åˆ°getValue()çš„å‡½å¼ï¼ å¦‚æœåˆæ²’æ‰¾åˆ°ï¼Œé‚£å°±æœ€å¾Œæ‰¾A.prototype.__proto__ == Object.prototypeè‹¥æ²’æœ‰é‚£å°±æ‰¾ Object.prototype.__proto__ == null å³æ‰¾ç„¡è©²å‡½å¼ï¼Œcompileå‘ŠçŸ¥ç™¼ç”ŸéŒ¯èª¤); Prototype inheritance çš„å¥½è™• Suitable in loosely typed environments, no need to define explicit types. Makes it incredibly easy to implement singleton pattern (compare JavaScript and Java in this regard, and youâ€™ll know what I am talking about). (why? å› ç‚ºprototype inheritanceæä¾›???? è«‹çœ‹è£œå……äºŒï¼‰ Provides ways of applying a method of an object in the context of a different object, adding and replacing methods dynamically from an object etc. (things which are not possible in a strongly typed languages). Prototype inheritanceçš„å£è™• No easy way of implementing private variables. Its possible to implement private vars using Crockfordâ€™s wizardry using closures, but its definitely not as trivial as using private variables in say Java or C#.(å› ç‚º__prpto__æœƒæŒ‡å‘prototypeçš„æ‰€æœ‰æˆå“¡ï¼æ•…ç„¡æ³•åƒclass inheritanceé‚£æ¨£é¿å…ç¹¼æ‰¿åˆ°æœ‰privateé—œéµå­—çš„è®Šæ•¸ï¼Œæ•…å¾—ç”¨closureæ‰‹æ³•ä¾†é¿å…ç¹¼æ‰¿åˆ°_privateè®Šæ•¸) Reference:prototype based vs. class based inheritance è£œå……ã„§ï¼šFunction.prototype.applyfun.apply(thisArg, [argsArray])// å°‡ä¸€é€£ä¸²åƒæ•¸ç”¨arrayåŒ…èµ·ä¾†ï¼š[argsArray]ï¼Œä¸Ÿçµ¦funå‡½å¼è™•ç† ç¯„ä¾‹ï¼š1234567891011121314function theFunction(name, profession) &#123; console.log(&quot;My name is &quot; + name + &quot; and I am a &quot; + profession + &quot;.&quot;);&#125;// call functionfunction callFn(name, profession) &#123; theFunction.apply(this, [name, profession]);&#125;theFunction(&apos;å°will&apos;, &apos;å·¥ç¨‹å¸«&apos;);callFn(&apos;å¤§Will&apos;, &apos;å°å»¢å»¢&apos;);// è¼¸å‡º:// My name is å°will and I am a å·¥ç¨‹å¸«.// My name is å¤§Will and I am a å°å»¢å»¢. è£œå……äºŒï¼šç”¨Closureå¯¦ä½œSingletonæ¨¡å¼é–‰åŒ…è§€å¿µé€£çµï¼š==&gt; é–‰åŒ…æ˜¯ä»€éº¼ï¼Ÿï¼Ÿ å…ˆçœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼1234567891011121314151617181920var UniverseN;(function()&#123; var instance; UniverseN = function UniverseN()&#123; if(instance)&#123; return instance; &#125; instance = this; this.start_time = 0; this.bang = 'Big'; &#125;;&#125;());var uni9 = new UniverseN();var uni10 = new UniverseN();console.log(uni9 === uni10); //trueUniverseN.prototype.inEverything = true; å¯ä»¥çœ‹å‡ºè‹¥åˆ©ç”¨äº†Prototype inheritanceçš„ç‰¹æ€§ï¼Œï¼Œå°‡IIFEå‡½å¼æ›åœ¨UniverseN.prototype.IIFEä¸Šï¼Œä½¿å¾—ä¹‹å¾Œå®£å‘Šçš„ç‰©ä»¶ä¸æœƒåœ¨è¤‡è£½ä¸€ä»½IIFEå‡ºä¾†å‡ºä¾†ï¼Œè®“IIFEåªè·‘ä¸€æ¬¡ï¼é€™æ¨£å°±å¯ä»¥é”æˆä¸€å€‹class (UniverseN) åªèƒ½å®£å‘Šä¸€æ¬¡çš„ç‰©ä»¶ (uni9)ã€‚ å¦‚æœåœ¨å®£å‘Šå‡º uni10ï¼Œä»–å€‘éƒ½é‚„æ˜¯æŒ‡å‘åŒä¸€æ¨£çš„instance(uni9.__proto__ == uni10__proto__) Reference:JavaScript Design Pattern - Singleton å–®é«”æ¨¡å¼","categories":[{"name":"Javascript","slug":"Javascript","permalink":"http://a10000005588.github.io/categories/Javascript/"}],"tags":[{"name":"Javascript","slug":"Javascript","permalink":"http://a10000005588.github.io/tags/Javascript/"}]},{"title":"ä½¿ç”¨OpenZeppelinæ­é…Truffleä¾†æ‰“é€ æ™ºèƒ½åˆç´„","slug":"openzepplin","date":"2017-09-13T02:43:31.000Z","updated":"2020-07-26T09:17:39.142Z","comments":true,"path":"2017/09/13/openzepplin/","link":"","permalink":"http://a10000005588.github.io/2017/09/13/openzepplin/","excerpt":"æœ¬ç¯‡æ˜¯åƒè€ƒtruffleå®˜ç¶²æ‰€åšçš„ç­†è¨˜ï¼šROBUST SMART CONTRACTS WITH OPENZEPPELIN","text":"æœ¬ç¯‡æ˜¯åƒè€ƒtruffleå®˜ç¶²æ‰€åšçš„ç­†è¨˜ï¼šROBUST SMART CONTRACTS WITH OPENZEPPELIN OpenZeppelinä»‹ç´¹å¯ä»¥æŠŠOpenZeppelinç•¶æˆå¼·åŒ–Solidityè³‡è¨Šå®‰å…¨çš„Frameworkï¼Œç‚ºæ™ºèƒ½åˆç´„é™„ä¸ŠEthereumæ‰€èªå¯çš„ERC-20æ¨™æº–ï¼Œç•¢ç«Ÿåˆç´„è¦è™•ç†çš„å¯æ˜¯çœŸæ­£çš„éŒ¢ï¼ ERC-20æ¨™æº–ä»‹ç´¹ï¼šWhat is ERC-20 and What Does it Mean for Ethereum? ç°¡å–®ä¾†èªªERC-20æ¨™æº–å…è¨±éŒ¢åŒ…ã€äº¤æ˜“æ‰€å’Œå…¶ä»–æ™ºèƒ½åˆç´„ä»¥ä¸€ç¨®å¸¸è¦‹çš„æ–¹å¼å°æ¥å„ç¨®ä»£å¹£ã€‚ ä½¿ç”¨OpenZeppeliné å‚™çŸ¥è­˜å»ºè­°å…ˆç­è§£ethereumä»¥åŠSmart Contractèªè¨€Solidityä»¥åŠé–‹ç™¼Smart Contractçš„æ¡†æ¶ Truffle å¯ä»¥åƒè€ƒå®˜ç¶²æˆ–æ˜¯æˆ‘ä¹‹å‰æ‰€åšçš„ç­†è¨˜ Ethereumå®˜æ–¹ç¶²ç«™ï¼š èœé³¥Williamçš„Solidityå­¸ç¿’ç´€éŒ„ ä½¿ç”¨Truffleä¾†ç·´ç¿’æ’°å¯«èªé¤Šå¯µç‰©çš„æ™ºèƒ½åˆç´„ ç’°å¢ƒè¨­å®šå‰µç«‹ä¸€å€‹è³‡æ–™å¤¾ open_zä½¿ç”¨truffle unboxæŠŠç·´ç¿’å°ˆæ¡ˆçµ¦ä¸‹è¼‰åˆ°æœ¬æ©Ÿä¸Š12cd open_ztruffle ubbox tutorialtoken å®‰è£ zeppelin-solidity 1npm install zeppelin-solidity ç‚ºtutorialtokenå°ˆæ¡ˆæ’°å¯« TutorialTokenåˆç´„åœ¨ /contracts ç›®éŒ„åº•ä¸‹å‰µå»º TutorialToken.sol TutorialToken.sol12345678910111213141516171819pragma solidity ^0.4.4;// å¼•å…¥zepplin-solidityçš„StandardToken.sol åˆç´„import 'zeppelin-solidity/contracts/token/StandardToken.sol';// ä½¿ç”¨is ä¾†ç¹¼æ‰¿StandardTokenåˆç´„contract TutorialToken is StandardToken &#123; string public name = 'TutorialToken'; // token name string public symbol = 'TT'; uint public decimals = 2; // åˆç´„è¢«å‰µå»ºæ™‚æ‰€ç”¢ç”Ÿçš„é‡‘é¡ç¸½æ•¸ uint public INITIAL_SUPPLY = 12000; function TutorialToken() &#123; totalSupply = INITIAL_SUPPLY; balances[msg.sender] = INITIAL_SUPPLY; &#125;&#125; é€éä»¥ä¸Šç°¡çŸ­çš„ç¨‹å¼ç¢¼å°±å·²ç¶“å‰µé€ å‡ºç¬¦åˆEthereumçš„ ERC-20æ¨™æº–çš„Tokenå›‰ï¼ ç·¨è­¯(Compile)ä»¥åŠéƒ¨ç½²(Deploy)åœ¨/migrationså…§ï¼Œå‰µå»º2_deploy_contracts.jsæª”æ¡ˆ 2_deploy_contracts.js12345var TutorialToken = artifacts.require(\"./TutorialToken.sol\");module.exports = function(deployer) &#123; deployer.deploy(TutorialToken);&#125;; åœ¨terminalï¼Œå…ˆç”¨testrpcå•Ÿå¥½è‡ªå·±çš„æ¸¬è©¦éŠ 1testrpc then åŸ·è¡Œ12truffle comiletruffle migrate å’ŒTutorialToken Dappäº’å‹•æˆ‘å€‘ä½¿ç”¨metamaskå’Œæˆ‘å€‘çš„Dappäº’å‹• ä¸¦ä¸”è©²å°ˆæ¡ˆå·²ç¶“å…§å»º lite-serverå¯é‹è¡ŒDapp åŸ·è¡Œ1npm run dev çœ‹åˆ°ä»¥ä¸‹ç•«é¢å‰‡è¡¨ç¤ºæˆåŠŸé‹è¡Œï¼(åˆ¥å¿˜äº†è¦å…ˆç™»å…¥metamaskï¼Œä»¥ä¾¿å‰ç«¯èƒ½å¤ æ“·å–åˆ°testrpcæ‰€é–‹å•Ÿçš„éŒ¢åŒ…è³‡è¨Š) ä»¥åŠå¯ä»¥çœ‹åˆ°åœ¨metamaskä¸ŠéŒ¢åŒ…çš„è³‡è¨Š ç¸½çµ: Truffle+OpenZeppelin = A Superb Development Experienceé€éï¼š Truffleï¼šé–‹ç™¼æ™ºèƒ½åˆç´„çš„æ¡†æ¶ OpenZeppelinï¼šå¯ç‚ºæ™ºèƒ½åˆç´„æä¾›ERC-20æ¨™æº–çš„å·¥å…· å°±å¯ä»¥æ‰“é€ å‡ºå¯ä¸Šå¸‚çš„æ™ºèƒ½åˆç´„çš„é–‹ç™¼ç’°å¢ƒï¼ å°OpenZeppelinå…§çš„åˆç´„æ¶æ§‹æœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥è§€çœ‹æˆ‘é€™ç¯‡ç­†è¨˜ï¼š OpenZeppelinåˆç´„æ¶æ§‹é€æ","categories":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/categories/Solidity/"}],"tags":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/tags/Solidity/"},{"name":"Truffle","slug":"Truffle","permalink":"http://a10000005588.github.io/tags/Truffle/"}]},{"title":"Solidityå­¸ç¿’ç´€éŒ„","slug":"solidity","date":"2017-09-12T13:34:23.000Z","updated":"2020-07-26T09:17:50.095Z","comments":true,"path":"2017/09/12/solidity/","link":"","permalink":"http://a10000005588.github.io/2017/09/12/solidity/","excerpt":"é€™ç¯‡ä¸»è¦è¨˜éŒ„è‘—æˆ‘å°Solidityå®˜ç¶²æ–‡æª”çš„å­¸ç¿’ç´€éŒ„","text":"é€™ç¯‡ä¸»è¦è¨˜éŒ„è‘—æˆ‘å°Solidityå®˜ç¶²æ–‡æª”çš„å­¸ç¿’ç´€éŒ„ ç°¡å–®çš„åˆç´„é–‹å§‹ä»‹ç´¹èµ·1234567891011121314pragma solidity ^0.4.0; // å‘Šè¨´compilerè¦å¦‚ä½•å°å¾…é€™ä»½codecontract SimpleStorage &#123; uint storedData; // å®£å‘Šuintå‹æ…‹çš„è®Šæ•¸ uintç‚º 256 bits. // ä»¥ä¸‹æ§åˆ¶stored variable. function set(uint x) &#123; storedData = x; &#125; function get() constant returns (uint) &#123; return storedData; &#125;&#125; å¦å¤–ä¸€å€‹æ¯”è¼ƒè¤‡é›œçš„åˆç´„ 123456789101112131415161718192021222324252627282930313233pragma solidity ^0.4.0;contract Coin &#123; // The keyword \"public\" makes those variables // readable from outside. address public minter; mapping (address =&gt; uint) public balances; // å¯æŠŠmapping ç•¶æˆæ˜¯hash tables // å°‡addressç•¶åƒæ•¸ æ˜ å°„åˆ°balancesä¸­æœƒå¾—åˆ°uintå‹æ…‹çš„å›å‚³å€¼ // Events allow light clients to react on // changes efficiently. event Sent(address from, address to, uint amount); // å’ŒcontractåŒåçš„å‡½å¼åç¨±å³ç‚ºconstructorï¼Œåœ¨åˆç´„è¢«å‰µé€ å‡ºä¾†æ™‚å‘¼å« function Coin() &#123; minter = msg.sender; &#125; function mint(address receiver, uint amount) &#123; if (msg.sender != minter) return; balances[receiver] += amount; &#125; function send(address receiver, uint amount) &#123; if (balances[msg.sender] &lt; amount) return; balances[msg.sender] -= amount; balances[receiver] += amount; Sent(msg.sender, receiver, amount); // msg.sender åˆç´„çš„æŒæœ‰è€… &#125;&#125; addressï¼š160-bit value that does not allow any arithmetic operations. publicï¼šä½¿å…¶ä»–åˆç´„å¯ä»¥å­˜å–è‡ªå·±çš„scope function,variable. address public minter å¯çœ‹æˆå¦‚ä¸‹ï¼š 1function minter() returns (address) &#123; return minter; &#125; mapping (address =&gt; uint) public balances;å¯çœ‹æˆå¦‚ä¸‹ 123function balances(address _account) returns (uint) &#123; return balances[_account];&#125; event Sent(address from, address to, uint amount); é€éè©²Sent functionæ–¹ä¾¿è¿½è¹¤éŒ¢çš„æµå‡ºå’Œæµå…¥åœ°å€æ˜¯å“ª Coin()ï¼šç‚ºå»ºæ§‹å­ï¼Œåˆç´„å‰µé€ å‡ºä¾†å°±æœƒå‘¼å«ä¸”å»ºæ§‹å­æœƒå„²å­˜ï¼š msgï¼šå„²å­˜å‰µé€ åˆç´„çš„äººçš„addressä»¥åŠå…¶ä»–properties (tx,blockâ€¦)ï¼Œæ“æœ‰ç›´æ¥å’Œblockchainæºé€šçš„æ¬Šåˆ© msg.senderï¼šå‘¼å«åˆç´„çš„äººï¼Œè‹¥contract Aå‘¼å«contract Bï¼Œé‚£msg.senderåœ¨contract A Béƒ½æ˜¯ç›¸åŒçš„ã€‚ Ethereum Virtual MachineThe Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum. Features: OverviewThe Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum AccountsExternal accounts that are controlled by public-private key pairs (i.e. humans)Contract accounts which are controlled by the code stored together with the account.â€”-Every account has a persistent key-value store mapping 256-bit words to 256-bit words called storage. Transactions GasThe gas price is a value set by the creator of the transactionåˆç´„çš„æ‰‹çºŒè²»ï¼Œç”¨ä¾†åŸ·è¡Œåˆç´„çš„ç‡ƒæ–™ï¼Œé¿å…Contractæœ‰bugæœƒæŠŠéŒ¢ä¸€ç›´è½‰èµ° Storage, Memory and the Stack Storage:æ¯å€‹Contractéƒ½æœƒæŒæœ‰è‡ªå·±çš„storage,storageç‚ºä¸€å€‹key-value store that maps 256-bit words to 256-bit words. Memoryï¼šof which a contract obtains a freshly cleared instance for each message call Delegatecall / Callcode and Libraries Solidity ExamplesSolidity Example 1ï¼šVoting Contract.123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138pragma solidity ^0.4.11;/// @title Voting with delegation.contract Ballot &#123; // This declares a new complex type which will // be used for variables later. // It will represent a single voter. struct Voter &#123; uint weight; // weight is accumulated by delegation bool voted; // if true, that person already voted address delegate; // person delegated to uint vote; // index of the voted proposal &#125; // This is a type for a single proposal. struct Proposal &#123; bytes32 name; // short name (up to 32 bytes) uint voteCount; // number of accumulated votes &#125; address public chairperson; // This declares a state variable that // stores a `Voter` struct for each possible address. // å°‡æ¯ä¸€å€‹åœ°å€æ˜ å°„åˆ°å°æ‡‰çš„ Voter struct. mapping(address =&gt; Voter) public voters; // A dynamically-sized array of `Proposal` structs. Proposal[] public proposals; /// Create a new ballot to choose one of `proposalNames`. function Ballot(bytes32[] proposalNames) &#123; chairperson = msg.sender; voters[chairperson].weight = 1; // For each of the provided proposal names, // create a new proposal object and add it // to the end of the array. for (uint i = 0; i &lt; proposalNames.length; i++) &#123; // `Proposal(&#123;...&#125;)` creates a temporary // Proposal object and `proposals.push(...)` // appends it to the end of `proposals`. proposals.push(Proposal(&#123; name: proposalNames[i], voteCount: 0 &#125;)); &#125; &#125; // Give `voter` the right to vote on this ballot. // May only be called by `chairperson`. function giveRightToVote(address voter) &#123; // If the argument of `require` evaluates to `false`, // it terminates and reverts all changes to // the state and to Ether balances. It is often // a good idea to use this if functions are // called incorrectly. But watch out, this // will currently also consume all provided gas // (this is planned to change in the future). require((msg.sender == chairperson) &amp;&amp; !voters[voter].voted &amp;&amp; (voters[voter].weight == 0)); voters[voter].weight = 1; &#125; /// Delegate your vote to the voter `to`. function delegate(address to) &#123; // assigns reference Voter storage sender = voters[msg.sender]; require(!sender.voted); // Self-delegation is not allowed. require(to != msg.sender); // Forward the delegation as long as // `to` also delegated. // In general, such loops are very dangerous, // because if they run too long, they might // need more gas than is available in a block. // In this case, the delegation will not be executed, // but in other situations, such loops might // cause a contract to get \"stuck\" completely. while (voters[to].delegate != address(0)) &#123; to = voters[to].delegate; // We found a loop in the delegation, not allowed. require(to != msg.sender); &#125; // Since `sender` is a reference, this // modifies `voters[msg.sender].voted` sender.voted = true; sender.delegate = to; Voter delegate = voters[to]; if (delegate.voted) &#123; // If the delegate already voted, // directly add to the number of votes proposals[delegate.vote].voteCount += sender.weight; &#125; else &#123; // If the delegate did not vote yet, // add to her weight. delegate.weight += sender.weight; &#125; &#125; /// Give your vote (including votes delegated to you) /// to proposal `proposals[proposal].name`. function vote(uint proposal) &#123; Voter storage sender = voters[msg.sender]; require(!sender.voted); sender.voted = true; sender.vote = proposal; // If `proposal` is out of the range of the array, // this will throw automatically and revert all // changes. proposals[proposal].voteCount += sender.weight; &#125; /// @dev Computes the winning proposal taking all /// previous votes into account. function winningProposal() constant returns (uint winningProposal) &#123; uint winningVoteCount = 0; for (uint p = 0; p &lt; proposals.length; p++) &#123; if (proposals[p].voteCount &gt; winningVoteCount) &#123; winningVoteCount = proposals[p].voteCount; winningProposal = p; &#125; &#125; &#125; // Calls winningProposal() function to get the index // of the winner contained in the proposals array and then // returns the name of the winner function winnerName() constant returns (bytes32 winnerName) &#123; winnerName = proposals[winningProposal()].name; &#125;&#125; Solidity Example 2ï¼šSimple Open Auction123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119pragma solidity ^0.4.11;contract SimpleAuction &#123; // Parameters of the auction. Times are either // absolute unix timestamps (seconds since 1970-01-01) // or time periods in seconds. address public beneficiary; uint public auctionStart; uint public biddingTime; // Current state of the auction. address public highestBidder; uint public highestBid; // Allowed withdrawals of previous bids mapping(address =&gt; uint) pendingReturns; // Set to true at the end, disallows any change bool ended; // Events that will be fired on changes. event HighestBidIncreased(address bidder, uint amount); event AuctionEnded(address winner, uint amount); // The following is a so-called natspec comment, // recognizable by the three slashes. // It will be shown when the user is asked to // confirm a transaction. /// Create a simple auction with `_biddingTime` /// seconds bidding time on behalf of the /// beneficiary address `_beneficiary`. function SimpleAuction( uint _biddingTime, address _beneficiary ) &#123; beneficiary = _beneficiary; auctionStart = now; biddingTime = _biddingTime; &#125; /// Bid on the auction with the value sent /// together with this transaction. /// The value will only be refunded if the /// auction is not won. function bid() payable &#123; // No arguments are necessary, all // information is already part of // the transaction. The keyword payable // is required for the function to // be able to receive Ether. // Revert the call if the bidding // period is over. require(now &lt;= (auctionStart + biddingTime)); // If the bid is not higher, send the // money back. require(msg.value &gt; highestBid); if (highestBidder != 0) &#123; // Sending back the money by simply using // highestBidder.send(highestBid) is a security risk // because it could execute an untrusted contract. // It is always safer to let the recipients // withdraw their money themselves. pendingReturns[highestBidder] += highestBid; &#125; highestBidder = msg.sender; highestBid = msg.value; HighestBidIncreased(msg.sender, msg.value); &#125; /// Withdraw a bid that was overbid. function withdraw() returns (bool) &#123; uint amount = pendingReturns[msg.sender]; if (amount &gt; 0) &#123; // It is important to set this to zero because the recipient // can call this function again as part of the receiving call // before `send` returns. pendingReturns[msg.sender] = 0; if (!msg.sender.send(amount)) &#123; // No need to call throw here, just reset the amount owing pendingReturns[msg.sender] = amount; return false; &#125; &#125; return true; &#125; /// End the auction and send the highest bid /// to the beneficiary. function auctionEnd() &#123; // It is a good guideline to structure functions that interact // with other contracts (i.e. they call functions or send Ether) // into three phases: // 1. checking conditions // 2. performing actions (potentially changing conditions) // 3. interacting with other contracts // If these phases are mixed up, the other contract could call // back into the current contract and modify the state or cause // effects (ether payout) to be performed multiple times. // If functions called internally include interaction with external // contracts, they also have to be considered interaction with // external contracts. // 1. Conditions require(now &gt;= (auctionStart + biddingTime)); // auction did not yet end require(!ended); // this function has already been called // 2. Effects ended = true; AuctionEnded(highestBidder, highestBid); // 3. Interaction beneficiary.transfer(highestBid); &#125;&#125; Solidity Example 3ï¼šBlink Auction123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144pragma solidity ^0.4.11;contract BlindAuction &#123; struct Bid &#123; bytes32 blindedBid; uint deposit; &#125; address public beneficiary; uint public auctionStart; uint public biddingEnd; uint public revealEnd; bool public ended; mapping(address =&gt; Bid[]) public bids; address public highestBidder; uint public highestBid; // Allowed withdrawals of previous bids mapping(address =&gt; uint) pendingReturns; event AuctionEnded(address winner, uint highestBid); /// Modifiers are a convenient way to validate inputs to /// functions. `onlyBefore` is applied to `bid` below: /// The new function body is the modifier's body where /// `_` is replaced by the old function body. modifier onlyBefore(uint _time) &#123; require(now &lt; _time); _; &#125; modifier onlyAfter(uint _time) &#123; require(now &gt; _time); _; &#125; function BlindAuction( uint _biddingTime, uint _revealTime, address _beneficiary ) &#123; beneficiary = _beneficiary; auctionStart = now; biddingEnd = now + _biddingTime; revealEnd = biddingEnd + _revealTime; &#125; /// Place a blinded bid with `_blindedBid` = keccak256(value, /// fake, secret). /// The sent ether is only refunded if the bid is correctly /// revealed in the revealing phase. The bid is valid if the /// ether sent together with the bid is at least \"value\" and /// \"fake\" is not true. Setting \"fake\" to true and sending /// not the exact amount are ways to hide the real bid but /// still make the required deposit. The same address can /// place multiple bids. function bid(bytes32 _blindedBid) payable onlyBefore(biddingEnd) &#123; bids[msg.sender].push(Bid(&#123; blindedBid: _blindedBid, deposit: msg.value &#125;)); &#125; /// Reveal your blinded bids. You will get a refund for all /// correctly blinded invalid bids and for all bids except for /// the totally highest. function reveal( uint[] _values, bool[] _fake, bytes32[] _secret ) onlyAfter(biddingEnd) onlyBefore(revealEnd) &#123; uint length = bids[msg.sender].length; require(_values.length == length); require(_fake.length == length); require(_secret.length == length); uint refund; for (uint i = 0; i &lt; length; i++) &#123; var bid = bids[msg.sender][i]; var (value, fake, secret) = (_values[i], _fake[i], _secret[i]); if (bid.blindedBid != keccak256(value, fake, secret)) &#123; // Bid was not actually revealed. // Do not refund deposit. continue; &#125; refund += bid.deposit; if (!fake &amp;&amp; bid.deposit &gt;= value) &#123; if (placeBid(msg.sender, value)) refund -= value; &#125; // Make it impossible for the sender to re-claim // the same deposit. bid.blindedBid = 0; &#125; msg.sender.transfer(refund); &#125; // This is an \"internal\" function which means that it // can only be called from the contract itself (or from // derived contracts). function placeBid(address bidder, uint value) internal returns (bool success) &#123; if (value &lt;= highestBid) &#123; return false; &#125; if (highestBidder != 0) &#123; // Refund the previously highest bidder. pendingReturns[highestBidder] += highestBid; &#125; highestBid = value; highestBidder = bidder; return true; &#125; /// Withdraw a bid that was overbid. function withdraw() &#123; uint amount = pendingReturns[msg.sender]; if (amount &gt; 0) &#123; // It is important to set this to zero because the recipient // can call this function again as part of the receiving call // before `send` returns (see the remark above about // conditions -&gt; effects -&gt; interaction). pendingReturns[msg.sender] = 0; msg.sender.transfer(amount); &#125; &#125; /// End the auction and send the highest bid /// to the beneficiary. function auctionEnd() onlyAfter(revealEnd) &#123; require(!ended); AuctionEnded(highestBidder, highestBid); ended = true; // We send all the money we have, because some // of the refunds might have failed. beneficiary.transfer(this.balance); &#125;&#125; Solidity Example 4ï¼š Remote Purchase123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384pragma solidity ^0.4.11;contract Purchase &#123; uint public value; address public seller; address public buyer; enum State &#123; Created, Locked, Inactive &#125; State public state; function Purchase() payable &#123; seller = msg.sender; value = msg.value / 2; require((2 * value) == msg.value); &#125; modifier condition(bool _condition) &#123; require(_condition); _; &#125; modifier onlyBuyer() &#123; require(msg.sender == buyer); _; &#125; modifier onlySeller() &#123; require(msg.sender == seller); _; &#125; modifier inState(State _state) &#123; require(state == _state); _; &#125; event Aborted(); event PurchaseConfirmed(); event ItemReceived(); /// Abort the purchase and reclaim the ether. /// Can only be called by the seller before /// the contract is locked. function abort() onlySeller inState(State.Created) &#123; Aborted(); state = State.Inactive; seller.transfer(this.balance); &#125; /// Confirm the purchase as buyer. /// Transaction has to include `2 * value` ether. /// The ether will be locked until confirmReceived /// is called. function confirmPurchase() inState(State.Created) condition(msg.value == (2 * value)) payable &#123; PurchaseConfirmed(); buyer = msg.sender; state = State.Locked; &#125; /// Confirm that you (the buyer) received the item. /// This will release the locked ether. function confirmReceived() onlyBuyer inState(State.Locked) &#123; ItemReceived(); // It is important to change the state first because // otherwise, the contracts called using `send` below // can call in again here. state = State.Inactive; // NOTE: This actually allows both the buyer and the seller to // block the refund - the withdraw pattern should be used. buyer.transfer(value); seller.transfer(this.balance); &#125;&#125; Solidity èªæ³•AddressHolds a 20 byte value (size of an Ethereum address) Members of AddressesaddressåŒ…å«è‘—æœ‰ä»¥ä¸‹çš„propertiesï¼š balanceï¼šåœ°å€çš„é¤˜é¡ transferï¼šè½‰éŒ¢åˆ°è©²åœ°å€ è‹¥æœ‰éŒ¯èª¤æœƒç™¼é€exception 1234address x = 0x123;address myAddress = this;if (x.balance &lt; 10 &amp;&amp; myAddress.balance &gt;= 10) x.transfer(10); // é€çµ¦xé€™å€‹åœ°å€ 10å¡Šether send ï¼šä¹Ÿæ˜¯è½‰éŒ¢åˆ°è©²åœ°å€ è‹¥æœ‰éŒ¯èª¤åªæœƒreturn falseï¼Œä½¿ç”¨è¦æ¯”è¼ƒå°å¿ƒ call ï¼šå‚³é€åƒæ•¸ï¼ˆ.value()ï¼‰æˆ–å‡½å¼å›å‚³å€¼çµ¦åˆç´„ï¼Œ delegatecall 1234address nameReg = 0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2;nameReg.call(&quot;register&quot;, &quot;MyName&quot;);nameReg.call(bytes4(keccak256(&quot;fun(uint256)&quot;)), a);nameReg.call.value(10); Enumsï¼šé¡ä¼¼å¯¦ä½œinterfaceEnums needs at least one member. 123456789101112131415161718192021222324pragma solidity ^0.4.0;contract test &#123; enum ActionChoices &#123; GoLeft, GoRight, GoStraight, SitStill &#125; ActionChoices choice; ActionChoices constant defaultChoice = ActionChoices.GoStraight; function setGoStraight() &#123; choice = ActionChoices.GoStraight; &#125; // Since enum types are not part of the ABI, the signature of \"getChoice\" // will automatically be changed to \"getChoice() returns (uint8)\" // for all matters external to Solidity. The integer type used is just // large enough to hold all enum values, i.e. if you have more values, // `uint16` will be used and so on. function getChoice() returns (ActionChoices) &#123; return choice; &#125; function getDefaultChoice() returns (uint) &#123; return uint(defaultChoice); &#125;&#125; Functionalçš„ç¨®é¡ä»¥åŠåƒæ•¸(constnat,payble) Internal functionï¼š can only be called inside the current contract. External functionï¼š consist of an address and a function signature and they can be passed via and returned from external function calls. functionå®£å‘Šçš„æ ¼å¼ï¼š123456789function (&lt;parameter types&gt;) &#123;internal|external&#125; [constant] [payable] [returns (&lt;return types&gt;)]parameter typesï¼šåƒæ•¸çš„å½¢å¼constantï¼šæ¨™è¨»è©²functionç‚ºread-onlyï¼Œä¸æœƒæ”¹è®Šcontractçš„state.payableï¼š è¨­å®šæœƒéœ€è¦æ”¶etherçš„å‡½å¼éƒ½è¦åŠ ä¸€å€‹payableå±¬æ€§ï¼Œå¦‚æœæ²’åŠ è€Œæœ‰äººå‘¼å«è©²å‡½å¼é †ä¾¿å¸¶etherçš„è©±å°±æœƒé€ æˆerrorex:function (address chairman) &#123;&#125; constant payble returns (uint) &#123;&#125;; å…©ç¨®æ–¹æ³•å­˜å–è©²function: fï¼š will result in an internal function, this.fï¼š an external function. Internal Example: é¡ä¼¼OODçš„Protectedã€ä¸èƒ½è¢«å…¶ä»–åˆç´„å‘¼å«12345678910111213141516171819202122232425262728293031323334353637383940414243444546pragma solidity ^0.4.5;library ArrayUtils &#123; // internal functions can be used in internal library functions because // they will be part of the same code context function map(uint[] memory self, function (uint) returns (uint) f) internal returns (uint[] memory r) &#123; r = new uint[](self.length); for (uint i = 0; i &lt; self.length; i++) &#123; r[i] = f(self[i]); &#125; &#125; function reduce( uint[] memory self, function (uint, uint) returns (uint) f ) internal returns (uint r) &#123; r = self[0]; for (uint i = 1; i &lt; self.length; i++) &#123; r = f(r, self[i]); &#125; &#125; function range(uint length) internal returns (uint[] memory r) &#123; r = new uint[](length); for (uint i = 0; i &lt; r.length; i++) &#123; r[i] = i; &#125; &#125;&#125;contract Pyramid &#123; using ArrayUtils for *; function pyramid(uint l) returns (uint) &#123; return ArrayUtils.range(l).map(square).reduce(sum); &#125; function square(uint x) internal returns (uint) &#123; return x * x; &#125; function sum(uint x, uint y) internal returns (uint) &#123; return x + y; &#125;&#125; Externalï¼š å…¶ä»–åˆç´„å¯ä»¥å‘¼å«è©²åˆç´„çš„function1234567891011121314151617181920212223242526272829pragma solidity ^0.4.11;contract Oracle &#123; struct Request &#123; bytes data; function(bytes memory) external callback; &#125; Request[] requests; event NewRequest(uint); function query(bytes data, function(bytes memory) external callback) &#123; requests.push(Request(data, callback)); NewRequest(requests.length - 1); &#125; function reply(uint requestID, bytes response) &#123; // Here goes the check that the reply comes from a trusted source requests[requestID].callback(response); &#125;&#125;contract OracleUser &#123; Oracle constant oracle = Oracle(0x1234567); // known contract function buySomething() &#123; oracle.query(\"USD\", this.oracleResponse); &#125; function oracleResponse(bytes response) &#123; require(msg.sender == address(oracle)); // Use the data &#125;&#125; å®£å‘ŠArrayex:1uint[] memory a = new uint[](7); å®£å‘Š Structï¼š é¡ä¼¼å®£å‘Šä¸€å€‹ç‰©ä»¶æ¨¡æ¿ 1234struct Funder &#123; address addr; uint amount;&#125; Mappingså®£å‘Šæˆï¼š mapping(_KeyType =&gt; _ValueType) çš„å½¢å¼ï¼Œå¯ä»¥çœ‹æˆæ˜¯hash tableçš„å½¢å¼ï¼Œ 123456789101112131415161718pragma solidity ^0.4.0;contract MappingExample &#123; mapping(address =&gt; uint) public balances; //è¨­å®šbalancesçš„indexç‚ºaddreesså½¢æ…‹çš„ï¼Œæ˜ å°„å‡ºå¾Œæœƒå¾—åˆ°uintå‹æ…‹çš„å›å‚³å€¼ã€‚ function update(uint newBalance) &#123; balances[msg.sender] = newBalance; &#125;&#125;contract MappingUser &#123; function f() returns (uint) &#123; MappingExample m = new MappingExample(); m.update(100); return m.balances(this); &#125;&#125; å…¶ä»– Operators Involving LValuesï¼ˆå¯è¢«assignçš„value)delete aï¼š æŠŠaåˆå§‹åŒ–æˆ 0ï¼ˆä¹Ÿå¯ä»¥ç”¨åœ¨array éƒ½è¨­æˆ0, struct éƒ½è¨­æˆåˆå§‹å€¼) Etherå–®ä½Ether Uintï¼š1 ether =1000000000000000000 wei, (10^18)1000 finney, (10^3)1000000 szabo (10^6) å…¨åŸŸå¯ç”¨è®Šæ•¸åŠå‡½å¼Special Variables and Functions suicide.(Aåˆç´„): å°‡ç›®å‰åˆç´„çš„æ‰€æœ‰etheréƒ½è½‰å…¥åˆ°æŒ‡å®šçš„ï¼¡åˆç´„(contract) deleteï¼šå›æ”¶å®£å‘Šçš„æˆå“¡ï¼Œä¸¦ä¸”è¿”å›ä¸€äº›gasç•¶ä½œå›æ”¶çš„çå‹µã€‚ å›æ”¶å„å‹æ…‹çš„åƒè€ƒè³‡æ–™ï¼šhttp://me.tryblockchain.org/solidity-delete.html Block and Transaction Properties block.blockhash(uint blockNumber) returns (bytes32): hash of the given block - only works for 256 most recent blocks excluding current block.coinbase (address): current block minerâ€™s address block.difficulty (uint): current block difficulty block.gaslimit (uint): current block gaslimit block.number (uint): current block number block.timestamp (uint): current block timestamp as seconds since unix epoch msg.data (bytes): complete calldata msg.gas (uint): remaining gas msg.sender (address): sender of the message (current call) msg.sig (bytes4): first four bytes of the calldata (i.e. function identifier) msg.value (uint): number of wei sent with the message now (uint): current block timestamp (alias for block.timestamp) tx.gasprice (uint): gas price of the transaction tx.origin (address): sender of the transaction (full call chain)(ä¸å»ºè­°ç”¨) Error Handling assert(bool condition):throws if the condition is not met - to be used for internal errors. require(bool condition):throws if the condition is not met - to be used for errors in inputs or external components. revert():abort execution and revert state changes Mathematical and Cryptographic Functions addmod(uint x, uint y, uint k) returns (uint):compute (x + y) % k where the addition is performed with arbitrary precision and does not wrap around at 2**256. mulmod(uint x, uint y, uint k) returns (uint):compute (x * y) % k where the multiplication is performed with arbitrary precision and does not wrap around at 2**256. keccak256(â€¦) returns (bytes32):compute the Ethereum-SHA-3 (Keccak-256) hash of the (tightly packed) arguments sha256(â€¦) returns (bytes32):compute the SHA-256 hash of the (tightly packed) argumentssha3(â€¦) returns (bytes32):alias to keccak256 ripemd160(â€¦) returns (bytes20):compute RIPEMD-160 hash of the (tightly packed) arguments ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address):recover the address associated with the public key from elliptic curve signature or return zero on error (example usage) Solidityçš„è¡¨é”å’Œæ§åˆ¶çš„çµæ§‹ï¼ˆExpressions and Control Structuresï¼‰Input Parameters and Output Parameters æ¥æ”¶åƒæ•¸å’Œå›å‚³çš„å½¢å¼12345678910pragma solidity ^0.4.0;contract Simple &#123; // æ¥æ”¶ uint _a , uint _bè®Šæ•¸ // å›å‚³uint -_sum uint o_product function arithmetics(uint _a, uint _b) returns (uint o_sum, uint o_product) &#123; o_sum = _a + _b; o_product = _a * _b; &#125;&#125; External Function Callså¦‚æœè¦å¾—çŸ¥å‘¼å«æŸåˆç´„çš„functionæœƒæœ‰å¤šå°‘Weiå’ŒèŠ±è²»å¤šå°‘gasï¼Œå¯ç”¨.value() .gas() ç¯„ä¾‹ä¸­çš„function info() å¦‚æœæ²’æœ‰åŠ ä¸Š payableé€™å€‹keywordï¼Œå°±ç„¡æ³•ä½¿ç”¨ .value() 123456789101112pragma solidity ^0.4.0;contract InfoFeed &#123; // function info() payable returns (uint ret) &#123; return 42; &#125;&#125;contract Consumer &#123; InfoFeed feed; function setFeed(address addr) &#123; feed = InfoFeed(addr); &#125; function callFeed() &#123; feed.info.value(10).gas(800)(); &#125;&#125; Creating Contracts via new123456789101112131415161718192021pragma solidity ^0.4.0;contract D &#123; uint x; function D(uint a) payable &#123; x = a; &#125;&#125;contract C &#123; D d = new D(4); // will be executed as part of C's constructor function createD(uint arg) &#123; D newD = new D(arg); &#125; function createAndEndowD(uint arg, uint amount) &#123; // Send ether along with the creation D newD = (new D).value(amount)(arg); &#125;&#125; Error handling: Assert, Require, Revertand Exceptions require can be used to easily check conditions on inputs. assert can be used for internal error checking. 1234567891011121314pragma solidity ^0.4.0;contract Sharer &#123; function sendHalf(address addr) payable returns (uint balance) &#123; require(msg.value % 2 == 0); // Only allow even numbers uint balanceBeforeTransfer = this.balance; addr.transfer(msg.value / 2); // Since transfer throws an exception on failure and // cannot call back here, there should be no way for us to // still have half of the money. assert(this.balance == balanceBeforeTransfer - msg.value / 2); return this.balance; &#125;&#125; assert ç™¼ç”Ÿçš„ç‹€æ³ï¼š If you access an array at a too large or negative index (i.e. x[i] where i &gt;= x.length or i &lt; 0). If you access a fixed-length bytesN at a too large or negative index. If you divide or modulo by zero (e.g. 5 / 0 or 23 % 0). If you shift by a negative amount. If you convert a value too big or negative into an enum type. If you call a zero-initialized variable of internal function type. If you call assert with an argument that evaluates to false. require ç™¼ç”Ÿçš„ç‹€æ³ï¼š Calling throw. Calling require with an argument that evaluates to false. If you call a function via a message call but it does not finish properly (i.e. it runs out of gas, has no matching function, or throws an exception itself), except when a low level operation call, send, delegatecall or callcode is used. The low level operations never throw exceptions but indicate failures by returning false. If you create a contract using the new keyword but the contract creation does not finish properly (see above for the definition of â€œnot finish properlyâ€). If you perform an external function call targeting a contract that contains no code. If your contract receives Ether via a public function without payable modifier (including the constructor and the fallback function). If your contract receives Ether via a public getter function. If a .transfer() fails. Solidity Contract(å³Class)å‰µå»ºcontractçš„æ™‚å€™ï¼Œconstructoråªæœƒè¢«å‘¼å«ä¸€æ¬¡ åˆç´„çš„Visibility and GettersVisibilityï¼š external:External functions are part of the contract interface, which means they can be called from other contracts and via transactions. An external function f cannot be called internally (i.e. f() does not work, but this.f() works). External functions are sometimes more efficient when they receive large arrays of data. public:Public functions are part of the contract interface and can be either called internally or via messages. For public state variables, an automatic getter function (see below) is generated. internal:Those functions and state variables can only be accessed internally (i.e. from within the current contract or contracts deriving from it), without using this. private:Private functions and state variables are only visible for the contract they are defined in and not in derived contracts. Getter Functions123456789pragma solidity ^0.4.0;contract C &#123; uint public data; function x() &#123; data = 3; // internal access ç•¶æˆstateè®Šæ•¸ uint val = this.data(); // external access ç•¶æˆæ˜¯function &#125;&#125; Function Modifier (é¡ä¼¼ï¼šå‡½å¼æ’æ§½)Modifierå¯ç”¨ç”¨ä¾†æ“´å……å…¶ä»–functionçš„å…§å®¹ï¼Œéœ€è¦è¢«inheritæ‰èƒ½ä½¿ç”¨ã€‚é€šå¸¸modifierç”¨ä¾†è¨­å®šä¸€äº›æ¢ä»¶ï¼Œå¹«åŠ©å‡½å¼è¢«åŸ·è¡Œæ™‚èƒ½å¤ å…ˆæ»¿è¶³è©²æ¢ä»¶å†è¢«åŸ·è¡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172pragma solidity ^0.4.11;contract owned &#123; function owned() &#123; owner = msg.sender; &#125; address owner; // è©²ownedåˆç´„åªæœ‰å®£å‘Šä¸€å€‹modifier onlyOwnerï¼Œä¸¦ä¸”æ²’æœ‰ä½¿ç”¨å®ƒ // è©²modifieråªæœƒè¢«å…¶ä»–æœ‰ç¹¼æ‰¿owned contractçš„åˆç´„æ‰€ä½¿ç”¨ // // \"_;\" è¦ç¹¼æ‰¿onlyOwner å‡½å¼çš„å…§å®¹ modifier onlyOwner &#123; require(msg.sender == owner); _; &#125;&#125;contract mortal is owned &#123; // ç¹¼æ‰¿ ownedåˆç´„ // closeå‡½å¼ ä½¿ç”¨modifier \"onlyOwner\" // ä¸”closeçš„å…§å®¹æœƒæ’å…¥åœ¨ modifierä¸­çš„ \"_;\"ä¸­ // å¯ä»¥æŠŠmodifieræƒ³åƒæˆ slotï¼ˆæ’æ§½) function close() onlyOwner &#123; selfdestruct(owner); &#125;&#125;contract priced &#123; // Modifier ä¹Ÿå¯ä»¥æ¥æ”¶åƒæ•¸ modifier costs(uint price) &#123; // è‹¥æ»¿è¶³msg.value &gt;= price é‚£å°±åŸ·è¡Œ ä½¿ç”¨è©²modifierå‡½å¼çš„å…§å®¹ if (msg.value &gt;= price) &#123; _; &#125; &#125;&#125;contract Register is priced, owned &#123; mapping (address =&gt; bool) registeredAddresses; uint price; function Register(uint initialPrice) &#123; price = initialPrice; &#125; // éœ€è¦æä¾› payableï¼Œregisteræ‰æœƒæ¥å—ether // ä½¿ç”¨ costs çš„modifier . function register() payable costs(price) &#123; registeredAddresses[msg.sender] = true; &#125; function changePrice(uint _price) onlyOwner &#123; price = _price; &#125;&#125;contract Mutex &#123; bool locked; modifier noReentrancy() &#123; require(!locked); locked = true; _; locked = false; &#125; // noReentrancy è¢«ä¸€å€‹mutexæ‰€ä¿è­·ï¼Œå¿…é ˆè¦åˆ¤æ–·lockedæ˜¯å¦æ˜¯falseæ‰èƒ½åŸ·è¡Œ noReentrancyæ‰èƒ½åŸ·è¡Œ // reentrant calls from within // msg.sender.call cannot call f again.å› çˆ²lockä½äº† // ä½¿ç”¨ noReentrancy(modifier), function f() noReentrancy returns (uint) &#123; require(msg.sender.call()); return 7; &#125;&#125; Constant State Variablesç›®å‰åƒ…æ”¯æ´ uint, stringä½¿ç”¨ å®£å‘Šä¸€æ¬¡å¾Œå°±ä¸èƒ½å†è¢«æ”¹è®Š Constant Functionsä¸æœƒæ”¹è®Šcontract stateçš„å€¼ 1234567pragma solidity ^0.4.0;contract C &#123; function f(uint a, uint b) constant returns (uint) &#123; return a * (b + 42); &#125;&#125; Fallback Functionæ²’æœ‰åç¨±çš„function,ä¸¦ä¸”æ²’æœ‰æ¥æ”¶åƒæ•¸ä»¥åŠä¸æœƒå‚³ä»»ä½•å€¼ã€‚ç•¶å‘¼å«æŸåˆç´„çš„æ–¹æ³•æ™‚ï¼Œæ²’æœ‰è¾¦æ³•æˆåŠŸ å¦‚æœæœ‰åˆç´„ç›´æ¥æ”¶åˆ°etherçš„è©±ï¼ˆäº¦å³ä¸æ˜¯é€ésend() or transfer() é‚£å°±å¾—å®šç¾©ä¸€å€‹fallback functionï¼Œä¸ç„¶æœƒthrow an exception. 1234567891011121314151617181920212223242526pragma solidity ^0.4.0;contract Test &#123; function() &#123; x = 1; &#125; uint x;&#125;// This contract keeps all Ether sent to it with no way// to get it back.contract Sink &#123; function() payable &#123; &#125;&#125;contract Caller &#123; function callTest(Test test) &#123; test.call(0xabcdef01); // hash: 0xabcdef01 ä¸å­˜åœ¨ // æ•… test.xçš„çµæœæœƒè®Šæˆ test.x = 1 // The following will not compile, but even // if someone sends ether to that contract, // the transaction will fail and reject the // Ether. //test.send(2 ether); &#125;&#125; EventsEventæ‰€å¯«å…¥çš„è³‡æ–™æœƒè¢«è¨˜éŒ„åœ¨ä¸€å€‹Receiptï¼ˆtransaction logs)è³‡æ–™è£¡ï¼Œä¸¦ç­‰å¾…è¢«æ‰“åŒ…é€²å€å¡Šéˆã€‚ ç™½è©±ä¸€é»å°±æ˜¯ï¼šé€šçŸ¥å…¨ç¶²æœ‰ä¸€ä»¶äº‹æƒ…ç™¼ç”Ÿã€‚ 12345678910111213141516pragma solidity ^0.4.0;contract ClientReceipt &#123; event Deposit( address indexed _from, bytes32 indexed _id, uint _value ); function deposit(bytes32 _id) payable &#123; // Any call to this function (even deeply nested) can // be detected from the JavaScript API by filtering // for `Deposit` to be called. Deposit(msg.sender, _id, msg.value); &#125;&#125; åœ¨javascript APIçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š1234567891011121314151617181920var abi = /* abi as generated by the compiler */;var ClientReceipt = web3.eth.contract(abi);var clientReceipt = ClientReceipt.at(0x123 /* address */);var event = clientReceipt.Deposit();// watch for changesevent.watch(function(error, result)&#123; // result will contain various information // including the argumets given to the Deposit // call. if (!error) console.log(result);&#125;);// Or pass a callback to start watching immediatelyvar event = clientReceipt.Deposit(function(error, result) &#123; if (!error) console.log(result);&#125;); Inheritanceä½¿ç”¨ is ä¾†ç¹¼æ‰¿å…¶ä»–contract. æä¾›å¤šé‡ç¹¼æ‰¿åŒæ™‚ä¹ŸåŒ…å«å¤šå‹ç•¶ä¸€å€‹åˆç´„Rç¹¼æ‰¿å…¶ä»–A,B,Cçš„åˆç´„æ™‚ï¼Œåªæœ‰Rçš„åˆç´„è¢«æ‰“åŒ…é€²å»blockchainï¼Œå…¶ä»–ABCä¸æœƒã€‚ï¼ˆå› ç‚ºæ˜¯å°‡A,B,Cçš„å…§å®¹è¤‡è£½åˆ°Rçš„åˆç´„å…§) åƒæ˜¯Pythonçš„ç¹¼æ‰¿ç‰¹æ€§ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556pragma solidity ^0.4.0;contract owned &#123; function owned() &#123; owner = msg.sender; &#125; address owner;&#125;// ä½¿ç”¨ \"is\" ä¾†ç¹¼æ‰¿ï¼Œå¯ä»¥å­˜å–ç¹¼æ‰¿åˆç´„çš„ non-private members (åŒ…å« internal function and state variables)ï¼Œç„¡æ³•é€é this ä¾†åšexternally access.contract mortal is owned &#123; function kill() &#123; if (msg.sender == owner) selfdestruct(owner); &#125;&#125;// ç•¶æˆæ˜¯ interfaceï¼Œç­‰å¾…è¢«ç¹¼æ‰¿å¯¦ä½œcontract Config &#123; function lookup(uint id) returns (address adr);&#125;contract NameReg &#123; function register(bytes32 name); function unregister();&#125;// å¯ä»¥å¯¦ç¾å¤šé‡ç¹¼æ‰¿// æ³¨æ„çš„æ˜¯\"owned\" ä¸€æ¨£ä¹Ÿè¢«mortalç¹¼æ‰¿ï¼Œæ•…åªæœ‰ä¸€å€‹\"owned\"çš„instance (å’ŒC++çš„vritual inheritanceä¸€æ¨£)contract named is owned, mortal &#123; function named(bytes32 name) &#123; Config config = Config(0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970); NameReg(config.lookup(1)).register(name); &#125;// å¯ä»¥override ç¹¼æ‰¿çš„function.æ³¨æ„è¦èˆ‡åŸæœ¬çš„å‹æ…‹è¦ä¸€è‡´ function kill() &#123; if (msg.sender == owner) &#123; Config config = Config(0xd5f9d8d94886e70b06e474c3fb14fd43e2f23970); NameReg(config.lookup(1)).unregister(); // ä¾ç„¶å¯ä»¥å‘¼å«ç¹¼æ‰¿åˆç´„å…§çš„å‡½å¼ mortal.kill(); &#125; &#125;&#125;// å¦‚æœç¹¼æ‰¿çš„contractä¸­æœ‰çš„äººçš„contractoréœ€è¦parameter,// é‚£å°±å¾—åœ¨ is å¾Œé¢çš„åœ°æ–¹è¼¸å…¥åƒæ•¸ï¼Œ// å¦‚ä¸‹ \"named(\"GoldFeed\");contract PriceFeed is owned, mortal, named(\"GoldFeed\") &#123; function updateInfo(uint newInfo) &#123; if (msg.sender == owner) info = newInfo; &#125; function get() constant returns(uint r) &#123; return info; &#125; uint info;&#125; å¤šé‡ç¹¼æ‰¿è¦æ³¨æ„çš„é»ï¼š12345678910111213141516171819202122232425pragma solidity ^0.4.0;contract owned &#123; function owned() &#123; owner = msg.sender; &#125; address owner;&#125;contract mortal is owned &#123; function kill() &#123; if (msg.sender == owner) selfdestruct(owner); &#125;&#125;contract Base1 is mortal &#123; function kill() &#123; /* do cleanup 1 */ mortal.kill(); &#125;&#125;contract Base2 is mortal &#123; function kill() &#123; /* do cleanup 2 */ mortal.kill(); &#125;&#125;contract Final is Base1, Base2 &#123;&#125; å‘¼å« Final.kill åƒ…æœƒå‘¼å«åˆ° Base2çš„ kill function.è€Œå¿½ç•¥æ‰ Base1 çš„. Abstract Contractsä¸å¯¦ä½œåˆç´„å…§çš„functionå…§å®¹ï¼Œè¢«ç¹¼æ‰¿æ™‚åœ¨å¯¦ä½œã€‚ä½†å¯ä»¥å®šç¾©è®Šæ•¸ï¼Œå»ºæ§‹å­ç­‰ç­‰ã€‚ ä¾‹å­ï¼š12345pragma solidity ^0.4.0;contract Feline &#123; function utterance() returns (bytes32);&#125; Interfaceså’ŒAbstractå¾ˆåƒï¼Œä¸éä¸èƒ½æœ‰ä»»ä½•çš„functionè¢«å¯¦ä½œä»¥ä¸‹ç‚ºé™åˆ¶æ¢ä»¶ Cannot inherit other contracts or interfaces. Cannot define constructor. Cannot define variables. Cannot define structs. Cannot define enums. 12345pragma solidity ^0.4.11;interface Token &#123; function transfer(address recipient, uint amount);&#125; Librarieså’Œcontract(class)å¾ˆåƒï¼Œä¸éåƒ…æœƒåœ¨ç‰¹åœ°çš„addresséƒ¨ç½²ä¸€æ¬¡è€Œå·²ã€‚ å› ç‚ºä½ˆä¸€å€‹contractéœ€è¦gasï¼Œä¸éå¦‚æœè¦é‡è¤‡ä½¿ç”¨Setçš„è©±ï¼Œåˆä¸æƒ³é‡è¤‡å®£å‘Šcontractï¼Œé‚£å°±å¯ä»¥ç”¨Librariesä¾†å¯¦ä½œå‡ºä¸€å€‹Setï¼Œä¸¦ä¸”ä½ˆå‡ºå»å°±æœƒç”¢ç”Ÿä¸€å€‹åœ°å€ (linker)ï¼Œå…¶ä»–åˆç´„å°±å¯ä»¥é€élinkerä¾†ä½¿ç”¨Set. ç›´æ¥çœ‹ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950pragma solidity ^0.4.11;library Set &#123; // We define a new struct datatype that will be used to // hold its data in the calling contract. struct Data &#123; mapping(uint =&gt; bool) flags; &#125; // Note that the first parameter is of type \"storage // reference\" and thus only its storage address and not // its contents is passed as part of the call. This is a // special feature of library functions. It is idiomatic // to call the first parameter 'self', if the function can // be seen as a method of that object. function insert(Data storage self, uint value) returns (bool) &#123; if (self.flags[value]) return false; // already there self.flags[value] = true; return true; &#125; function remove(Data storage self, uint value) returns (bool) &#123; if (!self.flags[value]) return false; // not there self.flags[value] = false; return true; &#125; function contains(Data storage self, uint value) returns (bool) &#123; return self.flags[value]; &#125;&#125;contract C &#123; Set.Data knownValues; function register(uint value) &#123; // The library functions can be called without a // specific instance of the library, since the // \"instance\" will be the current contract. require(Set.insert(knownValues, value)); &#125; // In this contract, we can also directly access knownValues.flags, if we want.&#125; Style Guide ï¼ˆå¥—ç”¨eslint for solidity) Indentation: 4 spaces (avoid using tabs.) Order of Functions: (functionçš„å¯«æ³•çš„å„ªå…ˆé †åº) constructor fallback function (if exists) external public internal private Web3.js å­¸ç¿’ç›®æ¨™ç­è§£ï¼š1.å¦‚ä½•æŠŠkey pairæŠ“å‡ºä¾†2.å¦‚ä½•ç°½é©—ç« 3.å¦‚ä½•é€²è¡ŒåŠ è§£å¯†4.å¦‚ä½•ç™¼events ç’°ç°½ç«  åŒæ…‹åŠ å¯†Confidential transactionï¼ˆhttps://www.elementsproject.org/elements/confidential-transactions/ ZKsnark(åŒ…å«é›¶çŸ¥è­˜è­‰æ˜)åƒè€ƒï¼šï¼ˆæ‡‰ç”¨ä¾‹å­ï¼šä¸å…¬é–‹UTXOï¼Œä¹Ÿèƒ½è®“ç¤¦å·¥é©—è­‰ï¼Œä¸éç¤¦å·¥ä¸èƒ½è§£å¯†ï¼Œä¸ç„¶æœƒå¤±å»confidentialçš„ç‰¹æ€§ï¼Œä¸è®“receiverçŸ¥é“UTXOï¼‰https://z.cash/technology/zksnarks.html","categories":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/categories/Solidity/"}],"tags":[{"name":"Blockchain","slug":"Blockchain","permalink":"http://a10000005588.github.io/tags/Blockchain/"},{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/tags/Ethereum/"},{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/tags/Solidity/"}]},{"title":"ä½¿ç”¨truffleä¾†ç·´ç¿’æ’°å¯«èªé¤Šå¯µç‰©çš„æ™ºèƒ½åˆç´„","slug":"truffle-petshop","date":"2017-09-07T14:02:57.000Z","updated":"2020-07-26T09:17:54.837Z","comments":true,"path":"2017/09/07/truffle-petshop/","link":"","permalink":"http://a10000005588.github.io/2017/09/07/truffle-petshop/","excerpt":"æœ¬ç¯‡æ˜¯ç¿»è­¯è‡ªTruffleå®˜æ–¹æ‰€é‡‹å‡ºçš„Dappæ•™å­¸æ–‡æª”Pet-Shophttp://truffleframework.com/tutorials/pet-shop åŸ·è¡Œç’°å¢ƒé–‹ç™¼å‰æº–å‚™é¦–å…ˆè¦å®‰è£testrpcã€truffle :12345npm install -g ethereumjs-testrpc// å®‰è£æ¸¬è©¦ç”¨ethereumç§æœ‰éŠnpm install -g truffle// é–‹ç™¼æ™ºèƒ½åˆç´„çš„ä¸€å¥—æ¡†æ¶","text":"æœ¬ç¯‡æ˜¯ç¿»è­¯è‡ªTruffleå®˜æ–¹æ‰€é‡‹å‡ºçš„Dappæ•™å­¸æ–‡æª”Pet-Shophttp://truffleframework.com/tutorials/pet-shop åŸ·è¡Œç’°å¢ƒé–‹ç™¼å‰æº–å‚™é¦–å…ˆè¦å®‰è£testrpcã€truffle :12345npm install -g ethereumjs-testrpc// å®‰è£æ¸¬è©¦ç”¨ethereumç§æœ‰éŠnpm install -g truffle// é–‹ç™¼æ™ºèƒ½åˆç´„çš„ä¸€å¥—æ¡†æ¶ å®‰è£truffleä¸Šå·²ç¶“é å…ˆåŒ…å¥½çš„ç·´ç¿’å°ˆæ¡ˆ(Truffle box: ETHEREUM PET SHOP)ï¼š12345678mkdir pet-shop-tutorial // å‰µå»ºä¸€å€‹ç›®éŒ„cd pet-shop-tutorial // åˆ‡æ›åˆ°è©²ç›®éŒ„truffle unbox pet-shop// å®‰è£truffleæ‰“åŒ…å¥½çš„pet-shopç·´ç¿’å°ˆæ¡ˆæª” ç›®éŒ„æ¶æ§‹ /contracts: å­˜æ”¾åˆç´„çš„åœ°æ–¹ï¼Œæª”åç‚º.solï¼Œè€ŒMigrate.solæ˜¯è² è²¬ç´€éŒ„å…¶ä»–åˆç´„å¦‚ä½•deployåˆ°å€å¡Šéˆï¼Œä¸èƒ½åˆªé™¤ï¼ /migrations: è² è²¬å°‡åˆç´„æ›åˆ°å€å¡Šéˆä¸Šï¼Œä¸¦ä¸”è¿½è¹¤åˆç´„çš„æ›´å‹•ç‹€æ³ã€‚ /test: åŒ…å«Javascript and solidityæª”æ¡ˆï¼Œè² è²¬æ¸¬è©¦åˆç´„å…§å®¹ã€‚ truffle.js : truffleçš„è¨­å®šæª” åˆç´„å…§å®¹åœ¨/contract å»ºç«‹ Adoption.solå®£å‘Šä¸€å€‹contract:12345678910111213141516171819202122232425262728pragma solidity ^0.4.4;// å‘Šè¨´compiler ç¾åœ¨è¦ç”¨å“ªå€‹ç‰ˆæœ¬ç·¨è­¯contract Adoption &#123; //å®£å‘Šä¸€å€‹ contractçš„class å« Adoption // å­˜æ”¾é ˜é¤Šé£¼ä¸»çš„åœ°å€ï¼ˆé è¨­æ˜¯æœ‰16éš»ç‹—ç­‰å¾…è¢«èªé¤Šï¼‰ address[16] public adopters; // æœ‰äººè¦èªé¤ŠæŸéš»å¯µç‰©(petId)ï¼Œåˆ¤æ–·æ˜¯å¦å¯ä»¥èªé¤Šï¼Œ // å›å‚³è©²èªé¤Šçš„å¯µç‰©IDä»¥è­‰æ˜è©²å¯µç‰©æˆåŠŸè¢«æŸç”¨æˆ¶èªé¤Š function adopt(uint petId) public returns (uint) &#123; require(petId &gt;= 0 &amp;&amp; petId &lt;= 15); // åˆ¤æ–·petIdï¼Œè‹¥ä¸ç¬¦åˆçµæŸè©²å‡½å¼ï¼Œä¸å†å¾€ä¸‹åŸ·è¡Œ adopters[petId] = msg.sender; // é€émsg.senderå–å¾—å‘¼å«è©²å‡½å¼çš„ä½¿ç”¨è€… // ä¹Ÿå°±æ˜¯èªé¤Šè©²å¯µç‰©çš„ç”¨æˆ¶ID return petId; &#125; // å›å‚³æ‰€æœ‰çš„èªé¤Šè€…ï¼Œå›å‚³å€¼çš„å‹æ…‹ç‚ºaddress[16] function getAdopters() public returns (address[16]) &#123; return adopters; &#125; &#125; ç·¨è­¯(Compiling)å’Œéƒ¨ç½²(Migrating)åˆç´„å¯«å¥½åˆç´„å¾Œï¼Œéœ€è¦å°‡.solæª”é€²è¡Œç·¨è­¯æˆ.bytecodeï¼Œæ‰èƒ½åœ¨EVM (ethereum virtual machineä¸ŠåŸ·è¡Œ). ç„¶å¾Œåœ¨terminalä¸ŠåŸ·è¡Œ testrpc å•Ÿå‹• å•Ÿå‹•å¾Œæœƒå‡ºç¾ï¼š æ•¸çµ„å¸³æˆ¶çš„addressä»¥åŠç§é‘° HD walletçš„è³‡è¨Šï¼ˆç¨å¾Œæœƒæåˆ°metataskï¼Œæœƒä½¿ç”¨åˆ°Mnemonic sectionçš„è³‡è¨Š) Mnemonicç‚ºæ•¸å€‹è®Šæ•¸çš„è³‡è¨Šï¼Œå¦‚ä¸‹Mnemonic: spider level team helmet shaft clarify abuse recipe stem ankle angry fee åŸ·è¡Œ truffle compile æœƒçœ‹åˆ° .solæª”è¢«ç·¨è­¯ Migrationmigrate.solæè¿°å¦‚ä½•å°‡åˆç´„çš„å…§å®¹éƒ¨ç½²åˆ°éˆä¸Šï¼Œä¸¦ä¸”è™•ç†åˆç´„ä¸Šstateçš„æ›´å‹•ã€‚ åœ¨ /migration æª”æ¡ˆå…§ï¼š 1_initial_migration.jsï¼š 123456// å¼•å…¥ç·¨è­¯åˆç´„çš„å…§å®¹var Migrations = artifacts.require(\"./Migrations.sol\");module.exports = function(deployer) &#123; deployer.deploy(Migrations);&#125;; é€éè©²æª”æ¡ˆå¯ä»¥è¿½è¹¤å¾ŒçºŒcontractçš„è®ŠåŒ–ï¼Œå·²éƒ¨ç½²éçš„åˆç´„ä¸”æ²’æœ‰è¢«ä¿®æ”¹å°±ä¸ç”¨å†è¢«éƒ¨ç½²ï¼ˆä¸ç„¶åˆæœƒæ¶ˆè€—gas). 2_deploy_contracts.jsæ³¨æ„ï¼Œé€™é‚Šçš„å‘½åé–‹é ­è¦ç·¨è™Ÿï¼Œå› ç‚ºtruffleé€²è¡Œmigrateæ™‚æœƒä¾æ“šè©²ç·¨è™Ÿè€Œé€²è¡Œã€‚ 12345var Adoption = artifacts.require(\"./Adoption.sol\");module.exports = function(deployer) &#123; deployer.deploy(Adoption);&#125;; åœ¨terminalåŸ·è¡Œ truffle migrate æœƒçœ‹åˆ°å¦‚ä¸‹çµæœ123456789101112Using network &apos;development&apos;.Running migration: 1_initial_migration.js Deploying Migrations... Migrations: 0x75175eb116b36ff5fef15ebd15cbab01b50b50d1Saving successful migration to network...Saving artifacts...Running migration: 2_deploy_contracts.js Deploying Adoption... Adoption: 0xb9f485451a945e65e48d9dd7fc5d759af0a89e21Saving successful migration to network...Saving artifacts... è‹¥çœ‹åˆ°ä¸Šè¿°è¡¨é¢è¡¨ç¤ºæˆ‘å€‘å¯«çš„ç¬¬ä¸€éš» Adoption.solçš„åˆç´„å·²ç¶“æˆåŠŸè¢«éƒ¨ç½²åˆ°éˆä¸Šï¼ ç‚ºSmart Contractå¯«æ¸¬è©¦æˆ‘å€‘å¯ä»¥ç”¨javascriptæˆ–solidityå¯«æ¸¬è©¦ï¼Œä¸éæœ¬ç¯„ä¾‹ç”¨solidityä¾†å¯«ã€‚ åœ¨ /test ç›®éŒ„ä¸‹å‰µå»º TestAdoption.sol123456789101112131415161718192021222324252627282930313233343536373839404142434445464748pragma solidity ^0.4.11;// å¼•ç”¨truffleå…§å»ºçš„æª”æ¡ˆ // Assert.solç”¨ä¾†åšUnit test (åˆ¤æ–·function input ?= output)import \"truffle/Assert.sol\";// ç•¶æ¸¬è©¦åŸ·è¡Œï¼Œtruffleæœƒåœ¨testrpcä¸­æ¸¬è©¦è©²åˆç´„ï¼Œ// è©²DeployedAddressesç”¨ä¾†å–å¾—è¢«éƒ¨ç½²åˆç´„çš„addressimport \"truffle/DeployedAddresses.sol\";// è¦è¢«æ¸¬è©¦çš„åˆç´„import \"../contracts/Adoption.sol\";contract TestAdoption &#123; Adoption adoption = Adoption(DeployedAddresses.Adoption()); // Testing The adopt() Function function testUserCanAdoptPet() &#123; // å‘¼å«Adoptionä¸­çš„adoptæ–¹æ³• uint returnedId = adoption.adopt(8); uint expected = 8; // åˆ¤æ–·returnID æ˜¯å¦ç­‰æ–¼ expectedçš„å€¼ Assert.equal(returnedId, expected, \"Adoption of pet ID 8 should be recorded.\"); &#125; // Testing Retrieval of a Single Pet's Owner function testGetAdopterAddressByPetId() &#123; // é€éthiså–å¾—ç›®å‰åˆç´„çš„åœ°å€ address expected = this; address adopter = adoption.adopters(8); Assert.equal(adopter, expected, \"Owner of pet ID 8 should be recorded.\"); &#125; // Testing Retrieval of All Pet Owners function testGetAdopterAddressByPetIdInArray() &#123; address expected = this; address[16] memory adopters = adoption.getAdopters(); Assert.equal(adopters[8], expected, \"Owner of pet ID 8 should be recorded.\"); &#125; &#125; åŸ·è¡Œ truffle test è‹¥çœ‹åˆ°ä»¥ä¸‹ç•«é¢è¡¨ç¤ºtesté€šé123456789101112131415Using network &apos;development&apos;.Compiling ./contracts/Adoption.sol...Compiling ./test/TestAdoption.sol...Compiling truffle/Assert.sol...Compiling truffle/DeployedAddresses.sol... TestAdoption âœ“ testUserCanAdoptPet (91ms) âœ“ testGetAdopterAddressByPetId (70ms) âœ“ testGetAdopterAddressByPetIdInArray (89ms) 3 passing (670ms) ä½¿ç”¨UIå’ŒSmart Contractäº’å‹•ç•¶è§£é–‹truffle boxçš„pet-shopï¼Œå¯ä»¥çœ‹åˆ°åœ¨ /srcç›®éŒ„åº•ä¸‹æœƒæœ‰å·²ç¶“é è¨­å¥½çš„UIæª”ä¾›ç·´ç¿’ç”¨ã€‚ ä½¿ç”¨Web3.jsåˆå§‹åŒ–å‰ç«¯ç’°å¢ƒWeb3.jsç‚ºç”¨ä¾†å’Œethereumæºé€šçš„javascript library.ï¼ˆè€Œç·´ç¿’å°ˆæ¡ˆå‰ç«¯æ˜¯ä½¿ç”¨jQuery) åœ¨ /src/js/app.jsæª”æ¡ˆçš„å…§å®¹æ”¹ç‚ºä»¥ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131App = &#123; web3Provider: null, contracts: &#123;&#125;, init: function() &#123; // è¼‰å…¥å¯µç‰©çš„è³‡æ–™ $.getJSON('../pets.json', function(data) &#123; var petsRow = $('#petsRow'); var petTemplate = $('#petTemplate'); for (i = 0; i &lt; data.length; i ++) &#123; petTemplate.find('.panel-title').text(data[i].name); petTemplate.find('img').attr('src', data[i].picture); petTemplate.find('.pet-breed').text(data[i].breed); petTemplate.find('.pet-age').text(data[i].age); petTemplate.find('.pet-location').text(data[i].location); petTemplate.find('.btn-adopt').attr('data-id', data[i].id); petsRow.append(petTemplate.html()); &#125; &#125;); return App.initWeb3(); &#125;, initWeb3: function() &#123; // åˆå§‹åŒ–web3.jsä¸¦ä¸”è¨­ç½®provideré€£æ¥testrpc // å¦‚æœåµæ¸¬åˆ°æœ‰metamaskæ³¨å…¥åœ¨ç€è¦½å™¨çš„web3 instance if (typeof web3 !== 'undefined') &#123; App.web3Provider = web3.currentProvider; // å°‡currentProvider = metamask // web3 = new Web3(web3.currentProvider); &#125; else &#123; // è‹¥æ²’æœ‰metamask or mistç­‰ç­‰ä¹‹é¡çš„ï¼Œ // é‚£å°±ç”¨è‡ªå·±é–‹å•Ÿtestrpcç•¶æˆæ˜¯provider App.web3Provider = new web3.providers.HttpProvider('http://localhost:8545'); web3 = new Web3(App.web3Provider); &#125; return App.initContract(); &#125;, initContract: function() &#123; $.getJSON('Adoption.json', function(data) &#123; // å–å¾—contractçš„artifact(Adoption.json) // ä¾‹å¦‚contract address, ABI (Application Binary Interface)ï¼š // å³å¦‚ä½•ä½¿ç”¨contractçš„è®Šæ•¸ã€å‡½å¼ç­‰ç­‰ var AdoptionArtifact = data; // truffleæä¾›`truffle-contract`ä¾†å¹«åŠ©æˆ‘å€‘ç›£è½å·²ç¶“è¢«migrateçš„contract // ä¸¦æŠŠcontractçš„artifactå‚³çµ¦truffle-contract'ï¼Œå¥½è®“æˆ‘å€‘å¯ä»¥è·Ÿåˆç´„æºé€š App.contracts.Adoption = TruffleContract(AdoptionArtifact); // ç‚ºcontractè¨­ç½®Provider(æˆ‘å€‘æ˜¯ç”¨metamask) App.contracts.Adoption.setProvider(App.web3Provider); // å¾Adpotion.jsonçš„åˆç´„è³‡æ–™ä¸­ï¼Œåˆ¤æ–·å¯µç‰©çš„æ˜¯å¦å·²è¢«èªé¤Šä¸¦åšæ¨™ç¤º return App.markAdopted(); &#125;); return App.bindEvents(); &#125;, bindEvents: function() &#123; $(document).on('click', '.btn-adopt', App.handleAdopt); &#125;, handleAdopt: function() &#123; event.preventDefault(); var petId = parseInt($(event.target).data('id')); var adoptionInstance; // ä½¿ç”¨web3ä¾†å–å¾—user's accounts // é€™æ™‚metamaskæœƒè·³å‡ºäº¤æ˜“è¨Šæ¯å‡ºä¾† web3.eth.getAccounts(function(error, accounts) &#123; if (error) &#123; console.log(error); &#125; // é¸æ“‡ç¬¬ä¸€å€‹accountsä½œç‚ºæˆ‘å€‘çš„ç”¨æˆ¶ var account = accounts[0]; App.contracts.Adoption.deployed().then(function(instance) &#123; adoptionInstance = instance; // åœ¨é€™è£¡è¦åŸ·è¡ŒæœƒèŠ±è²»gasçš„transaction // å–å¾—èªé¤Šç”¨æˆ¶çš„accountï¼Œä»¥åŠé»é¸æ¬²èªé¤Šçš„petId return adoptionInstance.adopt(petId, &#123;from: account&#125;); &#125;).then(function(result) &#123; // è‹¥å›å‚³çµæœæ­£å¸¸åŸ·è¡ŒmarkAdoptedåˆ·æ–°UIä¸Šå¯µç‰©èªé¤Šä¸­çš„ç‹€æ…‹ return App.markAdopted(); &#125;).catch(function(err) &#123; console.log(err.message); &#125;); &#125;); &#125;, markAdopted: function(adopters, account) &#123; var adoptionInstance; App.contracts.Adoption.deployed().then(function(instance) &#123; // å–å¾—Adpotionåˆç´„çš„å…§å®¹ adoptionInstance = instance; // å‘¼å«åˆç´„ä¸­çš„getAdoptersæ–¹æ³• // åˆ©ç”¨`call`å¯ä»¥ç›´æ¥è®€å–Blockchainä¸Šçš„è³‡æ–™ï¼Œä¸ç”¨èŠ±è²»ether(gas) return adoptionInstance.getAdopters.call(); &#125;).then(function(adopters) &#123; for (i = 0; i &lt; adopters.length; i++) &#123; if (adopters[i] !== '0x0000000000000000000000000000000000000000') &#123; $('.panel-pet').eq(i).find('button').text('Pending...').attr('disabled', true); &#125; &#125; &#125;).catch(function(err) &#123; console.log(err.message); &#125;); &#125;&#125;;$(function() &#123; $(window).load(function() &#123; App.init(); &#125;);&#125;); åœ¨Chromeä¸Šå’ŒDappäº’å‹•å®‰è£ metamaskçš„æ“´å……å¥—ä»¶ é•·é€™æ¨£ï¼š ç”±æ–¼æˆ‘å€‘è¦æ¸¬è©¦è‡ªå·±çš„Dappï¼Œé»é¸è©²åœ–å·¦ä¸Šè§’åˆ‡æ›åˆ°è‡ªå·±é–‹å•Ÿtestrpc:8545çš„ç§æœ‰éˆ å› ç‚ºæ˜¯åˆæ¬¡ç™»å…¥ï¼Œé»é¸I forgot my password å°‡ä¸€é–‹å§‹é–‹å•Ÿtestrpc ç”¢ç”Ÿçš„ Mnemonicï¼ˆæ•¸çµ„è®Šæ•¸åç¨±ï¼‰è²¼åˆ°wallet seed.Mnemonic:1spider level team helmet shaft clarify abuse recipe stem ankle angry fee (Warningï¼šä½ çš„testrpcç”¢ç”Ÿçš„Mnemonicè®Šæ•¸çµ„æœƒè·Ÿä¸Šé¢çš„ä¸ä¸€æ¨£) è¨­ç½®è‡ªå·±çš„æ–°å¯†ç¢¼ï¼Œç¢ºèªå¾Œé»é¸OK é€²å…¥å¾Œå°±æœƒçœ‹åˆ°è‡ªå·±çš„ç¬¬ä¸€ç­†accountè³‡è¨Šäº† è‹¥æœ‰é¡¯ç¤ºå¸³æˆ¶è¡¨ç¤ºæˆåŠŸèˆ‡testrpcé€£æ¥(åŸæœ¬testrpcæ˜¯é è¨­100 etherï¼Œé¡¯ç¤ºå‡ºä¾†ä¸æ˜¯100 etherçš„åŸå› æ˜¯å› ç‚ºéƒ¨ç½²åˆç´„åˆ°è‡ªå·±çš„private blockchainä¹Ÿéœ€è¦è²»ç”¨) å®‰è£å’Œè¨­ç½®lite-serverå•Ÿå‹•Dapplite-serverå·²ç¶“åŒ…å«åœ¨pet-shopçš„boxå…§ åœ¨ bs-config.jsonæª”æ¡ˆä¸­ 12345&#123; &quot;server&quot;: &#123; &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;] &#125;&#125; è©²è¨­ç½®å‘Šè¨´serverè¦åŸ·è¡Œçš„åŸºåº•ç›®éŒ„åœ¨å“ªã€‚ ./srcï¼šå‰ç«¯çš„å…§å®¹./build/contractsï¼šæ”¾ç½®åˆç´„çš„å…§å®¹ åœ¨scriptæª”ä¸­ 1234&quot;scripts&quot;: &#123; &quot;dev&quot;: &quot;lite-server&quot;, &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;&#125;, è¨­ç½® &quot;dev&quot; : lite-server&quot;æ–¹ä¾¿æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨terminalä¸‹åŸ·è¡Œ npm run dev ä¾†é‹è¡ŒDapp é‹è¡ŒæˆåŠŸå¾Œçš„æ¨£å­ è‹¥è¦é€²è¡Œèªé¤Šï¼šé»é¸ AdoptæŒ‰éˆ• é»é¸Sumitå¾Œå³å®Œæˆèªé¤Šçš„å‹•ä½œï¼Œä¸¦ä¸”æŠŠè©²èªé¤Šçš„è³‡è¨Šé€éåˆç´„æ›åˆ°testrpcçš„éˆä¸Šï¼Œä¸¦åœ¨è©²å¯µç‰©ä¸Šç‹€æ…‹æ”¹æˆ Pending... ï¼ˆå·²èªé¤Šï¼‰ å»¶ä¼¸ å°‡å‰ç«¯æ”¹æˆç”¨Vue.jså¯ä»¥è€ƒæ…®ç”¨ä»¥ä¸‹packageï¼š Vue-Truffle-Webpackhttps://github.com/wilfreddenton/vue-truffle-webpack é¡¯ç¤ºè©²éš»ç‹—è¢«å“ªä½ç”¨æˆ¶èªé¤Šèµ° æ”¹æˆè¦ä»˜è¶³å¤ çš„éŒ¢æ‰èƒ½èªé¤Šè©²éš»ç‹—","categories":[{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/categories/Solidity/"}],"tags":[{"name":"Ethereum","slug":"Ethereum","permalink":"http://a10000005588.github.io/tags/Ethereum/"},{"name":"Solidity","slug":"Solidity","permalink":"http://a10000005588.github.io/tags/Solidity/"},{"name":"Truffle","slug":"Truffle","permalink":"http://a10000005588.github.io/tags/Truffle/"}]},{"title":"åˆ©ç”¨Hexoä¾†è¨˜éŒ„è‡ªå·±çš„å­¸ç¿’ä¸¦ä½¿ç”¨Material-flowä¸»é¡Œ","slug":"How_To_Use_Hexo","date":"2017-09-05T14:58:47.000Z","updated":"2021-01-28T12:26:55.742Z","comments":true,"path":"2017/09/05/How_To_Use_Hexo/","link":"","permalink":"http://a10000005588.github.io/2017/09/05/How_To_Use_Hexo/","excerpt":"å¦‚æœè¦æ‰“é€ è‡ªå·±é¢¨æ ¼çš„Blogï¼Œé‚£å°±ä¸èƒ½éŒ¯éHexoHexoæ˜¯ä¸€å¥—é–‹æºçš„æ¶å€‹äººéƒ¨è½æ ¼çš„æ¡†æ¶ï¼Œ","text":"å¦‚æœè¦æ‰“é€ è‡ªå·±é¢¨æ ¼çš„Blogï¼Œé‚£å°±ä¸èƒ½éŒ¯éHexoHexoæ˜¯ä¸€å¥—é–‹æºçš„æ¶å€‹äººéƒ¨è½æ ¼çš„æ¡†æ¶ï¼Œ å…¶å„ªé»å¦‚ä¸‹ï¼š æ–‡ç« ä»¥markdownæ ¼å¼ç‚ºä¸»ã€‚ ä¸¦ä¸”èƒ½ä¸€éµéƒ¨ç½²åœ¨Githubï¼Œå…¬é–‹çµ¦å¤§å®¶çœ‹ã€‚ æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„template themeä¾†è£é£¾è‡ªå·±çš„Blog æˆ‘ç›®å‰é€™å€‹Blogçš„ä¸»é¡Œæ˜¯ä½¿ç”¨NextTå›‰ ä»¥ä¸‹æœƒè©³ç´°ä»‹ç´¹æ€éº¼ç”¨Hexoå¿«é€Ÿæ¶ç«™ Hexoæ¶è¨­æµç¨‹å®‰è£Hexo1npm install hexo-cli -g åˆå§‹åŒ–ä¸€å€‹Hexoå°ˆæ¡ˆï¼Œä¸¦ä¸”é‹è¡Œä¹‹1234567hexo init blogcd blognpm installhexo server// ä¹Ÿå¯ä»¥ç”¨ hexo s -p 8080 // æŒ‡å®šæ¬²é–‹å•Ÿçš„port numberç‚ºå¤šå°‘ å¯ä»¥çœ‹åˆ°æ–°å»ºç«‹å¥½çš„Blogé•·é€™æ¨£ (X) æ–°å¢ä¸€ç¯‡æ–‡ç« 1hexo new [layout] &lt;title&gt; [layout]æœ‰ä»¥ä¸‹å¹¾ç¨®(defaultç‚º post)ï¼š postï¼šå°±poä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« éƒ½æ”¾ç½®åœ¨ source/_postsä¸­ pageï¼šå»ºç«‹ç¨ç«‹çš„é é¢ï¼Œä¾‹å¦‚å»ºç«‹abouté é¢ draftï¼šç™¼ä½ˆä¸€ç¯‡è‰ç¨¿ï¼Œå¦‚æœè¦å…¬é–‹å‰‡ä¸‹ hexo publish [layout] &lt;title&gt;ï¼Œå°‡è‰ç¨¿ç§»å‹•åˆ° source/_posts ä½ˆç½²åˆ°è‡ªå·±çš„githubå®‰è£ hexo-deployer-git1npm install hexo-deployer-git --save ä¿®æ”¹ _config.yml12345deploy: type: git repo: &lt;repository url&gt; // å„²å­˜åº«ï¼ˆRepositoryï¼‰ç¶²å€ branch: [branch] // åˆ†æ”¯åç¨± message: [message] // è‡ªå®šæäº¤è¨Šæ¯ æ–°å¢å¥½æ–‡ç« å¾Œéœ€è¦ç”¢ç”Ÿéƒ¨ç½²ç”¨éœæ…‹æª”æ¡ˆåŸ·è¡Œï¼šhexo generate æœƒç”¢ç”Ÿpublicç›®éŒ„ åŸ·è¡Œ hexo deploy å³å¯ä¸€éµéƒ¨ç½²publicç›®éŒ„å…§å®¹åˆ°github.ioç¶²ç«™ä¸Š æ³¨æ„ï¼šgithubä¸Šçš„repoå‘½åè¦èˆ‡ä½ çš„å¸³è™Ÿä¸€æ¨£ï¼Œå¦å‰‡é‚„å¾—è™•ç†è·¯å¾‘å•é¡Œ è‹¥è¦ç›´æ¥æ–°å¢å¥½æ–‡ç« å¾Œéƒ¨ç½²ï¼šhexo generate --deploy ä¹‹å¾Œè‹¥è¦é‡æ–°åŸ·è¡Œhexo deployï¼Œè«‹å…ˆç”¨ hexo cleanæ¸…é™¤éœæ…‹é é¢ï¼Œç„¶å¾Œåœ¨åŸ·è¡Œdeploy. ä½¿ç”¨Material-flow ä¾†æ”¹é€ è‡ªå·±çš„Blogè©³æƒ…è«‹çœ‹Material-flow çš„Githubä¸Šæ–‡ä»¶ https://github.com/stkevintan/hexo-theme-material-flow ä¿®æ”¹è‡ªå·±çš„Descriptionåœ¨å¤§é ­è²¼ä¸‹æ–¹çš„æè¿°ï¼Œè‹¥è¦ä¿®æ”¹çš„è©±å¾—åˆ°ï¼š ./theme/material-flow/layout/_widget/about.ejsä¸­ä¿®æ”¹ï¼ å»¶ä¼¸è‹¥è¦å°è‡ªå·±Blogåšæ“´å……éƒ½å¯ä»¥å†åƒè€ƒHexoä»¥åŠNextTçš„å®˜æ–¹æ–‡æª” Hexoå®˜æ–¹é€£çµï¼šhttps://hexo.io/zh-tw/ å¦‚æœå°å…¶ä»–themeæœ‰èˆˆè¶£ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¶²ç«™ Hexoå®˜æ–¹ä¸»é¡Œï¼šhttps://hexo.io/zh-tw/docs/writing.htmlHexoä¸»é¡Œæ’åï¼šhttps://www.zhihu.com/question/24422335","categories":[{"name":"Note","slug":"Note","permalink":"http://a10000005588.github.io/categories/Note/"}],"tags":[{"name":"Note","slug":"Note","permalink":"http://a10000005588.github.io/tags/Note/"}]}]}